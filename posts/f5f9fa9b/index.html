<!DOCTYPE html>


<html lang="zh-CN">


<head>
  <meta charset="utf-8" />
    
  <meta name="description" content="K殿" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
    Docker |  K殿
  </title>
  <meta name="generator" content="hexo-theme-ayer">
  
  <link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/Khighness/Khighness.github.io/k.ico" />
  
  
<link rel="stylesheet" href="/dist/main.css">

  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css">

  
<link rel="stylesheet" href="/css/custom.css">

  
  
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

  
  

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'ParaK', 'auto');
ga('send', 'pageview');

</script>



  
<script>
var _hmt = _hmt || [];
(function() {
	var hm = document.createElement("script");
	hm.src = "https://hm.baidu.com/hm.js?ParaK";
	var s = document.getElementsByTagName("script")[0]; 
	s.parentNode.insertBefore(hm, s);
})();
</script>


  <!-- 封面标题闪烁 -->
  <link rel="stylesheet" href="/css/titleFlash.css">
  <!-- 浏览器搞笑标题 -->
<!--  <script type="text/javascript">
  //
  var OriginTitle = document.title;
  var titleTime;
  document.addEventListener('visibilitychange', function () {
      if (location.href != "https://www.xxxzhy.com/"){//主页不变
          if (document.hidden) {
              //$('[rel="icon"]').attr('href', "/funny.ico");
              document.title = '/(ㄒoㄒ)/你弄丢了XXXZhy';
              clearTimeout(titleTime);
          }else {
              //$('[rel="icon"]').attr('href', "/favicon.ico");
              document.title = '(ฅ>ω<*ฅ) 噫又好啦~' + OriginTitle;
              titleTime = setTimeout(function () {
                  document.title = OriginTitle;
              }, 2000);
          }
      }
  });
  </script> -->
  <!-- 百度自动推送 -->
  <script>
  (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();
  </script>
<link rel="alternate" href="/atom.xml" title="Khighness" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

</html>


<body>
  <div id="app">
    
      <canvas class="fireworks"></canvas>
      <style>
        .fireworks {
          position: fixed;
          left: 0;
          top: 0;
          z-index: 99999;
          pointer-events: none;
        }
      </style>
      
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-Docker"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  Docker
</h1>
 

    </header>
     
    <div class="article-meta">
      <a href="/posts/f5f9fa9b/" class="article-date">
  <time datetime="2020-12-01T16:00:00.000Z" itemprop="datePublished">2020-12-02</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/DevOps/">DevOps</a>
  </div>
  
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> 字数统计:</span>
            <span class="post-count">8.7k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> 阅读时长≈</span>
            <span class="post-count">44 分钟</span>
        </span>
    </span>
</div>
 
    </div>
      
    <div class="tocbot"></div>




  
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><center>
    <font face="Kristen ITC" color="#555555" size=3>💤 Khighness 💤</font><br>
</center>



<h2 id="📖概述"><a href="#📖概述" class="headerlink" title="📖概述"></a>📖概述</h2>

<blockquote>
<p>故事</p>
</blockquote>
<p>2010年，几个搞 IT 的年轻人，在美国旧金山成立了一家名叫 <code>dotCloud </code>的公司。<code>dotCloud </code>的平台即服务（Platform-as-a-Service）提供商。底层技术上，<code>dotCloud</code> 平台利用了<code>Linux</code>的 <code>LXC </code>容器技术。为了方便创建和管理这些容器，<code>dotCloud </code>基于 Google 公司推出的 <code>Go </code>语言开发了一套内部工具，之后被命名为 <code>Docker</code>。<code>Docker </code>就是这样诞生的。</p>
<p>2013年的后端技术领域已经太久没有出现让人振奋的东西了。当然<code>Docker</code>在发行之后也没用引起行业的关注。在开源之后才爆火。</p>
<p><code>Docker</code>定义容器技术标砖使得容器技术的落地变得十分简单，应用可以稳定便携的运行在容器中。</p>
<a id="more"></a>



<blockquote>
<p>特点</p>
</blockquote>
<ul>
<li><strong>更快速的应用交付和部署</strong></li>
<li><strong>更便捷的升级和扩缩容</strong></li>
<li><strong>更高效的计算资源利用</strong></li>
<li><strong>更简单的系统运维</strong></li>
</ul>
<blockquote>
<p>架构</p>
</blockquote>
<img src="/posts/f5f9fa9b/Docker%E6%9E%B6%E6%9E%84.jpg" class="" title="Docker">

<p><strong>镜像（image）：</strong> 相当于一个模板，可以通过这个模板来创建容器服务</p>
<p><strong>容器（container）：</strong> 独立运行一个或者一个组应用</p>
<p><strong>仓库（repository）：</strong> 存放镜像的地方</p>
<h2 id="🔨安装"><a href="#🔨安装" class="headerlink" title="🔨安装"></a>🔨安装</h2><blockquote>
<p>官方文档</p>
</blockquote>
<p>CentOS 7安装：<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/centos/">https://docs.docker.com/engine/install/centos/</a></p>
<blockquote>
<p>卸载旧版本</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell">$ sudo yum remove docker \
                  docker-client \
                  docker-client-latest \
                  docker-common \
                  docker-latest \
                  docker-latest-logrotate \
                  docker-logrotate \
                  docker-engine<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>设置存储库</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell">$ sudo yum install -y yum-utils<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p>更换镜像源</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell">$ sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p>更新YUM包</p>
<p>更新YUM索引</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell">$ sudo yum update
$ sudo yum makecache fast<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p>安装docker引擎和容器</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell">$ sudo yum install docker-ce docker-ce-cli containerd.io<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p>启动Docker并测试hello-world</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell">$ sudo systemctl start docker
$ sudo docker run hello-world<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p>卸载方式</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell">$ sudo yum remove docker-ce docker-ce-cli containerd.io
$ sudo rm -rf /var/lib/docker<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p>镜像加速</p>
</blockquote>
<p>1️⃣使用阿里镜像加速器</p>
<img src="/posts/f5f9fa9b/image-20201206122604398.png" class="" title="image-20201206122604398">

<p>2️⃣使用中科大或者网易镜像加速</p>
<pre class="line-numbers language-shell"><code class="language-shell"># 添加daemon.json
$ touch /etc/docker/daemon.json

# 写入内容并保存
# 科大源: https://docker.mirrors.ustc.edu.cn/
# 网易源：http://hub-mirror.c.163.com
&#123;
  "registry-mirrors": ["https://docker.mirrors.ustc.edu.cn/"]
&#125;

# 重启Dicker
$ sudo systemctl restart docker<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="🚀原理"><a href="#🚀原理" class="headerlink" title="🚀原理"></a>🚀原理</h2><blockquote>
<p>docker run的执行流程</p>
</blockquote>
<img src="Docker/image-20201203233730702.png" alt="image-20201203233730702" style="zoom:88%;" />

<blockquote>
<p>Docker的工作</p>
</blockquote>
<p>Docker是一个Client-Server结构的系统，Docker的守护进程运行在主机上。通过Socket从客户端访问。</p>
<p><strong>为什么Docker比VM快？</strong></p>
<img src="/posts/f5f9fa9b/image-20201204003500802.png" class="" title="image-20201204003500802">

<p>1、Docker有比虚拟机更少的抽象层。Docker不需要Hypervisor实现硬件资源虚拟化，运行在Docker容器上的程序直接使用的是实际物理机的硬件资源，因此在CPU、内存利用率上Docker将会在效率上有明显的优势。</p>
<p>2、Docker利用的是宿主机的内核，而不需要Guest OS。因此创建一个容器时，不需要和虚拟机一样重新加载一个操作系统内核。从而避免引寻、加载操作系统内核返回时耗时耗资源的过程，当新建一个虚拟机时，虚拟机软件需要加载Guest OS，返回新建过程是分钟级别的。而新建一个Docker容器只需要几秒钟。</p>
<p>3、Docker与VM相比：</p>
<ul>
<li>Docker灵活，VM笨重</li>
<li>Docker存储的镜像小，便于存储和传输，VM镜像庞大</li>
</ul>
<h2 id="🔰命令"><a href="#🔰命令" class="headerlink" title="🔰命令"></a>🔰命令</h2><blockquote>
<p>🌐官方文档</p>
</blockquote>
<p>Command-line reference：<a target="_blank" rel="noopener" href="https://docs.docker.com/reference/">https://docs.docker.com/reference/</a></p>
<img src="/posts/f5f9fa9b/image-20201204225734966.png" class="" title="image-20201204225734966">



<h3 id="1️⃣帮助命令"><a href="#1️⃣帮助命令" class="headerlink" title="1️⃣帮助命令"></a>1️⃣帮助命令</h3><pre class="line-numbers language-shell"><code class="language-shell">$ docker version    # 显示Docker版本信息
$ docker info       # 显示Docker系统信息
$ docker --help     # Docker命令帮助信息<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="2️⃣镜像命令"><a href="#2️⃣镜像命令" class="headerlink" title="2️⃣镜像命令"></a>2️⃣镜像命令</h3><blockquote>
<p>查看镜像</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell">$ docker images

# 可选项
-a, --all             # 列出所有镜像
    --digests         # 显示镜像的摘要信息
-q, --quiet           # 只显示镜像的ID

# 运行
[root@parak khighness]# docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
hello-world         latest              bf756fb1ae65        11 months ago       13.3kB
# 解释
REPOSITORY  镜像的仓库源
TAG         镜像的标签
IMAGE ID    镜像的ID
CREATED     镜像的创建时间
SIZE        镜像的大小<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>搜索镜像</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell">$ docker search <IMAGE>

# 可选项
--filter=STARS=1000 # 镜像的STARS大于1000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>下载镜像</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell">$ docker pull <IMAGE>
$ docker pull .io/library/mysql:latest

# 如果不写tag，默认就是最新的

# 指定版本下载
[root@parak khighness]# docker pull mysql:8.0.20
8.0.20: Pulling from library/mysql  # 分层下载
8559a31e96f4: Pull complete 
d51ce1c2e575: Pull complete 
c2344adc4858: Pull complete 
fcf3ceff18fc: Pull complete 
16da0c38dc5b: Pull complete 
b905d1797e97: Pull complete 
4b50d1c6b05c: Pull complete 
c75914a65ca2: Pull complete 
1ae8042bdd09: Pull complete 
453ac13c00a3: Pull complete 
9e680cd72f08: Pull complete 
a6b5dc864b6c: Pull complete 
Digest: sha256:8b7b328a7ff6de46ef96bcf83af048cb00a1c86282bfca0cb119c84568b4caf6
Status: Downloaded newer image for mysql:8.0.20
docker.io/library/mysql:8.0.20<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>删除镜像</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell"># 通过镜像ID删除
$ docker rmi -f <IMAGE ID> ...
# 删除所有镜像
$ docker rmi -f $(docker images -aq)0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="3️⃣容器命令"><a href="#3️⃣容器命令" class="headerlink" title="3️⃣容器命令"></a>3️⃣容器命令</h3><blockquote>
<p>下载一个CentOS镜像来测试学(套)习(娃)</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell">[root@parak khighness]# docker pull centos
Using default tag: latest
latest: Pulling from library/centos
3c72a8ed6814: Pull complete 
Digest: sha256:76d24f3ba3317fa945743bb3746fbaf3a0b752f10b10376960de01da70685fbd
Status: Downloaded newer image for centos:latest
docker.io/library/centos:latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>新建容器并启动</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell">$ docker run [可选参数] <IMAGE>

# 参数说明
--name="NAME"   容器名字，用于区分容器
-d              后台方式运行
-it             使用交互方式运行，进如容器查看内容
-p              指定容器端口  -p 8080:8080
    -p ip:主机端口:容器端口
    -p 主机端口:容器端口
    -p 容器端口

# 测试，启动并进入容器
[root@parak khighness]# docker run -it centos /bin/bash
[root@e4efa1c507b8 /]# ls
bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
# 从容器中退回主机
[root@e4efa1c507b8 /]# exit
exit
[root@parak khighness]# ls
公共  模板  视频  图片  文档  下载  音乐  桌面<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>查看容器</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell">$ docker ps  # 显示所有正在运行的容器
-a           # 显示所有正在运行的容器+历史运行过的容器
-n=?         # 显示最近创建的n个容器
-q           # 只显示容器的编号<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>退出容器</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell">$ exit        <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p>删除容器</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell">$ docker rm <Container ID/NAME>    # 删除指定的容器，不能删除只在运行的容器
$ docker rm -f $(docker ps -aq)    # 删除所有的容器
$ docker ps -a -q|xargs docker rm  # 删除所有的容器 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>容器操作</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell">$ docker start   <Container ID/NAME>  # 启动容器 
$ docker restart <Container ID/NAME>  # 重启容器
$ docker stop    <Container ID/NAME>  # 停止当前正在运行的容器
$ docker kill    <Container ID/NAME>  # 强制停止当前容器<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>查看日志</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell">$ docker logs -tf --tail <n> <Container ID/NAME> # 显示指定行数的日志<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p>查看容器中进程信息</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell">$ docker top <Container ID/NAME><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p>查看镜像的元数据</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell">$ docker inspect<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p>进入当前正在运行的容器</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell">$ docker exec -it <Container ID> bashShell  
# 进入容器后开启一个新的终端，可以在里面操作；
# exec之后不会终结当前容器进程

$ docker attach <Container ID>              
# 进入容器中正在执行的终端，不会启动新的进程
# exec之后终结当前容器进程<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>从容器拷贝新的东西到主机</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell"># 开启CentOS容器
[root@parak khighness]# docker start b9ace468ea7d
b9ace468ea7d
# 进入CentOS容器
[root@parak khighness]# docker attach b9ace468ea7d
# 创建文件夹和文件
[root@b9ace468ea7d /]# cd home/
[root@b9ace468ea7d home]# mkdir document 
[root@b9ace468ea7d home]# vi K1.java
# 退出容器
[root@b9ace468ea7d document]# exit
exit
# 将容器文件复制到主机上
[root@parak khighness]# docker cp b9ace468ea7d:/home/document/K1.java document/
[root@parak khighness]# cd document/
[root@parak document]# ll
总用量 4
-rw-r--r--. 1 root root 186 12月  5 11:33 K1.java<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="🔱练习"><a href="#🔱练习" class="headerlink" title="🔱练习"></a>🔱练习</h2><h3 id="🌠-安装Nginx"><a href="#🌠-安装Nginx" class="headerlink" title="🌠 安装Nginx"></a>🌠 安装Nginx</h3><pre class="line-numbers language-shell"><code class="language-shell"># 搜索镜像
[root@parak khighness]# docker search nginx
NAME                               DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED
nginx                              Official build of Nginx.                        14063               [OK]                
jwilder/nginx-proxy                Automated Nginx reverse proxy for docker con…   1912                                    [OK]
richarvey/nginx-php-fpm            Container running Nginx + PHP-FPM capable of…   795                                     [OK]
linuxserver/nginx                  An Nginx container, brought to you by LinuxS…   131                                     
jc21/nginx-proxy-manager           Docker container for managing Nginx proxy ho…   115                                     
tiangolo/nginx-rtmp                Docker image with Nginx using the nginx-rtmp…   105                                     [OK]
bitnami/nginx                      Bitnami nginx Docker Image                      90                                      [OK]
alfg/nginx-rtmp                    NGINX, nginx-rtmp-module and FFmpeg from sou…   80                                      [OK]
jlesage/nginx-proxy-manager        Docker container for Nginx Proxy Manager        72                                      [OK]
nginxdemos/hello                   NGINX webserver that serves a simple page co…   63                                      [OK]
nginx/nginx-ingress                NGINX Ingress Controller for Kubernetes         45                                      
privatebin/nginx-fpm-alpine        PrivateBin running on an Nginx, php-fpm & Al…   42                                      [OK]
nginxinc/nginx-unprivileged        Unprivileged NGINX Dockerfiles                  21                                      
schmunk42/nginx-redirect           A very simple container to redirect HTTP tra…   19                                      [OK]
nginx/nginx-prometheus-exporter    NGINX Prometheus Exporter                       15                                      
centos/nginx-112-centos7           Platform for running nginx 1.12 or building …   15                                      
staticfloat/nginx-certbot          Opinionated setup for automatic TLS certs lo…   14                                      [OK]
raulr/nginx-wordpress              Nginx front-end for the official wordpress:f…   13                                      [OK]
centos/nginx-18-centos7            Platform for running nginx 1.8 or building n…   13                                      
mailu/nginx                        Mailu nginx frontend                            8                                       [OK]
bitwarden/nginx                    The Bitwarden nginx web server acting as a r…   7                                       
flashspys/nginx-static             Super Lightweight Nginx Image                   7                                       [OK]
bitnami/nginx-ingress-controller   Bitnami Docker Image for NGINX Ingress Contr…   6                                       [OK]
wodby/nginx                        Generic nginx                                   1                                       [OK]
ansibleplaybookbundle/nginx-apb    An APB to deploy NGINX                          1                                       [OK]
# 下载镜像
[root@parak khighness]# docker pull nginx
Using default tag: latest
latest: Pulling from library/nginx
852e50cd189d: Pull complete 
571d7e852307: Pull complete 
addb10abd9cb: Pull complete 
d20aa7ccdb77: Pull complete 
8b03f1e11359: Pull complete 
Digest: sha256:6b1daa9462046581ac15be20277a7c75476283f969cb3a61c8725ec38d3b01c3
Status: Downloaded newer image for nginx:latest
docker.io/library/nginx:latest
# 查看镜像
[root@parak khighness]# docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
nginx               latest              bc9a0695f571        10 days ago         133MB
centos              latest              0d120b6ccaa8        3 months ago        215MB
mysql               8.0.20              be0dbf01a0f3        5 months ago        541MB
hello-world         latest              bf756fb1ae65        11 months ago       13.3kB
# 后台启动80端口nginx，对外开放3355端口
[root@parak khighness]# docker run -d --name nginx1 -p 3355:80 nginx 
b6072408f44cd78594f01c95bc63da6baf911f74d62bf232ec42c1cd8b08b4d0
[root@parak khighness]# docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES
b6072408f44c        nginx               "/docker-entrypoint.…"   6 seconds ago       Up 4 seconds        0.0.0.0:3355->80/tcp   nginx1
# 测试，可以用ip:3355在浏览器访问
[root@parak khighness]# curl localhost:3355
<!DOCTYPE html>
<html>
<head>
<title>Welcome to nginx!</title>
<style>
    body &#123;
        width: 35em;
        margin: 0 auto;
        font-family: Tahoma, Verdana, Arial, sans-serif;
    &#125;
</style>
</head>
<body>
<h1>Welcome to nginx!</h1>
<p>If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.</p>

<p>For online documentation and support please refer to
<a target="_blank" rel="noopener" href="http://nginx.org/">nginx.org</a>.<br/>
Commercial support is available at
<a target="_blank" rel="noopener" href="http://nginx.com/">nginx.com</a>.</p>

<p><em>Thank you for using nginx.</em></p>
</body>
</html><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="🌠-安装Tomcat"><a href="#🌠-安装Tomcat" class="headerlink" title="🌠 安装Tomcat"></a>🌠 安装Tomcat</h3><pre class="line-numbers language-shell"><code class="language-shell">[root@parak khighness]# docker pull tomcat:9.0
9.0: Pulling from library/tomcat
756975cb9c7e: Pull complete 
d77915b4e630: Pull complete 
5f37a0a41b6b: Pull complete 
96b2c1e36db5: Pull complete 
27a2d52b526e: Pull complete 
a867dba77389: Pull complete 
0939c055fb79: Pull complete 
0b0694ce0ae2: Pull complete 
81a5f8099e05: Pull complete 
c3d7917d545e: Pull complete 
Digest: sha256:a319b10d8729817c7ce0bcc2343a6f97711c7870395019340d96b6aafd6ccbea
Status: Downloaded newer image for tomcat:9.0
docker.io/library/tomcat:9.0

[root@parak khighness]# docker run -d -p 3355:8080 --name tomcat1 tomcat
48c7de09007af158b13a9bef1f2d2b77bed0c4bc2f93a4887eac427911118a9b
[root@parak khighness]# docker exec -it tomcat1 /bin/bash
root@48c7de09007a:/usr/local/tomcat# ls -al
total 128
drwxr-xr-x. 1 root root    30 Nov 19 06:16 .
drwxr-xr-x. 1 root root    20 Nov 19 06:12 ..
-rw-r--r--. 1 root root 18982 Nov 12 15:41 BUILDING.txt
-rw-r--r--. 1 root root  5409 Nov 12 15:41 CONTRIBUTING.md
-rw-r--r--. 1 root root 57092 Nov 12 15:41 LICENSE
-rw-r--r--. 1 root root  2333 Nov 12 15:41 NOTICE
-rw-r--r--. 1 root root  3257 Nov 12 15:41 README.md
-rw-r--r--. 1 root root  6898 Nov 12 15:41 RELEASE-NOTES
-rw-r--r--. 1 root root 16507 Nov 12 15:41 RUNNING.txt
drwxr-xr-x. 2 root root  4096 Nov 19 06:16 bin
drwxr-xr-x. 1 root root    22 Dec  5 13:15 conf
drwxr-xr-x. 2 root root  4096 Nov 19 06:16 lib
drwxrwxrwx. 1 root root   177 Dec  5 13:15 logs
drwxr-xr-x. 2 root root   134 Nov 19 06:16 native-jni-lib
drwxrwxrwx. 2 root root    30 Nov 19 06:16 temp
drwxr-xr-x. 2 root root     6 Nov 19 06:16 webapps
drwxr-xr-x. 7 root root    81 Nov 12 15:38 webapps.dist
drwxrwxrwx. 2 root root     6 Nov 12 15:35 work
# 可以发现webapps目录为空
root@48c7de09007a:/usr/local/tomcat# cd webapps
root@48c7de09007a:/usr/local/tomcat/webapps# ls -l
total 0

# 将webapps.list目录下的内容拷贝到webapps下，再用浏览器测试访问
root@48c7de09007a:/usr/local/tomcat/webapps# cd ..
root@48c7de09007a:/usr/local/tomcat# cd webapps.dist/
root@48c7de09007a:/usr/local/tomcat/webapps.dist# ls
ROOT  docs  examples  host-manager  manager
root@48c7de09007a:/usr/local/tomcat/webapps.dist# cd ..
root@48c7de09007a:/usr/local/tomcat# cp -r webapps.dist/* webapps/
root@48c7de09007a:/usr/local/tomcat# cd webapps
root@48c7de09007a:/usr/local/tomcat/webapps# ls
ROOT  docs  examples  host-manager  manager<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>测试访问 <a target="_blank" rel="noopener" href="http://192.168.117.155:3355/">http://192.168.117.155:3355/</a></p>
</blockquote>
<img src="/posts/f5f9fa9b/image-20201205214537503.png" class="" title="image-20201205214537503">



<h3 id="🌠安装es-kibana"><a href="#🌠安装es-kibana" class="headerlink" title="🌠安装es + kibana"></a>🌠安装es + kibana</h3><pre class="line-numbers language-shell"><code class="language-shell"># --net somenetwork 网络配置
$ docker run -d --name es1 -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node" elasticsearch:7.6.2
# 查看主机状态
$ doucker stats

# 下载并运行ES
[root@parak khighness]#  docker run -d --name es1 -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node" elasticsearch:7.6.2
Unable to find image 'elasticsearch:7.6.2' locally
7.6.2: Pulling from library/elasticsearch
ab5ef0e58194: Pull complete 
c4d1ca5c8a25: Pull complete 
941a3cc8e7b8: Pull complete 
43ec483d9618: Pull complete 
c486fd200684: Pull complete 
1b960df074b2: Pull complete 
1719d48d6823: Pull complete 
Digest: sha256:1b09dbd93085a1e7bca34830e77d2981521a7210e11f11eda997add1c12711fa
Status: Downloaded newer image for elasticsearch:7.6.2
51441d9abfb966c4baa0402ceb99e702f58ec68cd427710a2b8c8043983412e9
# 查看主机状态
[root@parak khighness]# docker stats
CONTAINER ID    NAME   CPU %   MEM USAGE/LIMIT  MEM %     NET I/O    BLOCK I/O      PIDS
51441d9abfb9    es1   42.74%  495.6MiB/972.4MiB 50.97%    656B/0B   4.76GB/629MB     46

# 停止es1
$ docker stop es1
# 删除es1
$ docker rm es1

# 限制内存，启动ES
$ docker run -d --name es1 -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node" -e ES_JAVA_OPTS="-Xms64m -Xmx512m" elasticsearch:7.6.2

# 重新启动es1
[root@parak khighness]# docker run -d --name es1 -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node" -e ES_JAVA_OPTS="-Xms64m -Xmx512m" elasticsearch:7.6.2
ca4494f52e5642d5992c49816b636b1858f2e2f5c1aaf38621c76001262e8e4d
# 再次查看状态
[root@parak khighness]# docker stats
CONTAINER ID    NAME   CPU %   MEM USAGE/LIMIT   MEM %     NET I/O   BLOCK I/O       PIDS
ca4494f52e56    es1    0.68%   357.5MiB/972.4MiB 36.77%    737B/0B   476MB/1.78MB     45
# 测试访问
[root@parak khighness]# curl localhost:9200
&#123;
  "name" : "ca4494f52e56",
  "cluster_name" : "docker-cluster",
  "cluster_uuid" : "aDKZlZW_T7Ss3Dr0CXZQlQ",
  "version" : &#123;
    "number" : "7.6.2",
    "build_flavor" : "default",
    "build_type" : "docker",
    "build_hash" : "ef48eb35cf30adf4db14086e8aabd07ef6fb113f",
    "build_date" : "2020-03-26T06:34:37.794943Z",
    "build_snapshot" : false,
    "lucene_version" : "8.4.0",
    "minimum_wire_compatibility_version" : "6.8.0",
    "minimum_index_compatibility_version" : "6.0.0-beta1"
  &#125;,
  "tagline" : "You Know, for Search"
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="📈可视化"><a href="#📈可视化" class="headerlink" title="📈可视化"></a>📈可视化</h2><p>Y1S1可视化面板的前端写的真好看，我爱了。</p>
<pre class="line-numbers language-shell"><code class="language-shell"># 安装运行
$ docker run -d -p 8088:9000 --name=pt --restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p>访问测试 <a target="_blank" rel="noopener" href="http://192.168.117.155:8088/">http://192.168.117.155:8088/</a></p>
</blockquote>
<img src="Docker/image-20201205232646075.png" alt="image-20201205232646075"  />

<img src="Docker/image-20201206105337297.png" alt="image-20201206105337297"  />





<h2 id="📑DockerFile"><a href="#📑DockerFile" class="headerlink" title="📑DockerFile"></a>📑DockerFile</h2><p>DockerFile就是用来构建docker镜像的构建文件-命令脚本。</p>
<blockquote>
<p>命令</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">命令</th>
<th align="center">描述</th>
<th align="center">理解</th>
</tr>
</thead>
<tbody><tr>
<td align="center">FROM</td>
<td align="center">指定基础镜像</td>
<td align="center">公司的父公司</td>
</tr>
<tr>
<td align="center">MAINTAINER</td>
<td align="center">指定维护者信息</td>
<td align="center">公司注册信息</td>
</tr>
<tr>
<td align="center">RUN</td>
<td align="center">把命令前面加上RUN即可</td>
<td align="center">公司注册流程</td>
</tr>
<tr>
<td align="center">ADD</td>
<td align="center">COPY文件，会自动解压</td>
<td align="center">公司注册资金</td>
</tr>
<tr>
<td align="center">WORKDIR</td>
<td align="center">设置当前工作目录</td>
<td align="center">公司大楼仓库</td>
</tr>
<tr>
<td align="center">VOLUMN</td>
<td align="center">挂载主机目录</td>
<td align="center">公司的主仓库</td>
</tr>
<tr>
<td align="center">EXPOSE</td>
<td align="center">指定对外端口</td>
<td align="center">公司开放大门</td>
</tr>
<tr>
<td align="center">RUN</td>
<td align="center">进程要一直运行下去</td>
<td align="center">公司永不倒闭</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="center">命令</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">CMD</td>
<td align="center">指定这容器启动的时候要运行的命令只有最后一个会生效，可被替代。</td>
</tr>
<tr>
<td align="center">ENTRYPOINT</td>
<td align="center">指定这个容器启动的时候要运行的命令，可以追加命令。</td>
</tr>
<tr>
<td align="center">ONBUILD</td>
<td align="center">当构建一个被继承DockerFile这就会运行ONBUILD指令。触发指令.</td>
</tr>
<tr>
<td align="center">COPY</td>
<td align="center">类似ADD，将文件拷贝到镜像中。</td>
</tr>
<tr>
<td align="center">ENV</td>
<td align="center">构建的时候设置环境变量。</td>
</tr>
</tbody></table>
<blockquote>
<p>实例1-测试</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell">[root@parak home]# mkdir volume
[root@parak home]# cd volume/
[root@parak volume]# vim dockerfile1
[root@parak volume]# cat dockerfile1 
FROM centos
VOLUME ["volume01","volume02"]
CMD echo "---end---"
CMD /bin/bash
[root@parak volume]# docker build -f /home/volume/dockerfile1 -t khighness/centos:1.0 .
Sending build context to Docker daemon  2.048kB
Step 1/4 : FROM centos
 ---> 0d120b6ccaa8
Step 2/4 : VOLUME ["volume01","volume02"]
 ---> Running in 79dc7b449286
Removing intermediate container 79dc7b449286
 ---> 9a6608557c9a
Step 3/4 : CMD echo "---end---"
 ---> Running in 8b8c40056f99
Removing intermediate container 8b8c40056f99
 ---> 2158b18dedff
Step 4/4 : CMD /bin/bash
 ---> Running in 9d76c3598d69
Removing intermediate container 9d76c3598d69
 ---> 240a84cdfbef
Successfully built 240a84cdfbef
Successfully tagged khighness/centos:1.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>实例2-构建自己的centos</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell"># 1、编写DockerFile文件
[root@parak dockerfile]# vim mydockerfile-centos
[root@parak dockerfile]# cat mydockerfile-centos 
FROM centos
MAINTAINER khighness<1823676372@qq.com>

ENV MYPATH /usr/local
WORKDIR $MYPATH 

RUN yum -y install vim
RUN yum -y install net-tools

EXPOSE 80

CMD echo $MYPATH
CMD echo "---end---"
CMD /bin/bash

# 2、通过DockerFile构建镜像
[root@parak dockerfile]# docker build -f mydockerfile-centos  -t mycentos:1.0 .
Sending build context to Docker daemon  2.048kB
Step 1/10 : FROM centos
 ---> 0d120b6ccaa8
Step 2/10 : MAINTAINER khighness<1823676372@qq.com>
 ---> Running in 024da1b1d4cc
Removing intermediate container 024da1b1d4cc
 ---> 6c9b636504d2
Step 3/10 : ENV MYPATH /usr/local
 ---> Running in 4046d4e257ac
Removing intermediate container 4046d4e257ac
 ---> a5710fdc760e
Step 4/10 : WORKDIR $MYPATH
 ---> Running in 252416d49e94
Removing intermediate container 252416d49e94
 ---> fdbae7da4ca4
Step 5/10 : RUN yum -y install vim
 ---> Running in 9eb786294022
CentOS-8 - AppStream                            288 kB/s | 6.2 MB     00:22    
CentOS-8 - Base                                 703 kB/s | 2.3 MB     00:03    
CentOS-8 - Extras                               1.3 kB/s | 8.1 kB     00:06    
Dependencies resolved.
================================================================================
 Package             Arch        Version                   Repository      Size
================================================================================
Installing:
 vim-enhanced        x86_64      2:8.0.1763-15.el8         AppStream      1.4 M
Installing dependencies:
 gpm-libs            x86_64      1.20.7-15.el8             AppStream       39 k
 vim-common          x86_64      2:8.0.1763-15.el8         AppStream      6.3 M
 vim-filesystem      noarch      2:8.0.1763-15.el8         AppStream       48 k
 which               x86_64      2.21-12.el8               BaseOS          49 k

Transaction Summary
================================================================================
Install  5 Packages

Total download size: 7.8 M
Installed size: 30 M
Downloading Packages:
(1/5): gpm-libs-1.20.7-15.el8.x86_64.rpm        340 kB/s |  39 kB     00:00    
(2/5): vim-filesystem-8.0.1763-15.el8.noarch.rp 664 kB/s |  48 kB     00:00    
(3/5): which-2.21-12.el8.x86_64.rpm             315 kB/s |  49 kB     00:00    
(4/5): vim-enhanced-8.0.1763-15.el8.x86_64.rpm  543 kB/s | 1.4 MB     00:02    
(5/5): vim-common-8.0.1763-15.el8.x86_64.rpm    387 kB/s | 6.3 MB     00:16    
--------------------------------------------------------------------------------
Total                                           448 kB/s | 7.8 MB     00:17     
warning: /var/cache/dnf/AppStream-02e86d1c976ab532/packages/gpm-libs-1.20.7-15.el8.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID 8483c65d: NOKEY
CentOS-8 - AppStream                            1.6 MB/s | 1.6 kB     00:00    
Importing GPG key 0x8483C65D:
 Userid     : "CentOS (CentOS Official Signing Key) <security@centos.org>"
 Fingerprint: 99DB 70FA E1D7 CE22 7FB6 4882 05B5 55B3 8483 C65D
 From       : /etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial
Key imported successfully
Running transaction check
Transaction check succeeded.
Running transaction test
Transaction test succeeded.
Running transaction
  Preparing        :                                                        1/1 
  Installing       : which-2.21-12.el8.x86_64                               1/5 
  Installing       : vim-filesystem-2:8.0.1763-15.el8.noarch                2/5 
  Installing       : vim-common-2:8.0.1763-15.el8.x86_64                    3/5 
  Installing       : gpm-libs-1.20.7-15.el8.x86_64                          4/5 
  Running scriptlet: gpm-libs-1.20.7-15.el8.x86_64                          4/5 
  Installing       : vim-enhanced-2:8.0.1763-15.el8.x86_64                  5/5 
  Running scriptlet: vim-enhanced-2:8.0.1763-15.el8.x86_64                  5/5 
  Running scriptlet: vim-common-2:8.0.1763-15.el8.x86_64                    5/5 
  Verifying        : gpm-libs-1.20.7-15.el8.x86_64                          1/5 
  Verifying        : vim-common-2:8.0.1763-15.el8.x86_64                    2/5 
  Verifying        : vim-enhanced-2:8.0.1763-15.el8.x86_64                  3/5 
  Verifying        : vim-filesystem-2:8.0.1763-15.el8.noarch                4/5 
  Verifying        : which-2.21-12.el8.x86_64                               5/5 

Installed:
  gpm-libs-1.20.7-15.el8.x86_64         vim-common-2:8.0.1763-15.el8.x86_64    
  vim-enhanced-2:8.0.1763-15.el8.x86_64 vim-filesystem-2:8.0.1763-15.el8.noarch
  which-2.21-12.el8.x86_64             

Complete!
Removing intermediate container 9eb786294022
 ---> 491907dac3e2
Step 6/10 : RUN yum -y install net-tools
 ---> Running in 3a13d71952e5
Last metadata expiration check: 0:00:24 ago on Mon Dec  7 11:45:38 2020.
Dependencies resolved.
================================================================================
 Package         Architecture Version                        Repository    Size
================================================================================
Installing:
 net-tools       x86_64       2.0-0.52.20160912git.el8       BaseOS       322 k

Transaction Summary
================================================================================
Install  1 Package

Total download size: 322 k
Installed size: 942 k
Downloading Packages:
net-tools-2.0-0.52.20160912git.el8.x86_64.rpm   1.0 MB/s | 322 kB     00:00    
--------------------------------------------------------------------------------
Total                                           141 kB/s | 322 kB     00:02     
Running transaction check
Transaction check succeeded.
Running transaction test
Transaction test succeeded.
Running transaction
  Preparing        :                                                        1/1 
  Installing       : net-tools-2.0-0.52.20160912git.el8.x86_64              1/1 
  Running scriptlet: net-tools-2.0-0.52.20160912git.el8.x86_64              1/1 
  Verifying        : net-tools-2.0-0.52.20160912git.el8.x86_64              1/1 

Installed:
  net-tools-2.0-0.52.20160912git.el8.x86_64                                     

Complete!
Removing intermediate container 3a13d71952e5
 ---> 0d095f331d4a
Step 7/10 : EXPOSE 80
 ---> Running in 66d8aceea20c
Removing intermediate container 66d8aceea20c
 ---> a86402c5f9b7
Step 8/10 : CMD echo $MYPATH
 ---> Running in b6af3ea8ff6a
Removing intermediate container b6af3ea8ff6a
 ---> 17533352607f
Step 9/10 : CMD echo "---end---"
 ---> Running in f015d24c9277
Removing intermediate container f015d24c9277
 ---> cf7d78851a04
Step 10/10 : CMD /bin/bash
 ---> Running in d0f70eaa39ec
Removing intermediate container d0f70eaa39ec
 ---> d59930f07e43
Successfully built d59930f07e43
Successfully tagged mycentos:1.0


# 3、测试运行，官方的centos镜像中是没有网络命令和VIM命令的，而自己构建的centos中已经有
[root@parak dockerfile]# docker run -it --name=mycen mycentos:1.0 
[root@43b0b7eb76d8 local]# pwd
/usr/local
[root@43b0b7eb76d8 local]# vim test
[root@43b0b7eb76d8 local]# cat test 
Khighness
[root@43b0b7eb76d8 local]# ifconfig
eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 172.17.0.4  netmask 255.255.0.0  broadcast 172.17.255.255
        ether 02:42:ac:11:00:04  txqueuelen 0  (Ethernet)
        RX packets 8  bytes 656 (656.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0    
[root@43b0b7eb76d8 local]# exit
exit

# 4、查看镜像的变更历史
[root@parak dockerfile]# docker history mycentos:1.0 
IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT
d59930f07e43        23 minutes ago      /bin/sh -c #(nop)  CMD ["/bin/sh" "-c" "/bin…   0B          
cf7d78851a04        23 minutes ago      /bin/sh -c #(nop)  CMD ["/bin/sh" "-c" "echo…   0B               
17533352607f        23 minutes ago      /bin/sh -c #(nop)  CMD ["/bin/sh" "-c" "echo…   0B                  
a86402c5f9b7        23 minutes ago      /bin/sh -c #(nop)  EXPOSE 80                    0B                  
0d095f331d4a        23 minutes ago      /bin/sh -c yum -y install net-tools             23.2MB              
491907dac3e2        23 minutes ago      /bin/sh -c yum -y install vim                   57.7MB              
fdbae7da4ca4        24 minutes ago      /bin/sh -c #(nop) WORKDIR /usr/local            0B                  
a5710fdc760e        24 minutes ago      /bin/sh -c #(nop)  ENV MYPATH=/usr/local        0B                  
6c9b636504d2        24 minutes ago      /bin/sh -c #(nop)  MAINTAINER khighness<1823…   0B                  
0d120b6ccaa8        3 months ago        /bin/sh -c #(nop)  CMD ["/bin/bash"]            0B                  
<missing>           3 months ago        /bin/sh -c #(nop)  LABEL org.label-schema.sc…   0B                  
<missing>           3 months ago        /bin/sh -c #(nop) ADD file:538afc0c5c964ce0d…   215MB         <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>CMD和ENTRYPOINT的区别</p>
</blockquote>
<p><strong>测试CMD</strong></p>
<pre class="line-numbers language-shell"><code class="language-shell"># 编写测试CMD的dockerfile
[root@parak dockerfile]# vim dockerfile-cmd-test1
# 内容就是一个CMD命令
[root@parak dockerfile]# cat dockerfile-cmd-test1 
FROM centos
CMD ["ls","-a"]
# 构建镜像
[root@parak dockerfile]# docker build -f dockerfile-cmd-test1 -t cmdtest .
Sending build context to Docker daemon  3.072kB
Step 1/2 : FROM centos
 ---> 0d120b6ccaa8
Step 2/2 : CMD ["ls","-a"]
 ---> Running in e4df49ad7ca4
Removing intermediate container e4df49ad7ca4
 ---> 4be395747805
Successfully built 4be395747805
Successfully tagged cmdtest:latest
# 运行镜像就相当于运行CMD命令：ls -a
[root@parak dockerfile]# docker run cmdtest
.
..
.dockerenv
bin
dev
etc
home
lib
lib64
lost+found
media
mnt
opt
proc
root
run
sbin
srv
sys
tmp
usr
var
# 追加命令-l，即ls -al
[root@parak dockerfile]# docker run cmdtest -l
docker: Error response from daemon: OCI runtime create failed: container_linux.go:349: starting container process caused "exec: \"-l\": executable file not found in $PATH": unknown.

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>测试ENTRYPOINT</strong></p>
<pre class="line-numbers language-shell"><code class="language-shell"># 编写测试ENTRYPOINT的dockerfile
[root@parak dockerfile]# vim dockerfile-entrypoint-test1
# 内容就是一个ENTRYPOINT命令
[root@parak dockerfile]# cat dockerfile-entrypoint-test1 
FROM centos
ENTRYPOINT ["ls", "-a"]
# 构建镜像
[root@parak dockerfile]# docker build -f dockerfile-entrypoint-test1 -t entrypointtest .
Sending build context to Docker daemon  4.096kB
Step 1/2 : FROM centos
 ---> 0d120b6ccaa8
Step 2/2 : ENTRYPOINT ["ls", "-a"]
 ---> Running in 0aa9b4c97293
Removing intermediate container 0aa9b4c97293
 ---> 472d86e826d8
Successfully built 472d86e826d8
Successfully tagged entrypointtest:latest
# 运行镜像
[root@parak dockerfile]# docker run entrypointtest
.
..
.dockerenv
bin
dev
etc
home
lib
lib64
lost+found
media
mnt
opt
proc
root
run
sbin
srv
sys
tmp
usr
var
# 追击命令-l，即ls -al
[root@parak dockerfile]# docker run entrypointtest -l
total 0
drwxr-xr-x.   1 root root   6 Dec  7 12:27 .
drwxr-xr-x.   1 root root   6 Dec  7 12:27 ..
-rwxr-xr-x.   1 root root   0 Dec  7 12:27 .dockerenv
lrwxrwxrwx.   1 root root   7 May 11  2019 bin -> usr/bin
drwxr-xr-x.   5 root root 340 Dec  7 12:27 dev
drwxr-xr-x.   1 root root  66 Dec  7 12:27 etc
drwxr-xr-x.   2 root root   6 May 11  2019 home
lrwxrwxrwx.   1 root root   7 May 11  2019 lib -> usr/lib
lrwxrwxrwx.   1 root root   9 May 11  2019 lib64 -> usr/lib64
drwx------.   2 root root   6 Aug  9 21:40 lost+found
drwxr-xr-x.   2 root root   6 May 11  2019 media
drwxr-xr-x.   2 root root   6 May 11  2019 mnt
drwxr-xr-x.   2 root root   6 May 11  2019 opt
dr-xr-xr-x. 259 root root   0 Dec  7 12:27 proc
dr-xr-x---.   2 root root 162 Aug  9 21:40 root
drwxr-xr-x.  11 root root 163 Aug  9 21:40 run
lrwxrwxrwx.   1 root root   8 May 11  2019 sbin -> usr/sbin
drwxr-xr-x.   2 root root   6 May 11  2019 srv
dr-xr-xr-x.  13 root root   0 Dec  6 08:24 sys
drwxrwxrwt.   7 root root 145 Aug  9 21:40 tmp
drwxr-xr-x.  12 root root 144 Aug  9 21:40 usr
drwxr-xr-x.  20 root root 262 Aug  9 21:40 var<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>实例3-构建自己的tomcat</p>
</blockquote>
<h2 id="🔍镜像"><a href="#🔍镜像" class="headerlink" title="🔍镜像"></a>🔍镜像</h2><blockquote>
<p>概念</p>
</blockquote>
<p>镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含运行某个软件所需的所有内容，包括代码、运行时、库、环境变量和配置文件。</p>
<blockquote>
<p>UnionFS(联合文件系统)</p>
</blockquote>
<p>UnionFS: 联合文件系统是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下(Unite several directions into a single virtual file system)。Union文件系统是Docker镜像的基础。镜像可以通过分层来进行继承，基于基础镜像(没有父镜像)，可以制作各种具体的应用镜像。</p>
<p>特性：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录。</p>
<blockquote>
<p>Docker镜像加载原理</p>
</blockquote>
<p>Docker的镜像实际上由一层一层的文件系统组成，这种层级的文件系统UnionFS。</p>
<p>bootfs(boot file system)主要包含bootloader和kernel，bootloader主要是引导加载kernel，Linux刚启动时会在家bootfs文件系统，在Docker镜像的最底层是bootfs。这一层与我们典型的Linux/Unix系统是一样的，包含boot加载器和内核。当boot加载完成之后整个内核就都在内存中了，此时内存和使用权已由bootfs转交给内核，此时系统也会卸载bootfs。</p>
<p>rootfs(root file system)，在bootfs之后。包含的就是典型Linux系统/dev，/proc，/bin，/etc等标准目录和文件。rootfs就是各种不同的操作系统发行版，比如Ubuntu、CentOS等等。</p>
<blockquote>
<p>commit镜像</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell">$ docker commit -m="<messahe>" -a="<author>" <Container ID/NAME> <Target>:<Tag>

# 例如，改装tomcat:9.0的镜像打包成自己的镜像k-tom:1.0
[root@parak khighness]# docker commit -a="Khighness" -m="Add web application" tom1 k-tom:1.0
sha256:fa4617c8771c81b890dc2a87c7be1d2b851c6ba92b053d0d1d8730b2006550c5
[root@parak khighness]# docker images
REPOSITORY            TAG                 IMAGE ID            CREATED             SIZE
k-tom                 1.0                 fa4617c8771c        26 seconds ago      654MB
nginx                 latest              bc9a0695f571        11 days ago         133MB
tomcat                9.0                 e0bd8b34b4ea        2 weeks ago         649MB
redis                 latest              74d107221092        2 weeks ago         104MB
portainer/portainer   latest              62771b0b9b09        4 months ago        79.1MB
elasticsearch         7.6.2               f29a1ee41030        8 months ago        791MB
hello-world           latest              bf756fb1ae65        11 months ago       13.3kB<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="🌀容器数据卷"><a href="#🌀容器数据卷" class="headerlink" title="🌀容器数据卷"></a>🌀容器数据卷</h2><blockquote>
<p>概念</p>
</blockquote>
<p>目录挂载，将容器内的目录挂载在CentOS上</p>
<ul>
<li>Docker容器产生的数据同步到宿主机</li>
<li>数据卷可以在容器之间共享或重用数据</li>
</ul>
<blockquote>
<p>命令行挂载</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell">$ docker run -it -v -p <主机目录>:<容器目录> 

# 例如，将docker的centos容器目录/home/test与宿主centos的/home/test挂载起来
[root@parak khighness]# docker run -it --name=cen -v /home/test:/home/test centos  /bin/bash
Unable to find image 'centos:latest' locally
latest: Pulling from library/centos
3c72a8ed6814: Pull complete 
Digest: sha256:76d24f3ba3317fa945743bb3746fbaf3a0b752f10b10376960de01da70685fbd
Status: Downloaded newer image for centos:latest
[root@4410a5c86528 /]# ls
bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
[root@4410a5c86528 /]# cd home/
[root@4410a5c86528 home]# ls
test
[khighness@parak ~]$ cd /home/
[khighness@parak home]$ ls
khighness  test
[root@parak home]# docker inspect cen
# 如下是挂载信息
        "Mounts": [
            &#123;
                "Type": "bind",              # 类型：绑定
                "Source": "/home/test",      # 容器目录
                "Destination": "/home/test", # 主机目录
                "Mode": "",
                "RW": true,
                "Propagation": "rprivate"
            &#125;
        ]
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在容器的挂载目录下新建K1.java，在宿主机的挂载目录中可以直接看到</p>
<img src="/posts/f5f9fa9b/image-20201206183841366.png" class="" title="image-20201206183841366">



<blockquote>
<p>安装MySQL</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell"># 下载8.0.20版本的mysql镜像
$ docker pull mysql:8.0.20
# 启动mysql服务
# -d 后台运行
# -v 挂载配置和数据
# -e MYSQL_ROOT)PASSWORD 设置密码
$ docker run --name ksql -d -p 3306:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=KAG1823 mysql:8.0.20

# 解决windows的navicat无法连接的问题
# 进入mysql客户端
$ docker exec -it ksql  bash
# 登录mysql
$ mysql -u root -pKAG1823
# 重置密码
$ ALTER USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY 'KAG1823';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="🌐Docker网络"><a href="#🌐Docker网络" class="headerlink" title="🌐Docker网络"></a>🌐Docker网络</h2><blockquote>
<p>实现原理</p>
</blockquote>
<p>Docker使用Linux桥接，在宿主机虚拟一个Docker容器网桥(Docker0)，Docker启动一个容器时会根据Docker网桥的网段分配给容器一个IP地址，称为Container-IP，同时Docker网桥是每个容器的默认网关。因为在同一宿主机内的容器都接入同一网桥。这样容器之间就能够通过容器的Contain-IP直接通信。</p>
<p>Docker网桥是宿主机虚拟出来的，并不是真实存在的网络设备，外部设备是无法寻址到的，这也意味着外部设备无法通过直接Container-IP访问到容器。如果容器希望外部访问到，可以通过映射容器端口到宿主主机（端口映射），即docker run创建容器时候通过-p或者-P参数来启动，访问容器的时候就通过[宿主机IP]:[容器端口]访问容器。</p>
<blockquote>
<p>网络模式</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">模式</th>
<th align="center">配置</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Bridge模式</td>
<td align="center">-net=bridge</td>
<td align="center">默认模式</td>
</tr>
<tr>
<td align="center">Host模式</td>
<td align="center">-net=host</td>
<td align="center">容器和宿主机共享Network NameSpace</td>
</tr>
<tr>
<td align="center">Container模式</td>
<td align="center">-net=container : NAME OR ID</td>
<td align="center">容器和另外一个容器共享Network NameSpace</td>
</tr>
<tr>
<td align="center">None模式</td>
<td align="center">-net=none</td>
<td align="center">容器有独立的Network NameSpace，但并没有对其进行任何网络设置，如分配veth pair 和网桥连接，配置IP等</td>
</tr>
</tbody></table>
<h3 id="1️⃣host模式"><a href="#1️⃣host模式" class="headerlink" title="1️⃣host模式"></a>1️⃣host模式</h3><p>如果启动容器的时候使用host模式，那么这个容器将不会获得一个独立的Network NameSpace，而是和宿主机共用一个Network NameSpace。容器将不会虚拟出自己的网卡，配置自己的IP等，而是使用宿主机的IP和端口。但是，容器的其他方面，如文件系统、进程列表等还是和宿主机隔离的。</p>
<p>使用host模式的容器可以直接使用宿主机的IP地址与外界通信，容器内部的服务端口也可以使用宿主机的端口，不需要进行NAT，host最大的优势就是网络性能比较好，但是docker host上已经使用的端口就不能再用了，网络的隔离性不好。</p>
<h3 id="2️⃣container模式"><a href="#2️⃣container模式" class="headerlink" title="2️⃣container模式"></a>2️⃣container模式</h3><p>这个模式指定新创建的容器和已经存在的一个容器共享一个 Network NameSpace，而不是和宿主机共享。新创建的容器不会创建自己的网卡，配置自己的 IP，而是和一个指定的容器共享 IP、端口范围等。同样，两个容器除了网络方面，其他的如文件系统、进程列表等还是隔离的。两个容器的进程可以通过 lo 网卡设备通信。</p>
<h3 id="3️⃣none模式"><a href="#3️⃣none模式" class="headerlink" title="3️⃣none模式"></a>3️⃣none模式</h3><p>使用none模式，Docker容器拥有自己的Network NameSpace，但是，并不为Docker容器进行任何网络配置。也就是说，这个Docker容器没有网卡、IP、路由等信息。需要我们自己为Docker容器添加网卡、配置IP等。</p>
<p>这种网络模式下容器只有lo回环网络，没有其他网卡。none模式可以在容器创建时通过–network=none来指定。这种类型的网络没有办法联网，封闭的网络能很好的保证容器的安全性。</p>
<h3 id="4️⃣bridge模式"><a href="#4️⃣bridge模式" class="headerlink" title="4️⃣bridge模式"></a>4️⃣bridge模式</h3><p>当Docker进程启动时，会在主机上创建一个名为docker0的虚拟网桥，此主机上启动的Docker容器会连接到这个虚拟网桥上。虚拟网桥的工作方式和物理交换机类似，这样主机上的所有容器就通过交换机连在了一个二层网络中。</p>
<p>从docker0子网中分配一个IP给容器使用，并设置docker0的IP地址为容器的默认网关。在主机上创建一对虚拟网卡veth pair设备，Docker将veth pair设备的一端放在新创建的容器中，并命名为eth0（容器的网卡），另一端放在主机中，以vethxxx这样类似的名字命名，并将这个网络设备加入到docker0网桥中。可以通过brctl show命令查看。</p>
<p>bridge模式是docker的默认网络模式，不写–net参数，就是bridge模式。使用docker run -p时，docker实际是在iptables做了DNAT规则，实现端口转发功能。可以使用iptables -t nat -vnL查看。</p>
<blockquote>
<p>–link探究</p>
</blockquote>
<p>官方已经不推荐使用，我们可以了解一下。</p>
<p>2个容器之间互相访问通信：<code>docker run &lt;container1-id/name&gt; --link &lt;container2-id/name&gt; &lt;image&gt;</code></p>
<p>使用这个命令启动容器2的时候，容器便可以ping通容器1，但是反向ping不通。</p>
<pre class="line-numbers language-shell"><code class="language-shell"># 创建容器tom1
[root@parak khighness]# docker run -d -p 3356:8080 --name tom1 tomcat:9.0 
dd615d6d2ccb9467aad8ba008ece995588680d849b9f61945b10de5c3475f671
# 使用--link创建容器2
[root@parak khighness]# docker run -d -p 3357:8081 --name tom2 --link tom1  tomcat:9.0 
b2c17969a2cb4407bb1a61a53703a38998a11db01ce516feb70e397b42af6ad3
# tom1不能ping通tom2
[root@parak khighness]# docker exec -it tom1 ping tom2
ping: tom2: Name or service not known
# tom2可以ping通tom1
[root@parak khighness]# docker exec -it tom2 ping tom1
PING tom1 (172.17.0.4) 56(84) bytes of data.
64 bytes from tom1 (172.17.0.4): icmp_seq=1 ttl=64 time=0.161 ms
64 bytes from tom1 (172.17.0.4): icmp_seq=2 ttl=64 time=0.108 ms
64 bytes from tom1 (172.17.0.4): icmp_seq=3 ttl=64 time=0.122 ms
^C
--- tom1 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 4ms
rtt min/avg/max/mdev = 0.108/0.130/0.161/0.024 ms
# 查看tom2内部的hosts文件
[root@parak khighness]# docker exec -it tom2 cat /etc/hosts
127.0.0.1    localhost
::1    localhost ip6-localhost ip6-loopback
fe00::0    ip6-localnet
ff00::0    ip6-mcastprefix
ff02::1    ip6-allnodes
ff02::2    ip6-allrouters
172.17.0.4    tom1 dd615d6d2ccb # ==> 根源：本质就是tom2就是在本地配置了tom1的域名IP解析。
172.17.0.5    b2c17969a2cb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>自定义网络</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell"># 创建网络
[root@parak khighness]# docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet
abaebdc493149a140ee77965274885adea3882bf117c4f8e61e4034730c3b890
# 查看网络
[root@parak khighness]# docker network ls
NETWORK ID          NAME                DRIVER              SCOPE
4399361ba4a9        bridge              bridge              local
65f0ec2bfb42        host                host                local
abaebdc49314        mynet               bridge              local
feab1dfce431        none                null                local
# 详细信息
[root@parak khighness]# docker network inspect mynet 
[
    &#123;
        "Name": "mynet",
        "Id": "abaebdc493149a140ee77965274885adea3882bf117c4f8e61e4034730c3b890",
        "Created": "2020-12-10T16:12:08.563828418+08:00",
        "Scope": "local",
        "Driver": "bridge",
        "EnableIPv6": false,
        "IPAM": &#123;
            "Driver": "default",
            "Options": &#123;&#125;,
            "Config": [
                &#123;
                    "Subnet": "192.168.0.0/16",
                    "Gateway": "192.168.0.1"
                &#125;
            ]
        &#125;,
        "Internal": false,
        "Attachable": false,
        "Ingress": false,
        "ConfigFrom": &#123;
            "Network": ""
        &#125;,
        "ConfigOnly": false,
        "Containers": &#123;&#125;,
        "Options": &#123;&#125;,
        "Labels": &#123;&#125;
    &#125;
]
# 在mynet下启动tomcat1
[root@parak khighness]# docker run -d -it -p 8080:3355 --net mynet --name mynet-tom1 tomcat:9.0 
4d799757f01f560af7fd44d610b7fdabd1e0f66ef528bf1259f09242bddbb636
# 在mynet下启动tomcat2
[root@parak khighness]# docker run -d -it -p 8081:3356 --net mynet --name mynet-tom2 tomcat:9.0 
15c045f96d5b7b2ee2e470cb69e5b1f86511929f7ed05ed8f20db26ef4b975af
# 使用mynet-tom2 ping mynet-tom1
[root@parak khighness]# docker exec -it mynet-tom2 ping mynet-tom1
PING mynet-tom1 (192.168.0.2) 56(84) bytes of data.
64 bytes from mynet-tom1.mynet (192.168.0.2): icmp_seq=1 ttl=64 time=0.068 ms
64 bytes from mynet-tom1.mynet (192.168.0.2): icmp_seq=2 ttl=64 time=0.042 ms
64 bytes from mynet-tom1.mynet (192.168.0.2): icmp_seq=3 ttl=64 time=0.055 ms
--- mynet-tom1 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 4ms
rtt min/avg/max/mdev = 0.042/0.055/0.068/0.010 ms
# 使用mynet-tom1 ping mynet-tom2
[root@parak khighness]# docker exec -it mynet-tom1 ping mynet-tom2
PING mynet-tom2 (192.168.0.3) 56(84) bytes of data.
64 bytes from mynet-tom2.mynet (192.168.0.3): icmp_seq=1 ttl=64 time=0.036 ms
64 bytes from mynet-tom2.mynet (192.168.0.3): icmp_seq=2 ttl=64 time=0.048 ms
64 bytes from mynet-tom2.mynet (192.168.0.3): icmp_seq=3 ttl=64 time=0.058 ms
--- mynet-tom2 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2ms
rtt min/avg/max/mdev = 0.036/0.047/0.058/0.010 ms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>自定义网络自动维护好容器的网络关系！</p>
<blockquote>
<p>网络连通</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell"># 在Docker0网络启动tomcat
[root@parak khighness]# docker run -d -it -p 8082:3357 --name tom1 tomcat:9.0 
0344f04baab2eaeaac0118dac7a93d8b2d77946636c76ed3bde804cbeda836be
# 测试tom1 ping mynet—tom1
[root@parak khighness]# docker exec tom1 ping mynet-tom1
ping: mynet-tom1: Name or service not known
# 连通mynet - tom1
[root@parak khighness]# docker network connect mynet tom1 
# 查看mynet1的详细信息
[root@parak khighness]# docker inspect mynet
[
    &#123;
        "Name": "mynet",
        "Id": "abaebdc493149a140ee77965274885adea3882bf117c4f8e61e4034730c3b890",
        "Created": "2020-12-10T16:12:08.563828418+08:00",
        "Scope": "local",
        "Driver": "bridge",
        "EnableIPv6": false,
        "IPAM": &#123;
            "Driver": "default",
            "Options": &#123;&#125;,
            "Config": [
                &#123;
                    "Subnet": "192.168.0.0/16",
                    "Gateway": "192.168.0.1"
                &#125;
            ]
        &#125;,
        "Internal": false,
        "Attachable": false,
        "Ingress": false,
        "ConfigFrom": &#123;
            "Network": ""
        &#125;,
        "ConfigOnly": false,
        "Containers": &#123;
            # 发现mynet将tom1放到了mynet网络下，即一个容器，两个IP
            "0344f04baab2eaeaac0118dac7a93d8b2d77946636c76ed3bde804cbeda836be": &#123;
                "Name": "tom1",
                "EndpointID": "8911ad05a9b0d7d0effbf50c82659f36b82d21e18f992359b09494073dddd969",
                "MacAddress": "02:42:c0:a8:00:04",
                "IPv4Address": "192.168.0.4/16",
                "IPv6Address": ""
            &#125;,
            "15c045f96d5b7b2ee2e470cb69e5b1f86511929f7ed05ed8f20db26ef4b975af": &#123;
                "Name": "mynet-tom2",
                "EndpointID": "907f16284e90be0d880a999b29210d1cd82adb2c79b4179eeb1d70d75130362a",
                "MacAddress": "02:42:c0:a8:00:03",
                "IPv4Address": "192.168.0.3/16",
                "IPv6Address": ""
            &#125;,
            "4d799757f01f560af7fd44d610b7fdabd1e0f66ef528bf1259f09242bddbb636": &#123;
                "Name": "mynet-tom1",
                "EndpointID": "6529ef4fc05dffe65fe875fdf15f2f4a61665c4d969767db94dd828baf88b323",
                "MacAddress": "02:42:c0:a8:00:02",
                "IPv4Address": "192.168.0.2/16",
                "IPv6Address": ""
            &#125;
        &#125;,
        "Options": &#123;&#125;,
        "Labels": &#123;&#125;
    &#125;
]
# 再次测试tom1 ping mynet—tom1
[root@parak khighness]# docker exec -it tom1 ping mynet-tom1
PING mynet-tom1 (192.168.0.2) 56(84) bytes of data.
64 bytes from mynet-tom1.mynet (192.168.0.2): icmp_seq=1 ttl=64 time=0.097 ms
64 bytes from mynet-tom1.mynet (192.168.0.2): icmp_seq=2 ttl=64 time=0.052 ms
64 bytes from mynet-tom1.mynet (192.168.0.2): icmp_seq=3 ttl=64 time=0.053 ms
--- mynet-tom1 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 3ms
rtt min/avg/max/mdev = 0.052/0.067/0.097/0.022 ms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="💠Redis集群部署"><a href="#💠Redis集群部署" class="headerlink" title="💠Redis集群部署"></a>💠Redis集群部署</h2><blockquote>
<p>shell脚本</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell"># 创建网卡
docker network create redis --subnet 172.38.0.0/16

# 通过脚本创建六个redis配置
for port in $(seq 1 6); \
do \
mkdir -p /mydata/redis/node-$&#123;port&#125;/conf
touch /mydata/redis/node-$&#123;port&#125;/conf/redis.conf
cat << EOF >>/mydata/redis/node-$&#123;port&#125;/conf/redis.conf
port 6379
bind 0.0.0.0
cluster-enabled yes
cluster-config-file nodes.conf
cluster-node-timeout 5000
cluster-announce-ip 172.38.0.1$&#123;port&#125;
cluster-announce-port 6379
cluster-announce-bus-port 16379
appendonly yes
EOF
done

# 运行redis
for port in $(seq 1 6); \
do
docker run -p 637$&#123;port&#125;:6379 -p 1637$&#123;port&#125;:16379 --name redis-$&#123;port&#125; \
-v /mydata/redis/node-$&#123;port&#125;/data:/data \
-v /mydata/redis/node-$&#123;port&#125;/conf/redis.conf:/etc/redis/redis.conf \
-d --net redis --ip 172.38.0.1$&#123;port&#125; redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf
done

# 进入redis-1
docker exec -it redis-1 /bin/sh
# 搭建集群
redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379 

# 停止集群
for port in $(seq 1 6); \
do
docker stop redis-$&#123;port&#125; 
done

# 启动集群
for port in $(seq 1 6); \
do 
docker start redis-$&#123;port&#125; 
done<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="💨SpringBoot测试"><a href="#💨SpringBoot测试" class="headerlink" title="💨SpringBoot测试"></a>💨SpringBoot测试</h2><blockquote>
<p>步骤</p>
</blockquote>
<ul>
<li>构建SpringBoot项目</li>
<li>打包web应用</li>
<li>编写dockerfile</li>
<li>构建镜像</li>
<li>发布运行</li>
</ul>
<blockquote>
<p>编写Controller</p>
</blockquote>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/hello/&amp;#123;name&amp;#125;"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> String <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span> String name<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"Hello, "</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">"\n\n"</span> <span class="token operator">+</span> <span class="token string">" -from KHighness"</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>通过maven的package打包</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell">[INFO] Scanning for projects...
[INFO] 
[INFO] --------------------------< top.parak:hello >---------------------------
[INFO] Building hello 1.0-SNAPSHOT
[INFO] --------------------------------[ jar ]---------------------------------
[INFO] --- maven-resources-plugin:3.1.0:resources (default-resources) @ hello ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] Copying 0 resource
[INFO] Copying 0 resource
[INFO] --- maven-compiler-plugin:3.8.1:compile (default-compile) @ hello ---
[INFO] Changes detected - recompiling the module!
[INFO] Compiling 2 source files to C:\Users\18236\Desktop\Recent\hello\target\classes
[INFO] --- maven-resources-plugin:3.1.0:testResources (default-testResources) @ hello ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] skip non existing resourceDirectory C:\Users\18236\Desktop\Recent\hello\src\test\resources
[INFO] --- maven-compiler-plugin:3.8.1:testCompile (default-testCompile) @ hello ---
[INFO] No sources to compile
[INFO] --- maven-surefire-plugin:2.22.2:test (default-test) @ hello ---
[INFO] No tests to run.
[INFO] --- maven-jar-plugin:3.1.2:jar (default-jar) @ hello ---
[INFO] Building jar: C:\Users\18236\Desktop\Recent\hello\target\hello-1.0-SNAPSHOT.jar
[INFO] --- spring-boot-maven-plugin:2.2.5.RELEASE:repackage (repackage) @ hello ---
[INFO] Replacing main artifact with repackaged archive
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  5.534 s
[INFO] Finished at: 2020-12-10T17:54:11+08:00
[INFO] ------------------------------------------------------------------------<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>编写Dockerfile</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell">FROM java:8

COPY *.jar /app.jar

CMD ["--server.port=8080"]

EXPOSE 8080

ENTRYPOINT ["java", "-jar", "/app.jar"]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>通过Xftp将构建好的jar包和DockerFile发送到虚拟机</p>
<blockquote>
<p>构建镜像</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell">[root@parak hello]# docker build -t hello .
Sending build context to Docker daemon   17.6MB
Step 1/5 : FROM java:8
 ---> d23bdf5b1b1b
Step 2/5 : COPY *.jar /app.jar
 ---> 34774df7a107
Step 3/5 : CMD ["--server.port=8080"]
 ---> [Warning] IPv4 forwarding is disabled. Networking will not work.
 ---> Running in 11d95474e047
Removing intermediate container 11d95474e047
 ---> e8b6fa21a3a0
Step 4/5 : EXPOSE 8080
 ---> [Warning] IPv4 forwarding is disabled. Networking will not work.
 ---> Running in 896cc7d50875
Removing intermediate container 896cc7d50875
 ---> b139242b232d
Step 5/5 : ENTRYPOINT ["java", "-jar", "/app.jar"]
 ---> [Warning] IPv4 forwarding is disabled. Networking will not work.
 ---> Running in 562f3bb605a0
Removing intermediate container 562f3bb605a0
 ---> 1d28463205d5
Successfully built 1d28463205d5
Successfully tagged hello:latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>运行镜像</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell">[root@parak hello]# docker run -d -it -p 8001:8080 hello
7e19b364789de18c736c51e5c84d611e7474d3a733f188220dfd7cc011e55729
[root@parak hello]# curl http://192.168.117.155:8001/hello/KKK
Hello, KKK

 -from KHighness<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="⭕相关问题"><a href="#⭕相关问题" class="headerlink" title="⭕相关问题"></a>⭕相关问题</h2><blockquote>
<p>解决问题1: WARNING: IPv4 forwarding is disabled. Networking will not work.</p>
</blockquote>
<pre class="line-numbers language-shell"><code class="language-shell">$ echo "net.ipv4.ip_forward=1" >>/usr/lib/sysctl.d/00-system.conf
$ systemctl restart network && systemctl restart docker<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p>解决问题2: 使用阿里云服务器运行一个容器，外部IP不能访问</p>
</blockquote>
<p>需要在阿里云服务器配置防火墙相关端口对外开放。</p>
<p>比如跑一个开放端口为3333的springboot应用需要在阿里云服务器控制台的防火墙添加规则:</p>
<img src="/posts/f5f9fa9b/image-20201211233834182.png" class="" title="image-20201211233834182">



 
      <!-- reward -->
      
      <div id="reword-out">
        <div id="reward-btn">
          打赏
        </div>
      </div>
      
    </div>
    

    <!-- copyright -->
    
    <div class="declare">
      <ul class="post-copyright">
        <li>
          <i class="ri-copyright-line"></i>
          <strong>版权声明： </strong>
          
          本博客所有文章除特别声明外，著作权归作者所有。转载请注明出处！
          
        </li>
      </ul>
    </div>
    
    <footer class="article-footer">
       
<div class="share-btn">
      <span class="share-sns share-outer">
        <i class="ri-share-forward-line"></i>
        分享
      </span>
      <div class="share-wrap">
        <i class="arrow"></i>
        <div class="share-icons">
          
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="ri-weibo-fill"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="ri-wechat-fill"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="ri-qq-fill"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="ri-douban-line"></i>
          </a>
          <!-- <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a> -->
          
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="ri-facebook-circle-fill"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="ri-twitter-fill"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="ri-google-fill"></i>
          </a>
        </div>
      </div>
</div>

<div class="wx-share-modal">
    <a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=http://example.com/posts/f5f9fa9b/" alt="微信分享二维码">
    </div>
</div>

<div id="share-mask"></div>  
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li></ul>

    </footer>
  </div>

   
  <nav class="article-nav">
    
      <a href="/posts/c24675b4/" class="article-nav-link">
        <strong class="article-nav-caption">上一篇</strong>
        <div class="article-nav-title">
          
            MySQL
          
        </div>
      </a>
    
    
      <a href="/posts/33422a09/" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">负距离</div>
      </a>
    
  </nav>

   
<!-- valine评论 -->
<div id="vcomments-box">
    <div id="vcomments">
    </div>
</div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<!-- <script src='https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js'></script> -->
<!-- <script src="//unpkg.com/valine/dist/Valine.min.js"></script> -->
<script src="/js/Valine.min.js"></script>

<style>
    /* 设置评论背景 */
    #veditor{min-height: 10rem;
        background-image: url('/images/comment-bg.jpg');
        background-size: contain;
        background-repeat: no-repeat;
        background-position: right;
        background-color: rgba(255,255,255,0);
        resize: none;
    }

    /* 设置头像旋转 */
    .v .vcards .vcard .vimg {
        width: 3.125em;
        height: 3.125em;
        float: left;
        border-radius: 50%;
        margin-right: .7525em;
        padding: 0.125em;
        border: 1px solid #FFA500;
        opacity: 1;
        transition: all 1.0s;
    }

    .v .vcards .vcard .vimg:hover {
        box-shadow: 0 0 10px #fff;
        -webkit-box-shadow: 0 0 19px #fff;
        transform:rotate(360deg);
        -ms-transform:rotate(360deg); 	  /* IE 9 */
        -moz-transform:rotate(360deg); 	  /* Firefox */
        -webkit-transform:rotate(360deg); /* Safari 和 Chrome */
        -o-transform:rotate(360deg); 	  /* Opera */
        filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=3);
    }
</style>
<!-- Valine配置 -->
<script>
    new Valine({
        el: '#vcomments',
        enableQQ: true,
        app_id: 'Py2eOHzSdrnxKPzKrOJaHJOq-9Nh9j0Va',
        app_key: '9eQhwuCgyshpYKn4rtEhqt4R',
        path: window.location.pathname,
        //notify: 'false',
        //verify: 'false',
        avatar: 'wavatar',
        placeholder: '建议使用QQ邮箱，会自动获取QQ头像~',
        recordIP: true,

        // 设置Bilibili表情包地址
        emojiCDN: '//i0.hdslb.com/bfs/emote/',
        // 表情title和图片映射
        emojiMaps: {
           "tv_doge": "6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png",
            "tv_亲亲": "a8111ad55953ef5e3be3327ef94eb4a39d535d06.png",
            "tv_偷笑": "bb690d4107620f1c15cff29509db529a73aee261.png",
            "tv_再见": "180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png",
            "tv_冷漠": "b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png",
            "tv_发怒": "34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png",
            "tv_发财": "34db290afd2963723c6eb3c4560667db7253a21a.png",
            "tv_可爱": "9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png",
            "tv_吐血": "09dd16a7aa59b77baa1155d47484409624470c77.png",
            "tv_呆": "fe1179ebaa191569b0d31cecafe7a2cd1c951c9d.png",
            "tv_呕吐": "9f996894a39e282ccf5e66856af49483f81870f3.png",
            "tv_困": "241ee304e44c0af029adceb294399391e4737ef2.png",
            "tv_坏笑": "1f0b87f731a671079842116e0991c91c2c88645a.png",
            "tv_大佬": "093c1e2c490161aca397afc45573c877cdead616.png",
            "tv_大哭": "23269aeb35f99daee28dda129676f6e9ea87934f.png",
            "tv_委屈": "d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png",
            "tv_害羞": "a37683fb5642fa3ddfc7f4e5525fd13e42a2bdb1.png",
            "tv_尴尬": "7cfa62dafc59798a3d3fb262d421eeeff166cfa4.png",
            "tv_微笑": "70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png",
            "tv_思考": "90cf159733e558137ed20aa04d09964436f618a1.png",
            "tv_惊吓": "0d15c7e2ee58e935adc6a7193ee042388adc22af.png",
            // ... 更多表情
        }
    });
    const infoEle = document.querySelector('#vcomments .info');
    if (infoEle && infoEle.childNodes && infoEle.childNodes.length > 0) {
        infoEle.childNodes.forEach(function (item) {
            item.parentNode.removeChild(item);
        });
    }
</script>

<style>
    #vcomments-box {
        padding: 5px 30px;
    }

    @media screen and (max-width: 800px) {
        #vcomments-box {
            padding: 5px 0px;
        }
    }

    #vcomments-box #vcomments {
        background-color: #fff;
    }

    .v .vlist .vcard .vh {
        padding-right: 20px;
    }

    .v .vlist .vcard {
        padding-left: 10px;
    }
</style>

 
     
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2020-2021
        <i class="ri-heart-fill heart_icon"></i> Khighness
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></s>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s4.cnzz.com/z_stat.php?id=1279324689&amp;web_id=1279324689'></script>
        
      </li>
    </ul>
  </div>
</footer>
      <div class="float_btns">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

      </div>
    </main>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="https://cdn.jsdelivr.net/gh/Khighness/Khighness.github.io/images/Khighness.jpg" alt="Khighness"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">关于</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/friends">友链</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" target="_blank" rel="noopener" href="https://www.tidio.com/talk/Khighness">联系</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <script>
      if (window.matchMedia("(max-width: 768px)").matches) {
        document.querySelector('.content').classList.remove('on');
        document.querySelector('.sidebar').classList.remove('on');
      }
    </script>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>来杯抹茶？</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Khighness/Khighness.github.io/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Khighness/Khighness.github.io/images/wepay.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->


<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: '.tocbot',
    contentSelector: '.article-entry',
    headingSelector: 'h1, h2, h3, h4, h5, h6',
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: 'main',
    positionFixedSelector: '.tocbot',
    positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto'
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>

<!-- MathJax -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
  });

  MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for(i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
      }
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.6/unpacked/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
  var ayerConfig = {
    mathjax: true
  }
</script>

<!-- Katex -->


    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css">
        <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"></script>
        
    


<!-- busuanzi  -->


<script src="/js/busuanzi-2.3.pure.min.js"></script>


<!-- ClickLove -->

<!-- ClickBoom1 -->

<script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script>

<script src="/js/clickBoom1.js"></script>


<!-- ClickBoom2 -->

<!-- CodeCopy -->


<link rel="stylesheet" href="/css/clipboard.css">

<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>


<!-- CanvasBackground -->


    
  </div>
  <!-- 百度统计 -->
  <script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?97974cf7c750ac7da47173f2992d6970";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
  </script>
  <!-- 三角彩带背景 -->
  <canvas id="evanyou-canvas" style="opacity: 0.3; position: fixed; top: 0px; left: 0px; z-index: -1; width: 100%; height: 100%; pointer-events: none;"></canvas>
  <script src="/js/evanyou-canvas.js"></script>
  <!-- Tidio即时聊天-->
  <script src="//code.tidio.co/ao1f4qdjllf8yowzz7v5brdaejt42uoi.js" async></script>
</body>

</html>
