<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Docker | Khighness</title><meta name="keywords" content="Docker"><meta name="author" content="Khighness"><meta name="copyright" content="Khighness"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="📖概述   故事  2010年，几个搞 IT 的年轻人，在美国旧金山成立了一家名叫 dotCloud 的公司。dotCloud 的平台即服务（Platform-as-a-Service）提供商。底层技术上，dotCloud 平台利用了Linux的 LXC 容器技术。为了方便创建和管理这些容器，dotCloud 基于 Google 公司推出的 Go 语言开发了一套内部工具，之后被命名为 Docke">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker">
<meta property="og:url" content="https://www.parak.top/posts/f5f9fa9b/index.html">
<meta property="og:site_name" content="Khighness">
<meta property="og:description" content="📖概述   故事  2010年，几个搞 IT 的年轻人，在美国旧金山成立了一家名叫 dotCloud 的公司。dotCloud 的平台即服务（Platform-as-a-Service）提供商。底层技术上，dotCloud 平台利用了Linux的 LXC 容器技术。为了方便创建和管理这些容器，dotCloud 基于 Google 公司推出的 Go 语言开发了一套内部工具，之后被命名为 Docke">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Khighness/cdn/top/bg-14.jpg">
<meta property="article:published_time" content="2020-12-01T16:00:00.000Z">
<meta property="article:modified_time" content="2021-05-24T04:31:04.854Z">
<meta property="article:author" content="Khighness">
<meta property="article:tag" content="Docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/Khighness/cdn/top/bg-14.jpg"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/Khighness/cdn/avatar/K.jpg"><link rel="canonical" href="https://www.parak.top/posts/f5f9fa9b/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//s4.cnzz.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="yandex-verification" content="{&quot;theme_color&quot;:{&quot;enable&quot;:true,&quot;main&quot;:&quot;#49B1F5&quot;,&quot;paginator&quot;:&quot;#00c4b6&quot;,&quot;button_hover&quot;:&quot;#FF7242&quot;,&quot;text_selection&quot;:&quot;#00c4b6&quot;,&quot;link_color&quot;:&quot;#99a9bf&quot;,&quot;meta_color&quot;:&quot;#858585&quot;,&quot;hr_color&quot;:&quot;#A4D8FA&quot;,&quot;code_foreground&quot;:&quot;#F47466&quot;,&quot;code_background&quot;:&quot;rgba(27, 31, 35, .05)&quot;,&quot;toc_color&quot;:&quot;#00c4b6&quot;,&quot;blockquote_padding_color&quot;:&quot;#49b1f5&quot;,&quot;blockquote_background_color&quot;:&quot;#49b1f5&quot;}}"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?16576652";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script async="async" data-pjax="data-pjax" src="https://s4.cnzz.com/z_stat.php?id=1279324689&amp;web_id=1279324689"></script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Khighness","link":"链接: ","source":"来源: Khighness","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-05-24 12:31:04'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><link rel="stylesheet" href="/css/background.css"><link rel="stylesheet" href="/css/iconfont/iconfont.css"><link rel="stylesheet" href="/css/mouse.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/css/main.css"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="Khighness" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="https://cdn.jsdelivr.net/gh/Khighness/cdn/avatar/Khighness.jpg" onerror="onerror=null;src='https://cdn.jsdelivr.net/gh/Khighness/cdn/common/404.jpg'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">51</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">26</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">19</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-index"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw iconfont icon-tianchongxing-1"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw iconfont icon-tianchongxing-"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw iconfont icon-fenlei"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw iconfont icon-ziyuan"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-K"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/Khighness/cdn/top/bg-14.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Khighness</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-index"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw iconfont icon-tianchongxing-1"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw iconfont icon-tianchongxing-"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw iconfont icon-fenlei"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw iconfont icon-ziyuan"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-K"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Docker</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-12-01T16:00:00.000Z" title="发表于 2020-12-02 00:00:00">2020-12-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-05-24T04:31:04.854Z" title="更新于 2021-05-24 12:31:04">2021-05-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/DevOps/">DevOps</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">9.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>48分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Docker"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="📖概述"><a href="#📖概述" class="headerlink" title="📖概述"></a>📖概述</h2>

<blockquote>
<p>故事</p>
</blockquote>
<p>2010年，几个搞 IT 的年轻人，在美国旧金山成立了一家名叫 <code>dotCloud </code>的公司。<code>dotCloud </code>的平台即服务（Platform-as-a-Service）提供商。底层技术上，<code>dotCloud</code> 平台利用了<code>Linux</code>的 <code>LXC </code>容器技术。为了方便创建和管理这些容器，<code>dotCloud </code>基于 Google 公司推出的 <code>Go </code>语言开发了一套内部工具，之后被命名为 <code>Docker</code>。<code>Docker </code>就是这样诞生的。</p>
<p>2013年的后端技术领域已经太久没有出现让人振奋的东西了。当然<code>Docker</code>在发行之后也没用引起行业的关注。在开源之后才爆火。</p>
<p><code>Docker</code>定义容器技术标砖使得容器技术的落地变得十分简单，应用可以稳定便携的运行在容器中。</p>
<a id="more"></a>



<blockquote>
<p>特点</p>
</blockquote>
<ul>
<li><strong>更快速的应用交付和部署</strong></li>
<li><strong>更便捷的升级和扩缩容</strong></li>
<li><strong>更高效的计算资源利用</strong></li>
<li><strong>更简单的系统运维</strong></li>
</ul>
<blockquote>
<p>架构</p>
</blockquote>
<img src= "https://cdn.jsdelivr.net/gh/Khighness/cdn/common/loading.gif" data-lazy-src="/posts/f5f9fa9b/Docker%E6%9E%B6%E6%9E%84.jpg" class="" title="Docker">

<p><strong>镜像（image）：</strong> 相当于一个模板，可以通过这个模板来创建容器服务</p>
<p><strong>容器（container）：</strong> 独立运行一个或者一个组应用</p>
<p><strong>仓库（repository）：</strong> 存放镜像的地方</p>
<br>

<h2 id="🔨安装"><a href="#🔨安装" class="headerlink" title="🔨安装"></a>🔨安装</h2><blockquote>
<p>官方文档</p>
</blockquote>
<p>CentOS 7安装：<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/centos/">https://docs.docker.com/engine/install/centos/</a></p>
<blockquote>
<p>卸载旧版本</p>
</blockquote>
<pre><code class="shell">$ sudo yum remove docker \
                  docker-client \
                  docker-client-latest \
                  docker-common \
                  docker-latest \
                  docker-latest-logrotate \
                  docker-logrotate \
                  docker-engine</code></pre>
<blockquote>
<p>设置存储库</p>
</blockquote>
<pre><code class="shell">$ sudo yum install -y yum-utils</code></pre>
<blockquote>
<p>更换镜像源</p>
</blockquote>
<pre><code class="shell">$ sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</code></pre>
<blockquote>
<p>更新YUM包</p>
<p>更新YUM索引</p>
</blockquote>
<pre><code class="shell">$ sudo yum update
$ sudo yum makecache fast</code></pre>
<blockquote>
<p>安装docker引擎和容器</p>
</blockquote>
<pre><code class="shell">$ sudo yum install docker-ce docker-ce-cli containerd.io</code></pre>
<blockquote>
<p>启动Docker并测试hello-world</p>
</blockquote>
<pre><code class="shell">$ sudo systemctl start docker
$ sudo docker run hello-world</code></pre>
<blockquote>
<p>卸载方式</p>
</blockquote>
<pre><code class="shell">$ sudo yum remove docker-ce docker-ce-cli containerd.io
$ sudo rm -rf /var/lib/docker</code></pre>
<blockquote>
<p>镜像加速</p>
</blockquote>
<p>1️⃣使用阿里镜像加速器</p>
<img src= "https://cdn.jsdelivr.net/gh/Khighness/cdn/common/loading.gif" data-lazy-src="/posts/f5f9fa9b/image-20201206122604398.png" class="" title="image-20201206122604398">

<p>2️⃣使用中科大或者网易镜像加速</p>
<pre><code class="shell"># 添加daemon.json
$ touch /etc/docker/daemon.json

# 写入内容并保存
# 科大源: https://docker.mirrors.ustc.edu.cn/
# 网易源：http://hub-mirror.c.163.com
&#123;
  &quot;registry-mirrors&quot;: [&quot;https://docker.mirrors.ustc.edu.cn/&quot;]
&#125;

# 重启Dicker
$ sudo systemctl restart docker</code></pre>
<br>

<h2 id="🚀原理"><a href="#🚀原理" class="headerlink" title="🚀原理"></a>🚀原理</h2><blockquote>
<p>docker run的执行流程</p>
</blockquote>
<img src= "https://cdn.jsdelivr.net/gh/Khighness/cdn/common/loading.gif" data-lazy-src="/posts/f5f9fa9b/image-20201203233730702.png" class="" title="image-20201203233730702">

<blockquote>
<p>Docker的工作</p>
</blockquote>
<p>Docker是一个Client-Server结构的系统，Docker的守护进程运行在主机上。通过Socket从客户端访问。</p>
<p><strong>为什么Docker比VM快？</strong></p>
<img src= "https://cdn.jsdelivr.net/gh/Khighness/cdn/common/loading.gif" data-lazy-src="/posts/f5f9fa9b/image-20201204003500802.png" class="" title="image-20201204003500802">

<p>1、Docker有比虚拟机更少的抽象层。Docker不需要Hypervisor实现硬件资源虚拟化，运行在Docker容器上的程序直接使用的是实际物理机的硬件资源，因此在CPU、内存利用率上Docker将会在效率上有明显的优势。</p>
<p>2、Docker利用的是宿主机的内核，而不需要Guest OS。因此创建一个容器时，不需要和虚拟机一样重新加载一个操作系统内核。从而避免引寻、加载操作系统内核返回时耗时耗资源的过程，当新建一个虚拟机时，虚拟机软件需要加载Guest OS，返回新建过程是分钟级别的。而新建一个Docker容器只需要几秒钟。</p>
<p>3、Docker与VM相比：</p>
<ul>
<li>Docker灵活，VM笨重</li>
<li>Docker存储的镜像小，便于存储和传输，VM镜像庞大</li>
</ul>
<br>

<h2 id="🔰命令"><a href="#🔰命令" class="headerlink" title="🔰命令"></a>🔰命令</h2><blockquote>
<p>🌐官方文档</p>
</blockquote>
<p>Command-line reference：<a target="_blank" rel="noopener" href="https://docs.docker.com/reference/">https://docs.docker.com/reference/</a></p>
<img src= "https://cdn.jsdelivr.net/gh/Khighness/cdn/common/loading.gif" data-lazy-src="/posts/f5f9fa9b/image-20201204225734966.png" class="" title="image-20201204225734966">

<br>

<h3 id="1️⃣帮助命令"><a href="#1️⃣帮助命令" class="headerlink" title="1️⃣帮助命令"></a>1️⃣帮助命令</h3><pre><code class="shell">$ docker version    # 显示Docker版本信息
$ docker info       # 显示Docker系统信息
$ docker --help     # Docker命令帮助信息</code></pre>
<br>

<h3 id="2️⃣镜像命令"><a href="#2️⃣镜像命令" class="headerlink" title="2️⃣镜像命令"></a>2️⃣镜像命令</h3><blockquote>
<p>查看镜像</p>
</blockquote>
<pre><code class="shell">$ docker images

# 可选项
-a, --all             # 列出所有镜像
    --digests         # 显示镜像的摘要信息
-q, --quiet           # 只显示镜像的ID

# 运行
[root@parak khighness]# docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
hello-world         latest              bf756fb1ae65        11 months ago       13.3kB
# 解释
REPOSITORY  镜像的仓库源
TAG         镜像的标签
IMAGE ID    镜像的ID
CREATED     镜像的创建时间
SIZE        镜像的大小</code></pre>
<blockquote>
<p>搜索镜像</p>
</blockquote>
<pre><code class="shell">$ docker search &lt;IMAGE&gt;

# 可选项
--filter=STARS=1000 # 镜像的STARS大于1000</code></pre>
<blockquote>
<p>下载镜像</p>
</blockquote>
<pre><code class="shell">$ docker pull &lt;IMAGE&gt;
$ docker pull .io/library/mysql:latest

# 如果不写tag，默认就是最新的

# 指定版本下载
[root@parak khighness]# docker pull mysql:8.0.20
8.0.20: Pulling from library/mysql  # 分层下载
8559a31e96f4: Pull complete 
d51ce1c2e575: Pull complete 
c2344adc4858: Pull complete 
fcf3ceff18fc: Pull complete 
16da0c38dc5b: Pull complete 
b905d1797e97: Pull complete 
4b50d1c6b05c: Pull complete 
c75914a65ca2: Pull complete 
1ae8042bdd09: Pull complete 
453ac13c00a3: Pull complete 
9e680cd72f08: Pull complete 
a6b5dc864b6c: Pull complete 
Digest: sha256:8b7b328a7ff6de46ef96bcf83af048cb00a1c86282bfca0cb119c84568b4caf6
Status: Downloaded newer image for mysql:8.0.20
docker.io/library/mysql:8.0.20</code></pre>
<blockquote>
<p>删除镜像</p>
</blockquote>
<pre><code class="shell"># 通过镜像ID删除
$ docker rmi -f &lt;IMAGE ID&gt; ...
# 删除所有镜像
$ docker rmi -f $(docker images -aq)0</code></pre>
<br>

<h3 id="3️⃣容器命令"><a href="#3️⃣容器命令" class="headerlink" title="3️⃣容器命令"></a>3️⃣容器命令</h3><blockquote>
<p>下载一个CentOS镜像来测试学(套)习(娃)</p>
</blockquote>
<pre><code class="shell">[root@parak khighness]# docker pull centos
Using default tag: latest
latest: Pulling from library/centos
3c72a8ed6814: Pull complete 
Digest: sha256:76d24f3ba3317fa945743bb3746fbaf3a0b752f10b10376960de01da70685fbd
Status: Downloaded newer image for centos:latest
docker.io/library/centos:latest</code></pre>
<blockquote>
<p>新建容器并启动</p>
</blockquote>
<pre><code class="shell">$ docker run [可选参数] &lt;IMAGE&gt;

# 参数说明
--name=&quot;NAME&quot;   容器名字，用于区分容器
-d              后台方式运行
-it             使用交互方式运行，进如容器查看内容
-p              指定容器端口  -p 8080:8080
    -p ip:主机端口:容器端口
    -p 主机端口:容器端口
    -p 容器端口

# 测试，启动并进入容器
[root@parak khighness]# docker run -it centos /bin/bash
[root@e4efa1c507b8 /]# ls
bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
# 从容器中退回主机
[root@e4efa1c507b8 /]# exit
exit
[root@parak khighness]# ls
公共  模板  视频  图片  文档  下载  音乐  桌面</code></pre>
<blockquote>
<p>查看容器</p>
</blockquote>
<pre><code class="shell">$ docker ps  # 显示所有正在运行的容器
-a           # 显示所有正在运行的容器+历史运行过的容器
-n=?         # 显示最近创建的n个容器
-q           # 只显示容器的编号</code></pre>
<blockquote>
<p>退出容器</p>
</blockquote>
<pre><code class="shell">$ exit        </code></pre>
<blockquote>
<p>删除容器</p>
</blockquote>
<pre><code class="shell">$ docker rm &lt;Container ID/NAME&gt;    # 删除指定的容器，不能删除只在运行的容器
$ docker rm -f $(docker ps -aq)    # 删除所有的容器
$ docker ps -a -q|xargs docker rm  # 删除所有的容器 </code></pre>
<blockquote>
<p>容器操作</p>
</blockquote>
<pre><code class="shell">$ docker start   &lt;Container ID/NAME&gt;  # 启动容器 
$ docker restart &lt;Container ID/NAME&gt;  # 重启容器
$ docker stop    &lt;Container ID/NAME&gt;  # 停止当前正在运行的容器
$ docker kill    &lt;Container ID/NAME&gt;  # 强制停止当前容器</code></pre>
<blockquote>
<p>查看日志</p>
</blockquote>
<pre><code class="shell">$ docker logs -tf --tail &lt;n&gt; &lt;Container ID/NAME&gt; # 显示指定行数的日志</code></pre>
<blockquote>
<p>查看容器中进程信息</p>
</blockquote>
<pre><code class="shell">$ docker top &lt;Container ID/NAME&gt;</code></pre>
<blockquote>
<p>查看镜像的元数据</p>
</blockquote>
<pre><code class="shell">$ docker inspect</code></pre>
<blockquote>
<p>进入当前正在运行的容器</p>
</blockquote>
<pre><code class="shell">$ docker exec -it &lt;Container ID&gt; bashShell  
# 进入容器后开启一个新的终端，可以在里面操作；
# exec之后不会终结当前容器进程

$ docker attach &lt;Container ID&gt;              
# 进入容器中正在执行的终端，不会启动新的进程
# exec之后终结当前容器进程</code></pre>
<blockquote>
<p>从容器拷贝新的东西到主机</p>
</blockquote>
<pre><code class="shell"># 开启CentOS容器
[root@parak khighness]# docker start b9ace468ea7d
b9ace468ea7d
# 进入CentOS容器
[root@parak khighness]# docker attach b9ace468ea7d
# 创建文件夹和文件
[root@b9ace468ea7d /]# cd home/
[root@b9ace468ea7d home]# mkdir document 
[root@b9ace468ea7d home]# vi K1.java
# 退出容器
[root@b9ace468ea7d document]# exit
exit
# 将容器文件复制到主机上
[root@parak khighness]# docker cp b9ace468ea7d:/home/document/K1.java document/
[root@parak khighness]# cd document/
[root@parak document]# ll
总用量 4
-rw-r--r--. 1 root root 186 12月  5 11:33 K1.java</code></pre>
<br>

<h2 id="🔱练习"><a href="#🔱练习" class="headerlink" title="🔱练习"></a>🔱练习</h2><br>

<h3 id="🌠-安装Nginx"><a href="#🌠-安装Nginx" class="headerlink" title="🌠 安装Nginx"></a>🌠 安装Nginx</h3><pre><code class="shell"># 搜索镜像
[root@parak khighness]# docker search nginx
NAME                               DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED
nginx                              Official build of Nginx.                        14063               [OK]                
jwilder/nginx-proxy                Automated Nginx reverse proxy for docker con…   1912                                    [OK]
richarvey/nginx-php-fpm            Container running Nginx + PHP-FPM capable of…   795                                     [OK]
linuxserver/nginx                  An Nginx container, brought to you by LinuxS…   131                                     
jc21/nginx-proxy-manager           Docker container for managing Nginx proxy ho…   115                                     
tiangolo/nginx-rtmp                Docker image with Nginx using the nginx-rtmp…   105                                     [OK]
bitnami/nginx                      Bitnami nginx Docker Image                      90                                      [OK]
alfg/nginx-rtmp                    NGINX, nginx-rtmp-module and FFmpeg from sou…   80                                      [OK]
jlesage/nginx-proxy-manager        Docker container for Nginx Proxy Manager        72                                      [OK]
nginxdemos/hello                   NGINX webserver that serves a simple page co…   63                                      [OK]
nginx/nginx-ingress                NGINX Ingress Controller for Kubernetes         45                                      
privatebin/nginx-fpm-alpine        PrivateBin running on an Nginx, php-fpm &amp; Al…   42                                      [OK]
nginxinc/nginx-unprivileged        Unprivileged NGINX Dockerfiles                  21                                      
schmunk42/nginx-redirect           A very simple container to redirect HTTP tra…   19                                      [OK]
nginx/nginx-prometheus-exporter    NGINX Prometheus Exporter                       15                                      
centos/nginx-112-centos7           Platform for running nginx 1.12 or building …   15                                      
staticfloat/nginx-certbot          Opinionated setup for automatic TLS certs lo…   14                                      [OK]
raulr/nginx-wordpress              Nginx front-end for the official wordpress:f…   13                                      [OK]
centos/nginx-18-centos7            Platform for running nginx 1.8 or building n…   13                                      
mailu/nginx                        Mailu nginx frontend                            8                                       [OK]
bitwarden/nginx                    The Bitwarden nginx web server acting as a r…   7                                       
flashspys/nginx-static             Super Lightweight Nginx Image                   7                                       [OK]
bitnami/nginx-ingress-controller   Bitnami Docker Image for NGINX Ingress Contr…   6                                       [OK]
wodby/nginx                        Generic nginx                                   1                                       [OK]
ansibleplaybookbundle/nginx-apb    An APB to deploy NGINX                          1                                       [OK]
# 下载镜像
[root@parak khighness]# docker pull nginx
Using default tag: latest
latest: Pulling from library/nginx
852e50cd189d: Pull complete 
571d7e852307: Pull complete 
addb10abd9cb: Pull complete 
d20aa7ccdb77: Pull complete 
8b03f1e11359: Pull complete 
Digest: sha256:6b1daa9462046581ac15be20277a7c75476283f969cb3a61c8725ec38d3b01c3
Status: Downloaded newer image for nginx:latest
docker.io/library/nginx:latest
# 查看镜像
[root@parak khighness]# docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
nginx               latest              bc9a0695f571        10 days ago         133MB
centos              latest              0d120b6ccaa8        3 months ago        215MB
mysql               8.0.20              be0dbf01a0f3        5 months ago        541MB
hello-world         latest              bf756fb1ae65        11 months ago       13.3kB
# 后台启动80端口nginx，对外开放3355端口
[root@parak khighness]# docker run -d --name nginx1 -p 3355:80 nginx 
b6072408f44cd78594f01c95bc63da6baf911f74d62bf232ec42c1cd8b08b4d0
[root@parak khighness]# docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES
b6072408f44c        nginx               &quot;/docker-entrypoint.…&quot;   6 seconds ago       Up 4 seconds        0.0.0.0:3355-&gt;80/tcp   nginx1
# 测试，可以用ip:3355在浏览器访问
[root@parak khighness]# curl localhost:3355
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Welcome to nginx!&lt;/title&gt;
&lt;style&gt;
    body &#123;
        width: 35em;
        margin: 0 auto;
        font-family: Tahoma, Verdana, Arial, sans-serif;
    &#125;
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
&lt;p&gt;If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.&lt;/p&gt;

&lt;p&gt;For online documentation and support please refer to
&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
Commercial support is available at
&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
<br>

<h3 id="🌠-安装Tomcat"><a href="#🌠-安装Tomcat" class="headerlink" title="🌠 安装Tomcat"></a>🌠 安装Tomcat</h3><pre><code class="shell">[root@parak khighness]# docker pull tomcat:9.0
9.0: Pulling from library/tomcat
756975cb9c7e: Pull complete 
d77915b4e630: Pull complete 
5f37a0a41b6b: Pull complete 
96b2c1e36db5: Pull complete 
27a2d52b526e: Pull complete 
a867dba77389: Pull complete 
0939c055fb79: Pull complete 
0b0694ce0ae2: Pull complete 
81a5f8099e05: Pull complete 
c3d7917d545e: Pull complete 
Digest: sha256:a319b10d8729817c7ce0bcc2343a6f97711c7870395019340d96b6aafd6ccbea
Status: Downloaded newer image for tomcat:9.0
docker.io/library/tomcat:9.0

[root@parak khighness]# docker run -d -p 3355:8080 --name tomcat1 tomcat
48c7de09007af158b13a9bef1f2d2b77bed0c4bc2f93a4887eac427911118a9b
[root@parak khighness]# docker exec -it tomcat1 /bin/bash
root@48c7de09007a:/usr/local/tomcat# ls -al
total 128
drwxr-xr-x. 1 root root    30 Nov 19 06:16 .
drwxr-xr-x. 1 root root    20 Nov 19 06:12 ..
-rw-r--r--. 1 root root 18982 Nov 12 15:41 BUILDING.txt
-rw-r--r--. 1 root root  5409 Nov 12 15:41 CONTRIBUTING.md
-rw-r--r--. 1 root root 57092 Nov 12 15:41 LICENSE
-rw-r--r--. 1 root root  2333 Nov 12 15:41 NOTICE
-rw-r--r--. 1 root root  3257 Nov 12 15:41 README.md
-rw-r--r--. 1 root root  6898 Nov 12 15:41 RELEASE-NOTES
-rw-r--r--. 1 root root 16507 Nov 12 15:41 RUNNING.txt
drwxr-xr-x. 2 root root  4096 Nov 19 06:16 bin
drwxr-xr-x. 1 root root    22 Dec  5 13:15 conf
drwxr-xr-x. 2 root root  4096 Nov 19 06:16 lib
drwxrwxrwx. 1 root root   177 Dec  5 13:15 logs
drwxr-xr-x. 2 root root   134 Nov 19 06:16 native-jni-lib
drwxrwxrwx. 2 root root    30 Nov 19 06:16 temp
drwxr-xr-x. 2 root root     6 Nov 19 06:16 webapps
drwxr-xr-x. 7 root root    81 Nov 12 15:38 webapps.dist
drwxrwxrwx. 2 root root     6 Nov 12 15:35 work
# 可以发现webapps目录为空
root@48c7de09007a:/usr/local/tomcat# cd webapps
root@48c7de09007a:/usr/local/tomcat/webapps# ls -l
total 0

# 将webapps.list目录下的内容拷贝到webapps下，再用浏览器测试访问
root@48c7de09007a:/usr/local/tomcat/webapps# cd ..
root@48c7de09007a:/usr/local/tomcat# cd webapps.dist/
root@48c7de09007a:/usr/local/tomcat/webapps.dist# ls
ROOT  docs  examples  host-manager  manager
root@48c7de09007a:/usr/local/tomcat/webapps.dist# cd ..
root@48c7de09007a:/usr/local/tomcat# cp -r webapps.dist/* webapps/
root@48c7de09007a:/usr/local/tomcat# cd webapps
root@48c7de09007a:/usr/local/tomcat/webapps# ls
ROOT  docs  examples  host-manager  manager</code></pre>
<blockquote>
<p>测试访问 <a target="_blank" rel="noopener" href="http://192.168.117.155:3355/">http://192.168.117.155:3355/</a></p>
</blockquote>
<img src= "https://cdn.jsdelivr.net/gh/Khighness/cdn/common/loading.gif" data-lazy-src="/posts/f5f9fa9b/image-20201205214537503.png" class="" title="image-20201205214537503">

<br>

<h3 id="🌠安装es-kibana"><a href="#🌠安装es-kibana" class="headerlink" title="🌠安装es + kibana"></a>🌠安装es + kibana</h3><pre><code class="shell"># --net somenetwork 网络配置
$ docker run -d --name es1 -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; elasticsearch:7.6.2
# 查看主机状态
$ doucker stats

# 下载并运行ES
[root@parak khighness]#  docker run -d --name es1 -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; elasticsearch:7.6.2
Unable to find image &#39;elasticsearch:7.6.2&#39; locally
7.6.2: Pulling from library/elasticsearch
ab5ef0e58194: Pull complete 
c4d1ca5c8a25: Pull complete 
941a3cc8e7b8: Pull complete 
43ec483d9618: Pull complete 
c486fd200684: Pull complete 
1b960df074b2: Pull complete 
1719d48d6823: Pull complete 
Digest: sha256:1b09dbd93085a1e7bca34830e77d2981521a7210e11f11eda997add1c12711fa
Status: Downloaded newer image for elasticsearch:7.6.2
51441d9abfb966c4baa0402ceb99e702f58ec68cd427710a2b8c8043983412e9
# 查看主机状态
[root@parak khighness]# docker stats
CONTAINER ID    NAME   CPU %   MEM USAGE/LIMIT  MEM %     NET I/O    BLOCK I/O      PIDS
51441d9abfb9    es1   42.74%  495.6MiB/972.4MiB 50.97%    656B/0B   4.76GB/629MB     46

# 停止es1
$ docker stop es1
# 删除es1
$ docker rm es1

# 限制内存，启动ES
$ docker run -d --name es1 -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; -e ES_JAVA_OPTS=&quot;-Xms64m -Xmx512m&quot; elasticsearch:7.6.2

# 重新启动es1
[root@parak khighness]# docker run -d --name es1 -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; -e ES_JAVA_OPTS=&quot;-Xms64m -Xmx512m&quot; elasticsearch:7.6.2
ca4494f52e5642d5992c49816b636b1858f2e2f5c1aaf38621c76001262e8e4d
# 再次查看状态
[root@parak khighness]# docker stats
CONTAINER ID    NAME   CPU %   MEM USAGE/LIMIT   MEM %     NET I/O   BLOCK I/O       PIDS
ca4494f52e56    es1    0.68%   357.5MiB/972.4MiB 36.77%    737B/0B   476MB/1.78MB     45
# 测试访问
[root@parak khighness]# curl localhost:9200
&#123;
  &quot;name&quot; : &quot;ca4494f52e56&quot;,
  &quot;cluster_name&quot; : &quot;docker-cluster&quot;,
  &quot;cluster_uuid&quot; : &quot;aDKZlZW_T7Ss3Dr0CXZQlQ&quot;,
  &quot;version&quot; : &#123;
    &quot;number&quot; : &quot;7.6.2&quot;,
    &quot;build_flavor&quot; : &quot;default&quot;,
    &quot;build_type&quot; : &quot;docker&quot;,
    &quot;build_hash&quot; : &quot;ef48eb35cf30adf4db14086e8aabd07ef6fb113f&quot;,
    &quot;build_date&quot; : &quot;2020-03-26T06:34:37.794943Z&quot;,
    &quot;build_snapshot&quot; : false,
    &quot;lucene_version&quot; : &quot;8.4.0&quot;,
    &quot;minimum_wire_compatibility_version&quot; : &quot;6.8.0&quot;,
    &quot;minimum_index_compatibility_version&quot; : &quot;6.0.0-beta1&quot;
  &#125;,
  &quot;tagline&quot; : &quot;You Know, for Search&quot;
&#125;</code></pre>
<br>

<h2 id="📈可视化"><a href="#📈可视化" class="headerlink" title="📈可视化"></a>📈可视化</h2><p>Y1S1可视化面板的前端写的真好看，我爱了。</p>
<pre><code class="shell"># 安装运行
$ docker run -d -p 8088:9000 --name=pt --restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer</code></pre>
<blockquote>
<p>访问测试 <a target="_blank" rel="noopener" href="http://192.168.117.155:8088/">http://192.168.117.155:8088/</a></p>
</blockquote>
<img src= "https://cdn.jsdelivr.net/gh/Khighness/cdn/common/loading.gif" data-lazy-src="Docker/image-20201205232646075.png" alt="image-20201205232646075"  />

<img src= "https://cdn.jsdelivr.net/gh/Khighness/cdn/common/loading.gif" data-lazy-src="Docker/image-20201206105337297.png" alt="image-20201206105337297"  />





<h2 id="📑DockerFile"><a href="#📑DockerFile" class="headerlink" title="📑DockerFile"></a>📑DockerFile</h2><p>DockerFile就是用来构建docker镜像的构建文件-命令脚本。</p>
<blockquote>
<p>命令</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">命令</th>
<th align="center">描述</th>
<th align="center">理解</th>
</tr>
</thead>
<tbody><tr>
<td align="center">FROM</td>
<td align="center">指定基础镜像</td>
<td align="center">公司的父公司</td>
</tr>
<tr>
<td align="center">MAINTAINER</td>
<td align="center">指定维护者信息</td>
<td align="center">公司注册信息</td>
</tr>
<tr>
<td align="center">RUN</td>
<td align="center">把命令前面加上RUN即可</td>
<td align="center">公司注册流程</td>
</tr>
<tr>
<td align="center">ADD</td>
<td align="center">COPY文件，会自动解压</td>
<td align="center">公司注册资金</td>
</tr>
<tr>
<td align="center">WORKDIR</td>
<td align="center">设置当前工作目录</td>
<td align="center">公司大楼仓库</td>
</tr>
<tr>
<td align="center">VOLUMN</td>
<td align="center">挂载主机目录</td>
<td align="center">公司的主仓库</td>
</tr>
<tr>
<td align="center">EXPOSE</td>
<td align="center">指定对外端口</td>
<td align="center">公司开放大门</td>
</tr>
<tr>
<td align="center">RUN</td>
<td align="center">进程要一直运行下去</td>
<td align="center">公司永不倒闭</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="center">命令</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">CMD</td>
<td align="center">指定这容器启动的时候要运行的命令只有最后一个会生效，可被替代。</td>
</tr>
<tr>
<td align="center">ENTRYPOINT</td>
<td align="center">指定这个容器启动的时候要运行的命令，可以追加命令。</td>
</tr>
<tr>
<td align="center">ONBUILD</td>
<td align="center">当构建一个被继承DockerFile这就会运行ONBUILD指令。触发指令.</td>
</tr>
<tr>
<td align="center">COPY</td>
<td align="center">类似ADD，将文件拷贝到镜像中。</td>
</tr>
<tr>
<td align="center">ENV</td>
<td align="center">构建的时候设置环境变量。</td>
</tr>
</tbody></table>
<blockquote>
<p>实例1-测试</p>
</blockquote>
<pre><code class="shell">[root@parak home]# mkdir volume
[root@parak home]# cd volume/
[root@parak volume]# vim dockerfile1
[root@parak volume]# cat dockerfile1 
FROM centos
VOLUME [&quot;volume01&quot;,&quot;volume02&quot;]
CMD echo &quot;---end---&quot;
CMD /bin/bash
[root@parak volume]# docker build -f /home/volume/dockerfile1 -t khighness/centos:1.0 .
Sending build context to Docker daemon  2.048kB
Step 1/4 : FROM centos
 ---&gt; 0d120b6ccaa8
Step 2/4 : VOLUME [&quot;volume01&quot;,&quot;volume02&quot;]
 ---&gt; Running in 79dc7b449286
Removing intermediate container 79dc7b449286
 ---&gt; 9a6608557c9a
Step 3/4 : CMD echo &quot;---end---&quot;
 ---&gt; Running in 8b8c40056f99
Removing intermediate container 8b8c40056f99
 ---&gt; 2158b18dedff
Step 4/4 : CMD /bin/bash
 ---&gt; Running in 9d76c3598d69
Removing intermediate container 9d76c3598d69
 ---&gt; 240a84cdfbef
Successfully built 240a84cdfbef
Successfully tagged khighness/centos:1.0</code></pre>
<blockquote>
<p>实例2-构建自己的centos</p>
</blockquote>
<pre><code class="shell"># 1、编写DockerFile文件
[root@parak dockerfile]# vim mydockerfile-centos
[root@parak dockerfile]# cat mydockerfile-centos 
FROM centos
MAINTAINER khighness&lt;1823676372@qq.com&gt;

ENV MYPATH /usr/local
WORKDIR $MYPATH 

RUN yum -y install vim
RUN yum -y install net-tools

EXPOSE 80

CMD echo $MYPATH
CMD echo &quot;---end---&quot;
CMD /bin/bash

# 2、通过DockerFile构建镜像
[root@parak dockerfile]# docker build -f mydockerfile-centos  -t mycentos:1.0 .
Sending build context to Docker daemon  2.048kB
Step 1/10 : FROM centos
 ---&gt; 0d120b6ccaa8
Step 2/10 : MAINTAINER khighness&lt;1823676372@qq.com&gt;
 ---&gt; Running in 024da1b1d4cc
Removing intermediate container 024da1b1d4cc
 ---&gt; 6c9b636504d2
Step 3/10 : ENV MYPATH /usr/local
 ---&gt; Running in 4046d4e257ac
Removing intermediate container 4046d4e257ac
 ---&gt; a5710fdc760e
Step 4/10 : WORKDIR $MYPATH
 ---&gt; Running in 252416d49e94
Removing intermediate container 252416d49e94
 ---&gt; fdbae7da4ca4
Step 5/10 : RUN yum -y install vim
 ---&gt; Running in 9eb786294022
CentOS-8 - AppStream                            288 kB/s | 6.2 MB     00:22    
CentOS-8 - Base                                 703 kB/s | 2.3 MB     00:03    
CentOS-8 - Extras                               1.3 kB/s | 8.1 kB     00:06    
Dependencies resolved.
================================================================================
 Package             Arch        Version                   Repository      Size
================================================================================
Installing:
 vim-enhanced        x86_64      2:8.0.1763-15.el8         AppStream      1.4 M
Installing dependencies:
 gpm-libs            x86_64      1.20.7-15.el8             AppStream       39 k
 vim-common          x86_64      2:8.0.1763-15.el8         AppStream      6.3 M
 vim-filesystem      noarch      2:8.0.1763-15.el8         AppStream       48 k
 which               x86_64      2.21-12.el8               BaseOS          49 k

Transaction Summary
================================================================================
Install  5 Packages

Total download size: 7.8 M
Installed size: 30 M
Downloading Packages:
(1/5): gpm-libs-1.20.7-15.el8.x86_64.rpm        340 kB/s |  39 kB     00:00    
(2/5): vim-filesystem-8.0.1763-15.el8.noarch.rp 664 kB/s |  48 kB     00:00    
(3/5): which-2.21-12.el8.x86_64.rpm             315 kB/s |  49 kB     00:00    
(4/5): vim-enhanced-8.0.1763-15.el8.x86_64.rpm  543 kB/s | 1.4 MB     00:02    
(5/5): vim-common-8.0.1763-15.el8.x86_64.rpm    387 kB/s | 6.3 MB     00:16    
--------------------------------------------------------------------------------
Total                                           448 kB/s | 7.8 MB     00:17     
warning: /var/cache/dnf/AppStream-02e86d1c976ab532/packages/gpm-libs-1.20.7-15.el8.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID 8483c65d: NOKEY
CentOS-8 - AppStream                            1.6 MB/s | 1.6 kB     00:00    
Importing GPG key 0x8483C65D:
 Userid     : &quot;CentOS (CentOS Official Signing Key) &lt;security@centos.org&gt;&quot;
 Fingerprint: 99DB 70FA E1D7 CE22 7FB6 4882 05B5 55B3 8483 C65D
 From       : /etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial
Key imported successfully
Running transaction check
Transaction check succeeded.
Running transaction test
Transaction test succeeded.
Running transaction
  Preparing        :                                                        1/1 
  Installing       : which-2.21-12.el8.x86_64                               1/5 
  Installing       : vim-filesystem-2:8.0.1763-15.el8.noarch                2/5 
  Installing       : vim-common-2:8.0.1763-15.el8.x86_64                    3/5 
  Installing       : gpm-libs-1.20.7-15.el8.x86_64                          4/5 
  Running scriptlet: gpm-libs-1.20.7-15.el8.x86_64                          4/5 
  Installing       : vim-enhanced-2:8.0.1763-15.el8.x86_64                  5/5 
  Running scriptlet: vim-enhanced-2:8.0.1763-15.el8.x86_64                  5/5 
  Running scriptlet: vim-common-2:8.0.1763-15.el8.x86_64                    5/5 
  Verifying        : gpm-libs-1.20.7-15.el8.x86_64                          1/5 
  Verifying        : vim-common-2:8.0.1763-15.el8.x86_64                    2/5 
  Verifying        : vim-enhanced-2:8.0.1763-15.el8.x86_64                  3/5 
  Verifying        : vim-filesystem-2:8.0.1763-15.el8.noarch                4/5 
  Verifying        : which-2.21-12.el8.x86_64                               5/5 

Installed:
  gpm-libs-1.20.7-15.el8.x86_64         vim-common-2:8.0.1763-15.el8.x86_64    
  vim-enhanced-2:8.0.1763-15.el8.x86_64 vim-filesystem-2:8.0.1763-15.el8.noarch
  which-2.21-12.el8.x86_64             

Complete!
Removing intermediate container 9eb786294022
 ---&gt; 491907dac3e2
Step 6/10 : RUN yum -y install net-tools
 ---&gt; Running in 3a13d71952e5
Last metadata expiration check: 0:00:24 ago on Mon Dec  7 11:45:38 2020.
Dependencies resolved.
================================================================================
 Package         Architecture Version                        Repository    Size
================================================================================
Installing:
 net-tools       x86_64       2.0-0.52.20160912git.el8       BaseOS       322 k

Transaction Summary
================================================================================
Install  1 Package

Total download size: 322 k
Installed size: 942 k
Downloading Packages:
net-tools-2.0-0.52.20160912git.el8.x86_64.rpm   1.0 MB/s | 322 kB     00:00    
--------------------------------------------------------------------------------
Total                                           141 kB/s | 322 kB     00:02     
Running transaction check
Transaction check succeeded.
Running transaction test
Transaction test succeeded.
Running transaction
  Preparing        :                                                        1/1 
  Installing       : net-tools-2.0-0.52.20160912git.el8.x86_64              1/1 
  Running scriptlet: net-tools-2.0-0.52.20160912git.el8.x86_64              1/1 
  Verifying        : net-tools-2.0-0.52.20160912git.el8.x86_64              1/1 

Installed:
  net-tools-2.0-0.52.20160912git.el8.x86_64                                     

Complete!
Removing intermediate container 3a13d71952e5
 ---&gt; 0d095f331d4a
Step 7/10 : EXPOSE 80
 ---&gt; Running in 66d8aceea20c
Removing intermediate container 66d8aceea20c
 ---&gt; a86402c5f9b7
Step 8/10 : CMD echo $MYPATH
 ---&gt; Running in b6af3ea8ff6a
Removing intermediate container b6af3ea8ff6a
 ---&gt; 17533352607f
Step 9/10 : CMD echo &quot;---end---&quot;
 ---&gt; Running in f015d24c9277
Removing intermediate container f015d24c9277
 ---&gt; cf7d78851a04
Step 10/10 : CMD /bin/bash
 ---&gt; Running in d0f70eaa39ec
Removing intermediate container d0f70eaa39ec
 ---&gt; d59930f07e43
Successfully built d59930f07e43
Successfully tagged mycentos:1.0


# 3、测试运行，官方的centos镜像中是没有网络命令和VIM命令的，而自己构建的centos中已经有
[root@parak dockerfile]# docker run -it --name=mycen mycentos:1.0 
[root@43b0b7eb76d8 local]# pwd
/usr/local
[root@43b0b7eb76d8 local]# vim test
[root@43b0b7eb76d8 local]# cat test 
Khighness
[root@43b0b7eb76d8 local]# ifconfig
eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
        inet 172.17.0.4  netmask 255.255.0.0  broadcast 172.17.255.255
        ether 02:42:ac:11:00:04  txqueuelen 0  (Ethernet)
        RX packets 8  bytes 656 (656.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0    
[root@43b0b7eb76d8 local]# exit
exit

# 4、查看镜像的变更历史
[root@parak dockerfile]# docker history mycentos:1.0 
IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT
d59930f07e43        23 minutes ago      /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;/bin…   0B          
cf7d78851a04        23 minutes ago      /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;echo…   0B               
17533352607f        23 minutes ago      /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;echo…   0B                  
a86402c5f9b7        23 minutes ago      /bin/sh -c #(nop)  EXPOSE 80                    0B                  
0d095f331d4a        23 minutes ago      /bin/sh -c yum -y install net-tools             23.2MB              
491907dac3e2        23 minutes ago      /bin/sh -c yum -y install vim                   57.7MB              
fdbae7da4ca4        24 minutes ago      /bin/sh -c #(nop) WORKDIR /usr/local            0B                  
a5710fdc760e        24 minutes ago      /bin/sh -c #(nop)  ENV MYPATH=/usr/local        0B                  
6c9b636504d2        24 minutes ago      /bin/sh -c #(nop)  MAINTAINER khighness&lt;1823…   0B                  
0d120b6ccaa8        3 months ago        /bin/sh -c #(nop)  CMD [&quot;/bin/bash&quot;]            0B                  
&lt;missing&gt;           3 months ago        /bin/sh -c #(nop)  LABEL org.label-schema.sc…   0B                  
&lt;missing&gt;           3 months ago        /bin/sh -c #(nop) ADD file:538afc0c5c964ce0d…   215MB         </code></pre>
<blockquote>
<p>CMD和ENTRYPOINT的区别</p>
</blockquote>
<p><strong>测试CMD</strong></p>
<pre><code class="shell"># 编写测试CMD的dockerfile
[root@parak dockerfile]# vim dockerfile-cmd-test1
# 内容就是一个CMD命令
[root@parak dockerfile]# cat dockerfile-cmd-test1 
FROM centos
CMD [&quot;ls&quot;,&quot;-a&quot;]
# 构建镜像
[root@parak dockerfile]# docker build -f dockerfile-cmd-test1 -t cmdtest .
Sending build context to Docker daemon  3.072kB
Step 1/2 : FROM centos
 ---&gt; 0d120b6ccaa8
Step 2/2 : CMD [&quot;ls&quot;,&quot;-a&quot;]
 ---&gt; Running in e4df49ad7ca4
Removing intermediate container e4df49ad7ca4
 ---&gt; 4be395747805
Successfully built 4be395747805
Successfully tagged cmdtest:latest
# 运行镜像就相当于运行CMD命令：ls -a
[root@parak dockerfile]# docker run cmdtest
.
..
.dockerenv
bin
dev
etc
home
lib
lib64
lost+found
media
mnt
opt
proc
root
run
sbin
srv
sys
tmp
usr
var
# 追加命令-l，即ls -al
[root@parak dockerfile]# docker run cmdtest -l
docker: Error response from daemon: OCI runtime create failed: container_linux.go:349: starting container process caused &quot;exec: \&quot;-l\&quot;: executable file not found in $PATH&quot;: unknown.

</code></pre>
<p><strong>测试ENTRYPOINT</strong></p>
<pre><code class="shell"># 编写测试ENTRYPOINT的dockerfile
[root@parak dockerfile]# vim dockerfile-entrypoint-test1
# 内容就是一个ENTRYPOINT命令
[root@parak dockerfile]# cat dockerfile-entrypoint-test1 
FROM centos
ENTRYPOINT [&quot;ls&quot;, &quot;-a&quot;]
# 构建镜像
[root@parak dockerfile]# docker build -f dockerfile-entrypoint-test1 -t entrypointtest .
Sending build context to Docker daemon  4.096kB
Step 1/2 : FROM centos
 ---&gt; 0d120b6ccaa8
Step 2/2 : ENTRYPOINT [&quot;ls&quot;, &quot;-a&quot;]
 ---&gt; Running in 0aa9b4c97293
Removing intermediate container 0aa9b4c97293
 ---&gt; 472d86e826d8
Successfully built 472d86e826d8
Successfully tagged entrypointtest:latest
# 运行镜像
[root@parak dockerfile]# docker run entrypointtest
.
..
.dockerenv
bin
dev
etc
home
lib
lib64
lost+found
media
mnt
opt
proc
root
run
sbin
srv
sys
tmp
usr
var
# 追击命令-l，即ls -al
[root@parak dockerfile]# docker run entrypointtest -l
total 0
drwxr-xr-x.   1 root root   6 Dec  7 12:27 .
drwxr-xr-x.   1 root root   6 Dec  7 12:27 ..
-rwxr-xr-x.   1 root root   0 Dec  7 12:27 .dockerenv
lrwxrwxrwx.   1 root root   7 May 11  2019 bin -&gt; usr/bin
drwxr-xr-x.   5 root root 340 Dec  7 12:27 dev
drwxr-xr-x.   1 root root  66 Dec  7 12:27 etc
drwxr-xr-x.   2 root root   6 May 11  2019 home
lrwxrwxrwx.   1 root root   7 May 11  2019 lib -&gt; usr/lib
lrwxrwxrwx.   1 root root   9 May 11  2019 lib64 -&gt; usr/lib64
drwx------.   2 root root   6 Aug  9 21:40 lost+found
drwxr-xr-x.   2 root root   6 May 11  2019 media
drwxr-xr-x.   2 root root   6 May 11  2019 mnt
drwxr-xr-x.   2 root root   6 May 11  2019 opt
dr-xr-xr-x. 259 root root   0 Dec  7 12:27 proc
dr-xr-x---.   2 root root 162 Aug  9 21:40 root
drwxr-xr-x.  11 root root 163 Aug  9 21:40 run
lrwxrwxrwx.   1 root root   8 May 11  2019 sbin -&gt; usr/sbin
drwxr-xr-x.   2 root root   6 May 11  2019 srv
dr-xr-xr-x.  13 root root   0 Dec  6 08:24 sys
drwxrwxrwt.   7 root root 145 Aug  9 21:40 tmp
drwxr-xr-x.  12 root root 144 Aug  9 21:40 usr
drwxr-xr-x.  20 root root 262 Aug  9 21:40 var</code></pre>
<br>

<h2 id="🔍镜像"><a href="#🔍镜像" class="headerlink" title="🔍镜像"></a>🔍镜像</h2><blockquote>
<p>概念</p>
</blockquote>
<p>镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含运行某个软件所需的所有内容，包括代码、运行时、库、环境变量和配置文件。</p>
<blockquote>
<p>UnionFS(联合文件系统)</p>
</blockquote>
<p>UnionFS: 联合文件系统是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下(Unite several directions into a single virtual file system)。Union文件系统是Docker镜像的基础。镜像可以通过分层来进行继承，基于基础镜像(没有父镜像)，可以制作各种具体的应用镜像。</p>
<p>特性：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录。</p>
<blockquote>
<p>Docker镜像加载原理</p>
</blockquote>
<p>Docker的镜像实际上由一层一层的文件系统组成，这种层级的文件系统UnionFS。</p>
<p>bootfs(boot file system)主要包含bootloader和kernel，bootloader主要是引导加载kernel，Linux刚启动时会在家bootfs文件系统，在Docker镜像的最底层是bootfs。这一层与我们典型的Linux/Unix系统是一样的，包含boot加载器和内核。当boot加载完成之后整个内核就都在内存中了，此时内存和使用权已由bootfs转交给内核，此时系统也会卸载bootfs。</p>
<p>rootfs(root file system)，在bootfs之后。包含的就是典型Linux系统/dev，/proc，/bin，/etc等标准目录和文件。rootfs就是各种不同的操作系统发行版，比如Ubuntu、CentOS等等。</p>
<blockquote>
<p>commit镜像</p>
</blockquote>
<pre><code class="shell">$ docker commit -m=&quot;&lt;messahe&gt;&quot; -a=&quot;&lt;author&gt;&quot; &lt;Container ID/NAME&gt; &lt;Target&gt;:&lt;Tag&gt;

# 例如，改装tomcat:9.0的镜像打包成自己的镜像k-tom:1.0
[root@parak khighness]# docker commit -a=&quot;Khighness&quot; -m=&quot;Add web application&quot; tom1 k-tom:1.0
sha256:fa4617c8771c81b890dc2a87c7be1d2b851c6ba92b053d0d1d8730b2006550c5
[root@parak khighness]# docker images
REPOSITORY            TAG                 IMAGE ID            CREATED             SIZE
k-tom                 1.0                 fa4617c8771c        26 seconds ago      654MB
nginx                 latest              bc9a0695f571        11 days ago         133MB
tomcat                9.0                 e0bd8b34b4ea        2 weeks ago         649MB
redis                 latest              74d107221092        2 weeks ago         104MB
portainer/portainer   latest              62771b0b9b09        4 months ago        79.1MB
elasticsearch         7.6.2               f29a1ee41030        8 months ago        791MB
hello-world           latest              bf756fb1ae65        11 months ago       13.3kB</code></pre>
<br>

<h2 id="🌀容器数据卷"><a href="#🌀容器数据卷" class="headerlink" title="🌀容器数据卷"></a>🌀容器数据卷</h2><blockquote>
<p>概念</p>
</blockquote>
<p>目录挂载，将容器内的目录挂载在CentOS上</p>
<ul>
<li>Docker容器产生的数据同步到宿主机</li>
<li>数据卷可以在容器之间共享或重用数据</li>
</ul>
<blockquote>
<p>命令行挂载</p>
</blockquote>
<pre><code class="shell">$ docker run -it -v -p &lt;主机目录&gt;:&lt;容器目录&gt; 

# 例如，将docker的centos容器目录/home/test与宿主centos的/home/test挂载起来
[root@parak khighness]# docker run -it --name=cen -v /home/test:/home/test centos  /bin/bash
Unable to find image &#39;centos:latest&#39; locally
latest: Pulling from library/centos
3c72a8ed6814: Pull complete 
Digest: sha256:76d24f3ba3317fa945743bb3746fbaf3a0b752f10b10376960de01da70685fbd
Status: Downloaded newer image for centos:latest
[root@4410a5c86528 /]# ls
bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
[root@4410a5c86528 /]# cd home/
[root@4410a5c86528 home]# ls
test
[khighness@parak ~]$ cd /home/
[khighness@parak home]$ ls
khighness  test
[root@parak home]# docker inspect cen
# 如下是挂载信息
        &quot;Mounts&quot;: [
            &#123;
                &quot;Type&quot;: &quot;bind&quot;,              # 类型：绑定
                &quot;Source&quot;: &quot;/home/test&quot;,      # 容器目录
                &quot;Destination&quot;: &quot;/home/test&quot;, # 主机目录
                &quot;Mode&quot;: &quot;&quot;,
                &quot;RW&quot;: true,
                &quot;Propagation&quot;: &quot;rprivate&quot;
            &#125;
        ]
</code></pre>
<p>在容器的挂载目录下新建K1.java，在宿主机的挂载目录中可以直接看到</p>
<img src= "https://cdn.jsdelivr.net/gh/Khighness/cdn/common/loading.gif" data-lazy-src="/posts/f5f9fa9b/image-20201206183841366.png" class="" title="image-20201206183841366">



<blockquote>
<p>安装MySQL</p>
</blockquote>
<pre><code class="shell"># 下载8.0.20版本的mysql镜像
$ docker pull mysql:8.0.20
# 启动mysql服务
# -d 后台运行
# -v 挂载配置和数据
# -e MYSQL_ROOT)PASSWORD 设置密码
$ docker run --name ksql -d -p 3306:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=KAG1823 mysql:8.0.20

# 解决windows的navicat无法连接的问题
# 进入mysql客户端
$ docker exec -it ksql  bash
# 登录mysql
$ mysql -u root -pKAG1823
# 重置密码
$ ALTER USER &#39;root&#39;@&#39;%&#39; IDENTIFIED WITH mysql_native_password BY &#39;KAG1823&#39;;</code></pre>
<br>

<h2 id="🌐Docker网络"><a href="#🌐Docker网络" class="headerlink" title="🌐Docker网络"></a>🌐Docker网络</h2><blockquote>
<p>实现原理</p>
</blockquote>
<p>Docker使用Linux桥接，在宿主机虚拟一个Docker容器网桥(Docker0)，Docker启动一个容器时会根据Docker网桥的网段分配给容器一个IP地址，称为Container-IP，同时Docker网桥是每个容器的默认网关。因为在同一宿主机内的容器都接入同一网桥。这样容器之间就能够通过容器的Contain-IP直接通信。</p>
<p>Docker网桥是宿主机虚拟出来的，并不是真实存在的网络设备，外部设备是无法寻址到的，这也意味着外部设备无法通过直接Container-IP访问到容器。如果容器希望外部访问到，可以通过映射容器端口到宿主主机（端口映射），即docker run创建容器时候通过-p或者-P参数来启动，访问容器的时候就通过[宿主机IP]:[容器端口]访问容器。</p>
<blockquote>
<p>网络模式</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">模式</th>
<th align="center">配置</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Bridge模式</td>
<td align="center">-net=bridge</td>
<td align="center">默认模式</td>
</tr>
<tr>
<td align="center">Host模式</td>
<td align="center">-net=host</td>
<td align="center">容器和宿主机共享Network NameSpace</td>
</tr>
<tr>
<td align="center">Container模式</td>
<td align="center">-net=container : NAME OR ID</td>
<td align="center">容器和另外一个容器共享Network NameSpace</td>
</tr>
<tr>
<td align="center">None模式</td>
<td align="center">-net=none</td>
<td align="center">容器有独立的Network NameSpace，但并没有对其进行任何网络设置，如分配veth pair 和网桥连接，配置IP等</td>
</tr>
</tbody></table>
<br>

<h3 id="1️⃣host模式"><a href="#1️⃣host模式" class="headerlink" title="1️⃣host模式"></a>1️⃣host模式</h3><p>如果启动容器的时候使用host模式，那么这个容器将不会获得一个独立的Network NameSpace，而是和宿主机共用一个Network NameSpace。容器将不会虚拟出自己的网卡，配置自己的IP等，而是使用宿主机的IP和端口。但是，容器的其他方面，如文件系统、进程列表等还是和宿主机隔离的。</p>
<p>使用host模式的容器可以直接使用宿主机的IP地址与外界通信，容器内部的服务端口也可以使用宿主机的端口，不需要进行NAT，host最大的优势就是网络性能比较好，但是docker host上已经使用的端口就不能再用了，网络的隔离性不好。</p>
<br>

<h3 id="2️⃣container模式"><a href="#2️⃣container模式" class="headerlink" title="2️⃣container模式"></a>2️⃣container模式</h3><p>这个模式指定新创建的容器和已经存在的一个容器共享一个 Network NameSpace，而不是和宿主机共享。新创建的容器不会创建自己的网卡，配置自己的 IP，而是和一个指定的容器共享 IP、端口范围等。同样，两个容器除了网络方面，其他的如文件系统、进程列表等还是隔离的。两个容器的进程可以通过 lo 网卡设备通信。</p>
<br>

<h3 id="3️⃣none模式"><a href="#3️⃣none模式" class="headerlink" title="3️⃣none模式"></a>3️⃣none模式</h3><p>使用none模式，Docker容器拥有自己的Network NameSpace，但是，并不为Docker容器进行任何网络配置。也就是说，这个Docker容器没有网卡、IP、路由等信息。需要我们自己为Docker容器添加网卡、配置IP等。</p>
<p>这种网络模式下容器只有lo回环网络，没有其他网卡。none模式可以在容器创建时通过–network=none来指定。这种类型的网络没有办法联网，封闭的网络能很好的保证容器的安全性。</p>
<br>

<h3 id="4️⃣bridge模式"><a href="#4️⃣bridge模式" class="headerlink" title="4️⃣bridge模式"></a>4️⃣bridge模式</h3><p>当Docker进程启动时，会在主机上创建一个名为docker0的虚拟网桥，此主机上启动的Docker容器会连接到这个虚拟网桥上。虚拟网桥的工作方式和物理交换机类似，这样主机上的所有容器就通过交换机连在了一个二层网络中。</p>
<p>从docker0子网中分配一个IP给容器使用，并设置docker0的IP地址为容器的默认网关。在主机上创建一对虚拟网卡veth pair设备，Docker将veth pair设备的一端放在新创建的容器中，并命名为eth0（容器的网卡），另一端放在主机中，以vethxxx这样类似的名字命名，并将这个网络设备加入到docker0网桥中。可以通过brctl show命令查看。</p>
<p>bridge模式是docker的默认网络模式，不写–net参数，就是bridge模式。使用docker run -p时，docker实际是在iptables做了DNAT规则，实现端口转发功能。可以使用iptables -t nat -vnL查看。</p>
<blockquote>
<p>–link探究</p>
</blockquote>
<p>官方已经不推荐使用，我们可以了解一下。</p>
<p>2个容器之间互相访问通信：<code>docker run &lt;container1-id/name&gt; --link &lt;container2-id/name&gt; &lt;image&gt;</code></p>
<p>使用这个命令启动容器2的时候，容器便可以ping通容器1，但是反向ping不通。</p>
<pre><code class="shell"># 创建容器tom1
[root@parak khighness]# docker run -d -p 3356:8080 --name tom1 tomcat:9.0 
dd615d6d2ccb9467aad8ba008ece995588680d849b9f61945b10de5c3475f671
# 使用--link创建容器2
[root@parak khighness]# docker run -d -p 3357:8081 --name tom2 --link tom1  tomcat:9.0 
b2c17969a2cb4407bb1a61a53703a38998a11db01ce516feb70e397b42af6ad3
# tom1不能ping通tom2
[root@parak khighness]# docker exec -it tom1 ping tom2
ping: tom2: Name or service not known
# tom2可以ping通tom1
[root@parak khighness]# docker exec -it tom2 ping tom1
PING tom1 (172.17.0.4) 56(84) bytes of data.
64 bytes from tom1 (172.17.0.4): icmp_seq=1 ttl=64 time=0.161 ms
64 bytes from tom1 (172.17.0.4): icmp_seq=2 ttl=64 time=0.108 ms
64 bytes from tom1 (172.17.0.4): icmp_seq=3 ttl=64 time=0.122 ms
^C
--- tom1 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 4ms
rtt min/avg/max/mdev = 0.108/0.130/0.161/0.024 ms
# 查看tom2内部的hosts文件
[root@parak khighness]# docker exec -it tom2 cat /etc/hosts
127.0.0.1    localhost
::1    localhost ip6-localhost ip6-loopback
fe00::0    ip6-localnet
ff00::0    ip6-mcastprefix
ff02::1    ip6-allnodes
ff02::2    ip6-allrouters
172.17.0.4    tom1 dd615d6d2ccb # ==&gt; 根源：本质就是tom2就是在本地配置了tom1的域名IP解析。
172.17.0.5    b2c17969a2cb</code></pre>
<blockquote>
<p>自定义网络</p>
</blockquote>
<pre><code class="shell"># 创建网络
[root@parak khighness]# docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet
abaebdc493149a140ee77965274885adea3882bf117c4f8e61e4034730c3b890
# 查看网络
[root@parak khighness]# docker network ls
NETWORK ID          NAME                DRIVER              SCOPE
4399361ba4a9        bridge              bridge              local
65f0ec2bfb42        host                host                local
abaebdc49314        mynet               bridge              local
feab1dfce431        none                null                local
# 详细信息
[root@parak khighness]# docker network inspect mynet 
[
    &#123;
        &quot;Name&quot;: &quot;mynet&quot;,
        &quot;Id&quot;: &quot;abaebdc493149a140ee77965274885adea3882bf117c4f8e61e4034730c3b890&quot;,
        &quot;Created&quot;: &quot;2020-12-10T16:12:08.563828418+08:00&quot;,
        &quot;Scope&quot;: &quot;local&quot;,
        &quot;Driver&quot;: &quot;bridge&quot;,
        &quot;EnableIPv6&quot;: false,
        &quot;IPAM&quot;: &#123;
            &quot;Driver&quot;: &quot;default&quot;,
            &quot;Options&quot;: &#123;&#125;,
            &quot;Config&quot;: [
                &#123;
                    &quot;Subnet&quot;: &quot;192.168.0.0/16&quot;,
                    &quot;Gateway&quot;: &quot;192.168.0.1&quot;
                &#125;
            ]
        &#125;,
        &quot;Internal&quot;: false,
        &quot;Attachable&quot;: false,
        &quot;Ingress&quot;: false,
        &quot;ConfigFrom&quot;: &#123;
            &quot;Network&quot;: &quot;&quot;
        &#125;,
        &quot;ConfigOnly&quot;: false,
        &quot;Containers&quot;: &#123;&#125;,
        &quot;Options&quot;: &#123;&#125;,
        &quot;Labels&quot;: &#123;&#125;
    &#125;
]
# 在mynet下启动tomcat1
[root@parak khighness]# docker run -d -it -p 8080:3355 --net mynet --name mynet-tom1 tomcat:9.0 
4d799757f01f560af7fd44d610b7fdabd1e0f66ef528bf1259f09242bddbb636
# 在mynet下启动tomcat2
[root@parak khighness]# docker run -d -it -p 8081:3356 --net mynet --name mynet-tom2 tomcat:9.0 
15c045f96d5b7b2ee2e470cb69e5b1f86511929f7ed05ed8f20db26ef4b975af
# 使用mynet-tom2 ping mynet-tom1
[root@parak khighness]# docker exec -it mynet-tom2 ping mynet-tom1
PING mynet-tom1 (192.168.0.2) 56(84) bytes of data.
64 bytes from mynet-tom1.mynet (192.168.0.2): icmp_seq=1 ttl=64 time=0.068 ms
64 bytes from mynet-tom1.mynet (192.168.0.2): icmp_seq=2 ttl=64 time=0.042 ms
64 bytes from mynet-tom1.mynet (192.168.0.2): icmp_seq=3 ttl=64 time=0.055 ms
--- mynet-tom1 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 4ms
rtt min/avg/max/mdev = 0.042/0.055/0.068/0.010 ms
# 使用mynet-tom1 ping mynet-tom2
[root@parak khighness]# docker exec -it mynet-tom1 ping mynet-tom2
PING mynet-tom2 (192.168.0.3) 56(84) bytes of data.
64 bytes from mynet-tom2.mynet (192.168.0.3): icmp_seq=1 ttl=64 time=0.036 ms
64 bytes from mynet-tom2.mynet (192.168.0.3): icmp_seq=2 ttl=64 time=0.048 ms
64 bytes from mynet-tom2.mynet (192.168.0.3): icmp_seq=3 ttl=64 time=0.058 ms
--- mynet-tom2 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2ms
rtt min/avg/max/mdev = 0.036/0.047/0.058/0.010 ms</code></pre>
<p>自定义网络自动维护好容器的网络关系！</p>
<blockquote>
<p>网络连通</p>
</blockquote>
<pre><code class="shell"># 在Docker0网络启动tomcat
[root@parak khighness]# docker run -d -it -p 8082:3357 --name tom1 tomcat:9.0 
0344f04baab2eaeaac0118dac7a93d8b2d77946636c76ed3bde804cbeda836be
# 测试tom1 ping mynet—tom1
[root@parak khighness]# docker exec tom1 ping mynet-tom1
ping: mynet-tom1: Name or service not known
# 连通mynet - tom1
[root@parak khighness]# docker network connect mynet tom1 
# 查看mynet1的详细信息
[root@parak khighness]# docker inspect mynet
[
    &#123;
        &quot;Name&quot;: &quot;mynet&quot;,
        &quot;Id&quot;: &quot;abaebdc493149a140ee77965274885adea3882bf117c4f8e61e4034730c3b890&quot;,
        &quot;Created&quot;: &quot;2020-12-10T16:12:08.563828418+08:00&quot;,
        &quot;Scope&quot;: &quot;local&quot;,
        &quot;Driver&quot;: &quot;bridge&quot;,
        &quot;EnableIPv6&quot;: false,
        &quot;IPAM&quot;: &#123;
            &quot;Driver&quot;: &quot;default&quot;,
            &quot;Options&quot;: &#123;&#125;,
            &quot;Config&quot;: [
                &#123;
                    &quot;Subnet&quot;: &quot;192.168.0.0/16&quot;,
                    &quot;Gateway&quot;: &quot;192.168.0.1&quot;
                &#125;
            ]
        &#125;,
        &quot;Internal&quot;: false,
        &quot;Attachable&quot;: false,
        &quot;Ingress&quot;: false,
        &quot;ConfigFrom&quot;: &#123;
            &quot;Network&quot;: &quot;&quot;
        &#125;,
        &quot;ConfigOnly&quot;: false,
        &quot;Containers&quot;: &#123;
            # 发现mynet将tom1放到了mynet网络下，即一个容器，两个IP
            &quot;0344f04baab2eaeaac0118dac7a93d8b2d77946636c76ed3bde804cbeda836be&quot;: &#123;
                &quot;Name&quot;: &quot;tom1&quot;,
                &quot;EndpointID&quot;: &quot;8911ad05a9b0d7d0effbf50c82659f36b82d21e18f992359b09494073dddd969&quot;,
                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:04&quot;,
                &quot;IPv4Address&quot;: &quot;192.168.0.4/16&quot;,
                &quot;IPv6Address&quot;: &quot;&quot;
            &#125;,
            &quot;15c045f96d5b7b2ee2e470cb69e5b1f86511929f7ed05ed8f20db26ef4b975af&quot;: &#123;
                &quot;Name&quot;: &quot;mynet-tom2&quot;,
                &quot;EndpointID&quot;: &quot;907f16284e90be0d880a999b29210d1cd82adb2c79b4179eeb1d70d75130362a&quot;,
                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:03&quot;,
                &quot;IPv4Address&quot;: &quot;192.168.0.3/16&quot;,
                &quot;IPv6Address&quot;: &quot;&quot;
            &#125;,
            &quot;4d799757f01f560af7fd44d610b7fdabd1e0f66ef528bf1259f09242bddbb636&quot;: &#123;
                &quot;Name&quot;: &quot;mynet-tom1&quot;,
                &quot;EndpointID&quot;: &quot;6529ef4fc05dffe65fe875fdf15f2f4a61665c4d969767db94dd828baf88b323&quot;,
                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:02&quot;,
                &quot;IPv4Address&quot;: &quot;192.168.0.2/16&quot;,
                &quot;IPv6Address&quot;: &quot;&quot;
            &#125;
        &#125;,
        &quot;Options&quot;: &#123;&#125;,
        &quot;Labels&quot;: &#123;&#125;
    &#125;
]
# 再次测试tom1 ping mynet—tom1
[root@parak khighness]# docker exec -it tom1 ping mynet-tom1
PING mynet-tom1 (192.168.0.2) 56(84) bytes of data.
64 bytes from mynet-tom1.mynet (192.168.0.2): icmp_seq=1 ttl=64 time=0.097 ms
64 bytes from mynet-tom1.mynet (192.168.0.2): icmp_seq=2 ttl=64 time=0.052 ms
64 bytes from mynet-tom1.mynet (192.168.0.2): icmp_seq=3 ttl=64 time=0.053 ms
--- mynet-tom1 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 3ms
rtt min/avg/max/mdev = 0.052/0.067/0.097/0.022 ms</code></pre>
<br>

<h2 id="💠Redis集群部署"><a href="#💠Redis集群部署" class="headerlink" title="💠Redis集群部署"></a>💠Redis集群部署</h2><blockquote>
<p>shell脚本</p>
</blockquote>
<pre><code class="shell"># 创建网卡
docker network create redis --subnet 172.38.0.0/16

# 通过脚本创建六个redis配置
for port in $(seq 1 6); \
do \
mkdir -p /mydata/redis/node-$&#123;port&#125;/conf
touch /mydata/redis/node-$&#123;port&#125;/conf/redis.conf
cat &lt;&lt; EOF &gt;&gt;/mydata/redis/node-$&#123;port&#125;/conf/redis.conf
port 6379
bind 0.0.0.0
cluster-enabled yes
cluster-config-file nodes.conf
cluster-node-timeout 5000
cluster-announce-ip 172.38.0.1$&#123;port&#125;
cluster-announce-port 6379
cluster-announce-bus-port 16379
appendonly yes
EOF
done

# 运行redis
for port in $(seq 1 6); \
do
docker run -p 637$&#123;port&#125;:6379 -p 1637$&#123;port&#125;:16379 --name redis-$&#123;port&#125; \
-v /mydata/redis/node-$&#123;port&#125;/data:/data \
-v /mydata/redis/node-$&#123;port&#125;/conf/redis.conf:/etc/redis/redis.conf \
-d --net redis --ip 172.38.0.1$&#123;port&#125; redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf
done

# 进入redis-1
docker exec -it redis-1 /bin/sh
# 搭建集群
redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379 

# 停止集群
for port in $(seq 1 6); \
do
docker stop redis-$&#123;port&#125; 
done

# 启动集群
for port in $(seq 1 6); \
do 
docker start redis-$&#123;port&#125; 
done</code></pre>
<br>

<h2 id="💨SpringBoot测试"><a href="#💨SpringBoot测试" class="headerlink" title="💨SpringBoot测试"></a>💨SpringBoot测试</h2><blockquote>
<p>步骤</p>
</blockquote>
<ul>
<li>构建SpringBoot项目</li>
<li>打包web应用</li>
<li>编写dockerfile</li>
<li>构建镜像</li>
<li>发布运行</li>
</ul>
<blockquote>
<p>编写Controller</p>
</blockquote>
<pre><code class="java">@RestController
public class HelloController &#123;
    @GetMapping(&quot;/hello/&#123;name&#125;&quot;)
    public String sayHello(@PathVariable(&quot;name&quot;) String name) &#123;
        return &quot;Hello, &quot; + name + &quot;\n\n&quot; + &quot; -from KHighness&quot;;
    &#125;
&#125;</code></pre>
<blockquote>
<p>通过maven的package打包</p>
</blockquote>
<pre><code class="shell">[INFO] Scanning for projects...
[INFO] 
[INFO] --------------------------&lt; top.parak:hello &gt;---------------------------
[INFO] Building hello 1.0-SNAPSHOT
[INFO] --------------------------------[ jar ]---------------------------------
[INFO] --- maven-resources-plugin:3.1.0:resources (default-resources) @ hello ---
[INFO] Using &#39;UTF-8&#39; encoding to copy filtered resources.
[INFO] Copying 0 resource
[INFO] Copying 0 resource
[INFO] --- maven-compiler-plugin:3.8.1:compile (default-compile) @ hello ---
[INFO] Changes detected - recompiling the module!
[INFO] Compiling 2 source files to C:\Users\18236\Desktop\Recent\hello\target\classes
[INFO] --- maven-resources-plugin:3.1.0:testResources (default-testResources) @ hello ---
[INFO] Using &#39;UTF-8&#39; encoding to copy filtered resources.
[INFO] skip non existing resourceDirectory C:\Users\18236\Desktop\Recent\hello\src\test\resources
[INFO] --- maven-compiler-plugin:3.8.1:testCompile (default-testCompile) @ hello ---
[INFO] No sources to compile
[INFO] --- maven-surefire-plugin:2.22.2:test (default-test) @ hello ---
[INFO] No tests to run.
[INFO] --- maven-jar-plugin:3.1.2:jar (default-jar) @ hello ---
[INFO] Building jar: C:\Users\18236\Desktop\Recent\hello\target\hello-1.0-SNAPSHOT.jar
[INFO] --- spring-boot-maven-plugin:2.2.5.RELEASE:repackage (repackage) @ hello ---
[INFO] Replacing main artifact with repackaged archive
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  5.534 s
[INFO] Finished at: 2020-12-10T17:54:11+08:00
[INFO] ------------------------------------------------------------------------</code></pre>
<blockquote>
<p>编写Dockerfile</p>
</blockquote>
<pre><code class="shell">FROM java:8

COPY *.jar /app.jar

CMD [&quot;--server.port=8080&quot;]

EXPOSE 8080

ENTRYPOINT [&quot;java&quot;, &quot;-jar&quot;, &quot;/app.jar&quot;]</code></pre>
<p>通过Xftp将构建好的jar包和DockerFile发送到虚拟机</p>
<blockquote>
<p>构建镜像</p>
</blockquote>
<pre><code class="shell">[root@parak hello]# docker build -t hello .
Sending build context to Docker daemon   17.6MB
Step 1/5 : FROM java:8
 ---&gt; d23bdf5b1b1b
Step 2/5 : COPY *.jar /app.jar
 ---&gt; 34774df7a107
Step 3/5 : CMD [&quot;--server.port=8080&quot;]
 ---&gt; [Warning] IPv4 forwarding is disabled. Networking will not work.
 ---&gt; Running in 11d95474e047
Removing intermediate container 11d95474e047
 ---&gt; e8b6fa21a3a0
Step 4/5 : EXPOSE 8080
 ---&gt; [Warning] IPv4 forwarding is disabled. Networking will not work.
 ---&gt; Running in 896cc7d50875
Removing intermediate container 896cc7d50875
 ---&gt; b139242b232d
Step 5/5 : ENTRYPOINT [&quot;java&quot;, &quot;-jar&quot;, &quot;/app.jar&quot;]
 ---&gt; [Warning] IPv4 forwarding is disabled. Networking will not work.
 ---&gt; Running in 562f3bb605a0
Removing intermediate container 562f3bb605a0
 ---&gt; 1d28463205d5
Successfully built 1d28463205d5
Successfully tagged hello:latest</code></pre>
<blockquote>
<p>运行镜像</p>
</blockquote>
<pre><code class="shell">[root@parak hello]# docker run -d -it -p 8001:8080 hello
7e19b364789de18c736c51e5c84d611e7474d3a733f188220dfd7cc011e55729
[root@parak hello]# curl http://192.168.117.155:8001/hello/KKK
Hello, KKK

 -from KHighness</code></pre>
<br>

<h2 id="⭕相关问题"><a href="#⭕相关问题" class="headerlink" title="⭕相关问题"></a>⭕相关问题</h2><blockquote>
<p>解决问题1: WARNING: IPv4 forwarding is disabled. Networking will not work.</p>
</blockquote>
<pre><code class="shell">$ echo &quot;net.ipv4.ip_forward=1&quot; &gt;&gt;/usr/lib/sysctl.d/00-system.conf
$ systemctl restart network &amp;&amp; systemctl restart docker</code></pre>
<blockquote>
<p>解决问题2: 使用阿里云服务器运行一个容器，外部IP不能访问</p>
</blockquote>
<p>需要在阿里云服务器配置防火墙相关端口对外开放。</p>
<p>比如跑一个开放端口为3333的springboot应用需要在阿里云服务器控制台的防火墙添加规则:</p>
<img src= "https://cdn.jsdelivr.net/gh/Khighness/cdn/common/loading.gif" data-lazy-src="/posts/f5f9fa9b/image-20201211233834182.png" class="" title="image-20201211233834182">



</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://parak.top">Khighness</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://parak.top/posts/f5f9fa9b">https://parak.top/posts/f5f9fa9b</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用<a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"> CC BY-NC-SA 4.0 </a>许可协议。转载请注明来自<a href="https://www.parak.top">炒菜K殿下</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Docker/">Docker</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/Khighness/cdn/top/bg-14.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/Khighness/cdn/avatar/wepay.jpg" target="_blank"><img class="post-qr-code-img" data-lazy-src="https://cdn.jsdelivr.net/gh/Khighness/cdn/avatar/wepay.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/Khighness/cdn/avatar/alipay.jpg" target="_blank"><img class="post-qr-code-img" data-lazy-src="https://cdn.jsdelivr.net/gh/Khighness/cdn/avatar/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/c24675b4/"><img class="prev-cover" data-lazy-src="https://cdn.jsdelivr.net/gh/Khighness/cdn/top/bg-15.jpg" onerror="onerror=null;src='https://cdn.jsdelivr.net/gh/Khighness/cdn/common/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">MySQL</div></div></a></div><div class="next-post pull-right"><a href="/posts/33422a09/"><img class="next-cover" data-lazy-src="https://cdn.jsdelivr.net/gh/Khighness/cdn/top/bg-13.jpg" onerror="onerror=null;src='https://cdn.jsdelivr.net/gh/Khighness/cdn/common/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">负距离</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Twikoo</span><span class="switch-btn"></span><span class="second-comment">Valine</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%96%E6%A6%82%E8%BF%B0"><span class="toc-text">📖概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%A8%E5%AE%89%E8%A3%85"><span class="toc-text">🔨安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%9A%80%E5%8E%9F%E7%90%86"><span class="toc-text">🚀原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%B0%E5%91%BD%E4%BB%A4"><span class="toc-text">🔰命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%B8%8F%E2%83%A3%E5%B8%AE%E5%8A%A9%E5%91%BD%E4%BB%A4"><span class="toc-text">1️⃣帮助命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%B8%8F%E2%83%A3%E9%95%9C%E5%83%8F%E5%91%BD%E4%BB%A4"><span class="toc-text">2️⃣镜像命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%B8%8F%E2%83%A3%E5%AE%B9%E5%99%A8%E5%91%BD%E4%BB%A4"><span class="toc-text">3️⃣容器命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%B1%E7%BB%83%E4%B9%A0"><span class="toc-text">🔱练习</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%8C%A0-%E5%AE%89%E8%A3%85Nginx"><span class="toc-text">🌠 安装Nginx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%8C%A0-%E5%AE%89%E8%A3%85Tomcat"><span class="toc-text">🌠 安装Tomcat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%8C%A0%E5%AE%89%E8%A3%85es-kibana"><span class="toc-text">🌠安装es + kibana</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%88%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="toc-text">📈可视化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%91DockerFile"><span class="toc-text">📑DockerFile</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%8D%E9%95%9C%E5%83%8F"><span class="toc-text">🔍镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%8C%80%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-text">🌀容器数据卷</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%8C%90Docker%E7%BD%91%E7%BB%9C"><span class="toc-text">🌐Docker网络</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%B8%8F%E2%83%A3host%E6%A8%A1%E5%BC%8F"><span class="toc-text">1️⃣host模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%B8%8F%E2%83%A3container%E6%A8%A1%E5%BC%8F"><span class="toc-text">2️⃣container模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%B8%8F%E2%83%A3none%E6%A8%A1%E5%BC%8F"><span class="toc-text">3️⃣none模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%B8%8F%E2%83%A3bridge%E6%A8%A1%E5%BC%8F"><span class="toc-text">4️⃣bridge模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%92%A0Redis%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2"><span class="toc-text">💠Redis集群部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%92%A8SpringBoot%E6%B5%8B%E8%AF%95"><span class="toc-text">💨SpringBoot测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%AD%95%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98"><span class="toc-text">⭕相关问题</span></a></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdelivr.net/gh/Khighness/cdn/common/footer.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Khighness</div><div class="footer_custom_text"><a href="https://www.foreverblog.cn/" target="_blank" > <img src="https://img.foreverblog.cn/logo_en_default.png" alt="" style="width:auto;height:16px;"> </a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">簡</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      true && mermaid.init()
    })
  }
}</script><script>(()=>{
  const $countDom = document.getElementById('twikoo-count')
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'hexo-2grv2lyu1131c342',
      region: ''
    }, null))
  }

  const getCount = () => {
    twikoo.getCommentsCount({
      envId: 'hexo-2grv2lyu1131c342',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      $countDom.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const loadTwikoo = (bool = false) => {
    if (typeof twikoo === 'object') {
      init()
      bool && $countDom && setTimeout(getCount,0)
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(()=> {
        init()
        bool && $countDom && setTimeout(getCount,0)
      })
    }
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo(true)
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'Py2eOHzSdrnxKPzKrOJaHJOq-9Nh9j0Va',
      appKey: '9eQhwuCgyshpYKn4rtEhqt4R',
      placeholder: '',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: true,
      serverURLs: '',
      emojiCDN: 'https://cdn.jsdelivr.net/gh/imaegoo/emotion/owo.json',
      emojiMaps: "",
      enableQQ: true,
      path: window.location.pathname,
      requiredFields: ["nick, mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('/js/Valine.min.js').then(initValine)
}

if ('Twikoo' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'hexo-2grv2lyu1131c342',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.innerHTML= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})


document.addEventListener('pjax:send', function () {
  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>function history_calendar_injector_config(){
                var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
                var item_html = '<div class="card-widget card-history"><div class="card-content"><div class="item-headline"><i class="fas fa-clock fa-spin"></i><span>那年今日</span></div><div id="history-baidu" style="height: 100px;overflow: hidden"><div class="history_swiper-container" id="history-container" style="width: 100%;height: 100%"><div class="swiper-wrapper" id="history_container_wrapper" style="height:20px"></div></div></div></div>';
                console.log('已挂载history_calendar')
                // parent_div_git.innerHTML=item_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",item_html) // 有报错，但不影响使用(支持pjax跳转)
            }if( document.getElementsByClassName('sticky_layout')[0] && (location.pathname ==='/'|| '/' ==='all')){

            history_calendar_injector_config()
        } </script><script data-pjax  src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/js/main.js"></script><!-- hexo injector body_end end --></body></html>