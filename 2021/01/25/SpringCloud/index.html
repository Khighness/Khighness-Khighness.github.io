<!DOCTYPE html>


<html lang="zh-CN">


<head>
  <meta charset="utf-8" />
    
  <meta name="description" content="Kæ®¿" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
    Spring Cloud |  Kæ®¿
  </title>
  <meta name="generator" content="hexo-theme-ayer">
  
  <link rel="shortcut icon" href="/k.ico" />
  
  
<link rel="stylesheet" href="/dist/main.css">

  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css">

  
<link rel="stylesheet" href="/css/custom.css">

  
  
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

  
  

  

<link rel="alternate" href="/atom.xml" title="Khighness" type="application/atom+xml">
</head>

</html>

<body>
  <div id="app">
    
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-SpringCloud"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  Spring Cloud
</h1>
 

    </header>
     
    <div class="article-meta">
      <a href="/2021/01/25/SpringCloud/" class="article-date">
  <time datetime="2021-01-24T16:00:00.000Z" itemprop="datePublished">2021-01-25</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Spring-Cloud/">Spring Cloud</a>
  </div>
  
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> å­—æ•°ç»Ÿè®¡:</span>
            <span class="post-count">12.4k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> é˜…è¯»æ—¶é•¿â‰ˆ</span>
            <span class="post-count">51 åˆ†é’Ÿ</span>
        </span>
    </span>
</div>
 
    </div>
      
    <div class="tocbot"></div>




  
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="â˜ï¸-Spring-Cloud"><a href="#â˜ï¸-Spring-Cloud" class="headerlink" title="â˜ï¸ Spring Cloud"></a>â˜ï¸ Spring Cloud</h1><center>
    <font face="Kristen ITC" color="#555555" size=3>ğŸ’¤ Khighness ğŸ’¤</font><br>
</center>



<p><img src="https://img.shields.io/badge/java-8-brightgreen" alt="java"><img src="https://img.shields.io/badge/maven-3.6.3-brightgreen" alt="maven"><img src="https://img.shields.io/badge/mysql-8.0.20-brightgreen" alt="mysql"><img src="https://img.shields.io/badge/spring%20boot-2.2.2-brightgreen" alt="spring boot"><img src="https://img.shields.io/badge/spring%20cloud-Hoxton.SR1-brightgreen" alt="spring cloud"><img src="https://img.shields.io/badge/spring%20cloud%20alibaba-2.1.0-brightgreen" alt="spring cloud alibaba"><img src="https://img.shields.io/badge/fastjson-1.2.3-brightgreen" alt="fastjson"></p>
<p>code: <a target="_blank" rel="noopener" href="https://github.com/Khighness/cloud2020">https://github.com/Khighness/cloud2020</a></p>
<h2 id="ğŸ’¬-å¾®æœåŠ¡åºè¨€"><a href="#ğŸ’¬-å¾®æœåŠ¡åºè¨€" class="headerlink" title="ğŸ’¬ å¾®æœåŠ¡åºè¨€"></a>ğŸ’¬ å¾®æœåŠ¡åºè¨€</h2><h3 id="ğŸš€-å¾®æœåŠ¡æ¶æ„æ¦‚è¿°"><a href="#ğŸš€-å¾®æœåŠ¡æ¶æ„æ¦‚è¿°" class="headerlink" title="ğŸš€ å¾®æœåŠ¡æ¶æ„æ¦‚è¿°"></a>ğŸš€ å¾®æœåŠ¡æ¶æ„æ¦‚è¿°</h3><p>â€‹        å¾®æœåŠ¡æ¶æ„æ—¶ä¸€ç§æ¶æ„æ¨¡å¼ï¼Œå®ƒæå€¡å°†å•ä¸€åº”ç”¨ç¨‹åºåˆ’åˆ†æˆä¸€ç»„å°çš„æœåŠ¡ï¼ŒæœåŠ¡ä¹‹é—´äº’ç›¸åè°ƒã€äº’ç›¸é…åˆï¼Œä¸ºå“Ÿè¿‡æˆ·æä¾›æœ€ç»ˆä»·å€¼ã€‚æ¯ä¸ªæœåŠ¡è¿è¡Œåœ¨å…¶ç‹¬ç«‹çš„è¿›ç¨‹ä¸­ï¼ŒæœåŠ¡ä¸æœåŠ¡é—´é‡‡ç”¨è½»é‡çº§çš„é€šä¿¡æœºåˆ¶äº’ç›¸åä½œï¼ˆé€šå¸¸æ˜¯åŸºäºHTTPåè®®çš„Restful APIï¼‰ã€‚æ¯ä¸ªæœåŠ¡éƒ½å›´ç»•ç€å…·ä½“ä¸šåŠ¡è¿›è¡Œæ„å»ºï¼Œå¹¶ä¸”èƒ½å¤Ÿåˆ«ç‹¬ç«‹çš„éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€ç±»ç”Ÿäº§ç¯å¢ƒç­‰ã€‚å¦å¤–ï¼Œåº”è¯¥å°½é‡é¿å…åŒä¸€çš„ã€é›†ä¸­å¼çš„æœåŠ¡ç®¡ç†æœºåˆ¶ï¼Œå¯¹å…·ä½“çš„ä¸€ä¸ªæœåŠ¡è€Œè¨€ï¼Œåº”æ ¹æ®ä¸šåŠ¡ä¸Šä¸‹æ–‡ï¼Œé€‰æ‹©åˆé€‚çš„è¯­è¨€ã€å·¥å…·è¿›è¡Œæ„å»ºã€‚</p>
<h3 id="ğŸ“–-Spring-Cloudç®€ä»‹"><a href="#ğŸ“–-Spring-Cloudç®€ä»‹" class="headerlink" title="ğŸ“– Spring Cloudç®€ä»‹"></a>ğŸ“– Spring Cloudç®€ä»‹</h3><p>Spring Cloud = åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„çš„ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆã€‚</p>
<blockquote>
<p>åˆ†å¸ƒå¼å¾®æœåŠ¡</p>
</blockquote>
<ul>
<li>æœåŠ¡æ³¨å†Œä¸å‘ç°</li>
<li>æœåŠ¡è°ƒç”¨</li>
<li>æœåŠ¡ç†”æ–­</li>
<li>è´Ÿè½½å‡è¡¡</li>
<li>æœåŠ¡é™çº§</li>
<li>æœåŠ¡æ¶ˆæ¯é˜Ÿåˆ—</li>
<li>é…ç½®ä¸­å¿ƒç®¡ç†</li>
<li>æœåŠ¡ç½‘å…³</li>
<li>æœåŠ¡ç›‘æ§</li>
<li>å…¨é“¾è·¯è¿½è¸ª</li>
<li>è‡ªåŠ¨åŒ–æ„å»ºéƒ¨ç½²</li>
<li>æœåŠ¡å®šæ—¶ä»»åŠ¡è°ƒåº¦æ“ä½œ</li>
</ul>
<img src="/2021/01/25/SpringCloud/image-20201125150829563.png" class="" title="image-20201125150829563">



<blockquote>
<p>Cloudå‡çº§</p>
</blockquote>
<img src="/2021/01/25/SpringCloud/CloudUpgrade.jpg" class="" title="CloudUpgrade">



<h3 id="ğŸ³ï¸â€ğŸŒˆ-ç‰ˆæœ¬é€‰å‹"><a href="#ğŸ³ï¸â€ğŸŒˆ-ç‰ˆæœ¬é€‰å‹" class="headerlink" title="ğŸ³ï¸â€ğŸŒˆ ç‰ˆæœ¬é€‰å‹"></a>ğŸ³ï¸â€ğŸŒˆ ç‰ˆæœ¬é€‰å‹</h3><blockquote>
<p>å®˜ç½‘é™å®šï¼š<a target="_blank" rel="noopener" href="https://spring.io/projects/spring-cloud">https://spring.io/projects/spring-cloud</a></p>
</blockquote>
<p>æˆªæ­¢ 2020-11-25</p>
<table>
<thead>
<tr>
<th align="left">Spring Cloud Version</th>
<th align="left">Spring Boot Version</th>
</tr>
</thead>
<tbody><tr>
<td align="left">2020.0.x aka Ilford</td>
<td align="left">2.4.x</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-cloud/wiki/Spring-Cloud-Hoxton-Release-Notes">Hoxton</a></td>
<td align="left">2.2.x, 2.3.x (Starting with SR5)</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-cloud/wiki/Spring-Cloud-Greenwich-Release-Notes">Greenwich</a></td>
<td align="left">2.1.x</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-cloud/wiki/Spring-Cloud-Finchley-Release-Notes">Finchley</a></td>
<td align="left">2.0.x</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-cloud/wiki/Spring-Cloud-Edgware-Release-Notes">Edgware</a></td>
<td align="left">1.5.x</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-cloud/wiki/Spring-Cloud-Dalston-Release-Notes">Dalston</a></td>
<td align="left">1.5.x</td>
</tr>
</tbody></table>
<blockquote>
<p>å…·ä½“é™å®šï¼š<a target="_blank" rel="noopener" href="https://start.spring.io/actuator/info">https://start.spring.io/actuator/info</a></p>
</blockquote>
<p>æˆªæ­¢ 2020-11-25</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&quot;spring-cloud&quot;: &#123;</span><br><span class="line">  &quot;Finchley.M2&quot;: &quot;Spring Boot &gt;=2.0.0.M3 and &lt;2.0.0.M5&quot;,</span><br><span class="line">  &quot;Finchley.M3&quot;: &quot;Spring Boot &gt;=2.0.0.M5 and &lt;=2.0.0.M5&quot;,</span><br><span class="line">  &quot;Finchley.M4&quot;: &quot;Spring Boot &gt;=2.0.0.M6 and &lt;=2.0.0.M6&quot;,</span><br><span class="line">  &quot;Finchley.M5&quot;: &quot;Spring Boot &gt;=2.0.0.M7 and &lt;=2.0.0.M7&quot;,</span><br><span class="line">  &quot;Finchley.M6&quot;: &quot;Spring Boot &gt;=2.0.0.RC1 and &lt;=2.0.0.RC1&quot;,</span><br><span class="line">  &quot;Finchley.M7&quot;: &quot;Spring Boot &gt;=2.0.0.RC2 and &lt;=2.0.0.RC2&quot;,</span><br><span class="line">  &quot;Finchley.M9&quot;: &quot;Spring Boot &gt;=2.0.0.RELEASE and &lt;=2.0.0.RELEASE&quot;,</span><br><span class="line">  &quot;Finchley.RC1&quot;: &quot;Spring Boot &gt;=2.0.1.RELEASE and &lt;2.0.2.RELEASE&quot;,</span><br><span class="line">  &quot;Finchley.RC2&quot;: &quot;Spring Boot &gt;=2.0.2.RELEASE and &lt;2.0.3.RELEASE&quot;,</span><br><span class="line">  &quot;Finchley.SR4&quot;: &quot;Spring Boot &gt;=2.0.3.RELEASE and &lt;2.0.999.BUILD-SNAPSHOT&quot;,</span><br><span class="line">  &quot;Finchley.BUILD-SNAPSHOT&quot;: &quot;Spring Boot &gt;=2.0.999.BUILD-SNAPSHOT and &lt;2.1.0.M3&quot;,</span><br><span class="line">  &quot;Greenwich.M1&quot;: &quot;Spring Boot &gt;=2.1.0.M3 and &lt;2.1.0.RELEASE&quot;,</span><br><span class="line">  &quot;Greenwich.SR6&quot;: &quot;Spring Boot &gt;=2.1.0.RELEASE and &lt;2.1.999.BUILD-SNAPSHOT&quot;,</span><br><span class="line">  &quot;Greenwich.BUILD-SNAPSHOT&quot;: &quot;Spring Boot &gt;=2.1.999.BUILD-SNAPSHOT and &lt;2.2.0.M4&quot;,</span><br><span class="line">  &quot;Hoxton.SR9&quot;: &quot;Spring Boot &gt;=2.2.0.M4 and &lt;2.3.7.BUILD-SNAPSHOT&quot;,</span><br><span class="line">  &quot;Hoxton.BUILD-SNAPSHOT&quot;: &quot;Spring Boot &gt;=2.3.7.BUILD-SNAPSHOT and &lt;2.4.0.M1&quot;,</span><br><span class="line">  &quot;2020.0.0-M3&quot;: &quot;Spring Boot &gt;=2.4.0.M1 and &lt;=2.4.0.M1&quot;,</span><br><span class="line">  &quot;2020.0.0-M4&quot;: &quot;Spring Boot &gt;=2.4.0.M2 and &lt;=2.4.0-M3&quot;,</span><br><span class="line">  &quot;2020.0.0-M5&quot;: &quot;Spring Boot &gt;=2.4.0.M4 and &lt;2.4.1-SNAPSHOT&quot;,</span><br><span class="line">  &quot;2020.0.0-SNAPSHOT&quot;: &quot;Spring Boot &gt;=2.4.1-SNAPSHOT&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;spring-cloud-alibaba&quot;: &#123;</span><br><span class="line">  &quot;2.2.1.RELEASE&quot;: &quot;Spring Boot &gt;=2.2.0.RELEASE and &lt;2.3.0.M1&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>



<blockquote>
<p>æŠ€æœ¯é€‰å‹</p>
</blockquote>
<img src="/2021/01/25/SpringCloud/VersionSelect.jpg" class="" title="VersionSelect">



<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>top.parak.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud2020<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">developers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">developer</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>KHighness<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">email</span>&gt;</span>parakovo@gmail.com<span class="tag">&lt;/<span class="name">email</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">developer</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">developers</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- Jar Version Management--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">junit.version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">junit.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">log4j.version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">log4j.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">lombok.version</span>&gt;</span>1.18.16<span class="tag">&lt;/<span class="name">lombok.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>8.0.20<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fastjson.version</span>&gt;</span>1.2.75<span class="tag">&lt;/<span class="name">fastjson.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">druid.version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">druid.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring.boot.version</span>&gt;</span>2.2.2.RELEASE<span class="tag">&lt;/<span class="name">spring.boot.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring.cloud.version</span>&gt;</span>Hoxton.SR1<span class="tag">&lt;/<span class="name">spring.cloud.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring.cloud.alibaba.version</span>&gt;</span>2.1.0.RELEASE<span class="tag">&lt;/<span class="name">spring.cloud.alibaba.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">druid.spring.boot.starter.version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">druid.spring.boot.starter.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis.spring.boot.starter.version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">mybatis.spring.boot.starter.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis-plus.boot.starter.version</span>&gt;</span>3.4.1<span class="tag">&lt;/<span class="name">mybatis-plus.boot.starter.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hutool-all.version</span>&gt;</span>5.5.1<span class="tag">&lt;/<span class="name">hutool-all.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- Spring Boot --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- Spring Cloud --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.cloud.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- Spring Cloud alibaba --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.cloud.alibaba.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- Mysql --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- Druid--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;druid.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- Mybatis Starter --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.spring.boot.starter.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- Druid Starter --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;druid.spring.boot.starter.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- Junit --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;junit.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- Lombok --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;lombok.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- Fastjson --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;fastjson.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">fork</span>&gt;</span>true<span class="tag">&lt;/<span class="name">fork</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">addResources</span>&gt;</span>true<span class="tag">&lt;/<span class="name">addResources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="ğŸ’ -æœåŠ¡æ³¨å†Œä¸­å¿ƒ"><a href="#ğŸ’ -æœåŠ¡æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="ğŸ’  æœåŠ¡æ³¨å†Œä¸­å¿ƒ"></a>ğŸ’  æœåŠ¡æ³¨å†Œä¸­å¿ƒ</h2><h3 id="ğŸŒ -Eureka"><a href="#ğŸŒ -Eureka" class="headerlink" title="ğŸŒ  Eureka"></a>ğŸŒ  Eureka</h3><blockquote>
<p>æ¦‚è¿°</p>
</blockquote>
<p>Github: <a target="_blank" rel="noopener" href="https://github.com/Netflix/Eureka">https://github.com/Netflix/Eureka</a></p>
<p>Spring Cloud Eureka æ˜¯ Spring Cloud Netflix å¾®æœåŠ¡å¥—ä»¶çš„ä¸€éƒ¨åˆ†ï¼ŒåŸºäº Netflix Eureka åšäº†äºŒæ¬¡å°è£…ï¼Œä¸»è¦è´Ÿè´£å®ç°å¾®æœåŠ¡æ¶æ„ä¸­çš„æœåŠ¡æ²»ç†åŠŸèƒ½ã€‚Spring Cloud Eureka æ˜¯ä¸€ä¸ªåŸºäº REST çš„æœåŠ¡ï¼Œå¹¶ä¸”æä¾›äº†åŸºäºJavaçš„å®¢æˆ·ç«¯ç»„ä»¶ï¼Œèƒ½å¤Ÿéå¸¸æ–¹ä¾¿åœ°å°†æœåŠ¡æ³¨å†Œåˆ° Spring Cloud Eureka ä¸­è¿›è¡Œç»Ÿä¸€ç®¡ç†ã€‚</p>
<blockquote>
<p>æœåŠ¡æ²»ç†</p>
</blockquote>
<p>åœ¨ä¼ ç»Ÿçš„RPCè¿œç¨‹è°ƒç”¨æ¡†æ¶ä¸­ï¼Œç®¡ç†æ¯ä¸ªæœåŠ¡äºæœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»æ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨æœåŠ¡æ²»ç†ï¼Œç®¡ç†æœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå¯ä»¥å®ç°æœåŠ¡è°ƒç”¨ã€è´Ÿè½½å‡è¡¡ã€å®¹é”™ç­‰ï¼Œå®ç°æœåŠ¡å‘ç°ä¸æ³¨å†Œã€‚</p>
<blockquote>
<p>æœåŠ¡æ³¨å†Œä¸å‘ç°</p>
</blockquote>
<p>Eurekaé‡‡ç”¨äº†CSçš„è®¾è®¡æ¶æ„ï¼ŒEureka Serverä½œä¸ºæœåŠ¡æ³¨å†ŒåŠŸèƒ½çš„æœåŠ¡å™¨ï¼Œå®ƒæ˜¯æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œè€Œç³»ç»Ÿä¸­çš„å…¶ä»–å¾®æœåŠ¡ï¼Œä½¿ç”¨Eurekaçš„å®¢æˆ·ç«¯è¿æ¥åˆ°Eureka Serverå¹¶ç»´æŒå¿ƒè·³è¿æ¥ã€‚è¿™æ ·ç³»ç»Ÿçš„ç»´æŠ¤äººå‘˜å°±å¯ä»¥é€šè¿‡Eureka Serveræ¥ç›‘æ§ç³»ç»Ÿä¸­å„ä¸ªå¾®æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚</p>
<p>åœ¨æœåŠ¡æ³¨å†Œä¸å‘ç°ä¸­å¿ƒï¼Œæœ‰ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒï¼Œå½“æœåŠ¡å™¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šæŠŠè‡ªå·±æœåŠ¡å™¨çš„ä¿¡æ¯æ¯”å¦‚æœåŠ¡åœ°å€ã€é€šè®¯åœ°å€ç­‰ä»¥åˆ«åæ–¹å¼æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒä¸Šã€‚å¦ä¸€æ–¹ï¼ˆæ¶ˆè´¹è€…|æœåŠ¡æä¾›è€…ï¼‰ï¼Œä»¥è¯¥åˆ«åçš„æ–¹å¼å»æ³¨å†Œä¸­å¿ƒä¸Šè·å–åˆ°å®é™…çš„æœåŠ¡é€šè®¯åœ°å€ï¼Œç„¶åå†å®ç°æœ¬åœ°RPCè°ƒç”¨RPCè¿œç¨‹è°ƒç”¨æ¡†æ¶æ ¸å¿ƒè®¾è®¡æ€æƒ³ï¼šåœ¨äºæ³¨å†Œä¸­å¿ƒï¼Œå› ä¸ºä½¿ç”¨æ³¨å†Œä¸­å¿ƒç®¡ç†æ¯ä¸ªæœåŠ¡äºæœåŠ¡ä¹‹é—´çš„ä¸€ä¸ªä¾èµ–å…³ç³»ï¼ˆæœåŠ¡æ²»ç†æ¦‚å¿µï¼‰ã€‚åœ¨ä»»ä½•RPCè¿œç¨‹æ¡†æ¶ä¸­ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒï¼ˆå­˜æ”¾æœåŠ¡åœ°å€ç›¸å…³ä¿¡æ¯ï¼ˆæ¥å£åœ°å€ï¼‰ï¼‰ã€‚</p>
<blockquote>
<p>Eurekaç»„ä»¶ï¼šEureka Serverå’ŒEureka Client</p>
</blockquote>
<p>1ï¸âƒ£ Eureka Serveræä¾›æœåŠ¡æ³¨å†ŒæœåŠ¡</p>
<p>å„ä¸ªå¾®æœåŠ¡èŠ‚ç‚¹é€šè¿‡é…ç½®å¯åŠ¨åï¼Œä¼šåœ¨Eureka Serverä¸­è¿›è¡Œæ³¨å†Œï¼Œè¿™æ ·Eureka Serverä¸­çš„æœåŠ¡æ³¨å†Œè¡¨å°†ä¼šå­˜å‚¨æ‰€æœ‰å¯ç”¨æœåŠ¡èŠ‚ç‚¹çš„ä¿¡æ¯ï¼ŒæœåŠ¡èŠ‚ç‚¹çš„ä¿¡æ¯å¯ä»¥åœ¨ç•Œé¢ä¸­ç›´è§‚çœ‹åˆ°ã€‚</p>
<p>2ï¸âƒ£ Eureka Clienté€šè¿‡æ³¨å†Œä¸­å¿ƒè¿›è¡Œè®¿é—®</p>
<p>æ˜¯ä¸€ä¸ªJavaå®¢æˆ·ç«¯ï¼Œç”¨äºç®€åŒ–Eureka Severçš„äº¤äº’ï¼Œå®¢æˆ·ç«¯åŒæ—¶ä¹Ÿå…·å¤‡ä¸€ä¸ªå†…ç½®çš„ã€ä½¿ç”¨è½®è¯¢è´Ÿè½½ç®—æ³•çš„è´Ÿè½½å‡è¡¡å™¨ã€‚åœ¨åº”ç”¨å¯åŠ¨åï¼Œå°†ä¼šåœ¨Eureka Serverå‘é€å¿ƒè·³(é»˜è®¤å‘¨æœŸä¸º30S)ã€‚å¦‚æœEureka Serveråœ¨å¤šä¸ªå¿ƒè·³å‘¨æœŸå†…æ²¡æœ‰æ¥æ”¶åˆ°æŸä¸ªèŠ‚ç‚¹çš„å¿ƒè·³ï¼ŒEureka Serverå°†ä¼šä»æœåŠ¡æ³¨å†Œè¡¨ä¸­æŠŠè¿™ä¸ªæœåŠ¡èŠ‚ç‚¹ç§»é™¤ã€‚</p>
<blockquote>
<p>Eurekaçš„è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼</p>
</blockquote>
<p>1ï¸âƒ£æ¦‚è¿°</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœEureka Serveråœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æ¥æ”¶åˆ°æŸä¸ªå¾®æœåŠ¡å®ä¾‹çš„å¿ƒè·³ï¼ŒEureka Serverå°†ä¼šæ³¨é”€è¯¥å®ä¾‹ï¼ˆé»˜è®¤90ç§’ï¼‰ã€‚ä½†æ˜¯å½“å‰ç½‘ç»œåˆ†åŒºæ•…éšœå‘ç”Ÿï¼ˆå»¶æ—¶ã€å¡é¡¿ã€æ‹¥æŒ¤ï¼‰æ—¶ï¼Œå¾®æœåŠ¡ä¸Eureka Serverä¹‹é—´æ— æ³•æ­£å¸¸é€šä¿¡ï¼Œä»¥ä¸Šè¡Œä¸ºä¼šå˜å¾—å±é™©â€”â€”å› ä¸ºå¾®æœåŠ¡æœ¬èº«æ˜¯å¥åº·çš„ï¼Œæ­¤æ—¶æœ¬ä¸åº”è¯¥æ³¨é”€è¿™ä¸ªå¾®æœåŠ¡ã€‚Eurekaé€šè¿‡â€œè‡ªæˆ‘ä¿æŠ¤æ¨¡å¼â€æ¥è§£å†³è¿™ä¸ªé—®é¢˜â€”â€”â€”â€”å½“EurekaèŠ‚ç‚¹åœ¨çŸ­æ—¶é—´å†…ä¸¢å¤±è¿‡å¤šå®¢æˆ·ç«¯æ—¶å€™ï¼Œé‚£ä¹ˆè¿™ä¸ªèŠ‚ç‚¹å°±è¿›å…¥è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ã€‚</p>
<p>2ï¸âƒ£ç”¨é€”</p>
<p>ä¿æŠ¤æ¨¡å¼ä¸»è¦ç”¨äºä¸€ç»„Eureka Clientå’ŒEureka Serverä¹‹é—´å­˜åœ¨ç½‘ç»œåˆ†åŒºåœºæ™¯ä¸‹çš„ä¿æŠ¤ã€‚ä¸€æ—¦è¿›å…¥ä¿æŠ¤æ¨¡å¼ï¼ŒEureka Serverå°†ä¼šå°è¯•ä¿æŠ¤å…¶å¾®æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„ä¿¡æ¯ï¼Œä¸å†åˆ é™¤æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šæ³¨é”€ä»»ä½•å¾®æœåŠ¡ã€‚ä½¿ç”¨è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ï¼Œå¯ä»¥è®©Eurekaé›†ç¾¤æ›´åŠ çš„å¥å£®ã€ç¨³å®šã€‚</p>
<p>3ï¸âƒ£è®¾è®¡å“²å­¦</p>
<p>å®å¯ä¿æŠ¤é”™è¯¯çš„æœåŠ¡æ³¨å†Œä¿¡æ¯ï¼Œä¹Ÿä¸ç›²ç›®æ³¨é”€ä»»ä½•å¯èƒ½å¥åº·çš„æœåŠ¡å®ä¾‹ã€‚</p>
<p>4ï¸âƒ£å…³é—­è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼</p>
<p>Eurekaçš„è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼é»˜è®¤æ˜¯å¼€å¯çš„ï¼Œå…³é—­éœ€è¦é…ç½®Eureka Serverï¼š</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="comment"># å…³é—­è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ï¼Œå¯¹æ²¡æœ‰å¿ƒè·³çš„å¾®æœåŠ¡ç›´æ¥æ€æ— èµ¦ï¼Œä¿è¯ä¸å¯ç”¨æœåŠ¡åŠæ—¶è¸¢é™¤</span></span><br><span class="line">    <span class="attr">enable-self-preservation:</span> <span class="literal">false</span> </span><br><span class="line">    <span class="comment"># æ¸…ç†æ— æ•ˆèŠ‚ç‚¹çš„æ—¶é—´é—´éš”ï¼Œé»˜è®¤æ˜¯60000ms</span></span><br><span class="line">    <span class="attr">eviction-interval-timer-in-ms:</span> <span class="number">2000</span></span><br></pre></td></tr></table></figure>

<p>é‡å¯Eureka Serverè¿›å…¥Eurekaå¯è§†åŒ–ï¼Œå¯ä»¥çœ‹åˆ°è¿™å¥è¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">THE SELF PRESERVATION MODE IS TURNED OFF. THIS MAY NOT PROTECT INSTANCE EXPIRY IN CASE OF NETWORK/OTHER PROBLEMS.</span><br></pre></td></tr></table></figure>

<p>é…ç½®Eureka Client</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">instance</span>:<span class="string"></span></span><br><span class="line"><span class="comment">    # Eureka Clientå‘Eureka Serverå‘é€å¿ƒè·³çš„æ—¶é—´é—´éš”/é¢‘ç‡ï¼Œå•ä½ä¸ºç§’(é»˜è®¤æ˜¯30S)</span></span><br><span class="line"><span class="comment">    # åœ¨è¿™ä¸ªæ—¶é—´é—´éš”åï¼ŒEureka Serveræ²¡æœ‰æ”¶åˆ°Eureka clientçš„å¿ƒè·³ï¼Œå°†å‰”é™¤æœåŠ¡</span></span><br><span class="line">    <span class="meta">lease-renewal-interval-in-seconds</span>: <span class="string">1</span></span><br><span class="line"><span class="comment">    # Eureka Serveråœ¨æ”¶åˆ°æœ€åä¸€æ¬¡å¿ƒè·³åç­‰å¾…æ—¶é—´ä¸Šé™ï¼Œå•ä½ä¸ºç§’(é»˜è®¤æ˜¯90S)</span></span><br><span class="line"><span class="comment">    # è¶…æ—¶å°†å‰”é™¤æœåŠ¡</span></span><br><span class="line">    <span class="meta">lease-expiration-duration-in-seconds</span>: <span class="string">2</span></span><br></pre></td></tr></table></figure>

<p>å¼€å¯å¾®æœåŠ¡å¹¶ä¸”å¾ˆå¿«åœæ­¢ï¼Œå¯ä»¥çœ‹åˆ°Eureka Serverçš„æ—¥å¿—ä¸Š1sè¿‡æœŸäº†ä¸€ä¸ªæœåŠ¡ï¼ŒEurekaå¯è§†åŒ–ä¸Šæ³¨å†Œçš„æœåŠ¡ç›´æ¥æ¶ˆå¤±</p>
<blockquote>
<p>Eurekaåœæ›´è¯´æ˜</p>
</blockquote>
<p>Eureka 2.xåœæ­¢æ›´æ–°ï¼ŒEureka 1.x åœ¨å¼€æºç¤¾åŒºä¾ç„¶æ´»è·ƒã€‚</p>
<p><a target="_blank" rel="noopener" href="https://github.com/Netflix/eureka/wiki">eureka-wiki</a></p>
<p>The existing open source work on eureka 2.0 is discontinued. The code base and artifacts that were released as part of the existing repository of work on the 2.x branch is considered use at your own risk.</p>
<p>Eureka 1.x is a core part of Netflixâ€™s service discovery system and is still an active project.</p>
<h3 id="ğŸ’¤-ZooKeeper"><a href="#ğŸ’¤-ZooKeeper" class="headerlink" title="ğŸ’¤ ZooKeeper"></a>ğŸ’¤ ZooKeeper</h3><blockquote>
<p>æ¦‚è¿°</p>
</blockquote>
<p>å®˜ç½‘: <a target="_blank" rel="noopener" href="https://zookeeper.apache.org/">apache-zookeeper</a></p>
<p>wikiæ–‡æ¡£: <a target="_blank" rel="noopener" href="https://cwiki.apache.org/confluence/display/ZOOKEEPER/Index">wiki-zookeeper</a></p>
<p>ZooKeeperæ˜¯ç”¨äºç»´æŠ¤é…ç½®ä¿¡æ¯ï¼Œå‘½åï¼Œæä¾›åˆ†å¸ƒå¼åŒæ­¥ä»¥åŠæä¾›ç»„æœåŠ¡çš„é›†ä¸­å¼æœåŠ¡ã€‚</p>
<blockquote>
<p>Dockerè¿è¡ŒZookeeper</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker pull zookeeper</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker run -d -it -p 2181:2181 --name=zoo zookeeper</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p>POM</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SpringBootæ•´åˆZookeeperå®¢æˆ·ç«¯ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zookeeper-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- æ’é™¤è‡ªå¸¦çš„zookeeper3.5.3 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ·»åŠ zookeeper3.4.14 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ’é™¤è‡ªå¸¦çš„Slf4j --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="ğŸ’«-Consul"><a href="#ğŸ’«-Consul" class="headerlink" title="ğŸ’« Consul"></a>ğŸ’« Consul</h3><blockquote>
<p>æ¦‚è¿°</p>
</blockquote>
<p>å®˜ç½‘ï¼š<a target="_blank" rel="noopener" href="https://www.consul.io/docs/intro">Consul</a></p>
<p>å…¥é—¨æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-cloud-consul.html">spring-cloud-consul</a></p>
<p>Consul(Goè¯­è¨€å¼€å‘)æ˜¯ä¸€ç§æœåŠ¡ç½‘æ ¼è§£å†³æ–¹æ¡ˆï¼Œæä¾›å…·æœ‰æœåŠ¡å‘ç°ï¼Œé…ç½®å’Œåˆ†æ®µåŠŸèƒ½çš„å…¨åŠŸèƒ½æ§åˆ¶å¹³é¢ã€‚</p>
<blockquote>
<p>Dockerè¿è¡ŒConsul</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mkdir -p /home/consul/data /home/consul/conf</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker run -d --name=con -p 8500:8500  -v /home/consul/conf/:/consul/conf/                   -v /home/consul/data/:/consul/data/ consul</span></span><br></pre></td></tr></table></figure>

<p>Consulæœ‰å‰ç«¯å¯è§†åŒ–ç•Œé¢ï¼Œæ­¤æ—¶è¾“å…¥è™šæ‹ŸæœºIP:8500å³å¯è®¿é—®ã€‚</p>
<blockquote>
<p>POM</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SpringCloud Consul Server --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-consul-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>





<h3 id="ğŸŒ€-CAP"><a href="#ğŸŒ€-CAP" class="headerlink" title="ğŸŒ€ CAP"></a>ğŸŒ€ CAP</h3><blockquote>
<p>CAPåŸåˆ™</p>
</blockquote>
<p>åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼š</p>
<ul>
<li><p>C(Consistency): ä¸€è‡´æ€§(All nodes see the same data at the same time)</p>
</li>
<li><p>A(Availability): å¯ç”¨æ€§(Reads and writes always succeed)</p>
</li>
<li><p>P(Partition tolerance): åˆ†åŒºå®¹é”™æ€§(The system continues to operate despite arbitrary message loss or failure of part of the system)</p>
</li>
</ul>
<p>ä»¥ä¸Šä¸‰ç‚¹åªèƒ½æ»¡è¶³ä»»æ„ä¸¤ç‚¹ï¼Œä¸å¯èƒ½ä¸‰è€…å…¼é¡¾ã€‚</p>
<blockquote>
<p>ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒ</p>
</blockquote>
<p>ç°åœ¨çš„åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„éƒ½å¿…é¡»ä¿è¯PåŸåˆ™</p>
<table>
<thead>
<tr>
<th align="center">ç»„ä»¶å</th>
<th align="center">è¯­è¨€</th>
<th align="center">CAP</th>
<th align="center">æœåŠ¡å¥åº·æ£€æŸ¥</th>
<th align="center">å¯¹å¤–æš´éœ²æ¥å£</th>
<th align="center">Spring Cloudé›†æˆ</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Eureka</td>
<td align="center">Java</td>
<td align="center">AP</td>
<td align="center">å¯é…æ”¯æŒ</td>
<td align="center">HTTP</td>
<td align="center">å·²é›†æˆ</td>
</tr>
<tr>
<td align="center">Consul</td>
<td align="center">Go</td>
<td align="center">CP</td>
<td align="center">æ”¯æŒ</td>
<td align="center">HTTP/DNS</td>
<td align="center">å·²é›†æˆ</td>
</tr>
<tr>
<td align="center">Zookeeper</td>
<td align="center">Java</td>
<td align="center">CP</td>
<td align="center">æ”¯æŒ</td>
<td align="center">å®¢æˆ·ç«¯</td>
<td align="center">å·²é›†æˆ</td>
</tr>
</tbody></table>
<h2 id="ğŸ”±-æœåŠ¡è°ƒç”¨"><a href="#ğŸ”±-æœåŠ¡è°ƒç”¨" class="headerlink" title="ğŸ”± æœåŠ¡è°ƒç”¨"></a>ğŸ”± æœåŠ¡è°ƒç”¨</h2><h3 id="ğŸ—Ribbon"><a href="#ğŸ—Ribbon" class="headerlink" title="ğŸ—Ribbon"></a>ğŸ—Ribbon</h3><blockquote>
<p>è¯´æ˜</p>
</blockquote>
<p>wikiæ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://github.com/Netflix/ribbon/wiki">wiki-ribbon</a></p>
<p>Spring Cloud Ribbonæ˜¯åŸºäºNetflixçš„å¼€æºé¡¹ç›®ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æä¾›å®¢æˆ·ç«¯çš„è½¯ä»¶è´Ÿè½½å‡è¡¡ç®—æ³•å’ŒæœåŠ¡è°ƒç”¨ã€‚</p>
<p>Ribbonå®¢æˆ·ç«¯ç»„ä»¶æä¾›ä¸€ç³»åˆ—å®Œå–„çš„é…ç½®é¡¹å¦‚è¿æ¥è¶…æ—¶ã€é‡è¯•ç­‰ã€‚ç®€å•çš„è¯´ï¼Œå°±æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­åˆ—å‡ºLoad Balancerï¼ˆç®€ç§°LBï¼‰åé¢æ‰€æœ‰çš„æœºå™¨ï¼ŒRibbonä¼šè‡ªåŠ¨çš„å¸®åŠ©ä½ åŸºäºæŸç§è§„åˆ™ï¼ˆå¦‚ç®€å•è½®è¯¢ï¼Œéšæœºè¿æ¥ç­‰ï¼‰å»è¿æ¥è¿™äº›æœºå™¨ã€‚æˆ‘ä»¬å¾ˆå®¹æ˜“ä½¿ç”¨Ribbonå®ç°è‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡ç®—æ³•ã€‚</p>
<blockquote>
<p>LB</p>
</blockquote>
<p>Load Balanceï¼Œè´Ÿè½½å‡è¡¡ï¼Œå°†ç”¨æˆ·è¯·æ±‚å¹³æ‘Šåˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œä»è€Œè¾¾åˆ°ç³»ç»Ÿçš„HAï¼ˆé«˜å¯ç”¨ï¼‰ã€‚</p>
<blockquote>
<p>æ ¸å¿ƒç»„ä»¶IRule</p>
</blockquote>
<img src="/2021/01/25/SpringCloud/image-20201218194608766.png" class="" title="image-20201218194608766">

<p>1ï¸âƒ£æ ¹æ®ç‰¹å®šç®—æ³•ä»æœåŠ¡åˆ—è¡¨ä¸­é€‰å–ä¸€ä¸ªè¦è®¿é—®çš„æœåŠ¡ï¼š</p>
<ul>
<li>RoundRobinRule: è½®è¯¢(é»˜è®¤)</li>
<li>RandomRule: éšæœº</li>
<li>RetryRule: å…ˆæŒ‰ç…§RoundRuleçš„ç­–ç•¥è·å–æœåŠ¡ï¼Œå¦‚æœæœåŠ¡å¤±è´¥åˆ™åœ¨æŒ‡å®šæ—¶é—´å†…è¿›è¡Œé‡è¯•ï¼Œè·å–å¯ç”¨çš„æœåŠ¡</li>
<li>WeightedResponseTimeRule: å¯¹RoundRobinRuleçš„æ‰©å±•ï¼Œå“åº”é€Ÿåº¦è¶Šå¿«çš„å®ä¾‹é€‰æ‹©æƒé‡è¶Šå¤§ï¼Œè¶Šå®¹æ˜“è¢«é€‰æ‹©</li>
<li>BestAvaiableRule: ä¼šå…ˆè¿‡æ»¤æ‰ç”±äºå¤šæ¬¡è®¿é—®æ•…éšœè€Œå¤„äºæ–­è·¯å™¨è·³é—¸çŠ¶æ€çš„æœåŠ¡ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªå¹¶å‘é‡å°çš„æœåŠ¡</li>
<li>AvailabilityFilteringRule: å…ˆè¿‡æ»¤æ‰æ•…éšœå®ä¾‹ï¼Œå†é€‰æ‹©å¹¶å‘è¾ƒå°çš„å®ä¾‹</li>
<li>ZoneAvoidanceRule: é»˜è®¤è§„åˆ™ï¼Œå¤åˆåˆ¤æ–­serveræ‰€åœ¨åŒºåŸŸçš„æ€§èƒ½å’Œserverçš„å¯ç”¨æ€§é€‰æ‹©æœåŠ¡å™¨</li>
</ul>
<p>2ï¸âƒ£è‡ªå®šä¹‰ç®—æ³•çš„è§„åˆ™ï¼ˆå®˜æ–¹æ–‡æ¡£è­¦å‘Šï¼‰ï¼š</p>
<p>è‡ªå®šä¹‰é…ç½®ç±»ä¸èƒ½æ”¾åœ¨@ComponentScanæ‰€æ‰«æçš„å½“å‰åŒ…ä»¥åŠå­åŒ…ä¸‹ï¼Œå¦åˆ™è‡ªå®šä¹‰çš„è¿™ä¸ªé…ç½®ç±»å°±ä¼šè¢«æ‰€æœ‰çš„Ribbonå®¢æˆ·ç«¯å…±äº«ï¼Œè¾¾ä¸åˆ°ç‰¹æ®Šå®šåˆ¶åŒ–çš„ç›®çš„ã€‚</p>
<p>@SpringBootApplicationåŒ…å«ä¸‰å¤§æ³¨è§£ï¼š</p>
<ul>
<li><p>@SpringBootConfiguration</p>
</li>
<li><p>@EnableAutoConfiguration</p>
</li>
<li><p>@ComponentScan</p>
</li>
</ul>
<p>å› æ­¤ï¼Œè‡ªå®šä¹‰é…ç½®ç±»ä¸èƒ½ä¸SpringbootApplicationä¸»å¯åŠ¨ç±»æ”¾åœ¨ä¸€ä¸ªåŒ…ä¸‹ã€‚</p>
<h3 id="ğŸ›‘-OpenFeign"><a href="#ğŸ›‘-OpenFeign" class="headerlink" title="ğŸ›‘ OpenFeign"></a>ğŸ›‘ OpenFeign</h3><blockquote>
<p>æ¦‚è¿°</p>
</blockquote>
<p>Feignæ˜¯ä¸€ä¸ªå£°æ˜å¼WebServiceå®¢æˆ·ç«¯ï¼Œä½¿ç”¨Feignèƒ½è®©ç¼–å†™Web Serviceå®¢æˆ·ç«¯æ›´åŠ ç®€å•ã€‚ä½¿ç”¨æ–¹æ³•æ—¶å®šä¹‰ä¸€ä¸ªæœåŠ¡æ¥å£ç„¶ååœ¨ä¸Šé¢æ·»åŠ æ³¨è§£ã€‚Feignä¹Ÿæ”¯æŒå¯æ‹”æ’å¼çš„ç¼–ç å™¨å’Œè§£ç å™¨ã€‚Spring Cloudå¯¹Feignè¿›è¡Œäº†å°è£…ï¼Œä½¿å…¶æ”¯æŒäº†Spring MVCæ ‡å‡†æ³¨è§£å’ŒHttpMessageConvertersã€‚Feignå¯ä»¥ä¸Eurekaå’ŒRibbonç»„åˆä½¿ç”¨ä»¥æ”¯æŒè´Ÿè½½å‡è¡¡ã€‚</p>
<p>Feignæ—¨åœ¨ä½¿ç¼–å†™Java Httpå®¢æˆ·ç«¯å˜å¾—æ›´å®¹æ˜“ã€‚</p>
<p>å‰æœŸä½¿ç”¨Ribbon + RestTemplateæ—¶ï¼Œä½¿ç”¨RestTemplateå¯¹httpè¯·æ±‚çš„å°è£…å¤„ç†ï¼Œå½¢æˆäº†ä¸€å¥—æ¨¡æ¿åŒ–çš„è°ƒç”¨æ–¹æ³•ã€‚ä½†æ˜¯åœ¨å®é™…å¼€å‘ä¸­ï¼Œç”±äºå¯¹æœåŠ¡ä¾èµ–çš„è°ƒç”¨å¯èƒ½ä¸æ­¢ä¸€å¤„ï¼Œå¾€å¾€ä¸€ä¸ªæ¥å£ä¼šè¢«å¤šå¤„è°ƒç”¨ï¼Œæ‰€ä»¥é€šå¸¸éƒ½ä¼šé’ˆå¯¹æ¯ä¸ªå¾®æœåŠ¡è‡ªè¡Œå°è£…ä¸€äº›å®¢æˆ·ç«¯ç±»æ¥åŒ…è£…è¿™äº›ä¾èµ–æœåŠ¡çš„è°ƒç”¨ã€‚æ‰€ä»¥ï¼ŒFeignåœ¨æ­¤åŸºç¡€ä¸Šæ¥é…ç½®å®ƒï¼ˆä»¥å‰æ˜¯Daoæ¥å£ä¸Šæ ‡æ³¨ä¸€ä¸ªFeignæ³¨è§£å³å¯ï¼‰ï¼Œå³å¯å®Œæˆå¯¹æœåŠ¡æä¾›æ–¹çš„æ¥å£ç»‘å®šï¼Œç®€åŒ–äº†ä½¿ç”¨Spring Cloud Ribbonæ—¶ï¼Œè‡ªåŠ¨å°è£…æœåŠ¡è°ƒç”¨å®¢æˆ·ç«¯çš„å¼€å‘é‡ã€‚</p>
<p>Feigné›†æˆäº†Ribbonã€‚</p>
<p>åˆ©ç”¨Ribbonç»´æŠ¤äº†Paymentçš„æœåŠ¡åˆ—è¡¨ä¿¡æ¯ï¼Œå¹¶ä¸”é€šè¿‡è½®è¯¢å®ç°ç«¯çš„è´Ÿè½½å‡è¡¡ï¼Œè€Œä¸Ribbonä¸åŒçš„æ˜¯ï¼Œé€šè¿‡Feignä¸åŒçš„æ˜¯ï¼Œé€šè¿‡Feignåªéœ€è¦å®šä¹‰æœåŠ¡ç»‘å®šæ¥å£ä¸”ä»¥å£°æ˜å¼çš„æ–¹æ³•ï¼Œä¼˜é›…è€Œç®€å•çš„å®ç°äº†æœåŠ¡è°ƒç”¨ã€‚</p>
<table>
<thead>
<tr>
<th align="center">Feign</th>
<th align="center">OpenFeign</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Feignæ˜¯SpringCloudç»„ä»¶ä¸­çš„ä¸€ä¸ªè½»é‡çº§RESTfulçš„HTTPæœåŠ¡å®¢æˆ·ç«¯ã€‚Feignå†…ç½®äº†Ribbonï¼Œç”¨æ¥åšå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼Œå»è°ƒç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡ã€‚Feignçš„ä½¿ç”¨æ–¹æ³•ï¼šä½¿ç”¨Feignçš„æ³¨è§£å®šä¹‰æ¥å£ï¼Œè°ƒç”¨è¿™ä¸ªæ¥å£ï¼Œå°±å¯ä»¥è°ƒç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡ã€‚</td>
<td align="center">OpenFeignæ˜¯Spring Cloudåœ¨Feignçš„åŸºç¡€ä¸Šæ”¯æŒäº†SpringMVCçš„æ³¨è§£ï¼Œå¦‚@RequestMappingç­‰ç­‰ã€‚OpenFeignçš„@FeignClientå¯ä»¥è§£æSpringMVCçš„@RequestMappingæ³¨è§£ä¸‹çš„æ¥å£ï¼Œå¹¶é€šè¿‡åŠ¨æ€ä»£ç†çš„æ–¹å¼äº§ç”Ÿå®ç°ç±»ï¼Œå®ç°ç±»ä¸­åšè´Ÿè½½å‡è¡¡å¹¶è°ƒç”¨å…¶ä»–æœåŠ¡ã€‚</td>
</tr>
<tr>
<td align="center"><dependency>     <groupId>org.springframework.cloud</groupId>     <artifactId>spring-cloud-starter-feign</artifactId> </dependency></td>
<td align="center"><dependency>     <groupId>org.springframework.cloud</groupId>     <artifactId>spring-cloud-starter-openfeign</artifactId> </dependency></td>
</tr>
</tbody></table>
<blockquote>
<p>è¶…æ—¶æ§åˆ¶</p>
</blockquote>
<p>é»˜è®¤Feignå®¢æˆ·ç«¯åªç­‰å¾…1ç§’é’Ÿï¼Œä½†æ˜¯æœåŠ¡ç«¯å¤„ç†éœ€è¦è¶…è¿‡1ç§’é’Ÿï¼Œå¯¼è‡´Feignå®¢æˆ·ç«¯ä¸æƒ³ç­‰å¾…ï¼Œç›´æ¥è¿”å›æŠ¥é”™ã€‚ä¸ºäº†é¿å…è¿™æ ·çš„æƒ…å†µï¼Œæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦è®¾ç½®Feignå®¢æˆ·ç«¯çš„è¶…æ—¶æ§åˆ¶ã€‚</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®feignå®¢æˆ·ç«¯è¶…æ—¶æ—¶é—´(Openfeigné»˜è®¤æ”¯æŒribbon)</span></span><br><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">  <span class="comment"># æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥æ‰€ç”¨çš„æ—¶é—´ï¼Œé€‚ç”¨äºç½‘ç»œçŠ¶å†µæ­£å¸¸çš„æƒ…å†µä¸‹ï¼Œä¸¤ç«¯è¿æ¥æ‰€ç”¨çš„æ—¶é—´</span></span><br><span class="line">  <span class="attr">ReadTimeout:</span> <span class="number">5000</span></span><br><span class="line">  <span class="comment"># æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥åä»æœåŠ¡å™¨è¯»å–åˆ°å¯ç”¨èµ„æºæ‰€ç”¨çš„æ—¶é—´</span></span><br><span class="line">  <span class="attr">ConnectTimeout:</span> <span class="number">5000</span></span><br></pre></td></tr></table></figure>



<h2 id="ğŸ”°-æœåŠ¡é™çº§"><a href="#ğŸ”°-æœåŠ¡é™çº§" class="headerlink" title="ğŸ”° æœåŠ¡é™çº§"></a>ğŸ”° æœåŠ¡é™çº§</h2><p>æœåŠ¡é›ªå´©</p>
<p>å¤šä¸ªå¾®æœåŠ¡ä¹‹é—´è°ƒç”¨çš„æ—¶å€™ï¼Œå‡è®¾å¾®æœåŠ¡Aè°ƒç”¨å¾®æœåŠ¡Bå’Œå¾®æœåŠ¡Cï¼Œå¾®æœåŠ¡Bå’Œå¾®æœåŠ¡Cåˆè°ƒç”¨å…¶ä»–çš„æœåŠ¡å™¨ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„â€œæ‰‡å‡ºâ€ã€‚å¦‚æœæ‰‡å‡ºçš„é“¾è·¯ä¸ŠæŸä¸ªå¾®æœåŠ¡çš„è°ƒç”¨å“åº”æ—¶é—´è¿‡é•¿æˆ–è€…ä¸å¯ç”¨ï¼Œå¯¹å¾®æœåŠ¡Açš„è°ƒç”¨å°±ä¼šå ç”¨è¶Šæ¥è¶Šå¤šçš„ç³»ç»Ÿèµ„æºï¼Œè¿›è€Œå¼•èµ·ç³»ç»Ÿå´©æºƒï¼Œæ‰€è°“çš„â€œé›ªå´©æ•ˆåº”â€ã€‚</p>
<p>å¯¹äºé«˜æµé‡çš„åº”ç”¨æ¥è¯´ï¼Œå•ä¸€çš„åç«¯ä¾èµ–å¯èƒ½ä¼šå¯¼è‡´æ‰€æœ‰æœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰èµ„æºéƒ½åœ¨å‡ ç§’é’Ÿå†…é¥±å’Œã€‚æ¯”å¤±è´¥æ›´ç³Ÿç³•çš„æ˜¯ï¼Œè¿™äº›åº”ç”¨ç¨‹åºè¿˜å¯èƒ½å¯¼è‡´æœåŠ¡ä¹‹é—´çš„å»¶è¿Ÿå¢åŠ ï¼Œå¤‡ä»½é˜Ÿåˆ—ï¼Œçº¿ç¨‹å’Œå…¶ä»–èµ„æºç´§å¼ ï¼Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå‘ç”Ÿæ›´å¤šçš„çº§è”æ•…éšœã€‚è¿™äº›éƒ½è¡¨ç¤ºéœ€è¦å¯¹æ•…éšœå’Œå»¶è¿Ÿè¿›è¡Œéš”ç¦»å’Œç®¡ç†ï¼Œä»¥ä¾¿å•ä¸ªä¾èµ–å…³ç³»çš„å¤±è´¥ï¼Œä¸èƒ½å–æ¶ˆæ•´ä¸ªåº”ç”¨ç¨‹åºæˆ–ç³»ç»Ÿã€‚</p>
<p>é€šå¸¸ä¸€ä¸ªæ¨¡å—ä¸‹çš„æŸä¸ªå®ä¾‹å¤±è´¥åï¼Œè¿™æ—¶å€™è¿™ä¸ªæ¨¡å—ä¾ç„¶è¿˜ä¼šæ¥æ”¶æµé‡ï¼Œç„¶åè¿™ä¸ªæœ‰é—®é¢˜çš„æ¨¡å—è¿˜è°ƒç”¨äº†å…¶ä»–çš„æ¨¡å—ï¼Œè¿™æ ·å°±ä¼šå‘ç”Ÿçº§è”æ•…éšœï¼Œæˆ–è€…å«é›ªå´©ã€‚</p>
<h3 id="âš¡-Hystrix"><a href="#âš¡-Hystrix" class="headerlink" title="âš¡ Hystrix"></a>âš¡ Hystrix</h3><blockquote>
<p>è¯´æ˜</p>
</blockquote>
<p>Github: <a target="_blank" rel="noopener" href="https://github.com/Netflix/Hystrix">https://github.com/Netflix/Hystrix</a></p>
<p>Hystrixä¸å†ä¸»åŠ¨å¼€å‘ï¼Œå¹¶ä¸”å½“å‰å¤„äºç»´æŠ¤æ¨¡å¼ã€‚</p>
<p>Hystrixï¼ˆ1.5.18ç‰ˆï¼‰è¶³å¤Ÿç¨³å®šï¼Œå¯ä»¥æ»¡è¶³Netflixç°æœ‰åº”ç”¨ç¨‹åºçš„éœ€æ±‚ã€‚</p>
<blockquote>
<p>æ¦‚è¿°</p>
</blockquote>
<p>åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œä¸å¯é¿å…åœ°ä¼šæœ‰è®¸å¤šæœåŠ¡ä¾èµ–é¡¹ä¸­çš„æŸäº›å¤±è´¥ã€‚Hystrixæ˜¯ä¸€ä¸ªåº“ï¼Œå¯é€šè¿‡æ·»åŠ å»¶è¿Ÿå…¬å·®å’Œå®¹é”™é€»è¾‘æ¥å¸®åŠ©æ‚¨æ§åˆ¶è¿™äº›åˆ†å¸ƒå¼æœåŠ¡ä¹‹é—´çš„äº¤äº’ã€‚Hystrixé€šè¿‡éš”ç¦»æœåŠ¡ä¹‹é—´çš„è®¿é—®ç‚¹ï¼Œåœæ­¢æœåŠ¡ä¹‹é—´çš„çº§è”æ•…éšœå¹¶æä¾›åå¤‡é€‰é¡¹æ¥å®ç°æ­¤ç›®çš„ï¼Œä»¥æé«˜ç³»ç»Ÿçš„æ•´ä½“å¼¹æ€§ã€‚</p>
<p>â€œæ–­è·¯å™¨â€æœ¬èº«æ˜¯ä¸€ç§å¼€å…³è£…ç½®ï¼Œå½“æŸä¸ªæœåŠ¡å•å…ƒå‘ç”Ÿæ•…éšœä¹‹åï¼Œé€šè¿‡æ–­è·¯å™¨çš„æ•…éšœç›‘æ§ï¼ˆç±»ä¼¼ç†”æ–­ä¿é™©ä¸ï¼‰ï¼Œå‘è°ƒç”¨æ–¹è¿”å›ä¸€ä¸ªç¬¦åˆé¢„æœŸçš„ã€å¯å¤„ç†çš„å¤‡é€‰å“åº”ï¼ˆFallbackï¼‰ï¼Œè€Œä¸æ˜¯é•¿æ—¶é—´çš„ç­‰å¾…æˆ–è€…æŠ›å‡ºè°ƒç”¨æ–¹æ— æ³•å¤„ç†çš„å¼‚å¸¸ï¼Œè¿™æ ·å°±ä¿è¯äº†æœåŠ¡è°ƒç”¨æ–¹çš„çº¿ç¨‹ä¸ä¼šè¢«é•¿æ—¶é—´ã€ä¸å¿…è¦åœ°å ç”¨ï¼Œä»è€Œé¿å…äº†æ•…éšœåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„è”“å»¶ï¼Œä¹ƒè‡³é›ªå´©ã€‚</p>
<blockquote>
<p>ä½œç”¨</p>
</blockquote>
<ul>
<li>æä¾›ä¿æŠ¤å¹¶æ§åˆ¶å»¶è¿Ÿå’Œå¤±è´¥ï¼Œä»¥åŠé€šè¿‡ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯åº“è®¿é—®çš„ä¾èµ–é¡¹çš„å¤±è´¥</li>
<li>åœæ­¢å¤æ‚çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„çº§è”æ•…éšœ</li>
<li>å¿«é€Ÿå¤±è´¥å¹¶å¿«é€Ÿä¿®å¤</li>
<li>å›é€€å¹¶åœ¨å¯èƒ½çš„æƒ…å†µä¸‹æ­£å¸¸é™çº§</li>
<li>å¯ç”¨å®æ—¶ç›‘è§†ã€è­¦æŠ¥å’Œæ“ä½œæ§åˆ¶</li>
</ul>
<blockquote>
<p>å¹¶å‘åœºæ™¯</p>
</blockquote>
<p>1ï¸âƒ£å¹¶å‘åœºæ™¯åŠè§£å†³è¦æ±‚</p>
<ul>
<li>è¶…æ—¶å¯¼è‡´æœåŠ¡å™¨å˜æ…¢ï¼ˆè½¬åœˆï¼‰=&gt; è¶…æ—¶ä¸å†ç­‰å¾…</li>
<li>å‡ºé”™ï¼ˆå®•æœºæˆ–ç¨‹åºè¿è¡Œå‡ºé”™ï¼‰=&gt; å‡ºé”™è¦æœ‰å…œåº•</li>
</ul>
<p>2ï¸âƒ£è§£å†³æ–¹æ¡ˆ</p>
<ul>
<li>æœåŠ¡æä¾›è€…è¶…æ—¶ï¼ŒæœåŠ¡è°ƒç”¨è€…ä¸èƒ½ä¸€ç›´å¡æ­»ç­‰å¾…ï¼Œå¿…é¡»æœ‰æœåŠ¡é™çº§</li>
<li>æœåŠ¡æä¾›è€…å®•æœºï¼ŒæœåŠ¡è°ƒç”¨è€…ä¸èƒ½ä¸€ç›´å¡æ­»ç­‰å¾…ï¼Œå¿…é¡»æœ‰æœåŠ¡é™çº§</li>
<li>æœåŠ¡æä¾›è€…æ­£å¸¸ï¼ŒæœåŠ¡è°ƒç”¨è€…è‡ªå·±å‡ºæ•…éšœæˆ–æœ‰è‡ªæˆ‘è¦æ±‚ï¼ˆè‡ªå·±çš„ç­‰å¾…æ—¶é—´å°äºæœåŠ¡æ—¶é—´ï¼‰ï¼Œ</li>
</ul>
<blockquote>
<p>æœåŠ¡é™çº§</p>
</blockquote>
<p>1ï¸âƒ£æ¦‚å¿µ</p>
<p>å½“æœåŠ¡å™¨å‹åŠ›å‰§å¢çš„æƒ…å†µä¸‹ï¼Œæ ¹æ®å½“å‰ä¸šåŠ¡æƒ…å†µåŠæµé‡å¯¹ä¸€äº›æœåŠ¡å’Œé¡µé¢æœ‰ç­–ç•¥çš„é™çº§ï¼Œä»¥æ­¤é‡Šæ”¾æœåŠ¡å™¨èµ„æºä»¥ä¿è¯æ ¸å¿ƒä»»åŠ¡çš„æ­£å¸¸è¿è¡Œã€‚</p>
<p>æœåŠ¡å™¨å¿™ï¼Œè¯·ç¨åå†è¯•ï¼Œä¸è®©å®¢æˆ·ç«¯ç­‰å¾…å¹¶ç«‹åˆ»è¿”å›ä¸€ä¸ªå‹å¥½æç¤ºã€‚</p>
<p>2ï¸âƒ£è§¦å‘</p>
<ul>
<li>ç¨‹åºè¿è¡Œå¼‚å¸¸</li>
<li>è¶…æ—¶</li>
<li>æœåŠ¡ç†”æ–­</li>
<li>çº¿ç¨‹æ± /ä¿¡å·é‡æ‰“æ»¡</li>
</ul>
<p>3ï¸âƒ£è§£å†³</p>
<p>é™çº§é…ç½®ï¼š</p>
<p>æœåŠ¡æä¾›è€…è®¾ç½®è‡ªèº«è°ƒç”¨è¶…æ—¶æ—¶é—´çš„å³°å€¼ï¼Œå³°å€¼å†…å¯ä»¥æ­£å¸¸è¿è¡Œï¼›</p>
<p>è¶…è¿‡äº†éœ€è¦æœ‰å…œåº•çš„æ–¹æ³•å¤„ç†ï¼Œä½œæœåŠ¡é™çº§fallbackã€‚</p>
<blockquote>
<p>æœåŠ¡ç†”æ–­</p>
</blockquote>
<p>1ï¸âƒ£ç†”æ–­æœºåˆ¶</p>
<p>ç†”æ–­æœºåˆ¶æ˜¯åº”å¯¹é›ªå´©æ•ˆåº”çš„ä¸€ç§å¾®æœåŠ¡é“¾è·¯ä¿æŠ¤æœºåˆ¶ã€‚å½“æ‰‡å‡ºé“¾è·¯çš„æŸä¸ªä¸ºå‰¯æŠ¤å‡ºé”™ä¸å¯ç”¨æˆ–è€…ç›¸å“åº”æ—¶é—´å¤ªé•¿æ—¶ï¼Œä¼šè¿›è¡ŒæœåŠ¡çš„é™çº§ï¼Œè¿›è€Œç†”æ–­è¯¥èŠ‚ç‚¹å¾®æœåŠ¡çš„è°ƒç”¨ï¼Œå¿«é€Ÿè¿”å›é”™è¯¯çš„å“åº”ä¿¡æ¯ã€‚</p>
<p>å½“æ‰‡å‡ºé“¾è·¯çš„æŸä¸ªå¾®æœåŠ¡ä¸å¯ç”¨æˆ–è€…å“åº”æ—¶é—´å¤ªé•¿æ—¶ï¼Œä¼šè¿›è¡ŒæœåŠ¡çš„é™çº§ï¼Œè¿›è€Œç†”æ–­è¯¥èŠ‚ç‚¹å¾®æœåŠ¡çš„è°ƒç”¨ï¼Œå¿«é€Ÿè¿”å›â€é”™è¯¯â€çš„å“åº”ä¿¡æ¯ã€‚å½“æ£€æµ‹åˆ°è¯¥èŠ‚ç‚¹å¾®æœåŠ¡å“åº”æ­£å¸¸åæ¢å¤è°ƒç”¨é“¾è·¯ã€‚</p>
<p>2ï¸âƒ£æ–­è·¯å™¨</p>
<p>æ–­è·¯å™¨çš„ä¸‰ä¸ªé‡è¦å‚æ•°ï¼š</p>
<ul>
<li>å¿«ç…§æ—¶é—´çª—ï¼šæ–­è·¯å™¨ç¡®å®šæ˜¯å¦æ‰“å¼€éœ€è¦ç»Ÿè®¡ä¸€ä¸‹è¯·æ±‚å’Œé”™è¯¯æ•°æ®ï¼Œè€Œç»Ÿè®¡çš„æ—¶é—´èŒƒå›´å°±æ˜¯å¿«ç…§æ—¶é—´çª—ï¼Œé»˜è®¤ä¸ºæœ€è¿‘çš„10ç§’ã€‚</li>
<li>è¯·æ±‚æ€»æ•°é˜ˆå€¼ï¼šåœ¨å¿«ç…§æ—¶é—´çª—å†…ï¼Œå¿…é¡»æ»¡è¶³è¯·æ±‚æ€»æ•°é˜ˆå€¼æ‰æœ‰èµ„æ ¼ç†”æ–­ã€‚é»˜è®¤ä¸º20ï¼Œæ„å‘³ç€åœ¨10ç§’å†…ï¼Œå¦‚æœåœ¨hystrixå‘½ä»¤çš„è°ƒç”¨æ¬¡æ•°ä¸è¶³20æ¬¡ï¼Œå³ä½¿æ‰€æœ‰çš„è¯·zæ±‚éƒ½è¶…æ—¶æˆ–å…¶ä»–åŸå› å¤±è´¥ï¼Œæ–­è·¯å™¨éƒ½ä¸ä¼šæ‰“å¼€ã€‚</li>
<li>é”™è¯¯ç™¾åˆ†æ¯”é˜ˆå€¼ï¼šå½“è¯·æ±‚æ€»æ•°åœ¨å¿«ç…§æ—¶é—´çª—å†…è¶…è¿‡äº†é˜ˆå€¼ï¼Œæ¯”å¦‚å‘ç”Ÿäº†30æ¬¡è°ƒç”¨ï¼Œå¦‚æœåœ¨è¿™30æ¬¡è°ƒç”¨ä¸­ï¼Œæœ‰15æ¬¡å‘ç”Ÿäº†è¶…æ—¶å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯è¶…è¿‡50%çš„é”™è¯¯ç™¾åˆ†æ¯”ï¼Œåœ¨é»˜è®¤è®¾å®š50%é˜ˆå€¼æƒ…å†µä¸‹ï¼Œè¿™æ—¶å€™å°±ä¼šå°†æ–­è·¯å™¨æ‰“å¼€ã€‚</li>
</ul>
<p>å¼€å¯æˆ–è€…å…³é—­çš„æ¡ä»¶ï¼š</p>
<ul>
<li>å½“æ»¡è¶³ä¸€å®šçš„é˜ˆå€¼çš„æ—¶å€™ï¼ˆé»˜è®¤10ç§’å†…è¶…è¿‡20å“¥è¯·æ±‚æ¬¡æ•°ï¼‰</li>
<li>å½“å¤±è´¥ç‡è¾¾åˆ°ä¸€å®šçš„æ—¶å€™ï¼ˆé»˜è®¤10ç§’å†…è¶…è¿‡50%çš„è¯·æ±‚å¤±è´¥ï¼‰</li>
<li>åˆ°è¾¾ä»¥ä¸Šé˜ˆå€¼ï¼Œæ–­è·¯å™¨å°†ä¼šå¼€å¯</li>
<li>å½“å¼€å¯çš„æ—¶å€™ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¸ä¼šè¿›è¡Œè½¬å‘</li>
<li>ä¸€æ®µæ—¶é—´ä¹‹åï¼ˆé»˜è®¤æ˜¯5ç§’ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™æ–­è·¯å™¨æ˜¯åŠå¼€çŠ¶æ€ï¼Œä¼šè®©å…¶ä¸­ä¸€ä¸ªè¯·æ±‚è¿›è¡Œè½¬å‘ã€‚å¦‚æœæˆåŠŸï¼Œæ–­è·¯å™¨ä¼šå…³é—­ï¼Œè‹¥å¤±è´¥ï¼Œç»§ç»­å¼€å¯ã€‚é‡å¤4å’Œ5ã€‚</li>
</ul>
<p>æ–­è·¯å™¨æ‰“å¼€ä¹‹åï¼š</p>
<ul>
<li>å†æœ‰è¯·æ±‚è°ƒç”¨çš„æ—¶å€™ï¼Œå°†ä¸ä¼šè°ƒç”¨ä¸»é€»è¾‘ï¼Œè€Œæ˜¯ç›´æ¥è°ƒç”¨é™çº§fallbackï¼Œé€šè¿‡æ–­è·¯å™¨ï¼Œå®ç°äº†è‡ªåŠ¨åœ°å‘ç°é”™è¯¯å¹¶å°†é™çº§é€»è¾‘åˆ‡æ¢ä¸ºä¸»é€»è¾‘ï¼Œå‡å°‘å“åº”å»¶è¿Ÿçš„æ•ˆæœã€‚</li>
<li>æ¢å¤åŸæ¥çš„ä¸»é€»è¾‘ï¼š<ul>
<li>å¯¹äºè¿™ä¸€é—®é¢˜ï¼Œhystrixä¹Ÿä¸ºæˆ‘ä»¬å®ç°äº†è‡ªåŠ¨æ¢å¤åŠŸèƒ½ã€‚</li>
<li>å½“æ–­è·¯å™¨æ‰“å¼€ï¼Œå¯¹ä¸»é€»è¾‘è¿›è¡Œç†”æ–­ä¹‹åï¼Œhystrixä¼šå¯åŠ¨ä¸€ä¸ªä¼‘çœ æ—¶é—´çª—ï¼Œåœ¨è¿™ä¸ªæ—¶é—´çª—å†…ï¼Œé™çº§é€»è¾‘æ˜¯ä¸´æ—¶çš„æˆä¸ºä¸»é€»è¾‘ï¼Œå½“ä¼‘çœ æ—¶é—´çª—åˆ°æœŸï¼Œæ–­è·¯å™¨å°†è¿›å…¥åŠå¼€çŠ¶æ€ï¼Œé‡Šæ”¾ä¸€æ¬¡è¯·æ±‚åˆ°åŸæ¥çš„ä¸»é€»è¾‘ä¸Šï¼Œå¦‚æœæ­¤æ¬¡è¯·æ±‚æ­£å¸¸è¿”å›ï¼Œé‚£ä¹ˆæ–­è·¯å™¨å°†ç»§ç»­é—­åˆï¼Œä¸»é€»è¾‘æ¢å¤ï¼Œå¦‚æœè¿™æ¬¡è¯·æ±‚ä¾ç„¶æœ‰é—®é¢˜ï¼Œæ–­è·¯å™¨ç»§ç»­è¿›å…¥æ‰“å¼€çŠ¶æ€ï¼Œä¼‘çœ æ—¶é—´çª—é‡æ–°è®¡æ—¶ã€‚</li>
</ul>
</li>
</ul>
<blockquote>
<p>Dashboardç›‘æ§</p>
</blockquote>
<p>Hystrixæä¾›äº†å‡†å®æ—¶çš„è°ƒç”¨ç›‘æ§ï¼ˆHystrix Dashboardï¼‰ï¼ŒHystrixä¼šæŒç»­åœ°è®°å½•æ‰€æœ‰é€šè¿‡Hystrixå‘èµ·çš„è¯·æ±‚çš„æ‰§è¡Œä¿¡æ¯ï¼Œå¹¶ä»¥ç»Ÿè®¡æŠ¥è¡¨å’Œå›¾å½¢çš„å½¢å¼å±•ç¤ºç»™ç”¨æˆ·ï¼ŒåŒ…æ‹¬æ¯ç§’æ‰§è¡Œå¤šå°‘è¯·æ±‚æˆåŠŸã€å¤šå°‘å¤±è´¥ç­‰ã€‚Netflixé€šè¿‡hystrix-metrics-event-streamé¡¹ç›®å®ç°äº†å¯¹ä»¥ä¸ŠæŒ‡æ ‡çš„ç›‘æ§ã€‚Spring Cloudå¤œæä¾›äº†Hystrix Dashboardçš„æ•´åˆï¼Œå¯¹ç›‘æ§å†…å®¹è½¬æ¢æˆå¯è§†åŒ–ç•Œé¢ã€‚</p>
<blockquote>
<p>POM</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix-dashboard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>YML</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-consumer-hystrix-dashboard</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Main</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableHystrixDashboard</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HystrixDashboardMain9001Application</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(HystrixDashboardMain9001Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å…¥<a target="_blank" rel="noopener" href="http://localhost:8001/hystrix.stream%E5%8D%B3%E5%8F%AF%E8%BF%9B%E8%A1%8C%E7%9B%91%E6%8E%A7%EF%BC%9A">http://localhost:8001/hystrix.streamå³å¯è¿›è¡Œç›‘æ§ï¼š</a></p>
<img src="/2021/01/25/SpringCloud/image-20210119232242203.png" class="" title="image-20210119232242203">



<h2 id="ğŸŒæœåŠ¡ç½‘å…³"><a href="#ğŸŒæœåŠ¡ç½‘å…³" class="headerlink" title="ğŸŒæœåŠ¡ç½‘å…³"></a>ğŸŒæœåŠ¡ç½‘å…³</h2><h3 id="ğŸ‡Spring-Cloud-Gateway"><a href="#ğŸ‡Spring-Cloud-Gateway" class="headerlink" title="ğŸ‡Spring Cloud Gateway"></a>ğŸ‡Spring Cloud Gateway</h3><blockquote>
<p>æ¦‚è¿°</p>
</blockquote>
<p>Spring Cloud Gatewayæ—¶Spring Cloudçš„ä¸€ä¸ªå…¨æ–°é¡¹ç›®ï¼ŒåŸºäºSpring 5.0  + Spring Boot 2.0å’ŒProject Reactorç­‰æŠ€æœ¯å¼€å‘çš„ç½‘å…³ï¼Œå®ƒæ—¨åœ¨ä¸ºå¾®æœåŠ¡æ¶æ„æä¾›ä¸€ç§ç®€å•æœ‰æ•ˆçš„ç»Ÿä¸€çš„APIè·¯ç”±ç®¡ç†æ–¹å¼ã€‚</p>
<p>SpringCloud Gatewayä½œä¸ºSpring Cloudç”Ÿæ€ç³»ç»Ÿä¸­çš„ç½‘å…³ï¼Œç›®æ ‡æ˜¯æ›¿ä»£Zuulï¼Œåœ¨Spring Cloud 2.0ä»¥ä¸Šç‰ˆæœ¬ä¸­ï¼Œæ²¡æœ‰å¯¹æ–°ç‰ˆæœ¬çš„Zuul 2.0ä»¥ä¸Šæœ€æ–°é«˜æ€§èƒ½ç‰ˆæœ¬è¿›è¡Œé›†æˆï¼Œä»ç„¶è¿˜æ˜¯ä½¿ç”¨çš„Zuul 1.xéReactoræ¨¡å¼çš„è€ç‰ˆæœ¬ï¼Œè€Œä¸ºäº†æä¾›ç½‘å…³çš„æ€§èƒ½ï¼ŒSpringCloud Gatewayæ˜¯åŸºäºWebFluxæ¡†æ¶å®ç°çš„ï¼Œè€ŒWebFluxæ¡†æ¶åº•å±‚åˆ™ä½¿ç”¨äº†é«˜æ€§èƒ½çš„Reactoræ¨¡å¼é€šä¿¡æ¡†æ¶Nettyã€‚</p>
<p>Spring Cloud Gatewayçš„ç›®æ ‡æ˜¯æä¾›ç»Ÿä¸€çš„è·¯ç”±æ–¹å¼ä¸”åŸºäºFilteré“¾çš„æ–¹å¼æä¾›äº†ç½‘å…³åŸºæœ¬çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šå®‰å…¨ã€ç›‘æ§/æŒ‡æ ‡å’Œé™æµã€‚</p>
<blockquote>
<p>æ ¸å¿ƒæ¦‚å¿µ</p>
</blockquote>
<p>1ï¸âƒ£Route(è·¯ç”±)</p>
<p>è·¯ç”±æ˜¯æ„å»ºç½‘å…³çš„åŸºæœ¬æ¨¡å—ï¼Œå®ƒç”±IDã€ç›®æ ‡URIã€ä¸€ç³»åˆ—çš„æ–­è¨€å’Œè¿‡æ»¤å™¨ç»„æˆï¼Œå¦‚æœæ–­è¨€ä¸ºtrueåˆ™åŒ¹é…è¯¥è·¯ç”±ã€‚</p>
<p>2ï¸âƒ£Predicate(æ–­è¨€)</p>
<p>å‚è€ƒçš„æ˜¯Java8çš„java.util.function.Predicateã€‚å¼€å‘äººå‘˜å¯ä»¥åŒ¹é…HTTPè¯·æ±‚ä¸­çš„æ‰€æœ‰å†…å®¹(ä¾‹å¦‚è¯·æ±‚å¤´æˆ–è¯·æ±‚å‚æ•°)ï¼Œå¦‚æœè¯·æ±‚ä¸æ–­è¨€ç›¸åŒ¹é…åˆ™è¿›è¡Œè·¯ç”±ã€‚</p>
<p>3ï¸âƒ£Filter(è¿‡æ»¤)</p>
<p>æŒ‡çš„æ˜¯Springæ¡†æ¶ä¸­Gateway Filterçš„å®ä¾‹ï¼Œä½¿ç”¨è¿‡æ»¤å™¨ï¼Œå¯ä»¥åœ¨è¯·æ±‚è¢«è·¯ç”±å‰æˆ–è€…ä¹‹åå¯¹è¯·æ±‚ä¿®æ”¹ã€‚</p>
<blockquote>
<p>é€‰å‹è¯´æ˜</p>
</blockquote>
<ul>
<li>Zuul1.0å·²ç»è¿›å…¥ç»´æŠ¤é˜¶æ®µï¼ŒGatewayæ˜¯SpringCloudå›¢é˜Ÿç ”å‘çš„ï¼Œæ˜¯äº²å„¿å­äº§å“ï¼Œå€¼å¾—ä¿¡èµ–ã€‚è€Œä¸”Gatewayå¾ˆå¤šåŠŸèƒ½Zuuléƒ½æ²¡æœ‰ï¼Œç”¨èµ·æ¥éå¸¸ç®€å•ä¾¿æ·ã€‚</li>
<li>Gatewayæ˜¯åŸºäºå¼‚æ­¥é˜»å¡æ¨¡å‹ä¸Šè¿›è¡Œå¼€å‘çš„ï¼Œæ€§èƒ½æ–¹é¢ä¸éœ€è¦æ‹…å¿ƒã€‚è™½ç„¶Netfliæ—©å°±å‘å¸ƒäº†æœ€æ–°çš„Zuul2.xï¼Œä½†SpringCloudè²Œä¼¼æ²¡æœ‰æ•´åˆè®¡åˆ’ã€‚è€Œä¸”Netflixç›¸å…³ç»„ä»¶éƒ½å®£å¸ƒè¿›å…¥ç»´æŠ¤æœŸï¼Œä¸çŸ¥å‰æ™¯å¦‚ä½•ã€‚</li>
</ul>
<blockquote>
<p>ç‰¹æ€§</p>
</blockquote>
<ul>
<li>åŸºäºSpring Framework 5 ã€Project Reactorå’ŒSpring Boot 2.0è¿›è¡Œæ„å»º</li>
<li>åŠ¨æ€è·¯ç”±ï¼šèƒ½å¤ŸåŒ¹é…ä»»ä½•è¯·æ±‚å±æ€§</li>
<li>å¯ä»¥å¯¹è·¯ç”±æŒ‡å®šPredicate(æ–­è¨€)å’ŒFilter(è¿‡æ»¤å™¨)</li>
<li>é›†æˆHystrixçš„æ–­è·¯å™¨åŠŸèƒ½</li>
<li>é›†æˆSpring CloudæœåŠ¡å‘ç°åŠŸèƒ½</li>
<li>æ˜“äºç¼–å†™çš„Predicate(æ–­è¨€)å’ŒFilter(è¿‡æ»¤å™¨)</li>
<li>è¯·æ±‚é™æµåŠŸèƒ½</li>
<li>æ”¯æŒè·¯å¾„é‡å†™</li>
</ul>
<blockquote>
<p>SpringCloud Gatewayä¸Zuulçš„åŒºåˆ«</p>
</blockquote>
<ul>
<li>Zuul 1.xæ˜¯ä¸€ä¸ªåŸºäºé˜»å¡I/Oçš„API Gatewayã€‚</li>
<li>Zuul 1.xåŸºäºServlet2.5ä½¿ç”¨é˜»å¡æ¶æ„å®ƒä¸æ”¯æŒä»»ä½•é•¿è¿æ¥(å¦‚Websocket)ã€‚Zuulçš„è®¾è®¡æ¨¡å¼å’ŒNginxè¾ƒåƒï¼Œæ¯æ¬¡I/Oæ“ä½œéƒ½æ˜¯ä»å·¥ä½œçº¿ç¨‹ä¸­é€‰æ‹©ä¸€ä¸ªæ‰§è¡Œï¼Œè¯·æ±‚çº¿ç¨‹è¢«é˜»å¡åˆ°å·¥ä½œçº¿ç¨‹å®Œæˆï¼Œä½†æ˜¯å·®åˆ«æ˜¯Nginxç”¨C++å®ç°ï¼ŒZuulç”¨Javaå®ç°ï¼Œè€ŒJVMæœ¬èº«ä¼šæœ‰ç¬¬ä¸€æ¬¡åŠ è½½è¾ƒæ…¢çš„æƒ…å†µï¼Œä½¿å¾—Zuulçš„æ€§èƒ½ç›¸å¯¹è¾ƒå·®ã€‚</li>
<li>Zuul 2.xç†å¿µæ›´å…ˆè¿›ï¼Œæƒ³åŸºäºNettyéé˜»å¡å’Œæ”¯æŒé•¿è¿æ¥ï¼Œä½†SpringCloudç›®å‰è¿˜æ²¡æœ‰æ•´åˆã€‚Zuul 2.xçš„æ€§èƒ½è¾ƒZuul 1.xæœ‰è¾ƒå¤§æå‡ã€‚åœ¨æ€§èƒ½æ–¹é¢ï¼Œæ ¹æ®å®˜æ–¹æä¾›çš„åŸºå‡†æµ‹è¯•ï¼ŒSpringCloud Gatewayçš„RPS(æ¯ç§’è¯·æ±‚æ•°)æ˜¯Zuulçš„1.6å€ã€‚</li>
<li>SpringCloud Gatewayä½¿ç”¨éé˜»å¡APIã€‚</li>
<li>SpringCloud Gatewayè¿˜æ”¯æŒWebsocketï¼Œå¹¶ä¸”ä¸Springç´§å¯†é›†æˆæ‹¥æœ‰æ›´å¥½çš„å¼€å‘ä½“éªŒã€‚</li>
</ul>
<h2 id="ğŸ”¨-æœåŠ¡é…ç½®"><a href="#ğŸ”¨-æœåŠ¡é…ç½®" class="headerlink" title="ğŸ”¨ æœåŠ¡é…ç½®"></a>ğŸ”¨ æœåŠ¡é…ç½®</h2><h3 id="âš™-Spring-Cloud-Config"><a href="#âš™-Spring-Cloud-Config" class="headerlink" title="âš™ Spring Cloud Config"></a>âš™ Spring Cloud Config</h3><p>ğŸ“–åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ</p>
<blockquote>
<p>æ¦‚è¿°</p>
</blockquote>
<p>Spring Cloud Configä¸ºå¾®æœåŠ¡æ¶æ„ä¸­çš„å¾®æœåŠ¡æä¾›é›†ä¸­åŒ–çš„å¤–éƒ¨é…ç½®æ”¯æŒï¼Œé…ç½®æœåŠ¡å™¨ä¸ºå„ä¸ªä¸åŒå¾®æœåŠ¡åº”ç”¨çš„æ‰€æœ‰ç¯å¢ƒæä¾›äº†ä¸€ä¸ªä¸­å¿ƒåŒ–çš„å¤–éƒ¨é…ç½®ã€‚</p>
<blockquote>
<p>ä½¿ç”¨</p>
</blockquote>
<p>Spring Cloud Configåˆ†ä¸ºæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¸¤éƒ¨åˆ†</p>
<ul>
<li>æœåŠ¡ç«¯ï¼šåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒï¼Œå®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¾®æœåŠ¡åº”ç”¨ï¼Œç”¨æ¥è¿æ¥é…ç½®æœåŠ¡å™¨å¹¶ä¸ºå®¢æˆ·ç«¯æä¾›é…ç½®ä¿¡æ¯ï¼ŒåŠ å¯†/è§£å¯†ä¿¡æ¯ç­‰è®¿é—®æ¥å£ã€‚</li>
<li>å®¢æˆ·ç«¯ï¼šé€šè¿‡æŒ‡å®šçš„é…ç½®ä¸­å¿ƒæ¥ç®¡ç†åº”ç”¨èµ„æºï¼Œä»¥åŠä¸ä¸šåŠ¡ç›¸å…³çš„é…ç½®å†…å®¹ï¼Œå¹¶åœ¨å¯åŠ¨çš„æ—¶å€™ä»é…ç½®ä¸­å¿ƒè·å–å’ŒåŠ è½½é…ç½®ä¿¡æ¯å’Œé…ç½®æœåŠ¡å™¨ï¼Œé»˜è®¤é‡‡ç”¨gitæ¥å­˜å‚¨é…ç½®ä¿¡æ¯ï¼Œè¿™æ ·å°±æœ‰åŠ©äºå¯¹ç¯å¢ƒé…ç½®è¿›è¡Œç‰ˆæœ¬ç®¡ç†ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡gitå®¢æˆ·ç«¯å·¥å…·æ¥æ–¹ä¾¿çš„ç®¡ç†å’Œè®¿é—®é…ç½®å†…å®¹ã€‚</li>
</ul>
<h3 id="ğŸšŒSpring-Cloud-Bus"><a href="#ğŸšŒSpring-Cloud-Bus" class="headerlink" title="ğŸšŒSpring Cloud Bus"></a>ğŸšŒSpring Cloud Bus</h3><p>ğŸ“–æ¶ˆæ¯æ€»çº¿</p>
<blockquote>
<p>æ¦‚è¿°</p>
</blockquote>
<p>åœ¨å¾®æœåŠ¡æ¶æ„çš„ç³»ç»Ÿä¸­ï¼Œé€šè¿‡ä¼šä½¿ç”¨è½»é‡çº§çš„æ¶ˆæ¯ä»£ç†æ¥æ„å»ºä¸€ä¸ªå…±ç”¨çš„æ¶ˆæ¯ä¸»é¢˜ï¼Œå¹¶è®©ç³»ç»Ÿä¸­æ‰€æœ‰å¾®æœåŠ¡å®ä¾‹éƒ½è¿æ¥ä¸Šæ¥ï¼Œç”±äºè¯¥ä¸»é¢˜ä¸­äº§ç”Ÿçš„æ¶ˆæ¯ä¼šè¢«æ‰€æœ‰å®ä¾‹ç›‘å¬å’Œæ¶ˆè´¹ï¼Œæ‰€ä»¥ç§°å®ƒä¸ºæ¶ˆæ¯æ€»çº¿ã€‚åœ¨æ€»çº¿ä¸Šçš„å„ä¸ªå®ä¾‹ï¼Œéƒ½å¯ä»¥æ–¹ä¾¿åœ°å¹¿æ’­ä¸€äº›éœ€è¦è®©å…¶ä»–è¿æ¥åœ¨è¯¥ä¸»é¢˜ä¸Šçš„å®ä¾‹éƒ½çŸ¥é“çš„æ¶ˆæ¯ã€‚</p>
<blockquote>
<p>åŸç†</p>
</blockquote>
<p>ConfigClientå®ä¾‹éƒ½ç›‘å¬MQä¸­åŒä¸€ä¸ªtopic(é»˜è®¤æ˜¯SpringCloudBus)ã€‚å½“ä¸€ä¸ªæœåŠ¡åˆ·æ–°æ•°æ®çš„æ—¶å€™ï¼Œå®ƒä¼šæŠŠè¿™ä¸ªæ¶ˆæ¯æ”¾å…¥åˆ°Topicä¸­ï¼Œè¿™æ ·å…¶ä»–ç›‘å¬åŒä¸€Topicçš„æœåŠ¡å°±èƒ½å¾—åˆ°é€šçŸ¥ï¼Œç„¶åå»æ›´æ–°è‡ªèº«çš„é…ç½®ã€‚</p>
<blockquote>
<p>Dockerè¿è¡ŒRabbitMQ</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å®‰è£…è¿è¡Œ</span></span><br><span class="line">docker run -d --name rabbitmq -p 5672:5672 -p 15672:15672 -v `pwd`/data:/var/lib/rabbitmq -e RABBITMQ_DEFAULT_VHOST=/  -e RABBITMQ_DEFAULT_USER=Khighness -e RABBITMQ_DEFAULT_PASS=KAG1823 rabbitmq</span><br><span class="line"><span class="meta">#</span><span class="bash"> å¼€å¯å¯è§†åŒ–</span></span><br><span class="line">docker exec -it rabbitmq rabbitmq-plugins enable rabbitmq_management</span><br></pre></td></tr></table></figure>



<h3 id="ğŸŒŠSpring-Cloud-Stream"><a href="#ğŸŒŠSpring-Cloud-Stream" class="headerlink" title="ğŸŒŠSpring Cloud Stream"></a>ğŸŒŠSpring Cloud Stream</h3><p>ğŸ“–æ¶ˆæ¯é©±åŠ¨</p>
<blockquote>
<p>æ¦‚è¿°</p>
</blockquote>
<p>Spring Cloud Streamæ˜¯ä¸€ä¸ªæ„å»ºæ¶ˆæ¯é©±åŠ¨å¾®æœåŠ¡çš„æ¡†æ¶ã€‚</p>
<p>åº”ç”¨ç¨‹åºé€šè¿‡inputsæˆ–è€…outputsæ¥ä¸Spring Cloud Streamä¸­binderå¯¹è±¡äº¤äº’ã€‚</p>
<p>é€šè¿‡é…ç½®æ¥ç»‘å®šï¼ŒSpring Cloud Streamçš„binderå¯¹è±¡è´Ÿè´£ä¸æ¶ˆæ¯ä¸­é—´ä»¶äº¤äº’ã€‚</p>
<p>é€šè¿‡ä½¿ç”¨Spring Intergrationæ¥è¿æ¥æ¶ˆæ¯ä»£ç†ä¸­é—´ä»¶ä»¥å®ç°æ¶ˆæ¯äº‹ä»¶é©±åŠ¨ã€‚</p>
<p>Spring Cloud Streamä¸ºä¸€äº›ä¾›åº”å•†çš„æ¶ˆæ¯ä¸­é—´ä»¶äº§å“æä¾›äº†ä¸ªæ€§åŒ–çš„è‡ªåŠ¨åŒ–é…ç½®å®ç°ï¼Œå¼•ç”¨äº†å‘å¸ƒ/è®¢é˜…ã€æ¶ˆè´¹ç»„ã€åˆ†åŒºä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‚</p>
<p>ç›®å‰ä»…æ”¯æŒ<strong>RabbitMQ</strong>ã€<strong>Kafka</strong>ã€‚</p>
<blockquote>
<p>è®¾è®¡æ€æƒ³</p>
</blockquote>
<p>åœ¨æ²¡æœ‰ç»‘å®šå™¨è¿™ä¸ªæ¦‚å¿µçš„æƒ…å†µä¸‹ï¼ŒSpringBootåº”ç”¨è¦ç›´æ¥ä¸æ¶ˆæ¯ä¸­é—´ä»¶è¿›è¡Œä¿¡æ¯äº¤äº’çš„æ—¶å€™ï¼Œç”±äºå„æ¶ˆæ¯ä¸­é—´ä»¶æ„å»ºçš„åˆè¡·ä¸åŒï¼Œå®ƒä»¬çš„å®ç°ç»†èŠ‚ä¸Šä¼šæœ‰è¾ƒå¤§çš„å·®å¼‚æ€§ã€‚</p>
<p><strong>é€šè¿‡å®šä¹‰ç»‘å®šå™¨ä½œä¸ºä¸­é—´å±‚ï¼Œå®Œç¾åœ°å®ç°äº†åº”ç”¨ç¨‹åºä¸æ¶ˆæ¯ä¸­é—´ä»¶ä¹‹é—´çš„éš”ç¦»ã€‚</strong></p>
<p>é€šè¿‡å‘åº”ç”¨ç¨‹åºæš´éœ²ç»Ÿä¸€çš„Channelé€šé“ï¼Œä½¿å¾—åº”ç”¨ç¨‹åºä¸éœ€è¦å†è€ƒè™‘å„ç§ä¸åŒçš„æ¶ˆæ¯ä¸­é—´ä»¶å®ç°ã€‚</p>
<blockquote>
<p>ç»‘å®šå™¨</p>
</blockquote>
<img src="/2021/01/25/SpringCloud/Stream.png" class="" title="Stream">



<blockquote>
<p>æ ‡å‡†æµç¨‹å¥—è·¯</p>
</blockquote>
<ul>
<li>Binder: å¾ˆæ–¹ä¾¿çš„è¿æ¥ä¸­é—´ä»¶ï¼Œå±è”½å·®å¼‚</li>
<li>Channel: é€šé“ï¼Œæ˜¯é˜Ÿåˆ—Queueçš„ä¸€ç§æŠ½è±¡ï¼Œåœ¨æ¶ˆæ¯é€šè®¯ç³»ç»Ÿä¸­å°±æ˜¯å®ç°å­˜å‚¨å’Œè½¬å‘çš„åª’ä»‹ï¼Œé€šè¿‡Channelå¯¹é˜Ÿåˆ—è¿›è¡Œé…ç½®</li>
<li>Sourceå’ŒSink: ä»Streamå‘å¸ƒæ¶ˆæ¯å°±æ˜¯è¾“å‡ºï¼Œæ¥æ”¶æ¶ˆæ¯å°±æ˜¯è¾“å…¥</li>
</ul>
<blockquote>
<p>ç¼–ç å¸¸ç”¨æ³¨è§£</p>
</blockquote>
<img src="SpringCloud/image-20210124190703816.png" alt="image-20210124190703816" style="zoom: 80%;" />

<table>
<thead>
<tr>
<th>ç»„æˆ</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>Middleware</td>
<td>ä¸­é—´ä»¶ï¼Œç›®å‰åªæ”¯æŒRabbitMQå’ŒKafka</td>
</tr>
<tr>
<td>Binder</td>
<td>Binderæ˜¯åº”ç”¨ä¸æ¶ˆæ¯ä¸­é—´ä»¶ä¹‹é—´çš„å°è£…ï¼Œç›®å‰å®è¡Œäº†Kafkaå’ŒRabbitMQçš„Binderï¼Œé€šè¿‡Binderå¯ä»¥å¾ˆæ–¹ä¾¿çš„è¿æ¥ä¸­é—´ä»¶ï¼Œå¯ä»¥åŠ¨æ€çš„æ”¹å˜æ¶ˆæ¯ç±»å‹(å¯¹äºKafkaçš„topicï¼ŒRabbitMQçš„exchange)ï¼Œè¿™äº›éƒ½å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æ¥å®ç°</td>
</tr>
<tr>
<td>@Input</td>
<td>æ³¨è§£æ ‡è¯†è¾“å…¥é€šé“ï¼Œé€šè¿‡è¯¥è¾“å…¥é€šé“æ¥æ”¶åˆ°çš„æ¶ˆæ¯è¿›å…¥åº”ç”¨ç¨‹åº</td>
</tr>
<tr>
<td>@Output</td>
<td>æ³¨è§£æ ‡è¯†è¾“å‡ºé€šé“ï¼Œå‘å¸ƒçš„æ¶ˆæ¯å°†é€šè¿‡è¯¥é€šé“ç¦»å¼€åº”ç”¨ç¨‹åº</td>
</tr>
<tr>
<td>@StreamListener</td>
<td>ç›‘å¬é˜Ÿåˆ—ï¼Œç”¨äºæ¶ˆè´¹è€…çš„é˜Ÿåˆ—çš„æ¶ˆæ¯æ¥æ”¶</td>
</tr>
<tr>
<td>@EnableBinding</td>
<td>æŒ‡ä¿¡é“channelå’Œexchangeç»‘å®šåœ¨ä¸€èµ·</td>
</tr>
</tbody></table>
<h3 id="ğŸ“¸-Spring-Cloud-Sleuth"><a href="#ğŸ“¸-Spring-Cloud-Sleuth" class="headerlink" title="ğŸ“¸ Spring Cloud Sleuth"></a>ğŸ“¸ Spring Cloud Sleuth</h3><blockquote>
<p>ç—›ç‚¹</p>
</blockquote>
<p>åœ¨å¾®æœåŠ¡æ¡†æ¶ä¸­ï¼Œä¸€ä¸ªç”±å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚åœ¨åç«¯ç³»ç»Ÿä¸­ä¼šç»è¿‡å¤šä¸ªä¸åŒçš„æœåŠ¡èŠ‚ç‚¹è°ƒç”¨æ¥ååŒäº§ç”Ÿæœ€åçš„è¯·æ±‚ç»“æœï¼Œæ¯ä¸€ä¸ªå‰ç«¯è¯·æ±‚éƒ½ä¼šå½¢æˆä¸€ä¸ªå¤æ‚çš„åˆ†å¸ƒå¼æœåŠ¡è°ƒç”¨é“¾è·¯ï¼Œé“¾è·¯ä¸­çš„ä»»ä½•ä¸€ç¯å‡ºç°é«˜å»¶è¿Ÿæˆ–é”™è¯¯éƒ½ä¼šå¼•èµ·æ•´ä¸ªè¯·æ±‚æœ€åçš„å¤±è´¥ã€‚</p>
<blockquote>
<p>zipkin</p>
</blockquote>
<ul>
<li>jar</li>
</ul>
<p>ä¸‹è½½ï¼š<a target="_blank" rel="noopener" href="https://dl.bintray.com/openzipkin/maven/io/zipkin/java/zipkin-server/">https://dl.bintray.com/openzipkin/maven/io/zipkin/java/zipkin-server/</a></p>
<p>è¿è¡Œï¼š<code>java -jar zipkin-server-2.12.9-exec.jar</code></p>
<ul>
<li>docker</li>
</ul>
<p>ä¸‹è½½ï¼š<code>docker pull openzipkin/zipkin</code></p>
<p>è¿è¡Œï¼š<code>docker run -d --restart always -p 9411:9411 --name zipkin openzipkin/zipkin </code></p>
<h2 id="ğŸ’¥-é˜¿é‡Œå·´å·´"><a href="#ğŸ’¥-é˜¿é‡Œå·´å·´" class="headerlink" title="ğŸ’¥ é˜¿é‡Œå·´å·´"></a>ğŸ’¥ é˜¿é‡Œå·´å·´</h2><h3 id="ğŸ”¥-Spring-Cloud-Alibaba"><a href="#ğŸ”¥-Spring-Cloud-Alibaba" class="headerlink" title="ğŸ”¥  Spring Cloud Alibaba"></a>ğŸ”¥  Spring Cloud Alibaba</h3><blockquote>
<p>èƒŒæ™¯</p>
</blockquote>
<p>åšå®¢åŸæ–‡ï¼š<a target="_blank" rel="noopener" href="https://spring.io/blog/2018/12/12/spring-cloud-greenwich-rc1-available-now">spring-cloud-greenwich-rc1-available-now</a></p>
<p>Spring Cloud Netflixé¡¹ç›®è¿›å…¥ç»´æŠ¤æ¨¡å¼</p>
<p>ä»¥ä¸‹Spring Cloud Netflixæ¨¡å—å’Œç›¸åº”çš„å¯åŠ¨ç¨‹åºå°†è¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼š</p>
<ol>
<li>spring-cloud-netflix-archaius</li>
<li>spring-cloud-netflix-hystrix-contract</li>
<li>spring-cloud-netflix-hystrix-dashboard</li>
<li>spring-cloud-netflix-hystrix-stream</li>
<li>spring-cloud-netflix-hystrix</li>
<li>spring-cloud-netflix-ribbon</li>
<li>spring-cloud-netflix-turbine-stream</li>
<li>spring-cloud-netflix-turbine</li>
<li>spring-cloud-netflix-zuul</li>
</ol>
<p>è¿™ä¸åŒ…æ‹¬Eurekaæˆ–å¹¶å‘é™åˆ¶æ¨¡å—ã€‚</p>
<blockquote>
<p>è¯ç”Ÿ</p>
</blockquote>
<p>2018-10-31ï¼ŒSpring Cloud Alibabaæ­£å¼å…¥é©»äº†Spring Cloudå®˜æ–¹å­µåŒ–å™¨ï¼Œå¹¶åœ¨Mavenä¸­å¤®ä»“åº“å‘å¸ƒäº†ç¬¬ä¸€ä¸ªç‰ˆæœ¬ã€‚</p>
<p>å®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_introduction">spring-cloud-alibaba</a></p>
<blockquote>
<p>åŠŸèƒ½</p>
</blockquote>
<ul>
<li>æœåŠ¡é™æµé™çº§ï¼šé»˜è®¤æ”¯æŒServletã€Feignã€RestTemplateã€Duddoå’ŒRocketMQé™æµé™çº§åŠŸèƒ½çš„æ¥å…¥ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡æ§åˆ¶å°ä¿®æ”¹é™æµé™çº§è§„åˆ™ï¼Œè¿˜æ”¯æŒæŸ¥çœ‹é™æµé™çº§Metricsç›‘æ§ã€‚</li>
<li>æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼šé€‚é…Spring CloudæœåŠ¡æ³¨å†Œä¸å‘ç°æ ‡å‡†ï¼Œé»˜è®¤é›†æˆäº†Ribbonçš„æ”¯æŒã€‚</li>
<li>åˆ†å¸ƒå¼é…ç½®ç®¡ç†ï¼šæ”¯æŒåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¤–éƒ¨åŒ–é…ç½®ï¼Œé…ç½®æ›´æ”¹æ—¶è‡ªåŠ¨åˆ·æ–°ã€‚</li>
<li>æ¶ˆæ¯é©±åŠ¨èƒ½åŠ›ï¼šåŸºäºSpring Cloud Streamä¸ºå¾®æœåŠ¡åº”ç”¨æ„å»ºæ¶ˆæ¯é©±åŠ¨èƒ½åŠ›ã€‚</li>
<li>é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨ï¼šé˜¿é‡Œäº‘æä¾›æµ·é‡ã€å®‰å…¨ã€ä½æˆæœ¬ã€é«˜å¯é çš„äº‘å­˜å‚¨æœåŠ¡ã€‚æ”¯æŒåœ¨ä»»ä½•åº”ç”¨ã€ä»»ä½•æ—¶é—´ã€ä»»ä½•åœ°ç‚¹å­˜å‚¨å’Œè®¿é—®ä»»æ„ç±»å‹çš„æ•°æ®ã€‚</li>
<li>åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ï¼šæä¾›ç§’çº§ã€ç²¾å‡†ã€é«˜å¯é ã€é«˜å¯ç”¨çš„å®šæ—¶ï¼ˆåŸºäºCronè¡¨è¾¾å¼ï¼‰ä»»åŠ¡è°ƒåº¦æœåŠ¡ï¼ŒåŒæ—¶æä¾›åˆ†å¸ƒå¼çš„ä»»åŠ¡æ‰§è¡Œæ¨¡å‹ï¼Œå¦‚ç½‘æ ¼ä»»åŠ¡ã€‚ç½‘æ ¼ä»»åŠ¡æ”¯æŒæµ·é‡å­ä»»åŠ¡å‡åŒ€åˆ†é…åˆ°æ‰€æœ‰Workerï¼ˆschedulex-clientï¼‰ä¸Šæ‰§è¡Œã€‚</li>
</ul>
<h3 id="â™¾ï¸Nacos"><a href="#â™¾ï¸Nacos" class="headerlink" title="â™¾ï¸Nacos"></a>â™¾ï¸Nacos</h3><blockquote>
<p>æ¦‚è¿°</p>
</blockquote>
<p>ä¸€ä¸ªæ›´æ˜“äºæ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„åŠ¨æ€æœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†å¹³å°ï¼Œå³æ³¨å†Œä¸­å¿ƒå’Œé…ç½®ä¸­å¿ƒçš„ç»„åˆã€‚</p>
<p>ç†è§£ï¼šNacos = Eureka + Config + Bus</p>
<p>å®˜ç½‘ï¼š<a target="_blank" rel="noopener" href="http://nacos.io/">nacos</a></p>
<blockquote>
<p>Dockerè¿è¡ŒNacos</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä¸‹è½½é•œåƒ</span></span><br><span class="line">docker pull nacos/nacos-server:1.1.4 </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºé…ç½®æ–‡ä»¶å’Œæ—¥å¿—æ–‡ä»¶ç›®å½•</span></span><br><span class="line">mkdir -p /opt/nacos/single/init.d /opt/nacos/single/logs </span><br><span class="line">cd /opt/nacos/single/init.d &amp;&amp; touch custom.properties</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> custom.propertiesæ–‡ä»¶ä¸­å¡«å†™å¦‚ä¸‹é…ç½®</span></span><br><span class="line">server.contextPath=/nacos</span><br><span class="line">server.port=8848</span><br><span class="line">management.endpoints.web.exposure.include=*</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºå¹¶å¯åŠ¨å®¹å™¨</span></span><br><span class="line">docker run -d -p 8848:8848 -e MODE=standalone \</span><br><span class="line">-v /opt/nacos/single/init.d/custom.properties:/home/nacos/init.d/custom.properties \</span><br><span class="line">-v /opt/nacos/single/logs:/home/nacos/logs \</span><br><span class="line">--restart always \</span><br><span class="line">--name nacos nacos/nacos-server:1.1.4 </span><br></pre></td></tr></table></figure>



<blockquote>
<p>ç•Œé¢</p>
</blockquote>
<p>æ‰“å¼€æµè§ˆå™¨è¾“å…¥: <a target="_blank" rel="noopener" href="http://ip:8848/nacos%EF%BC%8C%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81%E5%9D%87%E4%B8%BA%EF%BC%9Anacos">http://ip:8848/nacosï¼Œè´¦å·å¯†ç å‡ä¸ºï¼šnacos</a></p>
<img src="/2021/01/25/SpringCloud/image-20210127232554083.png" class="" title="image-20210127232554083">



<blockquote>
<p>æ¶æ„</p>
</blockquote>
<ul>
<li>åŸºç¡€æ¶æ„</li>
</ul>
<img src="/2021/01/25/SpringCloud/NacosInfrastructure.jpeg" class="" title="NacosInfrastructure">

<ul>
<li>é€»è¾‘æ¶æ„</li>
</ul>
<img src="/2021/01/25/SpringCloud/NacosLogicalArchitecture.png" class="" title="NacosLogicalArchitecture">

<ul>
<li>å…¨æ™¯æ¶æ„</li>
</ul>
<img src="/2021/01/25/SpringCloud/NacosBuildAndDeploy.png" class="" title="NacosBuildAndDeploy">



<blockquote>
<p>CAP</p>
</blockquote>
<p>nacosæ”¯æŒCPå’ŒAPä¹‹é—´çš„åˆ‡æ¢ï¼š</p>
<ul>
<li>å¦‚æœä¸éœ€è¦å­˜å‚¨æœåŠ¡çº§åˆ«çš„ä¿¡æ¯ä¸”æœåŠ¡å®ä¾‹æ˜¯é€šè¿‡nacos-clientæ³¨å†Œï¼Œå¹¶èƒ½å¤Ÿä¿æŒå¿ƒè·³ä¸ŠæŠ¥ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€‰æ‹©APæ¨¡å¼ã€‚å½“å‰ä¸»æµçš„æœåŠ¡å¦‚Spring Cloudå’ŒDubboæœåŠ¡ï¼Œéƒ½é€‚ç”¨äºAPæ¨¡å¼ï¼ŒAPæ¨¡å¼ä¸ºäº†æœåŠ¡çš„å¯èƒ½æ€§è€Œå‡å¼±äº†ä¸€è‡´æ€§ï¼Œå› æ­¤APæ¨¡å¼ä¸‹åªæ”¯æŒæ³¨å†Œä¸´æ—¶å®ä¾‹ã€‚</li>
<li>å¦‚æœéœ€è¦åœ¨æœåŠ¡çº§åˆ«ç¼–è¾‘æˆ–è€…å­˜å‚¨é…ç½®ä¿¡æ¯ï¼Œé‚£ä¹ˆCPæ˜¯å¿…é¡»çš„ã€‚K8Så’ŒDNSæœåŠ¡å™¨åˆ™é€‚ç”¨äºCPæ¨¡å¼ã€‚CPæ¨¡å¼ä¸‹æ”¯æŒæ³¨å†ŒæŒä¹…åŒ–å®ä¾‹ï¼Œæ­¤æ—¶åˆ™æ˜¯ä»¥Raftåè®®ä¸ºé›†ç¾¤è¿è¡Œæ¨¡å¼ï¼Œè¯¥æ¨¡å¼ä¸‹æ³¨å†Œå®ä¾‹ä¹‹å‰å¿…é¡»å…ˆæ³¨å†ŒæœåŠ¡ï¼Œå¦‚æœæœåŠ¡ä¸å­˜åœ¨ï¼Œåˆ™ä¼šè¿”å›é”™è¯¯ã€‚</li>
</ul>
<blockquote>
<p>åŠ è½½é…ç½®</p>
</blockquote>
<ul>
<li><p>DataIDæ–¹æ¡ˆ</p>
<p>æŒ‡å®š<code>spring.profie.active</code>å’Œé…ç½®æ–‡ä»¶çš„<code>DataID</code>æ¥ä½¿ä¸åŒç¯å¢ƒä¸‹è¯»å–ä¸åŒçš„é…ç½®</p>
</li>
<li><p>Groupæ–¹æ¡ˆ</p>
<p>æŒ‡å®š<code>spring.cloud.nacos.config.group</code>æ¥æŒ‡å®šä¸åŒåˆ†ç»„çš„é…ç½®</p>
</li>
<li><p>NameSpaceæ–¹æ¡ˆ</p>
<p>æŒ‡å®š<code>spring.cloud.nacos.config.namespace</code>æ¥æŒ‡å®šä¸åŒå‘½åç©ºé—´çš„é…ç½®</p>
</li>
</ul>
<p>æ€»ç»“ï¼ŒNameSpaceåŒ…å«Groupï¼ŒGroupåŒ…å«DataIDã€‚</p>
<blockquote>
<p>éƒ¨ç½²æ¨¡å¼</p>
</blockquote>
<p>Nacosæ”¯æŒä¸‰ç§éƒ¨ç½²æ¨¡å¼ï¼š</p>
<ul>
<li>å•æœºæ¨¡å¼-ç”¨äºæµ‹è¯•å’Œå•æœºä½¿ç”¨</li>
<li>é›†ç¾¤æ¨¡å¼-ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œç¡®ä¿é«˜å¯ç”¨</li>
<li>å¤šé›†ç¾¤æ¨¡å¼-ç”¨äºå¤šæ•°æ®ä¸­å¿ƒåœºæ™¯</li>
</ul>
<blockquote>
<p>æŒä¹…åŒ–</p>
</blockquote>
<p>é»˜è®¤Nacosä½¿ç”¨åµŒå…¥å¼æ•°æ®åº“å®ç°æ•°æ®çš„å­˜å‚¨ã€‚æ‰€ä»¥ï¼Œå¦‚æœå¯åŠ¨å¤šä¸ªé»˜è®¤é…ç½®ä¸‹çš„NacosèŠ‚ç‚¹ï¼Œæ•°æ®å­˜å‚¨æ˜¯å­˜åœ¨ä¸€è‡´æ€§é—®é¢˜çš„ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒNacosé‡‡ç”¨äº†é›†ä¸­å¼å­˜å‚¨çš„æ–¹å¼æ¥æ”¯æŒé›†ç¾¤åŒ–éƒ¨ç½²ï¼Œç›®å‰åªæ”¯æŒMySQLçš„å­˜å‚¨ã€‚</p>
<blockquote>
<p>ä½¿ç”¨MySQL</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºé…ç½®æ–‡ä»¶å’Œæ—¥å¿—æ–‡ä»¶ç›®å½•</span></span><br><span class="line">mkdir -p /opt/nacos/single/init.d /opt/nacos/single/logs </span><br><span class="line">cd /opt/nacos/single/init.d &amp;&amp; touch custom.properties</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> custom.propertiesæ–‡ä»¶ä¸­å¡«å†™å¦‚ä¸‹é…ç½®</span></span><br><span class="line">server.contextPath=/nacos</span><br><span class="line">server.servlet.contextPath=/nacos</span><br><span class="line">server.port=8848</span><br><span class="line">spring.datasource.platform=mysql</span><br><span class="line"></span><br><span class="line">db.num=1</span><br><span class="line">db.url.0=jdbc:mysql://172.17.0.5:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true</span><br><span class="line">db.user=root</span><br><span class="line">db.password=KAG1823</span><br><span class="line"></span><br><span class="line">nacos.cmdb.dumpTaskInterval=3600</span><br><span class="line">nacos.cmdb.eventTaskInterval=10</span><br><span class="line">nacos.cmdb.labelTaskInterval=300</span><br><span class="line">nacos.cmdb.loadDataAtStart=false</span><br><span class="line"></span><br><span class="line">management.metrics.export.elastic.enabled=false</span><br><span class="line">management.metrics.export.influx.enabled=false</span><br><span class="line">server.tomcat.accesslog.enabled=true</span><br><span class="line">server.tomcat.accesslog.pattern=%h %l %u %t &quot;%r&quot; %s %b %D %&#123;User-Agent&#125;i</span><br><span class="line">nacos.security.ignore.urls=/,/**/*.css,/**/*.js,/**/*.html,/**/*.map,/**/*.svg,/**/*.png,/**/*.ico,/console-fe/public/**,/v1/auth/login,/v1/console/health/**,/v1/cs/**,/v1/ns/**,/v1/cmdb/**,/actuator/**,/v1/console/server/**</span><br><span class="line">nacos.naming.distro.taskDispatchThreadCount=1</span><br><span class="line">nacos.naming.distro.taskDispatchPeriod=200</span><br><span class="line">nacos.naming.distro.batchSyncKeyCount=1000</span><br><span class="line">nacos.naming.distro.initDataRatio=0.9</span><br><span class="line">nacos.naming.distro.syncRetryDelay=5000</span><br><span class="line">nacos.naming.data.warmup=true</span><br><span class="line">nacos.naming.expireInstance=true</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºå¹¶å¯åŠ¨å®¹å™¨</span></span><br><span class="line">docker run --name nacos -p 8848:8848   \</span><br><span class="line">--privileged=true \</span><br><span class="line">--restart=always \</span><br><span class="line">-e JVM_XMS=256m \</span><br><span class="line">-e JVM_XMX=256m \</span><br><span class="line">-e MODE=standalone \</span><br><span class="line">-e PREFER_HOST_MODE=hostname \</span><br><span class="line">-v /opt/nacos/single/logs:/home/nacos/logs \</span><br><span class="line">-v /opt/nacos/single/init.d/custom.properties:/home/nacos/init.d/custom.properties \</span><br><span class="line">-d nacos/nacos-server:1.3.1</span><br></pre></td></tr></table></figure>



<blockquote>
<p>é›†ç¾¤</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">-e MODE=cluster \</span><br><span class="line">-e NACOS_APPLICATION_PORT=8849 \</span><br><span class="line">-e NACOS_SERVERS=192.168.117.155:8849,192.168.117.155:8850,192.168.117.155:8851 \</span><br><span class="line">-e SPRING_DATASOURCE_PLATFORM=mysql \</span><br><span class="line">-e MYSQL_SERVICE_HOST=192.168.117.155 \</span><br><span class="line">-e MYSQL_SERVICE_PORT=3306 \</span><br><span class="line">-e MYSQL_SERVICE_USER=root \</span><br><span class="line">-e MYSQL_SERVICE_PASSWORD=KAG1823 \</span><br><span class="line">-e MYSQL_SERVICE_DB_NAME=nacos_config \</span><br><span class="line">-e NACOS_SERVER_IP=192.168.117.155 \</span><br><span class="line">-p 8849:8849 \</span><br><span class="line">--name nacos8849 \</span><br><span class="line">nacos/nacos-server:1.3.1</span><br><span class="line"> </span><br><span class="line">docker run -d \</span><br><span class="line">-e MODE=cluster \</span><br><span class="line">-e NACOS_APPLICATION_PORT=8850 \</span><br><span class="line">-e NACOS_SERVERS=192.168.117.155:8849,192.168.117.155:8850,192.168.117.155:8851 \</span><br><span class="line">-e SPRING_DATASOURCE_PLATFORM=mysql \</span><br><span class="line">-e MYSQL_SERVICE_HOST=192.168.117.155 \</span><br><span class="line">-e MYSQL_SERVICE_PORT=3306 \</span><br><span class="line">-e MYSQL_SERVICE_USER=root \</span><br><span class="line">-e MYSQL_SERVICE_PASSWORD=KAG1823 \</span><br><span class="line">-e MYSQL_SERVICE_DB_NAME=nacos_config \</span><br><span class="line">-e NACOS_SERVER_IP=192.168.100.132 \</span><br><span class="line">-p 8850:8850 \</span><br><span class="line">--name nacos8850 \</span><br><span class="line">nacos/nacos-server:1.3.1</span><br><span class="line"> </span><br><span class="line">docker run -d \</span><br><span class="line">-e MODE=cluster \</span><br><span class="line">-e NACOS_APPLICATION_PORT=8851 \</span><br><span class="line">-e NACOS_SERVERS=192.168.117.155:8849,192.168.117.155:8850,192.168.117.155:8851 \</span><br><span class="line">-e SPRING_DATASOURCE_PLATFORM=mysql \</span><br><span class="line">-e MYSQL_SERVICE_HOST=192.168.117.155 \</span><br><span class="line">-e MYSQL_SERVICE_PORT=3306 \</span><br><span class="line">-e MYSQL_SERVICE_USER=root \</span><br><span class="line">-e MYSQL_SERVICE_PASSWORD=KAG1823 \</span><br><span class="line">-e MYSQL_SERVICE_DB_NAME=nacos_config \</span><br><span class="line">-e NACOS_SERVER_IP=192.168.100.132 \</span><br><span class="line">-p 8851:8851 \</span><br><span class="line">--name nacos8851 \</span><br><span class="line">nacos/nacos-server:1.3.1</span><br></pre></td></tr></table></figure>





<h3 id="ğŸ›¡ï¸-Sentinel"><a href="#ğŸ›¡ï¸-Sentinel" class="headerlink" title="ğŸ›¡ï¸ Sentinel"></a>ğŸ›¡ï¸ Sentinel</h3><blockquote>
<p>æ–‡æ¡£</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/wiki/%E4%BB%8B%E7%BB%8D">https://github.com/alibaba/Sentinel/wiki/%E4%BB%8B%E7%BB%8D</a></p>
<blockquote>
<p>æ¦‚è¿°</p>
</blockquote>
<p>éšç€å¾®æœåŠ¡çš„æµè¡Œï¼ŒæœåŠ¡å’ŒæœåŠ¡ä¹‹é—´çš„ç¨³å®šæ€§å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚Sentinel ä»¥æµé‡ä¸ºåˆ‡å…¥ç‚¹ï¼Œä»æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ç­‰å¤šä¸ªç»´åº¦ä¿æŠ¤æœåŠ¡çš„ç¨³å®šæ€§ã€‚</p>
<p>Sentinel å…·æœ‰ä»¥ä¸‹ç‰¹å¾:</p>
<ul>
<li><strong>ä¸°å¯Œçš„åº”ç”¨åœºæ™¯</strong>ï¼šSentinel æ‰¿æ¥äº†é˜¿é‡Œå·´å·´è¿‘ 10 å¹´çš„åŒåä¸€å¤§ä¿ƒæµé‡çš„æ ¸å¿ƒåœºæ™¯ï¼Œä¾‹å¦‚ç§’æ€ï¼ˆå³çªå‘æµé‡æ§åˆ¶åœ¨ç³»ç»Ÿå®¹é‡å¯ä»¥æ‰¿å—çš„èŒƒå›´ï¼‰ã€æ¶ˆæ¯å‰Šå³°å¡«è°·ã€é›†ç¾¤æµé‡æ§åˆ¶ã€å®æ—¶ç†”æ–­ä¸‹æ¸¸ä¸å¯ç”¨åº”ç”¨ç­‰ã€‚</li>
<li><strong>å®Œå¤‡çš„å®æ—¶ç›‘æ§</strong>ï¼šSentinel åŒæ—¶æä¾›å®æ—¶çš„ç›‘æ§åŠŸèƒ½ã€‚æ‚¨å¯ä»¥åœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°æ¥å…¥åº”ç”¨çš„å•å°æœºå™¨ç§’çº§æ•°æ®ï¼Œç”šè‡³ 500 å°ä»¥ä¸‹è§„æ¨¡çš„é›†ç¾¤çš„æ±‡æ€»è¿è¡Œæƒ…å†µã€‚</li>
<li><strong>å¹¿æ³›çš„å¼€æºç”Ÿæ€</strong>ï¼šSentinel æä¾›å¼€ç®±å³ç”¨çš„ä¸å…¶å®ƒå¼€æºæ¡†æ¶/åº“çš„æ•´åˆæ¨¡å—ï¼Œä¾‹å¦‚ä¸ Spring Cloudã€Dubboã€gRPC çš„æ•´åˆã€‚æ‚¨åªéœ€è¦å¼•å…¥ç›¸åº”çš„ä¾èµ–å¹¶è¿›è¡Œç®€å•çš„é…ç½®å³å¯å¿«é€Ÿåœ°æ¥å…¥ Sentinelã€‚</li>
<li><strong>å®Œå–„çš„ SPI æ‰©å±•ç‚¹</strong>ï¼šSentinel æä¾›ç®€å•æ˜“ç”¨ã€å®Œå–„çš„ SPI æ‰©å±•æ¥å£ã€‚æ‚¨å¯ä»¥é€šè¿‡å®ç°æ‰©å±•æ¥å£æ¥å¿«é€Ÿåœ°å®šåˆ¶é€»è¾‘ã€‚ä¾‹å¦‚å®šåˆ¶è§„åˆ™ç®¡ç†ã€é€‚é…åŠ¨æ€æ•°æ®æºç­‰ã€‚</li>
</ul>
<blockquote>
<p>Dockerè¿è¡ŒSentinel</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull bladex/sentinel-dashboard</span><br><span class="line">docker run --name sentinel -d -p 8858:8858 -d bladex/sentinel-dashboard</span><br></pre></td></tr></table></figure>



<blockquote>
<p>æµæ§è§„åˆ™</p>
</blockquote>
<p>1ï¸âƒ£è§£é‡Šè¯´æ˜</p>
<ul>
<li>èµ„æºåï¼šå”¯ä¸€è·¯å¾„ï¼Œé»˜è®¤è¯·æ±‚è·¯å¾„</li>
<li>é’ˆå¯¹æ¥æºï¼šSentinelå¯ä»¥é’ˆå¯¹è°ƒç”¨è€…è¿›è¡Œé™æµï¼Œå¡«å†™å¾®æœåŠ¡åï¼Œé»˜è®¤default</li>
<li>é˜ˆå€¼ç±»å‹/å•æœºé˜ˆå€¼ï¼š<ul>
<li>QPSï¼ˆæ¯ç§’é’Ÿçš„è¯·æ±‚æ•°é‡ï¼‰ï¼šå½“ä¹”å‹‡è¯¥APIçš„QPSè¾¾åˆ°é˜ˆå€¼çš„æ—¶å€™ï¼Œè¿›è¡Œé™æµ</li>
<li>çº¿ç¨‹æ•°ï¼šå½“è°ƒç”¨è¯¥APIçš„çº¿ç¨‹æ•°è¾¾åˆ°é˜ˆå€¼çš„æ—¶å€™ï¼Œè¿›è¡Œé™æµ</li>
</ul>
</li>
</ul>
<p>2ï¸âƒ£æµæ§æ¨¡å¼</p>
<ul>
<li>ç›´æ¥ï¼šAPIè¾¾åˆ°çº¿è·¯æ¡ä»¶æ—¶ï¼Œç›´æ¥é™æµ</li>
<li>å…³è”ï¼šå½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±</li>
<li>é“¾è·¯ï¼šåªè®°å½•æŒ‡å®šé“¾è·¯ä¸Šçš„æµé‡ï¼ˆæŒ‡å®šèµ„æºä»å…¥å£èµ„æºè¿›æ¥çš„æµé‡ï¼Œå¦‚æœè¾¾åˆ°é˜ˆå€¼ï¼Œå°±è¿›è¡Œé™æµï¼‰</li>
</ul>
<p>3ï¸âƒ£æµæ§æ•ˆæœ</p>
<ul>
<li><p>å¿«é€Ÿå¤±è´¥ï¼šé»˜è®¤çš„æµé‡æ§åˆ¶æ–¹å¼ï¼Œå½“QPSè¶…è¿‡ä»»æ„è§„åˆ™çš„é˜ˆå€¼åï¼Œæ–°çš„è¯·æ±‚å°±ä¼šè¢«ç«‹å³æ‹’ç»ï¼Œæ‹’ç»æ–¹å¼ä¸ºæŠ›å‡º<code>FlowException</code>ã€‚ [Blocked by Sentinel (flow limiting)]</p>
</li>
<li><p>Warm Up(é¢„çƒ­/å†·å¯åŠ¨)ï¼šå½“ç³»ç»Ÿé•¿æœŸå¤„äºä½æ°´ä½çš„æƒ…å†µä¸‹ï¼Œå½“æµé‡çªç„¶å¢åŠ æ—¶ï¼Œç›´æ¥æŠŠç³»ç»Ÿæ‹‰å‡åˆ°é«˜æ°´ä½å¯èƒ½ç¬é—´æŠŠç³»ç»Ÿå‹å®ã€‚é€šè¿‡â€å†·å¯åŠ¨â€ï¼Œè®©é€šè¿‡çš„æµé‡ç¼“æ…¢å¢åŠ ï¼Œåœ¨ä¸€å®šæ—¶é—´å†…é€æ¸å¢åŠ åˆ°é˜ˆå€¼ä¸Šé™ï¼Œç»™å†·ç³»ç»Ÿä¸€ä¸ªé¢„çƒ­çš„æ—¶é—´ï¼Œé¿å…å†·ç³»ç»Ÿè¢«å‹å®ã€‚</p>
<p>[æ ¹æ®codeFactorï¼ˆå†·åŠ è½½å› å­ï¼Œé»˜è®¤3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿ï¼Œæ‰è¾¾åˆ°è®¾ç½®çš„QPSé˜ˆå€¼]</p>
</li>
<li><p>æ’é˜Ÿç­‰å¾…ï¼šåŒ€é€Ÿæ’é˜Ÿæ–¹å¼ä¼šä¸¥æ ¼æ§åˆ¶è¯·æ±‚é€šè¿‡çš„é—´éš”æ—¶é—´ï¼Œä¹Ÿå³æ˜¯è®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œå¯¹åº”çš„æ˜¯æ¼æ¡¶ç®—æ³•ã€‚[è®¾ç½®QPSæ§åˆ¶é—´éš”æ—¶é—´ï¼Œé—´éš”æ—¶é—´=1000ms/QPSï¼Œä¾‹å¦‚QPS=2æ—¶æ¯éš”500msæ‰å…è®¸ä¸‹ä¸€ä¸ªè¯·æ±‚]</p>
</li>
</ul>
<blockquote>
<p>é™çº§è§„åˆ™</p>
</blockquote>
<p>1ï¸âƒ£è§£é‡Šè¯´æ˜</p>
<p>Sentinelç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç°ä¸ç¨³å®šçŠ¶æ€æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…æ—¶æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ï¼Œå¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œé™åˆ¶ï¼Œè®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“åˆ°å…¶ä»–çš„èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ã€‚</p>
<p>å½“èµ„æºé™çº§åï¼Œåœ¨æ¥ä¸‹æ¥çš„é™çº§æ—¶é—´çª—å£å†…ï¼Œå¯¹è¯¥èµ„æºçš„è°ƒç”¨éƒ½è‡ªåŠ¨ç†”æ–­ï¼ˆé»˜è®¤è¡Œä¸ºæ˜¯æŠ›å‡º<code>DegradeException</code>ï¼‰ã€‚</p>
<p>2ï¸âƒ£ç†”æ–­ç­–ç•¥</p>
<p>Sentinel æä¾›ä»¥ä¸‹å‡ ç§ç†”æ–­ç­–ç•¥ï¼š</p>
<ul>
<li>æ…¢è°ƒç”¨æ¯”ä¾‹ (<code>SLOW_REQUEST_RATIO</code>)ï¼šé€‰æ‹©ä»¥æ…¢è°ƒç”¨æ¯”ä¾‹ä½œä¸ºé˜ˆå€¼ï¼Œéœ€è¦è®¾ç½®å…è®¸çš„æ…¢è°ƒç”¨ RTï¼ˆå³æœ€å¤§çš„å“åº”æ—¶é—´ï¼‰ï¼Œè¯·æ±‚çš„å“åº”æ—¶é—´å¤§äºè¯¥å€¼åˆ™ç»Ÿè®¡ä¸ºæ…¢è°ƒç”¨ã€‚å½“å•ä½ç»Ÿè®¡æ—¶é•¿ï¼ˆ<code>statIntervalMs</code>ï¼‰å†…è¯·æ±‚æ•°ç›®å¤§äºè®¾ç½®çš„æœ€å°è¯·æ±‚æ•°ç›®ï¼Œå¹¶ä¸”æ…¢è°ƒç”¨çš„æ¯”ä¾‹å¤§äºé˜ˆå€¼ï¼Œåˆ™æ¥ä¸‹æ¥çš„ç†”æ–­æ—¶é•¿å†…è¯·æ±‚ä¼šè‡ªåŠ¨è¢«ç†”æ–­ã€‚ç»è¿‡ç†”æ–­æ—¶é•¿åç†”æ–­å™¨ä¼šè¿›å…¥æ¢æµ‹æ¢å¤çŠ¶æ€ï¼ˆHALF-OPEN çŠ¶æ€ï¼‰ï¼Œè‹¥æ¥ä¸‹æ¥çš„ä¸€ä¸ªè¯·æ±‚å“åº”æ—¶é—´å°äºè®¾ç½®çš„æ…¢è°ƒç”¨ RT åˆ™ç»“æŸç†”æ–­ï¼Œè‹¥å¤§äºè®¾ç½®çš„æ…¢è°ƒç”¨ RT åˆ™ä¼šå†æ¬¡è¢«ç†”æ–­ã€‚</li>
<li>å¼‚å¸¸æ¯”ä¾‹ (<code>ERROR_RATIO</code>)ï¼šå½“å•ä½ç»Ÿè®¡æ—¶é•¿ï¼ˆ<code>statIntervalMs</code>ï¼‰å†…è¯·æ±‚æ•°ç›®å¤§äºè®¾ç½®çš„æœ€å°è¯·æ±‚æ•°ç›®ï¼Œå¹¶ä¸”å¼‚å¸¸çš„æ¯”ä¾‹å¤§äºé˜ˆå€¼ï¼Œåˆ™æ¥ä¸‹æ¥çš„ç†”æ–­æ—¶é•¿å†…è¯·æ±‚ä¼šè‡ªåŠ¨è¢«ç†”æ–­ã€‚ç»è¿‡ç†”æ–­æ—¶é•¿åç†”æ–­å™¨ä¼šè¿›å…¥æ¢æµ‹æ¢å¤çŠ¶æ€ï¼ˆHALF-OPEN çŠ¶æ€ï¼‰ï¼Œè‹¥æ¥ä¸‹æ¥çš„ä¸€ä¸ªè¯·æ±‚æˆåŠŸå®Œæˆï¼ˆæ²¡æœ‰é”™è¯¯ï¼‰åˆ™ç»“æŸç†”æ–­ï¼Œå¦åˆ™ä¼šå†æ¬¡è¢«ç†”æ–­ã€‚å¼‚å¸¸æ¯”ç‡çš„é˜ˆå€¼èŒƒå›´æ˜¯ <code>[0.0, 1.0]</code>ï¼Œä»£è¡¨ 0% - 100%ã€‚</li>
<li>å¼‚å¸¸æ•° (<code>ERROR_COUNT</code>)ï¼šå½“å•ä½ç»Ÿè®¡æ—¶é•¿å†…çš„å¼‚å¸¸æ•°ç›®è¶…è¿‡é˜ˆå€¼ä¹‹åä¼šè‡ªåŠ¨è¿›è¡Œç†”æ–­ã€‚ç»è¿‡ç†”æ–­æ—¶é•¿åç†”æ–­å™¨ä¼šè¿›å…¥æ¢æµ‹æ¢å¤çŠ¶æ€ï¼ˆHALF-OPEN çŠ¶æ€ï¼‰ï¼Œè‹¥æ¥ä¸‹æ¥çš„ä¸€ä¸ªè¯·æ±‚æˆåŠŸå®Œæˆï¼ˆæ²¡æœ‰é”™è¯¯ï¼‰åˆ™ç»“æŸç†”æ–­ï¼Œå¦åˆ™ä¼šå†æ¬¡è¢«ç†”æ–­ã€‚</li>
</ul>
<blockquote>
<p>çƒ­ç‚¹è§„åˆ™</p>
</blockquote>
<p>1ï¸âƒ£è§£é‡Šè¯´æ˜</p>
<p>ä½•ä¸ºçƒ­ç‚¹ï¼Ÿçƒ­ç‚¹å³ç»å¸¸è®¿é—®çš„æ•°æ®ã€‚å¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¸Œæœ›ç»Ÿè®¡æŸä¸ªçƒ­ç‚¹æ•°æ®ä¸­è®¿é—®é¢‘æ¬¡æœ€é«˜çš„ Top K æ•°æ®ï¼Œå¹¶å¯¹å…¶è®¿é—®è¿›è¡Œé™åˆ¶ã€‚æ¯”å¦‚ï¼š</p>
<ul>
<li>å•†å“ ID ä¸ºå‚æ•°ï¼Œç»Ÿè®¡ä¸€æ®µæ—¶é—´å†…æœ€å¸¸è´­ä¹°çš„å•†å“ ID å¹¶è¿›è¡Œé™åˆ¶</li>
<li>ç”¨æˆ· ID ä¸ºå‚æ•°ï¼Œé’ˆå¯¹ä¸€æ®µæ—¶é—´å†…é¢‘ç¹è®¿é—®çš„ç”¨æˆ· ID è¿›è¡Œé™åˆ¶</li>
</ul>
<p>çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµã€‚çƒ­ç‚¹å‚æ•°é™æµå¯ä»¥çœ‹åšæ˜¯ä¸€ç§ç‰¹æ®Šçš„æµé‡æ§åˆ¶ï¼Œä»…å¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨ç”Ÿæ•ˆã€‚</p>
<p>Sentinel åˆ©ç”¨ LRU ç­–ç•¥ç»Ÿè®¡æœ€è¿‘æœ€å¸¸è®¿é—®çš„çƒ­ç‚¹å‚æ•°ï¼Œç»“åˆä»¤ç‰Œæ¡¶ç®—æ³•æ¥è¿›è¡Œå‚æ•°çº§åˆ«çš„æµæ§ã€‚çƒ­ç‚¹å‚æ•°é™æµæ”¯æŒé›†ç¾¤æ¨¡å¼ã€‚</p>
<p>2ï¸âƒ£å‚æ•°è¯¦æƒ…</p>
<p>çƒ­ç‚¹å‚æ•°è§„åˆ™ï¼ˆ<code>ParamFlowRule</code>ï¼‰ç±»ä¼¼äºæµé‡æ§åˆ¶è§„åˆ™ï¼ˆ<code>FlowRule</code>ï¼‰ï¼š</p>
<table>
<thead>
<tr>
<th>å±æ€§</th>
<th>è¯´æ˜</th>
<th>é»˜è®¤å€¼</th>
</tr>
</thead>
<tbody><tr>
<td>resource</td>
<td>èµ„æºåï¼Œå¿…å¡«</td>
<td></td>
</tr>
<tr>
<td>count</td>
<td>é™æµé˜ˆå€¼ï¼Œå¿…å¡«</td>
<td></td>
</tr>
<tr>
<td>grade</td>
<td>é™æµæ¨¡å¼</td>
<td>QPS æ¨¡å¼</td>
</tr>
<tr>
<td>durationInSec</td>
<td>ç»Ÿè®¡çª—å£æ—¶é—´é•¿åº¦ï¼ˆå•ä½ä¸ºç§’ï¼‰ï¼Œ1.6.0 ç‰ˆæœ¬å¼€å§‹æ”¯æŒ</td>
<td>1s</td>
</tr>
<tr>
<td>controlBehavior</td>
<td>æµæ§æ•ˆæœï¼ˆæ”¯æŒå¿«é€Ÿå¤±è´¥å’ŒåŒ€é€Ÿæ’é˜Ÿæ¨¡å¼ï¼‰ï¼Œ1.6.0 ç‰ˆæœ¬å¼€å§‹æ”¯æŒ</td>
<td>å¿«é€Ÿå¤±è´¥</td>
</tr>
<tr>
<td>maxQueueingTimeMs</td>
<td>æœ€å¤§æ’é˜Ÿç­‰å¾…æ—¶é•¿ï¼ˆä»…åœ¨åŒ€é€Ÿæ’é˜Ÿæ¨¡å¼ç”Ÿæ•ˆï¼‰ï¼Œ1.6.0 ç‰ˆæœ¬å¼€å§‹æ”¯æŒ</td>
<td>0ms</td>
</tr>
<tr>
<td>paramIdx</td>
<td>çƒ­ç‚¹å‚æ•°çš„ç´¢å¼•ï¼Œå¿…å¡«ï¼Œå¯¹åº” <code>SphU.entry(xxx, args)</code> ä¸­çš„å‚æ•°ç´¢å¼•ä½ç½®</td>
<td></td>
</tr>
<tr>
<td>paramFlowItemList</td>
<td>å‚æ•°ä¾‹å¤–é¡¹ï¼Œå¯ä»¥é’ˆå¯¹æŒ‡å®šçš„å‚æ•°å€¼å•ç‹¬è®¾ç½®é™æµé˜ˆå€¼ï¼Œä¸å—å‰é¢ <code>count</code> é˜ˆå€¼çš„é™åˆ¶ã€‚<strong>ä»…æ”¯æŒåŸºæœ¬ç±»å‹å’Œå­—ç¬¦ä¸²ç±»å‹</strong></td>
<td></td>
</tr>
<tr>
<td>clusterMode</td>
<td>æ˜¯å¦æ˜¯é›†ç¾¤å‚æ•°æµæ§è§„åˆ™</td>
<td><code>false</code></td>
</tr>
<tr>
<td>clusterConfig</td>
<td>é›†ç¾¤æµæ§ç›¸å…³é…ç½®</td>
<td></td>
</tr>
</tbody></table>
<h3 id="ğŸŒŒ-Seata"><a href="#ğŸŒŒ-Seata" class="headerlink" title="ğŸŒŒ Seata"></a>ğŸŒŒ Seata</h3><blockquote>
<p>æ¦‚è¿°</p>
</blockquote>
<p>Seata æ˜¯ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œè‡´åŠ›äºæä¾›é«˜æ€§èƒ½å’Œç®€å•æ˜“ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡ã€‚Seata å°†ä¸ºç”¨æˆ·æä¾›äº† ATã€TCCã€SAGA å’Œ XA äº‹åŠ¡æ¨¡å¼ï¼Œä¸ºç”¨æˆ·æ‰“é€ ä¸€ç«™å¼çš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆã€‚</p>
<blockquote>
<p>Seata.zipä¸‹è½½</p>
</blockquote>
<p><strong>0.9.0</strong></p>
<ul>
<li>ç™¾åº¦ç½‘ç›˜ï¼š<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1SYGqlJEpashJlR-Nc8H8lg">https://pan.baidu.com/s/1SYGqlJEpashJlR-Nc8H8lg</a></li>
<li>æå–ç ï¼škkkk</li>
</ul>
<p><strong>1.4.0</strong></p>
<ul>
<li>ç™¾åº¦ç½‘ç›˜ï¼š<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1fpzo0zkfLFa8sJDs-TL9Ew">https://pan.baidu.com/s/1fpzo0zkfLFa8sJDs-TL9Ew</a></li>
<li>æå–ç ï¼škkkk</li>
</ul>
<blockquote>
<p>Dockerå®‰è£…Seata</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è·å–é•œåƒ</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker pull seataio/seata-server:1.4.0</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿è¡Œå®¹å™¨å¹¶è·å–é…ç½®</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker run --name seata-server -p 8091:8091 -d seataio/seata-server:1.4.0</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker cp seata-server:/seata-server /usr/<span class="built_in">local</span>/seata-1.4.0</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker stop seata-server &amp;&amp; docker rm seata-server</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¿®æ”¹é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> file.conf</span></span><br><span class="line">service &#123;</span><br><span class="line">  vgroupMapping.my_test_tx_group = &quot;default&quot;</span><br><span class="line">  disableGlobalTransaction = false</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">store &#123;</span><br><span class="line">  mode = &quot;db&quot;</span><br><span class="line">  db &#123;</span><br><span class="line">    datasource = &quot;druid&quot;</span><br><span class="line">    dbType = &quot;mysql&quot;</span><br><span class="line">    driverClassName = &quot;com.mysql.cj.jdbc.Driver&quot;</span><br><span class="line">    url = &quot;jdbc:mysql://172.17.0.5:3306/seata?serverTimezone=GMT%2B8&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&quot;</span><br><span class="line">    user = &quot;root&quot;</span><br><span class="line">    password = &quot;KAG1823&quot;</span><br><span class="line">    minConn = 5</span><br><span class="line">    maxConn = 30</span><br><span class="line">    globalTable = &quot;global_table&quot;</span><br><span class="line">    branchTable = &quot;branch_table&quot;</span><br><span class="line">    lockTable = &quot;lock_table&quot;</span><br><span class="line">    queryLimit = 100</span><br><span class="line">    maxWait = 5000</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> registry.conf</span></span><br><span class="line">registry &#123;</span><br><span class="line">  type = &quot;nacos&quot;</span><br><span class="line">  loadBalance = &quot;RandomLoadBalance&quot;</span><br><span class="line">  loadBalanceVirtualNodes = 10</span><br><span class="line"></span><br><span class="line">  nacos &#123;</span><br><span class="line">    application = &quot;seata-server&quot;</span><br><span class="line">    serverAddr = &quot;172.17.0.6:8848&quot;</span><br><span class="line">    group = &quot;SEATA_GROUP&quot;</span><br><span class="line">    namespace = &quot;&quot;</span><br><span class="line">    cluster = &quot;default&quot;</span><br><span class="line">    username = &quot;nacos&quot;</span><br><span class="line">    password = &quot;nacos&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">config &#123;</span><br><span class="line">  type = &quot;nacos&quot;</span><br><span class="line"></span><br><span class="line">  nacos &#123;</span><br><span class="line">    serverAddr = &quot;172.17.0.6:8848&quot;</span><br><span class="line">    namespace = &quot;&quot;</span><br><span class="line">    group = &quot;SEATA_GROUP&quot;</span><br><span class="line">    username = &quot;nacos&quot;</span><br><span class="line">    password = &quot;nacos&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨Seata</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker run -d \</span></span><br><span class="line">--restart always \</span><br><span class="line">--name seata-server \</span><br><span class="line">-p 8091:8091 \</span><br><span class="line">-v /usr/local/seata-1.4.0:/seata-server \</span><br><span class="line">-e SEATA_PORT=8091 \</span><br><span class="line">seataio/seata-server:1.4.0</span><br></pre></td></tr></table></figure>



 
      <!-- reward -->
      
      <div id="reword-out">
        <div id="reward-btn">
          æ‰“èµ
        </div>
      </div>
      
    </div>
    

    <!-- copyright -->
    
    <div class="declare">
      <ul class="post-copyright">
        <li>
          <i class="ri-copyright-line"></i>
          <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>
          
          æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œè‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
          
        </li>
      </ul>
    </div>
    
    <footer class="article-footer">
       
<div class="share-btn">
      <span class="share-sns share-outer">
        <i class="ri-share-forward-line"></i>
        åˆ†äº«
      </span>
      <div class="share-wrap">
        <i class="arrow"></i>
        <div class="share-icons">
          
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="ri-weibo-fill"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="ri-wechat-fill"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="ri-qq-fill"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="ri-douban-line"></i>
          </a>
          <!-- <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a> -->
          
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="ri-facebook-circle-fill"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="ri-twitter-fill"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="ri-google-fill"></i>
          </a>
        </div>
      </div>
</div>

<div class="wx-share-modal">
    <a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <div class="wx-qrcode">
      <img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=http://example.com/2021/01/25/SpringCloud/" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
    </div>
</div>

<div id="share-mask"></div>  
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring/" rel="tag">Spring</a></li></ul>

    </footer>
  </div>

   
  <nav class="article-nav">
    
    
      <a href="/2020/12/02/Docker/" class="article-nav-link">
        <strong class="article-nav-caption">ä¸‹ä¸€ç¯‡</strong>
        <div class="article-nav-title">Docker</div>
      </a>
    
  </nav>

  
     
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2020-2021
        <i class="ri-heart-fill heart_icon"></i> Khighness
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>è®¿é—®äººæ•°:<span id="busuanzi_value_site_uv"></span></s>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>æµè§ˆæ¬¡æ•°:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzzç»Ÿè®¡ -->
        
        <script type="text/javascript" src='https://s4.cnzz.com/z_stat.php?id=1279324689&amp;web_id=1279324689'></script>
        
      </li>
    </ul>
  </div>
</footer>
      <div class="float_btns">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

      </div>
    </main>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/Khighness.jpg" alt="Khighness"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">ä¸»é¡µ</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">å½’æ¡£</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">åˆ†ç±»</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">æ ‡ç­¾</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">å…³äº</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" target="_blank" rel="noopener" href="http://www.parak.top/contact/">è”ç³»</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" target="_blank" rel="noopener" href="http://findingho.me/">FIND</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="æœç´¢">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <script>
      if (window.matchMedia("(max-width: 768px)").matches) {
        document.querySelector('.content').classList.remove('on');
        document.querySelector('.sidebar').classList.remove('on');
      }
    </script>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>æ¥æ¯æŠ¹èŒ¶ï¼Ÿ</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">æ”¯ä»˜å®</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wepay.jpg">
      <span class="reward-type">å¾®ä¿¡</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->


<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: '.tocbot',
    contentSelector: '.article-entry',
    headingSelector: 'h1, h2, h3, h4, h5, h6',
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: 'main',
    positionFixedSelector: '.tocbot',
    positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto'
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // sliderå±•å¼€çŠ¶æ€
                // todo: è¿™æ ·ä¸å¥½ï¼Œåé¢æ”¹æˆçŠ¶æ€
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // è·å¾—åŸå›¾å°ºå¯¸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>

<!-- MathJax -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
  });

  MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for(i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
      }
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.6/unpacked/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
  var ayerConfig = {
    mathjax: true
  }
</script>

<!-- Katex -->


    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css">
        <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"></script>
        
    


<!-- busuanzi  -->


<script src="/js/busuanzi-2.3.pure.min.js"></script>


<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->


<link rel="stylesheet" href="/css/clipboard.css">

<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // ç­‰å¾…ä¸¤ç§’é’Ÿåæ¢å¤
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // ç­‰å¾…ä¸¤ç§’é’Ÿåæ¢å¤
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>


<!-- CanvasBackground -->


<script src="/js/dz.js"></script>



    
  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/ni-j.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7}});</script></body>

</html>