<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>åšå¼ˆè®º</title>
    <url>/2020/10/03/Game/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="åšå¼ˆè®º"><a href="#åšå¼ˆè®º" class="headerlink" title="åšå¼ˆè®º"></a>åšå¼ˆè®º</h1><center>
    <font face="Kristen ITC" color="#555555" font-size=100px>Khighnessã€å¯»æ‰¾å¿…è´¥æ€</font><br>
</center>





<h2 id="1-å·´ä»€åšå¼ˆ"><a href="#1-å·´ä»€åšå¼ˆ" class="headerlink" title="1. å·´ä»€åšå¼ˆ"></a>1. å·´ä»€åšå¼ˆ</h2><h3 id="1-1-é—®é¢˜"><a href="#1-1-é—®é¢˜" class="headerlink" title="1.1 é—®é¢˜"></a>1.1 é—®é¢˜</h3><blockquote>
<p>ä¸¤ä¸ªé¡¶å°–èªæ˜çš„äººåœ¨ç©æ¸¸æˆï¼Œæœ‰ n ä¸ªçŸ³å­ï¼Œæ¯ä¸ªäººæ¯æ¬¡æ‹¿ 1~m ä¸ªçŸ³å¤´ï¼Œæ‹¿æ‰æœ€åä¸€å—çŸ³å¤´çš„äººå°±æ˜¯è·èƒœè€…ã€‚è¯·é—®å…ˆæ‰‹ä¸åæ‰‹è°å¿…èƒœï¼Ÿ</p>
</blockquote>
<h3 id="1-2-åˆ†æ"><a href="#1-2-åˆ†æ" class="headerlink" title="1.2 åˆ†æ"></a>1.2 åˆ†æ</h3><blockquote>
<p>åˆ†ç±»è®¨è®º: </p>
<p>ï¼ˆ1ï¼‰å½“n â‰¤ mæ—¶ï¼Œè¿™æ—¶å…ˆæ‰‹çš„äººå¯ä»¥ä¸€æ¬¡å–èµ°æ‰€æœ‰çš„ï¼›</p>
<p>ï¼ˆ2ï¼‰å½“n = m+1æ—¶ï¼Œè¿™æ—¶å…ˆæ‰‹æ— è®ºå–èµ°å¤šå°‘ä¸ªï¼Œåæ‰‹çš„äººéƒ½èƒ½å–èµ°å‰©ä¸‹æ‰€æœ‰çš„ï¼›</p>
<p>ï¼ˆ3ï¼‰å½“n = k âˆ— ( m + 1)æ—¶ï¼Œå¯¹äºæ¯(m + 1)ä¸ªçŸ³å­ï¼Œå…ˆæ‰‹å–iä¸ªï¼Œåæ‰‹ä¸€å®šèƒ½å°†å‰©ä¸‹çš„(m + 1 âˆ’ i)ä¸ªéƒ½å–èµ°ï¼Œå› æ­¤åæ‰‹å¿…èƒœï¼›</p>
<p>ï¼ˆ4ï¼‰å½“n = k âˆ— ( m + 1)  + x ( 0&lt; x&lt; m + 1)æ—¶ï¼Œå…ˆæ‰‹å¯ä»¥å…ˆå– x ä¸ªï¼Œä¹‹åçš„å±€åŠ¿å°±å›åˆ°äº†ä¸Šä¸€ç§æƒ…å†µï¼Œæ— è®ºåæ‰‹å–å¤šå°‘ä¸ªï¼Œå…ˆæ‰‹éƒ½èƒ½å–èµ°m+1ä¸ªä¸­å‰©ä¸‹çš„ï¼Œå› æ­¤å…ˆæ‰‹å¿…èƒœã€‚</p>
</blockquote>
<h3 id="1-3-ç»“è®º"><a href="#1-3-ç»“è®º" class="headerlink" title="1.3 ç»“è®º"></a>1.3 ç»“è®º</h3><blockquote>
<p><strong>å½“n % m + 1) == 0æ—¶ï¼Œåæ‰‹å¿…èƒœï¼Œå¦åˆ™å…ˆæ‰‹å¿…èƒœã€‚</strong></p>
</blockquote>
<h3 id="1-4-ä»£ç "><a href="#1-4-ä»£ç " class="headerlink" title="1.4 ä»£ç "></a>1.4 ä»£ç </h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BashGame</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ((n % (m + <span class="number">1</span>)) == <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;åæ‰‹è·èƒœ&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å…ˆæ‰‹è·èƒœ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="2-å°¼å§†åšå¼ˆ"><a href="#2-å°¼å§†åšå¼ˆ" class="headerlink" title="2. å°¼å§†åšå¼ˆ"></a>2. å°¼å§†åšå¼ˆ</h2><h3 id="2-1-é—®é¢˜"><a href="#2-1-é—®é¢˜" class="headerlink" title="2.1 é—®é¢˜"></a>2.1 é—®é¢˜</h3><blockquote>
<p>ä¸¤ä¸ªé¡¶å°–èªæ˜çš„äººåœ¨ç©æ¸¸æˆï¼Œæœ‰ n å †çŸ³å­ï¼Œç¬¬ i å †æœ‰ ai æ¯ä¸ªäººæ¯æ¬¡èƒ½ä»ä¸€å †çŸ³å­ä¸­å–ä»»æ„å¤šä¸ªçŸ³å­ä½†ä¸èƒ½ä¸å–ï¼Œä¸èƒ½å–çš„äººè¾“ã€‚è¯·é—®å…ˆæ‰‹ä¸åæ‰‹è°å¿…èƒœï¼Ÿ</p>
</blockquote>
<h3 id="2-2-åˆ†æ"><a href="#2-2-åˆ†æ" class="headerlink" title="2.2 åˆ†æ"></a>2.2 åˆ†æ</h3><blockquote>
<p>ï¼ˆ1ï¼‰å½“n = 1æ—¶ï¼Œæ˜¾ç„¶å…ˆæ‰‹å–èµ°è¿™ä¸€å †å°±èƒ½è·èƒœï¼›</p>
<p>ï¼ˆ2ï¼‰å½“n = 2ä¸”a1 != a2æ—¶ï¼Œæˆ‘ä»¬å‡è®¾a1 &gt; a2ï¼Œå…ˆæ‰‹å¯ä»¥å…ˆåœ¨ç¬¬ä¸€å †å–èµ°a1-a2ä¸ªï¼Œä¸‹ä¸€æ¬¡æ— è®ºåæ‰‹å–èµ°å¤šå°‘ä¸ªï¼Œå…ˆæ‰‹éƒ½å¯ä»¥åœ¨å¦ä¸€å †å–èµ°ç›¸åŒçš„ä¸ªæ•°ï¼Œå› æ­¤å…ˆæ‰‹å¿…èƒœï¼›</p>
<p>ï¼ˆ3ï¼‰å½“n = 2ä¸”a1 == a2æ—¶ï¼Œå…ˆæ‰‹æ— è®ºå–å¤šå°‘ä¸ªï¼Œåæ‰‹éƒ½å¯ä»¥åœ¨å¦ä¸€å †å–ç›¸åŒçš„ä¸ªæ•°ï¼Œå› æ­¤åæ‰‹å¿…èƒœï¼›</p>
<p>ï¼ˆ4ï¼‰å½“n &gt;= 3æ—¶ï¼Œé—®é¢˜å˜å¾—ç¹çèµ·æ¥ï¼Œå…ˆæ‰¾å‡ºè§„å¾‹æ€§çš„ç»“è®ºã€‚</p>
</blockquote>
<h3 id="2-3-ç»“è®º"><a href="#2-3-ç»“è®º" class="headerlink" title="2.3 ç»“è®º"></a>2.3 ç»“è®º</h3><blockquote>
<p><strong>å½“ a1 ^ a2 ^ Â·Â·Â· ^ an =  0 æ—¶ï¼Œåæ‰‹å¿…èƒœï¼Œå¦åˆ™å…ˆæ‰‹å¿…èƒœã€‚</strong></p>
<p><strong>è¯æ˜ï¼š</strong></p>
<p>å‡è®¾å½“å‰ï¼ša1 ^ a2 ^ Â·Â·Â· ^ an =  0ï¼Œ</p>
<p>å…ˆæ‰‹å›åˆï¼šå–èµ°è‹¥å¹²ä¸ªåï¼Œ</p>
<p>å±€åŠ¿å˜æˆï¼ša1 ^ a2 ^ Â·Â·Â· ^ an =  Kï¼Œ</p>
<p>å³ï¼ša1 ^ a2 ^ Â·Â·Â· ^ an ^ K = 0ã€‚</p>
<p>å‡è®¾ K çš„æœ€é«˜ä½1åœ¨ç¬¬ x ä½ï¼Œ</p>
<p>é‚£ä¹ˆå¿…ç„¶å­˜åœ¨ aj (1 &lt; = j &lt;= n) çš„ ç¬¬ x ä½ä¸º1ï¼Œ</p>
<p>åæ‰‹å›åˆï¼šåªè¦æŠŠ aj å˜æˆ aj ^ Kï¼Œ</p>
<p>å°±èƒ½ä½¿å¾—ï¼ša1 ^ a2 ^ Â·Â·Â· ^ an =  0ã€‚</p>
<p>ç”±äº aj ^ K ä½¿å¾—ç¬¬ x ä½ ä¸º0ï¼Œæ— è®ºä½ä½æ˜¯ä»€ä¹ˆï¼Œ</p>
<p>ç¬¬ x ä½å˜ä¸º0åï¼Œaj æ•´ä¸ªæ•°ä¸€å®šä¼šå˜å°ï¼Œå³ï¼šaj ^ K &lt; ajï¼Œ</p>
<p>æ‰€ä»¥åæ‰‹åªéœ€åœ¨ç¬¬ j å †å–èµ°(aj - aj ^ K)ä¸ªçŸ³å­å³å¯ã€‚</p>
<p>å…ˆæ‰‹æ¯æ¬¡å–å®Œï¼Œåæ‰‹æ¯æ¬¡å–(aj - aj ^ K)ï¼Œ</p>
<p>æœ€åçš„å±€åŠ¿ä¸€å®šæ˜¯ï¼ša1 = a2 = Â·Â·Â· = an = 0ï¼Œ</p>
<p>æ­¤æ—¶å…ˆæ‰‹æ— æ³•å–äº†ï¼Œåæ‰‹å¿…èƒœã€‚</p>
<p>åä¹‹ï¼Œå½“a1 ^ a2 ^ Â·Â·Â· ^ an = K æ—¶ï¼Œ</p>
<p>å±€åŠ¿åè½¬ï¼Œå…ˆæ‰‹æ¯æ¬¡å–(aj - aj ^ K)ä¸ªå³å¯ï¼Œå…ˆæ‰‹å¿…èƒœã€‚</p>
</blockquote>
<h3 id="2-4-ä»£ç "><a href="#2-4-ä»£ç " class="headerlink" title="2.4 ä»£ç "></a>2.4 ä»£ç </h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NimGame</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">(<span class="keyword">int</span>[] a)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i : a) &#123;</span><br><span class="line">            res ^= i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (res == <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;åæ‰‹è·èƒœ&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å…ˆæ‰‹è·èƒœ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="3-å°¼å§†Plusåšå¼ˆ"><a href="#3-å°¼å§†Plusåšå¼ˆ" class="headerlink" title="3. å°¼å§†Plusåšå¼ˆ"></a>3. å°¼å§†Plusåšå¼ˆ</h2><h3 id="3-1-é—®é¢˜"><a href="#3-1-é—®é¢˜" class="headerlink" title="3.1 é—®é¢˜"></a>3.1 é—®é¢˜</h3><blockquote>
<p>ä¸¤ä¸ªé¡¶å°–èªæ˜çš„äººåœ¨ç©æ¸¸æˆï¼Œæœ‰ n å †çŸ³å­ï¼Œç¬¬ i å †æœ‰ ai ä¸ªçŸ³å­ï¼Œæ¯ä¸ªäººæ¯æ¬¡èƒ½ä» 1~d å †çŸ³å­ä¸­å–ä»»æ„å¤šä¸ªçŸ³å­ä½†ä¸èƒ½ä¸å–ï¼Œä¸èƒ½å–çš„äººè¾“ã€‚è¯·é—®å…ˆæ‰‹ä¸åæ‰‹è°å¿…èƒœï¼Ÿ</p>
</blockquote>
<h3 id="3-2-åˆ†æ"><a href="#3-2-åˆ†æ" class="headerlink" title="3.2 åˆ†æ"></a>3.2 åˆ†æ</h3><blockquote>
<p>ç‰¹ä¹ˆå¤ªéš¾äº†å•Šï¼Œå‘œå‘œå‘œæˆ‘å¥½èœ</p>
</blockquote>
<h3 id="3-3-ç»“è®º"><a href="#3-3-ç»“è®º" class="headerlink" title="3.3 ç»“è®º"></a>3.3 ç»“è®º</h3><blockquote>
<p><strong>å°†æ¯å †çŸ³å­æ•°é‡ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œå¯¹äºäºŒè¿›åˆ¶çš„ä»»æ„ä¸€ä½ï¼Œå¦‚æœè¿™ä¸€ä½ä¸º1çš„çŸ³å­å †æ•°é‡%(d+1)==0ï¼Œé‚£ä¹ˆåæ‰‹å¿…èƒœï¼Œå¦åˆ™å…ˆæ‰‹å¿…èƒœã€‚</strong></p>
</blockquote>
<h3 id="3-4-è¯æ˜"><a href="#3-4-è¯æ˜" class="headerlink" title="3.4 è¯æ˜"></a>3.4 è¯æ˜</h3><blockquote>
<p>åªéœ€è¦è¯æ˜ä¸‰ç‚¹ï¼š</p>
<ol>
<li><p>ç»ˆæ­¢å±€é¢ä¸ºå…ˆæ‰‹å¿…è´¥ï¼ˆæ˜¾ç„¶ï¼‰</p>
</li>
<li><p>ä»»æ„å…ˆæ‰‹å¿…èƒœçš„å±€é¢éƒ½èƒ½è½¬å˜æˆå…ˆæ‰‹å¿…è´¥çš„å±€é¢</p>
</li>
<li><p>ä»»æ„å…ˆæ‰‹å¿…è´¥çš„å±€é¢éƒ½ä¸èƒ½è½¬å˜æˆå…ˆæ‰‹å¿…èƒœçš„å±€é¢</p>
</li>
</ol>
<p><strong>è¯æ˜</strong></p>
<p>è¯æ˜2:</p>
<p>å‡è®¾æœ€é«˜ä½%(d+1) != 0æœ‰må †ï¼Œé‚£ä¹ˆå°†è¿™äº›å †çš„è¿™ä¸€ä½å˜æˆ0ï¼›</p>
<p>å‡è®¾ä¸‹ä¸€ä½%(d+1) != 0çš„ä½æœ‰nä¸ªï¼Œä¹‹å‰må †ä¸­è¿™ä¸€ä½æœ‰aä¸ª1å’Œbä¸ª0ã€‚</p>
<p>ï¼ˆ1ï¼‰å¦‚æœn &lt;= aï¼Œæ˜¾ç„¶å°†è¿™aä¸­çš„nä¸ªå˜æˆ0å³å¯ï¼›</p>
<p>ï¼ˆ2ï¼‰å¦‚æœ(d+1) - n &lt;= bï¼Œé‚£ä¹ˆåªè¦å°†bä¸ªä¸­çš„(d+1) - nä¸ªå˜æˆ1å³å¯ï¼›</p>
<p>å› ä¸ºä¹‹å‰æœ€é«˜ä½æ˜¯å°†1å˜æˆ0ï¼Œæ‰€ä»¥è¿™ä¸€ä½å³ä½¿ç”±0å˜1ï¼Œè¿™å †çŸ³å­ä¹Ÿæ˜¯å‡å°‘çš„ï¼›</p>
<p>ï¼ˆ3ï¼‰å¦‚æœä¸¤ä¸ªéƒ½ä¸æ»¡è¶³ï¼Œå³a &gt; n &amp;&amp; b &lt; (d + 1 - n)ï¼Œé‚£ä¹ˆåªè¦å°†è¿™aå †å’Œmå †ä¹‹å¤–çš„(n - a)å †çš„è¿™ä¸€ä½å˜æˆ0ï¼Œ</p>
<p>é‚£ä¹ˆæ€»æ”¹å˜å †æ•°ä¸º a + b + (n - a) = b + n &lt; (d + 1) - n + n = d + 1ï¼Œ</p>
<p>å³å°†è¿™ä¸€ä½å˜æˆ%(d+1) = 0éœ€è¦æ”¹å˜çš„æ€»å †æ•°è¦å°äº(d+1)ï¼Œ</p>
<p>å³å¯ä»¥ä¸€æ¬¡æ“ä½œå®Œæˆï¼Œç„¶åä»¥æ­¤ç±»æ¨å°±èƒ½ä½¿æ¯ä¸€ä½éƒ½å˜ä¸º%(d+1)=0ã€‚</p>
<p>è¯æ˜3:</p>
<p>å› ä¸ºä¸€æ¬¡æœ€å¤šæ“ä½œdå †çŸ³å­ï¼Œå› æ­¤ä¸èƒ½å°†(d+1)å †æŸä¸€ä½æ˜¯1çš„çŸ³å­å †çš„è¿™ä¸€ä½éƒ½å˜ä¸º0ã€‚</p>
</blockquote>
<h2 id="4-å¨ä½å¤«åšå¼ˆ"><a href="#4-å¨ä½å¤«åšå¼ˆ" class="headerlink" title="4. å¨ä½å¤«åšå¼ˆ"></a>4. å¨ä½å¤«åšå¼ˆ</h2><h3 id="4-1-é—®é¢˜"><a href="#4-1-é—®é¢˜" class="headerlink" title="4.1 é—®é¢˜"></a>4.1 é—®é¢˜</h3><blockquote>
<p>ä¸¤ä¸ªé¡¶å°–èªæ˜çš„äººåœ¨ç©æ¸¸æˆï¼Œæœ‰ 2 å †çŸ³å­ï¼Œæ¯ä¸ªäººæ¯æ¬¡å¯ä»¥ä»ä»»æ„ä¸€å †çŸ³å­ä¸­å–ä»»æ„å¤šçš„çŸ³å­æˆ–è€…ä»ä¸¤å †çŸ³å­ä¸­å–åŒæ ·å¤šçš„çŸ³å­ï¼Œä¸èƒ½å–çš„äººè¾“ã€‚è¯·é—®å…ˆæ‰‹ä¸åæ‰‹è°å¿…èƒœï¼Ÿ</p>
</blockquote>
<h3 id="4-1-åˆ†æ"><a href="#4-1-åˆ†æ" class="headerlink" title="4.1 åˆ†æ"></a>4.1 åˆ†æ</h3><blockquote>
<p>å¨ä½å¤«åšå¼ˆä¸åŒäºå·´ä»€åšå¼ˆå’Œå°¼å§†åšå¼ˆï¼Œå®ƒçš„ç‰¹æ®Šä¹‹å¤„åœ¨äºä¸èƒ½å°†ä¸¤å †çŸ³å­åˆ†å¼€åˆ†æã€‚</p>
<p><em>ä¸‹é¢åˆ†æä¸æƒ³çœ‹çš„ç›´æ¥è·³è¿‡è®°ä½ç»“è®ºå³å¯</em></p>
<p>å®šä¹‰å…ˆæ‰‹å¿…è¾“çš„å±€åŠ¿ä¸ºå¥‡å¼‚å±€åŠ¿ï¼Œå‰å‡ ä¸ªå¥‡å¼‚å±€åŠ¿ä¸º: (0, 0), (1, 2), (3, 5), (4, 7), (6,10)â€¦â€¦</p>
<p>å‡è®¾ (x, y) ä¸ºç¬¬ k ä¸ªå¥‡å¼‚å±€åŠ¿</p>
<p>æ€§è´¨ï¼š</p>
<ul>
<li>xä¸ºå‰ 1Â·Â·Â·k ä¸ªå¥‡å¼‚å±€åŠ¿ä¸­æ²¡æœ‰å‡ºç°è¿‡çš„æœ€å°æ­£æ•´æ•°ï¼Œy = x + k (æ‰“è¡¨æ‰¾è§„å¾‹)</li>
<li>ä»»ä½•ä¸€ä¸ªè‡ªç„¶æ•°éƒ½åŒ…å«åœ¨ä¸€ä¸ªä¸”ä»…æœ‰ä¸€ä¸ªå¥‡å¼‚å±€åŠ¿ä¸­</li>
<li>ä»»ä½•æ“ä½œéƒ½ä¼šå°†å¥‡å¼‚å±€åŠ¿å˜ä¸ºéå¥‡å¼‚å±€åŠ¿</li>
<li>éå¥‡å¼‚å±€åŠ¿å¯ä»¥é€šè¿‡é€‚å½“æ“ä½œå˜ä¸ºå¥‡å¼‚å±€åŠ¿</li>
</ul>
<p>è¯æ˜è¿™ä¸ªç»“è®ºï¼Œåªéœ€è¯æ˜ï¼š</p>
<ol>
<li>ä»»æ„è‡ªç„¶æ•°éƒ½å‡ºç°è¿‡</li>
<li>ä»»æ„è‡ªç„¶æ•°ä»…å‡ºç°ä¸€æ¬¡</li>
</ol>
<p>åè¯æ³•æ˜“è¯ã€‚</p>
</blockquote>
<img src="/2020/10/03/Game/%E5%A8%81%E4%BD%90%E5%A4%AB%E5%8D%9A%E5%BC%88.jpg" class="" title="XY">

<blockquote>
<p>æˆ‘ä»¬å¯ä»¥å°†ä¸¤å †çŸ³å­çœ‹æˆæ˜¯æ£‹ç›˜ä¸Šä¸€ä¸ªç‚¹çš„çºµæ¨ªåæ ‡ï¼Œé‚£ä¹ˆæ¸¸æˆåˆ‡æ¢ï¼š</p>
<p>æ£‹ç›˜ä¸Šæœ‰ä¸€ä¸ªç‚¹ï¼Œæ¯æ¬¡æ¯ä¸ªäººåªèƒ½å°†æ£‹å­å¾€å·¦æˆ–è€…å¾€ä¸‹ç§»åŠ¨ä»»æ„ä¸ªæ ¼å­ï¼Œä¸èƒ½ç§»åŠ¨çš„äººè¾“ã€‚</p>
<p>å°†èƒ½ä¸€æ­¥åˆ°è¾¾(0, 0)çš„ç‚¹éƒ½æŸ“è‰²ï¼Œé‚£ä¹ˆè¿™äº›ç‚¹å°±æ˜¯å¿…èƒœæ€ï¼Œå†æ‰¾åˆ°æ¨ªçºµåæ ‡ä¹‹å’Œæœ€å°çš„æ²¡è¢«æŸ“è‰²çš„ç‚¹ï¼Œ</p>
<p>è¿™ä¸ªç‚¹å°±æ˜¯ä¸‹ä¸€ä¸ªå¿…è´¥æ€ï¼Œç”±æ­¤ç”»å‡ºä¸Šå›¾ã€‚</p>
</blockquote>
<h3 id="4-1-ç»“è®º"><a href="#4-1-ç»“è®º" class="headerlink" title="4.1 ç»“è®º"></a>4.1 ç»“è®º</h3><blockquote>
<p><strong>æ ¹æ®<a href="https://baike.baidu.com/item/%E8%B4%9D%E8%92%82%E5%AE%9A%E7%90%86/2677437?fr=aladdin">Bettyå®šç†</a>ï¼Œç¬¬Kä¸ªå±€åŠ¿å°±æ˜¯(âŒŠ(1+âˆš5)/2 *kâŒ‹, âŒŠ(3+âˆš5)/2 *kâŒ‹)ï¼Œå…¶ä¸­(1+âˆš5)/2=1.618æ˜¯é»„é‡‘åˆ†å‰²ç³»æ•°ã€‚</strong></p>
<p><strong>å› æ­¤ï¼Œå±€åŠ¿(x, y)æ»¡è¶³(y - x)*(1+âˆš5)/2)=xæ—¶ï¼Œå…ˆæ‰‹å¿…è´¥ï¼Œå¦åˆ™å…ˆæ‰‹å¿…èƒœã€‚</strong></p>
</blockquote>
<h3 id="4-1-ä»£ç "><a href="#4-1-ä»£ç " class="headerlink" title="4.1 ä»£ç "></a>4.1 ä»£ç </h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WizovGame</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ä¿è¯ a &lt;= b</span></span><br><span class="line">        <span class="keyword">if</span> (a &gt; b) &#123;</span><br><span class="line">            <span class="keyword">int</span> temp = b;</span><br><span class="line">            b = a;</span><br><span class="line">            a = temp;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­ a == (b - a) * é»„é‡‘åˆ†å‰²ç³»æ•° (å‘ä¸Šå–æ•´)</span></span><br><span class="line">        <span class="keyword">if</span> ( a == (<span class="keyword">int</span>) Math.ceil( (b - a) * (<span class="number">1</span> + Math.sqrt(<span class="number">5.0</span>)) / <span class="number">2</span>) ) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;åæ‰‹è·èƒœ&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å…ˆæ‰‹è·èƒœ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="5-æ–æ³¢é‚£å¥‘åšå¼ˆ"><a href="#5-æ–æ³¢é‚£å¥‘åšå¼ˆ" class="headerlink" title="5. æ–æ³¢é‚£å¥‘åšå¼ˆ"></a>5. æ–æ³¢é‚£å¥‘åšå¼ˆ</h2><h3 id="5-1-é—®é¢˜"><a href="#5-1-é—®é¢˜" class="headerlink" title="5.1 é—®é¢˜"></a>5.1 é—®é¢˜</h3><blockquote>
<p>ä¸¤ä¸ªé¡¶å°–èªæ˜çš„äººåœ¨ç©æ¸¸æˆï¼Œæœ‰ä¸€å †çŸ³å­ï¼Œæ•°é‡ä¸ºnï¼Œä¸¤ä¸ªäººè½®æµå–çŸ³å­ï¼Œè§„åˆ™å¦‚ä¸‹ï¼š</p>
<p>ï¼ˆ1ï¼‰å…ˆæ‰‹ä¸èƒ½åœ¨ç¬¬ä¸€æ¬¡æŠŠæ‰€æœ‰çš„çŸ³å­å–å®Œï¼Œè‡³å°‘å–ä¸€é¢—ï¼›</p>
<p>ï¼ˆ2ï¼‰ä¹‹åæ¯æ¬¡å¯ä»¥å–çš„çŸ³å­æ•°è‡³å°‘ä¸º1ï¼Œè‡³å¤šä¸ºå¯¹æ‰‹åˆšå–çš„çŸ³å­æ•°çš„2å€ï¼›</p>
<p>ä¸èƒ½å–çš„äººè¾“ã€‚è¯·é—®å…ˆæ‰‹ä¸åæ‰‹è°å¿…èƒœï¼Ÿ</p>
</blockquote>
<h3 id="5-2-ç»“è®º"><a href="#5-2-ç»“è®º" class="headerlink" title="5.2 ç»“è®º"></a>5.2 ç»“è®º</h3><blockquote>
<p><strong>å½“nä¸ºFibonacciæ•°çš„æ—¶å€™ï¼Œåæ‰‹å¿…èƒœï¼Œå¦åˆ™å…ˆæ‰‹å¿…èƒœã€‚</strong></p>
</blockquote>
<h3 id="5-3-è¯æ˜"><a href="#5-3-è¯æ˜" class="headerlink" title="5.3 è¯æ˜"></a>5.3 è¯æ˜</h3><blockquote>
<p>æ•°å­¦å½’çº³æ³•ï¼š</p>
<p>å‡è®¾çŸ³å­æ•°é‡n = F[i]ï¼ˆæ–æ³¢é‚£å¥‘æ•°åˆ—ä¸­çš„ç¬¬ié¡¹{1, 1, 2, 3, 5Â·Â·Â·Â·Â·Â·}ï¼‰</p>
<p>ï¼ˆ1ï¼‰å½“ i = 2 æ—¶ï¼Œn = 2ï¼Œæ˜¾ç„¶å…ˆæ‰‹å–ä¸€ä¸ªï¼Œåæ‰‹å¿…èƒœ</p>
<p>ï¼ˆ2ï¼‰å½“ i &gt; 2 æ—¶ï¼Œå‡è®¾å½“ i &lt;= k æ—¶ç»“è®ºæˆç«‹ã€‚</p>
<p>å½“i = k + 1æ—¶ï¼ŒF[i] = F[k] + F[k-1]ï¼Œå°†çŸ³å­åˆ†æˆä¸¤éƒ¨åˆ†æ¥çœ‹ã€‚</p>
<p>å‡è®¾å…ˆæ‰‹ç¬¬ä¸€æ¬¡å– x ä¸ªï¼Œåæ‰‹ç¬¬ä¸€æ¬¡å– y ä¸ªã€‚</p>
<p>1ï¼‰å¦‚æœ x &lt; F[k-1] / 3ï¼Œå› ä¸º n = F[k-1] æ—¶å·²ç»è¯æ˜åæ‰‹ä¸€å®šèƒ½å–åˆ° F[k-1] ä¸ªä¸­çš„æœ€åä¸€ä¸ªï¼Œ</p>
<p>æ‰€ä»¥é—®é¢˜è½¬åŒ–æˆäº†æœ‰ F[k] ä¸ªä¸­çš„æœ€åä¸€ä¸ªï¼Œè¿™ä¸ªä¹Ÿå·²ç»è¯æ˜åæ‰‹ä¸€å®šèƒ½å–åˆ°F[k]ä¸­çš„æœ€åä¸€ä¸ªã€‚</p>
<p>æ‰€ä»¥åæ‰‹å¿…èƒœã€‚</p>
<p>2ï¼‰å¦‚æœ F[k-1] / 3 &lt;= x &lt;= F[k]æ—¶ï¼Œåˆ™F[k-1]ä¸­å‰©ä½™æ•°é‡å°äº2xï¼Œåæ‰‹å¯ä»¥ç›´æ¥å–å®Œï¼Œ</p>
<p>ï¼ˆå¦‚æœä¸é€‰æ‹©ä¸€æ¬¡æ€§å–å®Œï¼Œæ…¢æ…¢ç£¨æœ€ç»ˆä¹Ÿä¼šæ˜¯æ‰€è¯æ˜çš„F[k-1]çš„æƒ…å†µï¼Œåæ‰‹æœ€åå–å®Œï¼‰</p>
<p>å³åæ‰‹å–äº†F[k-1]-xä¸ªï¼Œå³y &lt;= 2/3 * F[k-1]ã€‚æ¯”è¾ƒ 2/3 * F[k-1] ä¸ 1/2 * F[k] çš„å¤§å°ï¼Œ</p>
<p>å³æ¯”è¾ƒ4 * [k-1] ä¸ 3 * F[k] çš„å¤§å°ï¼š</p>
<p>ç”±äº F[k] å‡½æ•°é€’å¢ ä¸” F[k] = F[k-1] + F[k-2]æ˜“çŸ¥ï¼š2 * F[k-2] &lt; F[k] &lt; 2 * F[k-1]ï¼Œ</p>
<p>å› è€Œ 3 * F[k] = 3 * F[k-1] + 3 * F[k-2] &gt; 3 * F[k-1] + 3 / 2 * F[k-1] &gt; 4 * F[k-1]ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨åæ‰‹å–å®ŒF[k-1]é‚£ä¸€å †çŸ³å­ä¹‹åï¼Œå…ˆæ‰‹ä¸èƒ½ä¸€æ¬¡æ€§å–å®ŒF[k]é‚£ä¸€å †çŸ³å­ï¼Œ</p>
<p>äºæ˜¯é—®é¢˜æœ€ç»ˆæ¼”å˜æˆäº†F[k]çš„çŠ¶å†µï¼Œåæ‰‹æœ€åå–å®Œã€‚</p>
<p>3ï¼‰å¦‚æœ x &gt; F[k-1]ï¼Œå› ä¸ºF[k] &lt; 2 * F[k-1]ï¼Œåæ‰‹å¯ä»¥ä¸€æ¬¡æ€§å–å®Œã€‚</p>
<p>ç»¼ä¸Šä¸‰ç§æƒ…å†µï¼Œå½“ i &lt;= k æ—¶ç»“è®ºæˆç«‹ï¼Œé‚£ä¹ˆå½“ n = k+1 æ—¶ç»“è®ºä¹Ÿæˆç«‹ã€‚</p>
</blockquote>
<h3 id="5-4-ä»£ç "><a href="#5-4-ä»£ç " class="headerlink" title="5.4 ä»£ç "></a>5.4 ä»£ç </h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FibonacciGame</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">fibnacci</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// é€’å½’è®¡ç®—ï¼Œæ…¢</span></span><br><span class="line"><span class="comment">//        if (n == 1 || n == 2)</span></span><br><span class="line"><span class="comment">//            return 1;</span></span><br><span class="line"><span class="comment">//        else</span></span><br><span class="line"><span class="comment">//            return fibnacci(n - 1) + fibnacci(n - 2);</span></span><br><span class="line">        <span class="comment">// å…¬å¼è®¡ç®—ï¼Œå¿«</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) Math.floor( ( Math.pow((<span class="number">1</span> + Math.sqrt(<span class="number">5</span>)) / <span class="number">2</span>, n)  - Math.pow((<span class="number">1</span> - Math.sqrt(<span class="number">5</span>)) / <span class="number">2</span>, n) ) / Math.sqrt(<span class="number">5</span>) );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; fibnacci(i) &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (fibnacci(i+<span class="number">1</span>) == n) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;åæ‰‹è·èƒœ&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;å…ˆæ‰‹è·èƒœ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
      <tags>
        <tag>Game</tag>
      </tags>
  </entry>
  <entry>
    <title>JWT</title>
    <url>/2020/11/20/JWT/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="JWT"><a href="#JWT" class="headerlink" title="JWT"></a>JWT</h1><h2 id="ğŸ“–å®˜æ–¹æ–‡æ¡£"><a href="#ğŸ“–å®˜æ–¹æ–‡æ¡£" class="headerlink" title="ğŸ“–å®˜æ–¹æ–‡æ¡£"></a>ğŸ“–å®˜æ–¹æ–‡æ¡£</h2><blockquote>
<p>ğŸŒå®˜æ–¹æ–‡æ¡£</p>
</blockquote>
<p>ğŸ‘‰<a href="https://jwt.io/introduction/">JWT</a></p>
<blockquote>
<p>ğŸ’°JWTæ¦‚è¿°</p>
</blockquote>
<p><strong>JSON Web Token</strong>æ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†ï¼ˆRFC 7519ï¼‰ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ç´§å‡‘ä¸”åŒ…å«çš„æ–¹å¼ï¼Œç”¨äºåœ¨å„æ–¹ä¹‹é—´å®‰å…¨åœ°ä¼ è¾“ä¿¡æ¯ä½œä¸ºJSONå¯¹è±¡ã€‚ç”±äºæ­¤ä¿¡æ¯æ˜¯ç»è¿‡æ•°å­—ç­¾åçš„ï¼Œç”¨äºåœ¨å„æ–¹é¢ä¹‹é—´å®‰å…¨åœ°ä¼ è¾“ä¿¡æ¯ä½œä¸ºJSONå¯¹è±¡ã€‚ç”±äºæ­¤ä¿¡æ¯æ˜¯ç»è¿‡æ•°å­—ç­¾ååœ°ï¼Œå› æ­¤å¯ä»¥è¢«éªŒè¯å’Œä¿¡ä»»ã€‚å¯ä»¥ä½¿ç”¨ç§˜å¯†ï¼ˆæˆ–è€…<strong>HMAC</strong>ç®—æ³•ï¼‰æˆ–ä½¿ç”¨<strong>RSA</strong>æˆ–<strong>ECDSA</strong>çš„å…¬é’¥/ç§é’¥å¯¹å¯¹JWTè¿›è¡Œç­¾åã€‚</p>
<p>å°½ç®¡å¯ä»¥å¯¹JWTè¿›è¡ŒåŠ å¯†ä»¥æä¾›åŒæ–¹ä¹‹é—´çš„ä¿å¯†æ€§ï¼Œä½†æˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨å·²ç­¾åçš„ä»¤ç‰Œã€‚ç­¾åçš„ä»¤ç‰Œå¯ä»¥éªŒè¯å…¶ä¸­åŒ…å«çš„å£°æ˜çš„å®Œæ•´æ€§ï¼Œè€ŒåŠ å¯†çš„ä»¤ç‰Œåˆ™å°†è¿™äº›å£°æ˜éšè—åœ¨å…¶ä»–æ–¹çš„é¢å‰ã€‚å½“ä½¿ç”¨å…¬é’¥/ç§é’¥å¯¹å¯¹ä»¤ç‰Œè¿›è¡Œç­¾åæ—¶ï¼Œç­¾åè¿˜è¯æ˜åªæœ‰æŒæœ‰ç§é’¥çš„ä¸€æ–¹æ‰æ˜¯å¯¹å…¶è¿›è¡Œç­¾åçš„ä¸€æ–¹ã€‚</p>
<blockquote>
<p>ğŸ”±åº”ç”¨åœºæ™¯</p>
</blockquote>
<ul>
<li>æˆæƒè®¤è¯ï¼šä½¿ç”¨JWTçš„æœ€å¸¸è§æ–¹æ¡ˆã€‚ä¸€æ—¦ç”¨æˆ·ç™»å½•ï¼Œæ¯ä¸ªåç»­è¯·æ±‚å°†åŒ…æ‹¬ä»¤ç‰Œï¼Œä»è€Œå…è®¸ç”¨æˆ·è®¿é—®è¯¥ä»¤ç‰Œå…è®¸çš„è·¯ç”±ã€æœåŠ¡å’Œèµ„æºã€‚å•ç‚¹ç™»å½•æ˜¯å½“ä»Šå¹¿æ³›ä½¿ç”¨JWTçš„ä¸€é¡¹åŠŸèƒ½ï¼Œå› ä¸ºå®ƒçš„å¼€é”€å¾ˆå°å¹¶ä¸”å¯ä»¥åœ¨ä¸åŒçš„åŸŸä¸­è½»æ¾ä½¿ç”¨ã€‚</li>
<li>ä¿¡æ¯äº¤æ¢ï¼šJWTæ˜¯åœ¨å„æ–¹ä¹‹é—´å®‰å…¨åœ°ä¼ è¾“ä¿¡æ¯çš„ä¸€ç§å¥½æ–¹æ³•ã€‚å› ä¸ºå¯ä»¥å¯¹JWTè¿›è¡Œç­¾åï¼Œä¾‹å¦‚ä½¿ç”¨å…¬é’¥/ç§é’¥å¯¹ã€‚æ­¤å¤–ã€‚ç”±äºç­¾åæ˜¯ä½¿ç”¨æ ‡å¤´å’Œæœ‰æ•ˆè´Ÿè½½è®¡ç®—çš„ï¼Œå› æ­¤è¿˜å¯ä»¥éªŒè¯å†…å®¹æ˜¯å¦é­åˆ°ç¯¡æ”¹ã€‚</li>
</ul>
<h2 id="ğŸš€è®¤è¯æµç¨‹"><a href="#ğŸš€è®¤è¯æµç¨‹" class="headerlink" title="ğŸš€è®¤è¯æµç¨‹"></a>ğŸš€è®¤è¯æµç¨‹</h2><blockquote>
<p>â›”ï¸sessionè®¤è¯</p>
</blockquote>
<p>ä¼ ç»Ÿæ–¹å¼ï¼šç”¨æˆ·ç¬¬ä¸€æ¬¡è¯·æ±‚ç™»å½•æ—¶å€™è®¾ç½®sessionï¼Œæ­¤åæ¯æ¬¡è®¿é—®æºå¸¦cookieã€‚</p>
<p>é—®é¢˜ï¼š</p>
<ul>
<li>æ¯ä¸ªç”¨æˆ·ç»è¿‡æˆ‘ä»¬çš„åº”ç”¨è®¤è¯ä¹‹åï¼Œæˆ‘ä»¬çš„åº”ç”¨éƒ½è¦åœ¨æœåŠ¡ç«¯åšä¸€æ¬¡è®°å½•ï¼Œä»¥æ–¹ä¾¿ç”¨æˆ·ä¸‹æ¬¡è¯·æ±‚çš„é‰´åˆ«ï¼Œé€šå¸¸è€Œè¨€sessionéƒ½æ˜¯ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œè€Œéšç€ç”¨æˆ·çš„å¢å¤šï¼ŒæœåŠ¡ç«¯çš„å¼€é”€ä¼šæ˜æ˜¾å¢å¤§ã€‚</li>
<li>ç”¨æˆ·è®¤è¯ä¹‹åï¼ŒæœåŠ¡ç«¯åšè®¤è¯è®°å½•ï¼Œå¦‚æœè®¤è¯çš„è®°å½•è¢«ä¿å­˜åœ¨å†…å­˜ä¸­çš„è¯ï¼Œè¿™æ„å‘³ç€ç”¨æˆ·ä¸‹æ¬¡è¯·æ±‚è¿˜å¿…é¡»è¦è¯·æ±‚åœ¨è¿™å°æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·æ‰èƒ½æ‹¿åˆ°æˆæƒçš„èµ„æºï¼Œè¿™æ ·åœ¨åˆ†å¸ƒå¼çš„åº”ç”¨ä¸Šï¼Œç›¸åº”çš„é™åˆ¶äº†è´Ÿè½½å‡è¡¡å™¨çš„èƒ½åŠ›ï¼Œè¿™ä¹Ÿæ„å‘³ç€é™åˆ¶äº†åº”ç”¨çš„æ‰©å±•èƒ½åŠ›ã€‚</li>
<li>å› ä¸ºæ˜¯åŸºäºcookieæ¥è¿›è¡Œç”¨æˆ·è¯†åˆ«çš„ï¼Œcookieå¦‚ä½•è¢«æˆªè·ï¼Œç”¨æˆ·å¾ˆå®¹æ˜“å—åˆ°è·¨ç«™è¯·æ±‚ä¼ªé€ çš„æ”»å‡»ã€‚</li>
</ul>
<blockquote>
<p>ğŸ”°JWTè®¤è¯</p>
</blockquote>
<img src="/2020/11/20/JWT/JWT%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B.png" class="" title="JWTè®¤è¯">

<p>è®¤è¯æµç¨‹ï¼š</p>
<p>é¦–å…ˆï¼Œå‰ç«¯é€šè¿‡webè¡¨å•å°†è‡ªå·±çš„ç”¨æˆ·åå’Œå¯†ç å‘é€åˆ°åç«¯çš„æ¥å£ï¼Œè¿™ä¸€è¿‡ç¨‹ä¸€èˆ¬æ˜¯ä¸€ä¸ªHttp POSTè¯·æ±‚ã€‚</p>
<p>åç«¯æ ¸å¯¹ç”¨æˆ·åå’Œå¯†ç æˆåŠŸåï¼Œå°†ç”¨æˆ·çš„idç­‰å…¶ä»–ä¿¡æ¯ä½œä¸ºJWT payload(è´Ÿè½½)ï¼Œå°†å…¶ä¸å¤´éƒ¨åˆ†åˆ«è¿›è¡ŒBased64ç¼–ç æ‹¼æ¥åç­¾åï¼Œå½¢æˆä¸€ä¸ªJWTã€‚å½¢æˆçš„JWTå°±å½¢åŒxxx.yyy.zzzçš„å­—ç¬¦ä¸²ã€‚</p>
<p>åç«¯å°†JWTå­—ç¬¦ä¸²ä½œä¸ºç™»é™†æˆåŠŸçš„è¿”å›ç»“æœè¿”å›ç»™å‰ç«¯ï¼Œå‰ç«¯å¯ä»¥å°†è¿”å›çš„ç»“æœä¿å­˜åœ¨localStorageä¸Šï¼Œé€€å‡ºç™»å½•æ—¶å‰ç«¯åˆ é™¤ä¿å­˜çš„JWTå³å¯ã€‚</p>
<p>å‰ç«¯åœ¨æ¯æ¬¡è¯·æ±‚æ—¶å°†JWTæ”¾å…¥HTTP Headerçš„Authorizationä½ã€‚ï¼ˆè§£å†³XSSå’ŒXSRFé—®é¢˜ï¼‰</p>
<p>åç«¯æ£€æŸ¥æ˜¯å¦å­˜åœ¨ï¼Œå¦‚å­˜åœ¨éªŒè¯JWTçš„æœ‰æ•ˆæ€§ã€‚ï¼ˆç­¾åæ˜¯å¦æ­£ç¡®ï¼ŒTokenæ˜¯å¦è¿‡æœŸç­‰ï¼‰</p>
<p>éªŒè¯é€šè¿‡ååç«¯ä½¿ç”¨JWTä¸­åŒ…å«çš„ç”¨æˆ·ä¿¡æ¯è¿›è¡Œå…¶ä»–é€»è¾‘æ“ä½œï¼Œå¹¶è¿”å›ç›¸åº”ç»“æœã€‚</p>
<p>ä¼˜åŠ¿ï¼š</p>
<ul>
<li>ç®€æ´ï¼Œå¯ä»¥é€šè¿‡URLï¼ŒPOSTå‚æ•°æˆ–è€…åœ¨HTTP Headerå‘é€ï¼Œå› ä¸ºæ•°æ®é‡å°ï¼Œä¼ è¾“é€Ÿåº¦ä¹Ÿå¾ˆå¿«</li>
<li>è‡ªåŒ…å«ï¼šè´Ÿè½½ä¸­åŒ…å«äº†æ‰€æœ‰ç”¨æˆ·æ‰€éœ€è¦çš„ä¿¡æ¯ï¼Œé¿å…äº†å¤šæ¬¡æŸ¥è¯¢æ•°æ®åº“</li>
<li>å› ä¸ºTokenæ˜¯JSONåŠ å¯†çš„å½¢å¼ä¿å­˜åœ¨å®¢æˆ·ç«¯çš„ï¼Œæ‰€ä»¥JWTæ˜¯è·¨è¯­è¨€çš„ï¼ŒåŸåˆ™ä¸Šä»»ä½•webå½¢å¼éƒ½æ”¯æŒ</li>
<li>ä¸éœ€è¦å†æœåŠ¡ç«¯ä¿å­˜ä¼šè¯ä¿¡æ¯ï¼Œç‰¹åˆ«é€‚åˆç”¨äºåˆ†å¸ƒå¼å¾®æœåŠ¡</li>
</ul>
<blockquote>
<p>â›“ä»¤ç‰Œç»“æ„</p>
</blockquote>
<p>JSON Web Tokenä»¥ç´§å‡‘çš„å½¢å¼ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œä¸‰éƒ¨åˆ†ç”±<code>.</code>åˆ†éš”ï¼Œå³<code>xxxxx.yyyyy.zzzzz</code></p>
<ul>
<li><p>æ ‡å¤´(Header)  : Base64ç¼–ç ï¼Œç”±ä»¤ç‰Œç±»å‹å’Œç­¾åç®—æ³•ç»„æˆ</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;alg&quot;</span>: <span class="string">&quot;HS256&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;typ&quot;</span>: <span class="string">&quot;JWT&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>è´Ÿè½½(Payload) : Base64ç¼–ç ï¼Œç”¨äºæ”¾ç½®æºå¸¦ä¿¡æ¯ï¼Œä¸èƒ½æ”¾æ•æ„Ÿä¿¡æ¯</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>:<span class="string">&quot;Khighness&quot;</span></span><br><span class="line">    <span class="string">&quot;admin&quot;</span>:<span class="literal">true</span></span><br><span class="line">    <span class="string">&quot;gender&quot;</span>:<span class="string">&quot;male&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç­¾å(Signature) : å¯¹æ ‡å¤´å’Œè´Ÿè½½è¿›è¡Œç­¾åï¼Œé˜²æ­¢å†…å®¹è¢«ç¯¡æ”¹</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">HMACSHA256(baseUrlEncode(header)) + &quot;.&quot; + base64UrlEncode(payload).secret)</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h2 id="ğŸ’»JWT-Demo"><a href="#ğŸ’»JWT-Demo" class="headerlink" title="ğŸ’»JWT-Demo"></a>ğŸ’»JWT-Demo</h2><blockquote>
<p>â•æ·»åŠ ä¾èµ–</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- JWT --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.auth0<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>java-jwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jwt.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p>ğŸ“‘Javaä»£ç </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">generateToken</span><span class="params">()</span>  </span>&#123;</span><br><span class="line">    HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    Calendar calendar = Calendar.getInstance();</span><br><span class="line">    calendar.add(Calendar.SECOND, <span class="number">60</span>);</span><br><span class="line"></span><br><span class="line">    String token = JWT.create()</span><br><span class="line">            .withHeader(map)                                     <span class="comment">// Header</span></span><br><span class="line">            .withClaim(<span class="string">&quot;userID&quot;</span>, <span class="number">1011</span>)              <span class="comment">// Payload</span></span><br><span class="line">            .withClaim(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;KHighness&quot;</span>)</span><br><span class="line">            .withExpiresAt(calendar.getTime())                  <span class="comment">// æŒ‡å®šä»¤ç‰Œè¿‡æœŸæ—¶é—´: 60S</span></span><br><span class="line">            .sign(Algorithm.HMAC256(<span class="string">&quot;PARAK&quot;</span>));                 <span class="comment">// Signatureï¼Œè®¾ç½®å¯†é’¥PARAK</span></span><br><span class="line"></span><br><span class="line">    System.out.println(token);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;éªŒè¯ä»¤ç‰Œ&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">verifyToken</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    JWTVerifier jwtVerifier = JWT.require(Algorithm.HMAC512(<span class="string">&quot;PARAK&quot;</span>)).build();</span><br><span class="line">    String token = <span class="string">&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE2MDU5NDU0ODQsInVzZXJJRCI6MTAxMSwidXNlcm5hbWUiOiJLSGlnaG5lc3MifQ.Gvwa3vu_LYogcEPFxKOgFgaH6WnTKoo-UDW977W1GAw&quot;</span>;</span><br><span class="line">    DecodedJWT verify = jwtVerifier.verify(token);</span><br><span class="line">    System.out.println(verify.getClaim(<span class="string">&quot;userID&quot;</span>).asInt());</span><br><span class="line">    System.out.println(verify.getClaim(<span class="string">&quot;username&quot;</span>).asString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>â—ï¸ å¸¸è§å¼‚å¸¸</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">å¼‚å¸¸</th>
<th align="center">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="center">TokenExpiredException</td>
<td align="center">ä»¤ç‰Œè¿‡æœŸå¼‚å¸¸</td>
</tr>
<tr>
<td align="center">SignatureVerificationException</td>
<td align="center">ç­¾åä¸ä¸€è‡´å¼‚å¸¸</td>
</tr>
<tr>
<td align="center">AlgorithmMismatchException</td>
<td align="center">åŠ å¯†ç®—æ³•ä¸åŒ¹é…å¼‚å¸¸</td>
</tr>
<tr>
<td align="center">InvalidClaimException</td>
<td align="center">å¤±æ•ˆçš„è´Ÿè½½å¼‚å¸¸</td>
</tr>
</tbody></table>
<h2 id="ğŸƒæ•´åˆSpringboot"><a href="#ğŸƒæ•´åˆSpringboot" class="headerlink" title="ğŸƒæ•´åˆSpringboot"></a>ğŸƒæ•´åˆSpringboot</h2><blockquote>
<p>ğŸ’¬è¯´æ˜</p>
</blockquote>
<p>ç”¨æˆ·åœ¨ç¬¬ä¸€æ¬¡ç™»é™†çš„æ—¶å€™ï¼Œåå°ç”Ÿæˆtokenè¿”å›ç»™å‰ç«¯å­˜å‚¨åœ¨sessionStorageä¸­ï¼Œæ­¤åæ¯æ¬¡å‰ç«¯éœ€è¦è°ƒç”¨åç«¯éœ€è¦è®¤è¯çš„æ¥å£æ—¶éƒ½æŠŠtokenå–å‡ºæ¥æºå¸¦åœ¨http headerä¸­ã€‚åå°è®¾ç½®æ‹¦æˆªå™¨ï¼Œè®¾ç½®éœ€è¦è®¤è¯æ‰èƒ½è®¿é—®çš„æ¥å£ï¼Œæ¯æ¬¡å¤„ç†è¯·æ±‚æ—¶ï¼Œå…ˆä»requestçš„http headerä¸­å–å‡ºtokenè¿›è¡Œè®¤è¯ï¼Œé€šè¿‡åæ‰è¿›è¡Œç›¸å…³æ¥å£å¤„ç†ã€‚</p>
<blockquote>
<p>ğŸ”§å°è£…å·¥å…·ç±»</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.auth0.jwt.JWT;</span><br><span class="line"><span class="keyword">import</span> com.auth0.jwt.JWTCreator;</span><br><span class="line"><span class="keyword">import</span> com.auth0.jwt.algorithms.Algorithm;</span><br><span class="line"><span class="keyword">import</span> com.auth0.jwt.interfaces.DecodedJWT;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Calendar;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: Springboot-JWT &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.common &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: KKJWTUtil &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: JWTå·¥å…·ç±» &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/11/22</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KKJWTUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;ç­¾åçš„å¯†é’¥[<span class="doctag">@NAME</span>]&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String secret = <span class="string">&quot;@KHIGHNESS&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;ç­¾åçš„è¿‡æœŸæ—¶é—´[A Week]&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> accessTokenExpireTime = <span class="number">604800</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;ä»¤ç‰Œé¢å¸ƒè€…èº«ä»½æ ‡è¯†[DOMAIN]&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String issuer = <span class="string">&quot;parak.top&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;ç”ŸæˆToken&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> chaims</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">generateToken</span><span class="params">(Map&lt;String, String&gt; chaims)</span> </span>&#123;</span><br><span class="line">        JWTCreator.Builder builder = JWT.create();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* æ·»åŠ è´Ÿè½½ */</span></span><br><span class="line">        chaims.forEach((k, v) -&gt; &#123;</span><br><span class="line">            builder.withClaim(k, v);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* è®¾ç½®è¿‡æœŸæ—¶é—´ */</span></span><br><span class="line">        Calendar calendar = Calendar.getInstance();</span><br><span class="line">        calendar.add(Calendar.SECOND, accessTokenExpireTime);</span><br><span class="line">        builder.withExpiresAt(calendar.getTime());</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* è®¾ç½®é¢å‘è€…èº«ä»½ */</span></span><br><span class="line">        builder.withIssuer(issuer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* è®¾ç½®åŠ å¯†ç®—æ³•ä»¥åŠå¯†é’¥ */</span></span><br><span class="line">        String token = builder.sign(Algorithm.HMAC256(secret));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;è§£ætoken&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DecodedJWT <span class="title">verifyToken</span><span class="params">(String token)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> JWT.require(Algorithm.HMAC256(secret)).build().verify(token);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç”¨æˆ·æ§åˆ¶å™¨</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.auth0.jwt.interfaces.DecodedJWT;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.ObjectUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> top.parak.common.KKCondition;</span><br><span class="line"><span class="keyword">import</span> top.parak.common.KKDataResponse;</span><br><span class="line"><span class="keyword">import</span> top.parak.common.KKJWTUtil;</span><br><span class="line"><span class="keyword">import</span> top.parak.entity.User;</span><br><span class="line"><span class="keyword">import</span> top.parak.service.UserService;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.validation.Valid;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     ç”¨æˆ·æ§åˆ¶å±‚</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020-11-19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;ç”¨æˆ·æ³¨å†Œ&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/register&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> KKDataResponse <span class="title">register</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> User user)</span> </span>&#123;</span><br><span class="line">        String username = user.getUsername();</span><br><span class="line">        String password = user.getPassword();</span><br><span class="line">        log.info(<span class="string">&quot;ç”¨æˆ·æ³¨å†Œ =&gt; [&#123;&#125;]&quot;</span>, username);</span><br><span class="line">        KKCondition condition = <span class="keyword">new</span> KKCondition();</span><br><span class="line">        condition.setName(username);</span><br><span class="line">        <span class="keyword">if</span> (!ObjectUtils.isEmpty(userService.queryUserInCondition(condition))) &#123;</span><br><span class="line">            log.warn(<span class="string">&quot;ç”¨æˆ·å&#123;&#125;å·²è¢«æ³¨å†Œï¼Œä¸å¯é‡å¤æ³¨å†Œ&quot;</span>, username);</span><br><span class="line">            <span class="keyword">return</span> KKDataResponse.errorResponse(<span class="string">&quot;è¯¥ç”¨æˆ·åå·²è¢«æ³¨å†Œï¼Œä¸å¯é‡å¤æ³¨å†Œ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> userService.saveUser(username, password) == <span class="number">1</span> ? KKDataResponse.successResponse(<span class="keyword">true</span>) : KKDataResponse.errorResponse(<span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;ç”¨æˆ·ç™»å½•&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> loginDataJson</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> KKDataResponse <span class="title">login</span><span class="params">(<span class="meta">@RequestBody</span> String loginDataJson)</span> </span>&#123;</span><br><span class="line">        JSONObject loginData = JSON.parseObject(loginDataJson);</span><br><span class="line">        String username = loginData.get(<span class="string">&quot;username&quot;</span>).toString();</span><br><span class="line">        String password = loginData.get(<span class="string">&quot;password&quot;</span>).toString();</span><br><span class="line">        log.info(<span class="string">&quot;ç”¨æˆ·ç™»å½• =&gt; [&#123;&#125;]&quot;</span>, username);</span><br><span class="line">        Map&lt;String, Object&gt; response = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (userService.authenticate(username, password)) &#123;</span><br><span class="line">            response.put(<span class="string">&quot;loginState&quot;</span>, <span class="keyword">true</span>);</span><br><span class="line">            <span class="comment">/* ç”Ÿæˆä»¤ç‰Œ */</span></span><br><span class="line">            Map&lt;String, String&gt; payload = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">            payload.put(<span class="string">&quot;username&quot;</span>, username);</span><br><span class="line">            String token = KKJWTUtil.generateToken(payload);</span><br><span class="line">            response.put(<span class="string">&quot;kktoken&quot;</span>, token);</span><br><span class="line">            <span class="keyword">return</span> KKDataResponse.successResponse(response);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            response.put(<span class="string">&quot;loginState&quot;</span>, <span class="keyword">false</span>);</span><br><span class="line">            response.put(<span class="string">&quot;kktoken&quot;</span>, <span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">return</span> KKDataResponse.errorResponse(response);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/test&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> KKDataResponse <span class="title">test</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        String kktoken = (String) request.getHeader(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">        DecodedJWT verify = KKJWTUtil.verifyToken(kktoken);</span><br><span class="line">        String username = verify.getClaim(<span class="string">&quot;username&quot;</span>).asString();</span><br><span class="line">        log.info(<span class="string">&quot;è¯·æ±‚ç”¨æˆ· =&gt; [&#123;&#125;]&quot;</span>, username);</span><br><span class="line">        <span class="keyword">return</span> KKDataResponse.successResponse(<span class="string">&quot;è¯·æ±‚æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è®¾ç½®æ‹¦æˆªå™¨</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.auth0.jwt.exceptions.AlgorithmMismatchException;</span><br><span class="line"><span class="keyword">import</span> com.auth0.jwt.exceptions.InvalidClaimException;</span><br><span class="line"><span class="keyword">import</span> com.auth0.jwt.exceptions.SignatureVerificationException;</span><br><span class="line"><span class="keyword">import</span> com.auth0.jwt.exceptions.TokenExpiredException;</span><br><span class="line"><span class="keyword">import</span> com.auth0.jwt.interfaces.DecodedJWT;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> top.parak.common.JwtTokenUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: Springboot-JWT &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.interceptor &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: JWTInterceptor &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: ä»¤ç‰Œæ‹¦æˆªå™¨ &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/11/22</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JWTInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String kktoken = request.getHeader(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            log.info(<span class="string">&quot;è¯·æ±‚ä»¤ç‰Œ =&gt; [&#123;&#125;]&quot;</span>, kktoken);</span><br><span class="line">            DecodedJWT decodedJWT = KKJWTUtil.verifyToken(kktoken);</span><br><span class="line">            log.info(<span class="string">&quot;éªŒè¯ç»“æœ =&gt; [&#123;&#125;]&quot;</span>, <span class="keyword">true</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (TokenExpiredException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;å‘æˆå¼‚å¸¸ =&gt; [&#123;&#125;]&quot;</span>, e.getMessage());</span><br><span class="line">            map.put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;ä»¤ç‰Œè¿‡æœŸ&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SignatureVerificationException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;å‘æˆå¼‚å¸¸ =&gt; [&#123;&#125;]&quot;</span>, e.getMessage());</span><br><span class="line">            map.put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;ç­¾åé”™è¯¯&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (AlgorithmMismatchException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;å‘æˆå¼‚å¸¸ =&gt; [&#123;&#125;]&quot;</span>, e.getMessage());</span><br><span class="line">            map.put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;åŠ å¯†ç®—æ³•ä¸åŒ¹é…&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvalidClaimException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;å‘æˆå¼‚å¸¸ =&gt; [&#123;&#125;]&quot;</span>, e.getMessage());</span><br><span class="line">            map.put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;å¤±æ•ˆè´Ÿè½½&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NullPointerException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;å‘æˆå¼‚å¸¸ =&gt; [&#123;&#125;]&quot;</span>, e.getMessage());</span><br><span class="line">            map.put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;ä»¤ç‰Œä¸ºç©º&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;å‘æˆå¼‚å¸¸ =&gt; [&#123;&#125;]&quot;</span>, e.getMessage());</span><br><span class="line">            map.put(<span class="string">&quot;msg&quot;</span>, e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        log.error(<span class="string">&quot;éªŒè¯ç»“æœ =&gt; [&#123;&#125;]&quot;</span>, <span class="keyword">false</span>);</span><br><span class="line">        map.put(<span class="string">&quot;state&quot;</span>, <span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">/* mapè½¬json */</span></span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(map);</span><br><span class="line">        response.setContentType(<span class="string">&quot;application/json;charset=UTF-8&quot;</span>);</span><br><span class="line">        PrintWriter writer = response.getWriter();</span><br><span class="line">        writer.println(json);</span><br><span class="line">        writer.close();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ‹¦æˆªå™¨é…ç½®</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"><span class="keyword">import</span> top.parak.intercepter.JWTIntercepter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: Springboot-JWT &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.config &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: IntercepterConfig &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/11/22</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InterceptorConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> JWTInterceptor())</span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/api/**/**&quot;</span>)</span><br><span class="line">                .excludePathPatterns(<span class="string">&quot;/api/user/login&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>JWT</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java8-Stream</title>
    <url>/2020/09/20/Java8-Stream/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Java8-Stream"><a href="#Java8-Stream" class="headerlink" title="Java8-Stream"></a>Java8-Stream</h1><center>
    <font face="Kristen ITC" color="#555555" font-size=100px>Khighness</font><br>
</center>



<h2 id="ä¸€-æ¦‚è¿°"><a href="#ä¸€-æ¦‚è¿°" class="headerlink" title="ä¸€. æ¦‚è¿°"></a>ä¸€. æ¦‚è¿°</h2><p>â€‹       Stream æ˜¯ Java8 ä¸­å¤„ç†é›†åˆçš„å…³é”®æŠ½è±¡æ¦‚å¿µï¼Œå®ƒå¯ä»¥æŒ‡å®šä½ å¸Œæœ›å¯¹é›†åˆè¿›è¡Œçš„æ“ä½œï¼Œå¯ä»¥æ‰§è¡Œéå¸¸å¤æ‚çš„æŸ¥æ‰¾ã€è¿‡æ»¤å’Œæ˜ å°„æ•°æ®ç­‰æ“ä½œã€‚ä½¿ç”¨Stream API å¯¹é›†åˆæ•°æ®è¿›è¡Œæ“ä½œï¼Œå°±ç±»ä¼¼äºä½¿ç”¨ SQL æ‰§è¡Œçš„æ•°æ®åº“æŸ¥è¯¢ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ Stream API æ¥å¹¶è¡Œæ‰§è¡Œæ“ä½œã€‚ç®€è€Œè¨€ä¹‹ï¼ŒStream API æä¾›äº†ä¸€ç§é«˜æ•ˆä¸”æ˜“äºä½¿ç”¨çš„å¤„ç†æ•°æ®çš„æ–¹å¼ã€‚</p>
<p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li><p>ä¸æ˜¯æ•°æ®ç»“æ„ï¼Œä¸ä¼šä¿å­˜æ•°æ®ã€‚</p>
</li>
<li><p>ä¸ä¼šä¿®æ”¹åŸæ¥çš„æ•°æ®æºï¼Œå®ƒä¼šå°†æ“ä½œåçš„æ•°æ®ä¿å­˜åˆ°å¦å¤–ä¸€ä¸ªå¯¹è±¡ä¸­ã€‚ï¼ˆä¿ç•™æ„è§ï¼šæ¯•ç«Ÿpeekæ–¹æ³•å¯ä»¥ä¿®æ”¹æµä¸­å…ƒç´ ï¼‰</p>
</li>
<li><p>æƒ°æ€§æ±‚å€¼ï¼Œæµåœ¨ä¸­é—´å¤„ç†è¿‡ç¨‹ä¸­ï¼Œåªæ˜¯å¯¹æ“ä½œè¿›è¡Œäº†è®°å½•ï¼Œå¹¶ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œéœ€è¦ç­‰åˆ°æ‰§è¡Œç»ˆæ­¢æ“ä½œçš„æ—¶å€™æ‰ä¼šè¿›è¡Œå®é™…çš„è®¡ç®—ã€‚</p>
</li>
</ul>
<h2 id="äºŒ-åˆ†ç±»"><a href="#äºŒ-åˆ†ç±»" class="headerlink" title="äºŒ. åˆ†ç±»"></a>äºŒ. åˆ†ç±»</h2><table>
<thead>
<tr>
<th align="center">ç±»å‹</th>
<th align="center">çŠ¶æ€</th>
<th align="center">API</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ä¸­é—´æ“ä½œ</td>
<td align="center">æœ‰çŠ¶æ€</td>
<td align="center">unordered() filter() map() mapToInt() mapToDouble() flatMap() flatMapToInt() flatMapToLong() flatMapToDouble() peek()</td>
</tr>
<tr>
<td align="center">ä¸­é—´æ“ä½œ</td>
<td align="center">æ— çŠ¶æ€</td>
<td align="center">distinct() sorted() limit() skip()</td>
</tr>
<tr>
<td align="center">ç»“æŸæ“ä½œ</td>
<td align="center">éçŸ­è·¯æ“ä½œ</td>
<td align="center">foreach() forEachOrdered() toArray() reduce() collect() max() min() count()</td>
</tr>
<tr>
<td align="center">ç»“æŸæ“ä½œ</td>
<td align="center">çŸ­è·¯æ“ä½œ</td>
<td align="center">anyMatch() allMatch() noneMatch() findFirst() findAny()</td>
</tr>
</tbody></table>
<p>æ³¨é‡Šï¼š</p>
<ul>
<li><p>æ— çŠ¶æ€ï¼šæŒ‡å…ƒç´ çš„å¤„ç†ä¸å—ä¹‹å‰å…ƒç´ çš„å½±å“ï¼›</p>
</li>
<li><p>æœ‰çŠ¶æ€ï¼šæŒ‡è¯¥æ“ä½œåªæœ‰æ‹¿åˆ°æ‰€æœ‰å…ƒç´ ä¹‹åæ‰èƒ½ç»§ç»­ä¸‹å»ã€‚</p>
</li>
<li><p>éçŸ­è·¯æ“ä½œï¼šæŒ‡å¿…é¡»å¤„ç†æ‰€æœ‰å…ƒç´ æ‰èƒ½å¾—åˆ°æœ€ç»ˆç»“æœï¼›</p>
</li>
<li><p>çŸ­è·¯æ“ä½œï¼šæŒ‡é‡åˆ°æŸäº›ç¬¦åˆæ¡ä»¶çš„å…ƒç´ å°±å¯ä»¥å¾—åˆ°æœ€ç»ˆç»“æœï¼Œå¦‚ A || Bï¼Œåªè¦Aä¸ºtrueï¼Œåˆ™æ— éœ€åˆ¤æ–­Bçš„ç»“æœã€‚</p>
</li>
</ul>
<h2 id="ä¸‰-ä½¿ç”¨"><a href="#ä¸‰-ä½¿ç”¨" class="headerlink" title="ä¸‰. ä½¿ç”¨"></a>ä¸‰. ä½¿ç”¨</h2><h3 id="1-æµçš„å¸¸ç”¨åˆ›å»ºæ–¹æ³•"><a href="#1-æµçš„å¸¸ç”¨åˆ›å»ºæ–¹æ³•" class="headerlink" title="1. æµçš„å¸¸ç”¨åˆ›å»ºæ–¹æ³•"></a>1. æµçš„å¸¸ç”¨åˆ›å»ºæ–¹æ³•</h3><h4 id="1-1-ä½¿ç”¨Collectionä¸‹çš„-stream-å’Œ-parallelStream-æ–¹æ³•"><a href="#1-1-ä½¿ç”¨Collectionä¸‹çš„-stream-å’Œ-parallelStream-æ–¹æ³•" class="headerlink" title="1.1 ä½¿ç”¨Collectionä¸‹çš„ stream() å’Œ parallelStream() æ–¹æ³•"></a>1.1 ä½¿ç”¨Collectionä¸‹çš„ <code>stream()</code> å’Œ <code>parallelStream()</code> æ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Collection.</span></span><br><span class="line"><span class="comment"> *            stream()</span></span><br><span class="line"><span class="comment"> *            parallelStream()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">method1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;----------method1----------&quot;</span>);</span><br><span class="line">    List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">    list.add(<span class="number">1</span>);</span><br><span class="line">    list.add(<span class="number">3</span>);</span><br><span class="line">    list.add(<span class="number">5</span>);</span><br><span class="line">    list.add(<span class="number">7</span>);</span><br><span class="line">    list.add(<span class="number">9</span>);</span><br><span class="line">    Stream&lt;Integer&gt; stream = list.stream();</span><br><span class="line">    Stream&lt;Integer&gt; parallelStream = list.parallelStream();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="1-2-ä½¿ç”¨Arraysä¸­çš„-stream-æ–¹æ³•ï¼Œå°†æ•°ç»„è½¬æˆæµ"><a href="#1-2-ä½¿ç”¨Arraysä¸­çš„-stream-æ–¹æ³•ï¼Œå°†æ•°ç»„è½¬æˆæµ" class="headerlink" title="1.2 ä½¿ç”¨Arraysä¸­çš„ stream() æ–¹æ³•ï¼Œå°†æ•°ç»„è½¬æˆæµ"></a>1.2 ä½¿ç”¨Arraysä¸­çš„ <code>stream()</code> æ–¹æ³•ï¼Œå°†æ•°ç»„è½¬æˆæµ</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Arrays.stream()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">method2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;----------method2----------&quot;</span>);</span><br><span class="line">    Double[] nums = <span class="keyword">new</span> Double[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        nums[i] = random();</span><br><span class="line">    &#125;</span><br><span class="line">    Stream&lt;Double&gt; stream = Arrays.stream(nums);</span><br><span class="line">    stream.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="1-3-ä½¿ç”¨Streamä¸­çš„é™æ€æ–¹æ³•-of-ã€iterate-ã€generate"><a href="#1-3-ä½¿ç”¨Streamä¸­çš„é™æ€æ–¹æ³•-of-ã€iterate-ã€generate" class="headerlink" title="1.3 ä½¿ç”¨Streamä¸­çš„é™æ€æ–¹æ³•: of()ã€iterate()ã€generate()"></a>1.3 ä½¿ç”¨Streamä¸­çš„é™æ€æ–¹æ³•: <code>of()</code>ã€<code>iterate()</code>ã€<code>generate()</code></h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Stream.</span></span><br><span class="line"><span class="comment"> *        of()</span></span><br><span class="line"><span class="comment"> *        iterate()</span></span><br><span class="line"><span class="comment"> *        generate()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">method3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;----------method3----------&quot;</span>);</span><br><span class="line">    Stream&lt;Integer&gt; stream1 = Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>);</span><br><span class="line">    stream1.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    Stream&lt;Integer&gt; stream2 = Stream.iterate(<span class="number">0</span>, (x) -&gt; x + <span class="number">1</span>).limit(<span class="number">6</span>);</span><br><span class="line">    stream2.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    Stream&lt;Double&gt; stream3 = Stream.generate(Math::random).limit(<span class="number">6</span>);</span><br><span class="line">    stream3.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="1-4-ä½¿ç”¨-BufferedReader-lines-æ–¹æ³•ï¼Œå°†æ¯è¡Œå†…å®¹è½¬æˆæµ"><a href="#1-4-ä½¿ç”¨-BufferedReader-lines-æ–¹æ³•ï¼Œå°†æ¯è¡Œå†…å®¹è½¬æˆæµ" class="headerlink" title="1.4 ä½¿ç”¨ BufferedReader.lines() æ–¹æ³•ï¼Œå°†æ¯è¡Œå†…å®¹è½¬æˆæµ"></a>1.4 ä½¿ç”¨ <code>BufferedReader.lines()</code> æ–¹æ³•ï¼Œå°†æ¯è¡Œå†…å®¹è½¬æˆæµ</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * BufferedReader.lines()</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">method4</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;----------method4----------&quot;</span>);</span><br><span class="line">    BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(<span class="string">&quot;D:/Java/Test/K1.txt&quot;</span>));</span><br><span class="line">    Stream&lt;String&gt; lines = reader.lines();</span><br><span class="line">    lines.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="1-5-ä½¿ç”¨-Pattern-splitAsStream-æ–¹æ³•ï¼Œå°†å­—ç¬¦ä¸²åˆ†éš”æˆæµ"><a href="#1-5-ä½¿ç”¨-Pattern-splitAsStream-æ–¹æ³•ï¼Œå°†å­—ç¬¦ä¸²åˆ†éš”æˆæµ" class="headerlink" title="1.5 ä½¿ç”¨ Pattern.splitAsStream() æ–¹æ³•ï¼Œå°†å­—ç¬¦ä¸²åˆ†éš”æˆæµ"></a>1.5 ä½¿ç”¨ <code>Pattern.splitAsStream()</code> æ–¹æ³•ï¼Œå°†å­—ç¬¦ä¸²åˆ†éš”æˆæµ</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Pattern.splitAsStream()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">method5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;----------method5----------&quot;</span>);</span><br><span class="line">    Pattern pattern = Pattern.compile(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">    Stream&lt;String&gt; stringStream = pattern.splitAsStream(<span class="string">&quot;K,H,I,G,H,N,E,S,S&quot;</span>);</span><br><span class="line">    stringStream.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-æµçš„ä¸­é—´æ“ä½œ"><a href="#2-æµçš„ä¸­é—´æ“ä½œ" class="headerlink" title="2. æµçš„ä¸­é—´æ“ä½œ"></a>2. æµçš„ä¸­é—´æ“ä½œ</h3><h4 id="2-1-ç­›é€‰ä¸åˆ‡ç‰‡"><a href="#2-1-ç­›é€‰ä¸åˆ‡ç‰‡" class="headerlink" title="2.1 ç­›é€‰ä¸åˆ‡ç‰‡"></a>2.1 ç­›é€‰ä¸åˆ‡ç‰‡</h4><ul>
<li>filter: è¿‡æ»¤æµä¸­çš„æŸäº›å…ƒç´ </li>
<li>limit: è·å–å‰nä¸ªå…ƒç´ </li>
<li>skip: è·³è¿‡å‰nä¸ªå…ƒç´ </li>
<li>limit + skip ==&gt; å¯ä»¥å®ç°åˆ†é¡µ[skip(PageNumber * PageSize).limit(PageSize)]</li>
<li>distinct: é€šè¿‡æµä¸­å…ƒç´ çš„hashCode()å’Œequals()å»é™¤é‡å¤å…ƒç´ </li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç­›é€‰ä¸åˆ‡ç‰‡</span></span><br><span class="line"><span class="comment"> * filter: è¿‡æ»¤æµä¸­çš„æŸäº›å…ƒç´ </span></span><br><span class="line"><span class="comment"> * limit: è·å–å‰nä¸ªå…ƒç´ </span></span><br><span class="line"><span class="comment"> * skip: è·³è¿‡å‰nä¸ªå…ƒç´ </span></span><br><span class="line"><span class="comment"> * limit + skip ==&gt; å¯ä»¥å®ç°åˆ†é¡µ[skip(PageNumber * PageSize).limit(PageSize)]</span></span><br><span class="line"><span class="comment"> * distinct: é€šè¿‡æµä¸­å…ƒç´ çš„hashCode()å’Œequals()å»é™¤é‡å¤å…ƒç´ </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">method1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;----------method1----------&quot;</span>);</span><br><span class="line">    List&lt;Integer&gt; list = Arrays.asList( <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">                                        <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>,</span><br><span class="line">                                        <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>,</span><br><span class="line">                                        <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>,</span><br><span class="line">                                        <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>,</span><br><span class="line">                                        <span class="number">6</span>, <span class="number">6</span>, <span class="number">6</span>,</span><br><span class="line">                                        <span class="number">7</span>, <span class="number">7</span>, <span class="number">7</span>,</span><br><span class="line">                                        <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>,</span><br><span class="line">                                        <span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;----------è¿‡æ»¤å¤§äº5çš„å…ƒç´ ----------&quot;</span>);</span><br><span class="line">    Stream&lt;Integer&gt; stream1 = list.stream().filter(x -&gt; x &lt;= <span class="number">5</span>);</span><br><span class="line">    stream1.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;----------åˆ†é¡µæŸ¥è¯¢/5/3----------&quot;</span>);</span><br><span class="line">    Stream&lt;Integer&gt; stream2 = list.stream().skip(<span class="number">5</span> * <span class="number">3</span>).limit(<span class="number">3</span>);</span><br><span class="line">    stream2.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;----------å»æ‰é‡å¤å…ƒç´ ----------&quot;</span>);</span><br><span class="line">    Stream stream3 = list.stream().distinct();</span><br><span class="line">    stream3.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="2-2-æ˜ å°„"><a href="#2-2-æ˜ å°„" class="headerlink" title="2.2 æ˜ å°„"></a>2.2 æ˜ å°„</h4><ul>
<li>map: æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°ä¼šè¢«åº”ç”¨åˆ°æ¯ä¸ªå…ƒç´ ä¸Šï¼Œå¹¶å°†å…¶æ˜ å°„æˆä¸€ä¸ªæ–°çš„å…ƒç´ </li>
<li>flatMap: æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå°†æµä¸­çš„æ¯ä¸ªå€¼éƒ½æ¢æˆå¦ä¸€ä¸ªæµï¼Œç„¶åæŠŠæ‰€æœ‰æµè¿æ¥æˆä¸€ä¸ªæµ<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ˜ å°„</span></span><br><span class="line"><span class="comment"> * map: æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°ä¼šè¢«åº”ç”¨åˆ°æ¯ä¸ªå…ƒç´ ä¸Šï¼Œå¹¶å°†å…¶æ˜ å°„æˆä¸€ä¸ªæ–°çš„å…ƒç´ </span></span><br><span class="line"><span class="comment"> * flatMap: æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå°†æµä¸­çš„æ¯ä¸ªå€¼éƒ½æ¢æˆå¦ä¸€ä¸ªæµï¼Œç„¶åæŠŠæ‰€æœ‰æµè¿æ¥æˆä¸€ä¸ªæµ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">method2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;----------method2----------&quot;</span>);</span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; list = Arrays.asList(<span class="string">&quot;A,B,C&quot;</span>, <span class="string">&quot;1,2,3&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Stream&lt;String&gt; stringStream1 = list.stream().map( x -&gt; x.replaceAll(<span class="string">&quot;,&quot;</span>, <span class="string">&quot;|&quot;</span>));</span><br><span class="line">    stringStream1.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    Stream&lt;String&gt; stringStream2 = list.stream().flatMap( x -&gt;&#123;</span><br><span class="line">        String[] split = x.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        Stream&lt;String&gt; stringStream = Arrays.stream(split);</span><br><span class="line">        <span class="keyword">return</span> stringStream;</span><br><span class="line">    &#125;);</span><br><span class="line">    stringStream2.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h4 id="2-3-æ’åº"><a href="#2-3-æ’åº" class="headerlink" title="2.3 æ’åº"></a>2.3 æ’åº</h4><ul>
<li>sorted(): è‡ªç„¶æ’åºï¼Œæµä¸­å…ƒç´ éœ€è¦å®ç°Comparableæ¥å£</li>
<li>sorted(Comparator c): è‡ªå®šä¹‰æ’åºï¼Œè‡ªå®šä¹‰Comparatoræ’åºå™¨<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ’åº</span></span><br><span class="line"><span class="comment"> * sorted(): è‡ªç„¶æ’åºï¼Œæµä¸­å…ƒç´ éœ€è¦å®ç°Comparableæ¥å£</span></span><br><span class="line"><span class="comment"> * sorted(Comparator c): è‡ªå®šä¹‰æ’åºï¼Œè‡ªå®šä¹‰Comparatoræ’åºå™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">method3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;----------method3----------&quot;</span>);</span><br><span class="line"></span><br><span class="line">    List&lt;Integer&gt; integers = Arrays.asList(<span class="number">1</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">2</span>);</span><br><span class="line">    integers.stream().sorted().forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; strings = Arrays.asList(<span class="string">&quot;K&quot;</span>, <span class="string">&quot;H&quot;</span>, <span class="string">&quot;I&quot;</span>, <span class="string">&quot;G&quot;</span>, <span class="string">&quot;H&quot;</span>, <span class="string">&quot;N&quot;</span>, <span class="string">&quot;E&quot;</span>, <span class="string">&quot;S&quot;</span>, <span class="string">&quot;S&quot;</span>);</span><br><span class="line">    strings.stream().sorted(</span><br><span class="line">            (s1, s2) -&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span> s1.compareTo(s2);</span><br><span class="line">            &#125;</span><br><span class="line">    ).forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="meta">@AllArgsConstructor</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">        String name;</span><br><span class="line">        <span class="keyword">int</span> score; </span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;Student&gt; students = Arrays.asList( <span class="keyword">new</span> Student(<span class="string">&quot;K&quot;</span>, <span class="number">100</span>),</span><br><span class="line">                                            <span class="keyword">new</span> Student(<span class="string">&quot;H&quot;</span>, <span class="number">91</span>),</span><br><span class="line">                                            <span class="keyword">new</span> Student(<span class="string">&quot;I&quot;</span>, <span class="number">95</span>),</span><br><span class="line">                                            <span class="keyword">new</span> Student(<span class="string">&quot;G&quot;</span>, <span class="number">98</span>),</span><br><span class="line">                                            <span class="keyword">new</span> Student(<span class="string">&quot;N&quot;</span>, <span class="number">88</span>));</span><br><span class="line">    students.stream().sorted(</span><br><span class="line">            (s1, s2) -&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span> s1.score - s2.score;</span><br><span class="line">            &#125;</span><br><span class="line">    ).forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h4 id="2-4-æ¶ˆè´¹"><a href="#2-4-æ¶ˆè´¹" class="headerlink" title="2.4 æ¶ˆè´¹"></a>2.4 æ¶ˆè´¹</h4><p>peek: ç±»ä¼¼map<br>ä¸åŒï¼š</p>
<ul>
<li>mapæ¥æ”¶functionè¡¨è¾¾å¼ï¼Œæœ‰è¿”å›å€¼</li>
<li>peekæ¥æ”¶consumerè¡¨è¾¾å¼ï¼Œæ— è¿”å›å€¼<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¶ˆè´¹</span></span><br><span class="line"><span class="comment"> * peek: ç±»ä¼¼map</span></span><br><span class="line"><span class="comment"> * ä¸åŒï¼š</span></span><br><span class="line"><span class="comment"> * mapæ¥æ”¶functionè¡¨è¾¾å¼ï¼Œæœ‰è¿”å›å€¼</span></span><br><span class="line"><span class="comment"> * peekæ¥æ”¶consumerè¡¨è¾¾å¼ï¼Œæ— è¿”å›å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">method4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;----------method4----------&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="meta">@AllArgsConstructor</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">        String name;</span><br><span class="line">        <span class="keyword">int</span> score;</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;Student&gt; students = Arrays.asList( <span class="keyword">new</span> Student(<span class="string">&quot;K&quot;</span>, <span class="number">100</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;H&quot;</span>, <span class="number">91</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;I&quot;</span>, <span class="number">95</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;G&quot;</span>, <span class="number">98</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;N&quot;</span>, <span class="number">88</span>));</span><br><span class="line">    students.stream().peek(</span><br><span class="line">            s -&gt; &#123;</span><br><span class="line">                s.setScore(<span class="number">99</span>);</span><br><span class="line">            &#125;</span><br><span class="line">    ).forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h3 id="3-æµçš„ç»ˆæ­¢æ“ä½œ"><a href="#3-æµçš„ç»ˆæ­¢æ“ä½œ" class="headerlink" title="3. æµçš„ç»ˆæ­¢æ“ä½œ"></a>3. æµçš„ç»ˆæ­¢æ“ä½œ</h3><h4 id="3-1-åŒ¹é…ã€èšåˆæ“ä½œ"><a href="#3-1-åŒ¹é…ã€èšåˆæ“ä½œ" class="headerlink" title="3.1 åŒ¹é…ã€èšåˆæ“ä½œ"></a>3.1 åŒ¹é…ã€èšåˆæ“ä½œ</h4><ul>
<li>allMatch: æ¥æ”¶ä¸€ä¸ªPredicateå‡½æ•°ï¼Œå½“æµä¸­æ¯ä¸ªå…ƒç´ éƒ½ç¬¦åˆè¯¥æ–­è¨€æ—¶æ‰è¿”å›trueï¼Œå¦åˆ™è¿”å›false</li>
<li>noneMatch: æ¥æ”¶ä¸€ä¸ªPredicateå‡½æ•°ï¼Œå½“æµä¸­æ¯ä¸ªå…ƒç´ éƒ½ä¸ç¬¦åˆè¯¥æ–­è¨€æ—¶æ‰è¿”å›trueï¼Œå¦åˆ™è¿”å›false</li>
<li>anyMatch: æ¥æ”¶ä¸€ä¸ªPredicateå‡½æ•°ï¼Œåªè¦æµä¸­æœ‰ä¸€ä¸ªå…ƒç´ æ»¡è¶³è¯¥æ–­è¨€åˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›false</li>
<li>findFIrst: è¿”å›æµä¸­ç¬¬ä¸€ä¸ªå…ƒç´ </li>
<li>findAny: è¿”å›æµä¸­çš„ä»»æ„å…ƒç´ </li>
<li>count: è¿”å›æµä¸­å…ƒç´ æ€»ä¸ªæ•°</li>
<li>max: è¿”å›æµä¸­å…ƒç´ çš„æœ€å¤§å€¼</li>
<li>min: è¿”å›æµä¸­å…ƒç´ çš„æœ€å°å€¼</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">method1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;----------method1----------&quot;</span>);</span><br><span class="line">    List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">boolean</span> allMatch = list.stream().anyMatch(e -&gt; e &gt; <span class="number">10</span>);    <span class="comment">// false</span></span><br><span class="line">    <span class="keyword">boolean</span> noneMatch = list.stream().noneMatch(e -&gt; e &gt; <span class="number">10</span>);  <span class="comment">// true</span></span><br><span class="line">    <span class="keyword">boolean</span> anyMatch = list.stream().anyMatch(e -&gt; e &gt; <span class="number">4</span>);     <span class="comment">// true</span></span><br><span class="line">    System.out.println(allMatch + <span class="string">&quot; &quot;</span> + noneMatch + <span class="string">&quot; &quot;</span> + anyMatch);</span><br><span class="line"></span><br><span class="line">    Integer findFirst = list.stream().findFirst().get();</span><br><span class="line">    Integer findAny = list.stream().findAny().get();</span><br><span class="line">    System.out.println(<span class="string">&quot;first = &quot;</span> + findFirst + <span class="string">&quot;, any = &quot;</span> + findAny);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">long</span> count = list.stream().count();</span><br><span class="line">    Integer max = list.stream().max(Integer::compareTo).get();</span><br><span class="line">    Integer min = list.stream().min(Integer::compareTo).get();</span><br><span class="line">    System.out.println(<span class="string">&quot;count = &quot;</span> + count + <span class="string">&quot;, max = &quot;</span> + max + <span class="string">&quot;, min = &quot;</span> + min);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h4 id="3-2-è§„çº¦æ“ä½œ"><a href="#3-2-è§„çº¦æ“ä½œ" class="headerlink" title="3.2 è§„çº¦æ“ä½œ"></a>3.2 è§„çº¦æ“ä½œ</h4><p>Optional&lt;T&gt; reduce(BinaryOperator&lt;T&gt; accumulator)ï¼šç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶ï¼Œaccumulatorå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæµä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæµä¸­å…ƒç´ çš„ç¬¬äºŒä¸ªå…ƒç´ ï¼›ç¬¬äºŒæ¬¡æ‰§è¡Œæ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç¬¬ä¸€æ¬¡å‡½æ•°æ‰§è¡Œçš„ç»“æœï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæµä¸­çš„ç¬¬ä¸‰ä¸ªå…ƒç´ ï¼›ä¾æ¬¡ç±»æ¨ã€‚<br>     T reduce(T identity, BinaryOperator&lt;T&gt; accumulator)ï¼šæµç¨‹è·Ÿä¸Šé¢ä¸€æ ·ï¼Œåªæ˜¯ç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶ï¼Œaccumulatorå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºidentityï¼Œè€Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæµä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚<br>     &lt;U&gt; U reduce(U identity,BiFunction&lt;U, ? super T, U&gt; accumulator,BinaryOperator&lt;U&gt; combiner)ï¼šåœ¨ä¸²è¡Œæµ(stream)ä¸­ï¼Œè¯¥æ–¹æ³•è·Ÿç¬¬äºŒä¸ªæ–¹æ³•ä¸€æ ·ï¼Œå³ç¬¬ä¸‰ä¸ªå‚æ•°combinerä¸ä¼šèµ·ä½œç”¨ã€‚åœ¨å¹¶è¡Œæµ(parallelStream)ä¸­,æˆ‘ä»¬çŸ¥é“æµè¢«fork joinå‡ºå¤šä¸ªçº¿ç¨‹è¿›è¡Œæ‰§è¡Œï¼Œæ­¤æ—¶æ¯ä¸ªçº¿ç¨‹çš„æ‰§è¡Œæµç¨‹å°±è·Ÿç¬¬äºŒä¸ªæ–¹æ³•reduce(identity,accumulator)ä¸€æ ·ï¼Œè€Œç¬¬ä¸‰ä¸ªå‚æ•°combinerå‡½æ•°ï¼Œåˆ™æ˜¯å°†æ¯ä¸ªçº¿ç¨‹çš„æ‰§è¡Œç»“æœå½“æˆä¸€ä¸ªæ–°çš„æµï¼Œç„¶åä½¿ç”¨ç¬¬ä¸€ä¸ªæ–¹æ³•reduce(accumulator)æµç¨‹è¿›è¡Œè§„çº¦ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è§„çº¦</span></span><br><span class="line"><span class="comment"> * reduce</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">method2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;----------method2----------&quot;</span>);</span><br><span class="line">    List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ±‚å’Œ</span></span><br><span class="line">    Integer v = list.stream().reduce(<span class="number">0</span>, (x1, x2) -&gt; x1 + x2);</span><br><span class="line">    System.out.println(<span class="string">&quot;sum = &quot;</span>  + v);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 10 + å’Œ</span></span><br><span class="line">    Integer v1 = list.stream().reduce(<span class="number">10</span>, (x1, x2) -&gt; x1 + x2);</span><br><span class="line">    System.out.println(<span class="string">&quot;10 + sum = &quot;</span> + v1);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ±‚-å’Œ</span></span><br><span class="line">    Integer v2 = list.stream().reduce(<span class="number">0</span>,</span><br><span class="line">            (x1, x2) -&gt; &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;stream accumulator: x1: &quot;</span> + x1 + <span class="string">&quot; x2: &quot;</span> + x2);</span><br><span class="line">                <span class="keyword">return</span> x1 - x2;</span><br><span class="line">            &#125;</span><br><span class="line">            );</span><br><span class="line">    System.out.println(v2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ±‚ç´¯ç§¯</span></span><br><span class="line">    Integer v3 = list.stream().reduce(<span class="number">1</span>,</span><br><span class="line">            (x1, x2) -&gt; &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;stream combiner: x1:&quot;</span> + x1 + <span class="string">&quot;  x2:&quot;</span> + x2);</span><br><span class="line">                <span class="keyword">return</span> x1 * x2;</span><br><span class="line">            &#125;</span><br><span class="line">     );</span><br><span class="line">    System.out.println(v3);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å­—ç¬¦ä¸²æ‹¼æ¥</span></span><br><span class="line">    List&lt;String&gt; list1 = Arrays.asList(<span class="string">&quot;K&quot;</span>, <span class="string">&quot;Highness&quot;</span>, <span class="string">&quot;. Nice &quot;</span>, <span class="string">&quot;to &quot;</span>, <span class="string">&quot;meet &quot;</span>, <span class="string">&quot;you&quot;</span>);</span><br><span class="line">    String res = list1.stream().reduce(<span class="string">&quot;Hello &quot;</span>, (c1, c2) -&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> c1 + c2;</span><br><span class="line">    &#125;);</span><br><span class="line">    System.out.println(res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h4 id="3-3-æ”¶é›†æ“ä½œ"><a href="#3-3-æ”¶é›†æ“ä½œ" class="headerlink" title="3.3 æ”¶é›†æ“ä½œ"></a>3.3 æ”¶é›†æ“ä½œ</h4><p> collectï¼šæ¥æ”¶ä¸€ä¸ªCollectorå®ä¾‹ï¼Œå°†æµä¸­å…ƒç´ æ”¶é›†æˆå¦å¤–ä¸€ä¸ªæ•°æ®ç»“æ„ã€‚</p>
<p>Collector&lt;T, A, R&gt; æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæœ‰ä»¥ä¸‹5ä¸ªæŠ½è±¡æ–¹æ³•ï¼š<br>       Supplier&lt;A&gt; supplier()ï¼šåˆ›å»ºä¸€ä¸ªç»“æœå®¹å™¨A<br>       BiConsumer&lt;A, T&gt; accumulator()ï¼šæ¶ˆè´¹å‹æ¥å£ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå®¹å™¨Aï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæµä¸­å…ƒç´ Tã€‚<br>       BinaryOperator&lt;A&gt; combiner()ï¼šå‡½æ•°æ¥å£ï¼Œè¯¥å‚æ•°çš„ä½œç”¨è·Ÿä¸Šä¸€ä¸ªæ–¹æ³•(reduce)ä¸­çš„combinerå‚æ•°ä¸€æ ·ï¼Œå°†å¹¶è¡Œæµä¸­å„ä¸ªå­è¿›ç¨‹çš„è¿è¡Œç»“æœ(accumulatorå‡½æ•°æ“ä½œåçš„å®¹å™¨A)è¿›è¡Œåˆå¹¶ã€‚<br>       Function&lt;A, R&gt; finisher()ï¼šå‡½æ•°å¼æ¥å£ï¼Œå‚æ•°ä¸ºï¼šå®¹å™¨Aï¼Œè¿”å›ç±»å‹ä¸ºï¼šcollectæ–¹æ³•æœ€ç»ˆæƒ³è¦çš„ç»“æœRã€‚<br>       Set&lt;Characteristics&gt; characteristics()ï¼šè¿”å›ä¸€ä¸ªä¸å¯å˜çš„Seté›†åˆï¼Œç”¨æ¥è¡¨æ˜è¯¥Collectorçš„ç‰¹å¾ã€‚æœ‰ä»¥ä¸‹ä¸‰ä¸ªç‰¹å¾ï¼š<br>         CONCURRENTï¼šè¡¨ç¤ºæ­¤æ”¶é›†å™¨æ”¯æŒå¹¶å‘ã€‚ï¼ˆå®˜æ–¹æ–‡æ¡£è¿˜æœ‰å…¶ä»–æè¿°ï¼Œæš‚æ—¶æ²¡å»æ¢ç´¢ï¼Œæ•…ä¸ä½œè¿‡å¤šç¿»è¯‘ï¼‰<br>         UNORDEREDï¼šè¡¨ç¤ºè¯¥æ”¶é›†æ“ä½œä¸ä¼šä¿ç•™æµä¸­å…ƒç´ åŸæœ‰çš„é¡ºåºã€‚<br>         IDENTITY_FINISHï¼šè¡¨ç¤ºfinisherå‚æ•°åªæ˜¯æ ‡è¯†è€Œå·²ï¼Œå¯å¿½ç•¥ã€‚</p>
]]></content>
      <categories>
        <category>-Stream</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>åä¸€æœˆçš„è‚–é‚¦</title>
    <url>/2020/03/21/Khighness/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>
        <div id="aplayer-EznHxCEE" class="aplayer aplayer-tag-marker" style="margin-bottom: 20px;">
            <pre class="aplayer-lrc-content">é€†é³ - å‘¨æ°ä¼¦ (Jay Chou)
è¯ï¼šé»„ä¿Šéƒ
æ›²ï¼šå‘¨æ°ä¼¦
è€Œç”Ÿå‘½ å¯¹æ¯ä¸ªäºº
éƒ½ä¸å…¬å¹³ ä¹Ÿæ²¡é“ç†
åªèƒ½æ‰‘å‘ æ³¥æ³è¿å‘
é‚£é˜µéª¤é›¨ ç”±ä¸å¾—ä½ 
Yeah
çªæ¥çš„éª¤é›¨
è¿™æ¡è¡—ä¸€è·¯æ³¥æ³
å°±åƒäººç”Ÿ
ä¸è¿‡æ˜¯ä¸€åœºå³å…´
æ•´ä¸ªä¸–ç•Œ
æ­£åœ¨å¯¹æˆ‘ä»¬æŒ‘è¡…
å°±ç®—å¦‚æ­¤
è¿˜æ˜¯å¾—æ— æƒ§å‰è¿›
æ‰‹ä¸­çš„é‚®æŠ¥
å°é¢çš„äººåœ¨å¾®ç¬‘
ä¸‹ä¸ªè·¯å£
ç”Ÿå‘½åœ¨æš—å··å°–å«
æ´»ç€åªæ˜¯
æ²¹å¢¨ä¸Šé¢çš„ä¸€è§’
æ˜å¤©ä¹‹å
è¿˜æœ‰è°ç¿»é˜…å¾—å¾—åˆ°
æˆ‘è·Ÿä½ ç”¨ä¸åŒæ–¹å¼
è¸©è¿‡å‰æ–¹å¸¦åˆºè†æ£˜
ä½ åš£å¼ ä¸ç•æƒ§é€€ç¼©
æˆ‘ä½å¤´æ²‰é»˜å´åšå®š
ç”¨åŠ›çš„è¿˜å‡» å‘å‡ºå£°éŸ³
è®©ä»–ä»¬å®‰é™ä¸æ•¢ç›¸ä¿¡
ç»§ç»­å‰è¿›
ä»–ä»¬ç•æƒ§ çå¤§çœ¼ç›
ä»–ä»¬èº²é¿ éš¾é“æ”¾å¼ƒ
ä¸“å¿ƒè†å¬ æˆ‘çš„å£°éŸ³
è¿™ç”Ÿå‘½ å¯¹æ¯ä¸ªäºº
éƒ½ä¸å…¬å¹³ ä¹Ÿæ²¡é“ç†
åªèƒ½æ‰‘å‘ æ³¥æ³è¿å‘
é‚£é˜µéª¤é›¨ ç”±ä¸å¾—ä½ 
å¦‚æœç”Ÿå‘½ å¯¹æ¯ä¸ªäºº
éƒ½ä¸å…¬å¹³ ä¹Ÿæ²¡é“ç†
é‚£å°±è®©æˆ‘ å¸¦ç€å­¤å¯‚
ç»§ç»­å‰è¿› ç›´åˆ°å…‰æ˜
Wo wo
æˆ‘åªæœ‰ä¸€ç§å®¹è²Œ
æˆ‘å°±æ˜¯æ°¸è¿œä¸ä¼šå€’
æˆ‘å°±ç®—é€†å¢ƒç¯ç»•
æˆ‘é¢å¯¹ä¹Ÿè¦å¸¦ç€ç¬‘
æˆ‘åªæœ‰ä¸€ç§å’†å“®
æˆ‘è¦è®©ä»–ä»¬éƒ½çŸ¥é“
æˆ‘ç”Ÿå‘½å†æ€ä¹ˆç²—ç³™
æˆ‘éƒ½è¦æ´»çš„å¾ˆéª„å‚²
æˆ‘è¯´è‡ªå°Šé‚£
çœ‹èµ·æ¥æˆ–è®¸å¯ç¬‘
ä½†å®ƒè‡³å°‘æ”¯ç€æˆ‘
è¯•ç€ä¸è®©æˆ‘è·Œå€’
æ´»ç€å¦‚æœåªæ˜¯ä¸ç”˜å¯‚é™çš„å–§åš£
é‚£å°±å’†å“®å§
è®©æ¯ä¸ªäººéƒ½èƒ½å¬å¾—åˆ°
ç”¨åŠ›çš„è¿˜å‡»
å‘å‡ºå£°éŸ³
è®©ä»–ä»¬å®‰é™ä¸æ•¢ç›¸ä¿¡
ç»§ç»­å‰è¿›
ä»–ä»¬ç•æƒ§ çå¤§çœ¼ç›
ä»–ä»¬èº²é¿ éš¾é“æ”¾å¼ƒ
ä¸“å¿ƒè†å¬ æˆ‘çš„å£°éŸ³
è¿™ç”Ÿå‘½ å¯¹æ¯ä¸ªäºº
éƒ½ä¸å…¬å¹³ ä¹Ÿæ²¡é“ç†
åªèƒ½æ‰‘å‘ æ³¥æ³è¿å‘
é‚£é˜µéª¤é›¨ ç”±ä¸å¾—ä½ 
å¦‚æœç”Ÿå‘½ å¯¹æ¯ä¸ªäºº
éƒ½ä¸å…¬å¹³ ä¹Ÿæ²¡é“ç†
é‚£å°±è®©æˆ‘ å¸¦ç€å­¤å¯‚
ç»§ç»­å‰è¿› ç›´åˆ°å…‰æ˜
è€Œç”Ÿå‘½ å¯¹æ¯ä¸ªäºº
éƒ½ä¸å…¬å¹³ ä¹Ÿæ²¡é“ç†
åªèƒ½æ‰‘å‘ æ³¥æ³è¿å‘
é‚£é˜µéª¤é›¨ ç”±ä¸å¾—ä½ 
å¦‚æœç”Ÿå‘½ å¯¹æ¯ä¸ªäºº
éƒ½ä¸å…¬å¹³ ä¹Ÿæ²¡é“ç†
é‚£å°±è®©æˆ‘ å¸¦ç€å­¤å¯‚
ç»§ç»­å‰è¿› ç›´åˆ°å…‰æ˜
è¿™ç”Ÿå‘½ å¯¹æ¯ä¸ªäºº
éƒ½ä¸å…¬å¹³ ä¹Ÿæ²¡é“ç†
åªèƒ½æ‰‘å‘ æ³¥æ³è¿å‘
é‚£é˜µéª¤é›¨ ç”±ä¸å¾—ä½ 
å¦‚æœç”Ÿå‘½ å¯¹æ¯ä¸ªäºº
éƒ½ä¸å…¬å¹³ ä¹Ÿæ²¡é“ç†
é‚£å°±è®©æˆ‘ å¸¦ç€å­¤å¯‚
ç»§ç»­å‰è¿›</pre>
        </div>
        <script>
          var ap = new APlayer({
            element: document.getElementById("aplayer-EznHxCEE"),
            narrow: false,
            autoplay: false,
            showlrc: 2,
            music: {
              title: "é€†é³",
              author: "å‘¨æ°ä¼¦",
              url: "é€†é³.ogg",
              pic: "/2020/03/21/Khighness/XB.jpg",
              lrc: "é€†é³.txt"
            }
          });
          window.aplayers || (window.aplayers = []);
          window.aplayers.push(ap);
        </script>



<center>
<p>é€†é³ - å‘¨æ°ä¼¦ (Jay Chou)</p>
<P>è¯ï¼šé»„ä¿Šéƒ</P>
<p>æ›²ï¼šå‘¨æ°ä¼¦</p>
<p>è€Œç”Ÿå‘½ å¯¹æ¯ä¸ªäºº
<p>éƒ½ä¸å…¬å¹³ ä¹Ÿæ²¡é“ç†
<p>åªèƒ½æ‰‘å‘ æ³¥æ³è¿å‘
<p>é‚£é˜µéª¤é›¨ ç”±ä¸å¾—ä½ 
<p>Yeah
<p>çªæ¥çš„éª¤é›¨
<p>è¿™æ¡è¡—ä¸€è·¯æ³¥æ³
<p>å°±åƒäººç”Ÿ
<p>ä¸è¿‡æ˜¯ä¸€åœºå³å…´
<p>æ•´ä¸ªä¸–ç•Œ
<p>æ­£åœ¨å¯¹æˆ‘ä»¬æŒ‘è¡…
<p>å°±ç®—å¦‚æ­¤
<p>è¿˜æ˜¯å¾—æ— æƒ§å‰è¿›
<p>æ‰‹ä¸­çš„é‚®æŠ¥
<p>å°é¢çš„äººåœ¨å¾®ç¬‘
<p>ä¸‹ä¸ªè·¯å£
<p>ç”Ÿå‘½åœ¨æš—å··å°–å«
<p>æ´»ç€åªæ˜¯
<p>æ²¹å¢¨ä¸Šé¢çš„ä¸€è§’
<p>æ˜å¤©ä¹‹å
<p>è¿˜æœ‰è°ç¿»é˜…å¾—å¾—åˆ°
<p>æˆ‘è·Ÿä½ ç”¨ä¸åŒæ–¹å¼
<p>è¸©è¿‡å‰æ–¹å¸¦åˆºè†æ£˜
<p>ä½ åš£å¼ ä¸ç•æƒ§é€€ç¼©
<p>æˆ‘ä½å¤´æ²‰é»˜å´åšå®š
<p>ç”¨åŠ›çš„è¿˜å‡» å‘å‡ºå£°éŸ³
<p>è®©ä»–ä»¬å®‰é™ä¸æ•¢ç›¸ä¿¡
<p>ç»§ç»­å‰è¿›
<p>ä»–ä»¬ç•æƒ§ çå¤§çœ¼ç›
<p>ä»–ä»¬èº²é¿ éš¾é“æ”¾å¼ƒ
<p>ä¸“å¿ƒè†å¬ æˆ‘çš„å£°éŸ³
<p>è¿™ç”Ÿå‘½ å¯¹æ¯ä¸ªäºº
<p>éƒ½ä¸å…¬å¹³ ä¹Ÿæ²¡é“ç†
<p>åªèƒ½æ‰‘å‘ æ³¥æ³è¿å‘
<p>é‚£é˜µéª¤é›¨ ç”±ä¸å¾—ä½ 
<p>å¦‚æœç”Ÿå‘½ å¯¹æ¯ä¸ªäºº
<p>éƒ½ä¸å…¬å¹³ ä¹Ÿæ²¡é“ç†
<p>é‚£å°±è®©æˆ‘ å¸¦ç€å­¤å¯‚
<p>ç»§ç»­å‰è¿› ç›´åˆ°å…‰æ˜
<p>Wo wo
<p>æˆ‘åªæœ‰ä¸€ç§å®¹è²Œ
<p>æˆ‘å°±æ˜¯æ°¸è¿œä¸ä¼šå€’
<p>æˆ‘å°±ç®—é€†å¢ƒç¯ç»•
<p>æˆ‘é¢å¯¹ä¹Ÿè¦å¸¦ç€ç¬‘
<p>æˆ‘åªæœ‰ä¸€ç§å’†å“®
<p>æˆ‘è¦è®©ä»–ä»¬éƒ½çŸ¥é“
<p>æˆ‘ç”Ÿå‘½å†æ€ä¹ˆç²—ç³™
<p>æˆ‘éƒ½è¦æ´»çš„å¾ˆéª„å‚²
<p>æˆ‘è¯´è‡ªå°Šé‚£
<p>çœ‹èµ·æ¥æˆ–è®¸å¯ç¬‘
<p>ä½†å®ƒè‡³å°‘æ”¯ç€æˆ‘
<p>è¯•ç€ä¸è®©æˆ‘è·Œå€’
<p>æ´»ç€å¦‚æœåªæ˜¯ä¸ç”˜å¯‚é™çš„å–§åš£
<p>é‚£å°±å’†å“®å§
<p>è®©æ¯ä¸ªäººéƒ½èƒ½å¬å¾—åˆ°
<p>ç”¨åŠ›çš„è¿˜å‡»
<p>å‘å‡ºå£°éŸ³
<p>è®©ä»–ä»¬å®‰é™ä¸æ•¢ç›¸ä¿¡
<p>ç»§ç»­å‰è¿›
<p>ä»–ä»¬ç•æƒ§ çå¤§çœ¼ç›
<p>ä»–ä»¬èº²é¿ éš¾é“æ”¾å¼ƒ
<p>ä¸“å¿ƒè†å¬ æˆ‘çš„å£°éŸ³
<p>è¿™ç”Ÿå‘½ å¯¹æ¯ä¸ªäºº
<p>éƒ½ä¸å…¬å¹³ ä¹Ÿæ²¡é“ç†
<p>åªèƒ½æ‰‘å‘ æ³¥æ³è¿å‘
<p>é‚£é˜µéª¤é›¨ ç”±ä¸å¾—ä½ 
<p>å¦‚æœç”Ÿå‘½ å¯¹æ¯ä¸ªäºº
<p>éƒ½ä¸å…¬å¹³ ä¹Ÿæ²¡é“ç†
<p>é‚£å°±è®©æˆ‘ å¸¦ç€å­¤å¯‚
<p>ç»§ç»­å‰è¿› ç›´åˆ°å…‰æ˜
<p>è€Œç”Ÿå‘½ å¯¹æ¯ä¸ªäºº
<p>éƒ½ä¸å…¬å¹³ ä¹Ÿæ²¡é“ç†
<p>åªèƒ½æ‰‘å‘ æ³¥æ³è¿å‘
<p>é‚£é˜µéª¤é›¨ ç”±ä¸å¾—ä½ 
<p>å¦‚æœç”Ÿå‘½ å¯¹æ¯ä¸ªäºº
<p>éƒ½ä¸å…¬å¹³ ä¹Ÿæ²¡é“ç†
<p>é‚£å°±è®©æˆ‘ å¸¦ç€å­¤å¯‚
<p>ç»§ç»­å‰è¿› ç›´åˆ°å…‰æ˜
<p>è¿™ç”Ÿå‘½ å¯¹æ¯ä¸ªäºº
<p>éƒ½ä¸å…¬å¹³ ä¹Ÿæ²¡é“ç†
<p>åªèƒ½æ‰‘å‘ æ³¥æ³è¿å‘
<p>é‚£é˜µéª¤é›¨ ç”±ä¸å¾—ä½ 
<p>å¦‚æœç”Ÿå‘½ å¯¹æ¯ä¸ªäºº
<p>éƒ½ä¸å…¬å¹³ ä¹Ÿæ²¡é“ç†
<p>é‚£å°±è®©æˆ‘ å¸¦ç€å­¤å¯‚
<p>ç»§ç»­å‰è¿›
</center>











]]></content>
      <categories>
        <category>Jay</category>
      </categories>
      <tags>
        <tag>é€†é³</tag>
      </tags>
  </entry>
  <entry>
    <title>å¶æƒ ç¾</title>
    <url>/2020/10/13/Yehuimei/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script>
        <div id="aplayer-QLrcrIEh" class="aplayer aplayer-tag-marker" style="margin-bottom: 20px;"></div>
			  <script>
				  var options = {"narrow":false,"autoplay":false,"showlrc":1,"mode":"oredr","mutex":true,"theme":"#e6d0b2","preload":"metadata","listmaxheight":"513px","music":[{"title":"ä»¥çˆ¶ä¹‹å","author":"å‘¨æ°ä¼¦","url":"/2020/10/13/Yehuimei/ä»¥çˆ¶ä¹‹å.ogg","pic":"/2020/10/13/Yehuimei/YHM.jpg","lrc":"ä»¥çˆ¶ä¹‹å.txt"},{"title":"æ‡¦å¤«","author":"å‘¨æ°ä¼¦","url":"/2020/10/13/Yehuimei/æ‡¦å¤«.ogg","pic":"/2020/10/13/Yehuimei/YHM.jpg","lrc":"æ‡¦å¤«.txt"},{"title":"æ™´å¤©","author":"å‘¨æ°ä¼¦","url":"/2020/10/13/Yehuimei/æ™´å¤©.flac","pic":"/2020/10/13/Yehuimei/YHM.jpg","lrc":"æ™´å¤©.txt"},{"title":"ä¸‰å¹´äºŒç­","author":"å‘¨æ°ä¼¦","url":"/2020/10/13/Yehuimei/ä¸‰å¹´äºŒç­.ogg","pic":"/2020/10/13/Yehuimei/YHM.jpg","lrc":"ä¸‰å¹´äºŒç­.txt"},{"title":"ä¸œé£ç ´","author":"å‘¨æ°ä¼¦","url":"/2020/10/13/Yehuimei/ä¸œé£ç ´.ogg","pic":"/2020/10/13/Yehuimei/YHM.jpg","lrc":"ä¸œé£ç ´.txt"},{"title":"ä½ å¬å¾—åˆ°","author":"å‘¨æ°ä¼¦","url":"/2020/10/13/Yehuimei/ä½ å¬å¾—åˆ°.ogg","pic":"/2020/10/13/Yehuimei/YHM.jpg","lrc":"ä½ å¬å¾—åˆ°.txt"},{"title":"åŒä¸€ç§è°ƒè°ƒ","author":"å‘¨æ°ä¼¦","url":"/2020/10/13/Yehuimei/åŒä¸€ç§è°ƒè°ƒ.ogg","pic":"/2020/10/13/Yehuimei/YHM.jpg","lrc":"åŒä¸€ç§è°ƒè°ƒ.txt"},{"title":"å¥¹çš„ç«æ¯›","author":"å‘¨æ°ä¼¦","url":"/2020/10/13/Yehuimei/å¥¹çš„ç«æ¯›.ogg","pic":"/2020/10/13/Yehuimei/YHM.jpg","lrc":"å¥¹çš„ç«æ¯›.txt"},{"title":"çˆ±æƒ…æ‚¬å´–","author":"å‘¨æ°ä¼¦","url":"/2020/10/13/Yehuimei/çˆ±æƒ…æ‚¬å´–.ogg","pic":"/2020/10/13/Yehuimei/YHM.jpg","lrc":"çˆ±æƒ…æ‚¬å´–.txt"},{"title":"æ¢¯ç”°","author":"å‘¨æ°ä¼¦","url":"/2020/10/13/Yehuimei/æ¢¯ç”°.ogg","pic":"/2020/10/13/Yehuimei/YHM.jpg","lrc":"æ¢¯ç”°.txt"},{"title":"åŒåˆ€","author":"å‘¨æ°ä¼¦","url":"/2020/10/13/Yehuimei/åŒåˆ€.ogg","pic":"/2020/10/13/Yehuimei/YHM.jpg","lrc":"åŒåˆ€.txt"}]};
				  options.element = document.getElementById("aplayer-QLrcrIEh");
				  var ap = new APlayer(options);
			    window.aplayers || (window.aplayers = []);
				  window.aplayers.push(ap);
			  </script>



<center>
<p>å¬å¦ˆå¦ˆçš„è¯ï¼Œä½ æ¯”ä»å‰å¿«ä¹ï¼›</p>
<p>å¬çˆ¸çˆ¸çš„è¯ï¼Œçˆ¸ï¼Œæˆ‘å›æ¥äº†ã€‚</p>
<p>æˆ‘æŠŠçˆ·çˆ·æ³¡çš„èŒ¶ï¼Œé€ç»™å¤©å°çš„å¤–å©†ï¼›</p>
<p>å¥¹åŠ äº†ç‚¹éº¦èŠ½ç³–ï¼Œå‘³é“å˜å¾—ç”œç”œçš„ã€‚</p>
<p>æ«æ—å¤œæ›²è¯‰ç´ä¼¤ï¼Œæ¢¯ç”°èŠ±æµ·ä¸ƒé‡Œé¦™ã€‚</p>
<p>å¤§ç¬¨é’Ÿè¿·é­‚æ›²åœ¨æˆ‘çš„åœ°ç›˜ï¼Œåˆå¥æ­¢æˆ˜ä¹‹æ®‡ã€‚</p>
<p>ç¨»é¦™ä¸­çªƒçˆ±å½“æ¢¦æƒ³å¯åŠ¨ï¼Œä½ å´è¯´äº†å†è§ï¼Œ</p>
<p>ä¸çˆ±æˆ‘å°±æ‹‰å€’æˆ‘è¦å¤å¤©ï¼Œå¡«æ»¡æ‰‹å†™çš„ä»å‰ï¼Œ</p>
<p>å‘å¦‚é›ªçš„å¨˜å­ç”¨æ–­äº†çš„å¼¦å¼¹å¥ä¸œé£ç ´ï¼Œ</p>
<p>åœ¨çº¢å°˜å®¢æ ˆå†™å…°äº­åºï¼Œé€å¤©æ¶¯è¿‡å®¢ï¼Œ</p>
<p>çƒŸèŠ±æ˜“å†·å¤©ä¸‹æ— åŒçš„è‹±é›„ä¹Ÿä¼šè½å¯ã€‚</p>
<p>èº«æŠ«é»„é‡‘ç”²çš„å°†å†›ï¼Œåœ¨èŠèŠ±å°å››é¢æ¥šæ­Œï¼Œ</p>
<p>å¤§ä¾ éœå…ƒç”²åœ¨ä¸Šæµ·1943å¤æ´»ï¼Œ</p>
<p>ç”¨é¾™æ‹³åŒæˆªæ£å‡»è´¥äº†æ‹¿åŒåˆ€çš„å¿è€…ï¼Œ</p>
<p>é¾™æˆ˜éª‘å£«ä»¥çˆ¶ä¹‹åå‘åŠ¨æœ€åçš„æˆ˜å½¹ï¼Œ</p>
<p>å›°å…½ä¹‹æ–—åŠå…½äººåœ¨è“è‰²é£æš´ä¸­æˆ˜æ —ï¼Œ</p>
<p>æµæµªè¯—äººé€å¯çˆ±å¥³äººä¸€ä»¶é»‘è‰²æ¯›è¡£ï¼Œ</p>
<p>é˜³å…‰å®…ç”·ä¸è¶…è·‘å¥³ç¥åœ¨é˜³æ˜å±±æ¼‚ç§»ï¼Œ</p>
<p>ç‰›ä»”å¾ˆå¿™å´ä¸ç±³å…°çš„å°é“åŒ è·³èµ·è›‡èˆï¼Œ</p>
<p>é­”æœ¯å…ˆç”ŸåŠä¹”å…‹å”å”ä¸è¦å½“æ‡¦å¤«ã€‚</p>
<p>å®‰é™ç¦»å¼€çˆ±æƒ…æ‚¬å´–ï¼Œæˆ‘è½æ³ªæƒ…ç»ªé›¶ç¢ï¼Œ</p>
<p>ä¸€è·¯å‘åŒ—çš„åé€€ï¼Œå“¦å¯¹ä¸èµ·æ˜¯æˆ‘ä¸é…ï¼Œ</p>
<p>å°±åƒæ°´æ‰‹æ€•æ°´ï¼Œå°±åƒè¶…äººä¸ä¼šé£ï¼Œ</p>
<p>è¿™è¡¨ç™½çš„è¯æˆ‘æ— æ³•ä¸€å£æ°”å…¨å¿µå¯¹ï¼Œ</p>
<p>ä½ æ˜æ˜å°±å–œæ¬¢å¥¹ï¼Œå´ä¸ºä½•å¼€ä¸äº†å£ï¼Œ</p>
<p>ä½ ç®—ä»€ä¹ˆç”·äººï¼Œæ€»æ˜¯è½¬èº«è¯´èµ°å°±èµ°ï¼Œ</p>
<p>ä¸è¯¥æ‰¾å€Ÿå£é€€åï¼ŒMojitoæ¥ä¸€ç‚¹ç‚¹ï¼Œ</p>
<p>è‡ªå¯¼è‡ªæ¼”å¯¹å¥¹è¯´ä½ å¥½å—ï¼Ÿå¥½ä¹…ä¸è§ã€‚</p>
<p>æ‹¨åŠ¨åæ–¹å‘çš„é’Ÿï¼Œæƒ³å›åˆ°è¿‡å»è¯´å¥½ä¸å“­ï¼Œ</p>
<p>çˆ±å°±åƒæ˜¯é¾™å·é£ï¼Œå¤¹æ‚å¿ƒé›¨ä½•æ—¶åœä½ï¼Œ</p>
<p>è·Ÿå…è´¹æ•™å­¦å½•éŸ³å¸¦å­¦æ‰‹è¯­æ€ä¹ˆäº†ï¼Œ</p>
<p>æˆ‘ä¸æƒ³å½“çˆ±æƒ…åºŸæŸ´ï¼Œè¯´å¥½çš„å¹¸ç¦å‘¢ï¼Ÿ</p>
<p>å›­æ¸¸ä¼šä¸­æˆ‘ç‰µç€å‘Šç™½æ°”çƒåœ¨å‚»ç¬‘ï¼Œ</p>
<p>æ™´å¤©çš„å½©è™¹ä¸‹ä½ å¬å¾—åˆ°æˆ‘çš„æš—å·ï¼Œ</p>
<p>åå››å­£åˆ—è½¦å»åƒé‡Œä¹‹å¤–çš„ä¼Šæ–¯å¦å ¡ï¼Œ</p>
<p>çˆ±ä½ æ²¡å·®ä½ æˆ‘ç”¨åŒä¸€ç§è°ƒè°ƒã€‚</p>
<p>ååœ¨ä¸‰å¹´äºŒç­é—¨å£çœ‹ç™½è‰²é£è½¦ï¼Œ</p>
<p>é›¨ä¸‹ä¸€æ•´æ™šäº†ï¼Œæˆ‘åœ¨ç­‰ä½ ä¸‹è¯¾ï¼Œ</p>
<p>åœ¨ç§˜å¯†èŠ±å›­é‡Œé€ä½ åŠå²›é“ç›’ï¼Œ</p>
<p>ç»™æˆ‘ä¸€é¦–æ­Œçš„æ—¶é—´ï¼Œç®€å•çˆ±è¦å¯¹ä½ è¯´ï¼Œ</p>
<p>ä¸ºä½ å¼¹ä¹Œå…‹ä¸½ä¸½ï¼Œé™ªä½ çœ‹æœ€é•¿çš„ç”µå½±ï¼Œ</p>
<p>æ²¿ç€æ—¶å…‰æœºçš„è½¨è¿¹ï¼Œå†™çˆ±çš„é£è¡Œæ—¥è®°ï¼Œ</p>
<p>éµä»ä½ çš„å®Œç¾ä¸»ä¹‰ï¼Œå®ˆæŠ¤ä¸èƒ½è¯´çš„ç§˜å¯†ï¼Œ</p>
<p>Now you see meï¼Œå“ªé‡Œéƒ½æ˜¯ä½ çš„å…¬ä¸»ç—…ã€‚</p>
<p>ä¸ä½ åƒåœŸè€³å…¶å†°æ·‡æ·‹å¬è§ä¸‹é›¨çš„å£°éŸ³ï¼Œ</p>
<p>åœ¨å¸ƒæ‹‰æ ¼å¹¿åœºä¸€èµ·å¬æ¯”è¾ƒå¤§çš„å¤§æç´ã€‚</p>
<p>åºŠè¾¹æ•…äº‹å¤œçš„ç¬¬ä¸ƒç« è®²ç€çˆ±åœ¨è¥¿å…ƒå‰ï¼Œ</p>
<p>å‰ä¸–æƒ…äººé€†é³ç¾äººé±¼ææµ…åœ¨çŠç‘šæµ·è¾¹ï¼Œ</p>
<p>å˜»å“ˆç©ºå§æ”¾ä¸‹æµªæ¼«æ‰‹æœºåƒç–—ä¼¤çƒ§è‚‰ç²½ï¼Œ</p>
<p>æ³¢çˆ·ç¿»å¼€æœ¬è‰çº²ç›®æ²»å¥½äº†å…¬å…¬åå¤´ç—›ï¼Œ</p>
<p>å°ç¬¬å®‰è€æ–‘é¸ åœ¨å¨å»‰å¤å ¡çœ‹èœ—ç‰›æ–—ç‰›ï¼Œ</p>
<p>é’èŠ±ç“·æ—å‘¨å¤§ä¾ çœ‹çš®å½±æˆé‡Œä¹±èˆæ˜¥ç§‹ã€‚</p>
<p>æˆ‘æ˜¯å¦‚æ­¤ç›¸ä¿¡æœ‰å¤©ä½ è¿˜ä¼šå‡ºæ–°æ­Œï¼Œ</p>
<p>ä¸–ç•Œæœ«æ—¥ã€ä¸–ç•Œæœªæœ«æ—¥éƒ½ä¼šç­‰ç€ã€‚</p>
</center>





]]></content>
      <categories>
        <category>Jay</category>
      </categories>
      <tags>
        <tag>å¶æƒ ç¾</tag>
      </tags>
  </entry>
  <entry>
    <title>è´Ÿè·ç¦»</title>
    <url>/2020/11/23/%E8%B4%9F%E8%B7%9D%E7%A6%BB/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="è´Ÿè·ç¦»"><a href="#è´Ÿè·ç¦»" class="headerlink" title="è´Ÿè·ç¦»"></a>è´Ÿè·ç¦»</h1><p>æƒ³æ˜¯å› ä¸ºä¹…äº†æ‰€ä»¥è®°ä¸èµ·äº†ï¼Œæƒ³æ˜¯å› ä¸ºç©ºæ°”æ¹¿äº†ä¸æ˜¯çœ¼çœ¶çº¢äº†ã€‚</p>
<p>æˆ‘çœ‹è§å‡‹é›¶çš„æ«ï¼Œå¤©ç©ºçš„é¢œè‰²æ¯”æ²¹å½©æ›´å‡é‡ï¼Œå¤§å—ç™½è‰²çš„æµ®äº‘æ è¿‡ï¼Œé‚£æ ‹ç°è‰²çš„å»ºç­‘é—ªçƒé¦™æ§Ÿè‰²çš„å…‰èŠ’ï¼Œæˆ‘ä»æœªæ€€ç–‘è¿‡è‡ªå·±åœ¨æ¢¦é‡Œã€‚</p>
<p>æ¯ä¸ªäººçš„èº«ä½“å’Œæ„å¿—ï¼Œæ€»æœ‰è¢«ç¯å¢ƒçš„ç‰¢ç¬¼ç¦é”¢é‚£ä¸€éƒ¨åˆ†ï¼Œæƒ³æ–½å±•æ‹³è„šå°±å„ç§Errorã€‚</p>
<p>æˆ–è®¸äººéƒ½åº”è¯¥åšåˆ°å¼ å¼›æœ‰åº¦ï¼Œé€Ÿåº¦ä¸ç¼“ä¸æ€¥ï¼Œè‡ªæœ‰å®‰æ’å¦¥å½“çš„èŠ‚å¥ï¼Œè¯¥æ”¶æ•›çš„æ—¶å€™ä¸é€å¼ºï¼Œè¯¥å‡ºå‡»çš„æ—¶å€™ä¸çŠ¹è±«ï¼Œè¯¥ä¿ç•™çš„æ—¶å€™ä¸ç›²ç›®ï¼Œè¯¥ç«­åŠ›çš„æ—¶å€™ä¸æ°”çŸ­ã€‚</p>
<p>2020ï¼ŒæƒŸæ„¿ä¿¡å¿µä½¿è‡ªå·±è¶…è¶Šã€‚</p>
]]></content>
      <categories>
        <category>éšç¬”</category>
      </categories>
      <tags>
        <tag>éšç¬”</tag>
      </tags>
  </entry>
  <entry>
    <title>HttpçŠ¶æ€ç </title>
    <url>/2020/06/01/HttpCode/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="HttpçŠ¶æ€ç "><a href="#HttpçŠ¶æ€ç " class="headerlink" title="HttpçŠ¶æ€ç "></a>HttpçŠ¶æ€ç </h1><center>
    <font face="Kristen ITC" color="#555555" font-size=100px>Khighness</font><br>
</center>



<table>
<thead>
<tr>
<th align="center">åˆ†ç±»</th>
<th align="center">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1**</td>
<td align="center">ä¿¡æ¯ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œéœ€è¦è¯·æ±‚è€…ç»§ç»­æ‰§è¡Œæ“ä½œ</td>
</tr>
<tr>
<td align="center">2**</td>
<td align="center">æˆåŠŸï¼Œæ“ä½œè¢«æˆåŠŸæ¥æ”¶å¹¶å¤„ç†</td>
</tr>
<tr>
<td align="center">3**</td>
<td align="center">é‡å®šå‘ï¼Œéœ€è¦è¿›ä¸€æ­¥çš„æ“ä½œä»¥å®Œæˆè¯·æ±‚</td>
</tr>
<tr>
<td align="center">4**</td>
<td align="center">å®¢æˆ·ç«¯é”™è¯¯ï¼Œè¯·æ±‚ç™½è›¤è¯­æ³•é”™è¯¯æˆ–æ— åˆ†å‘å®Œæˆè¯·æ±‚</td>
</tr>
<tr>
<td align="center">5**</td>
<td align="center">æœåŠ¡å™¨é”™è¯¯ï¼ŒæœåŠ¡å™¨æ‰å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†é”™è¯¯</td>
</tr>
</tbody></table>
<h2 id="1xx-æ¶ˆæ¯"><a href="#1xx-æ¶ˆæ¯" class="headerlink" title="1xx-æ¶ˆæ¯"></a>1xx-æ¶ˆæ¯</h2><p>è¿™ä¸€ç±»å‹çš„çŠ¶æ€ç ï¼Œä»£è¡¨è¯·æ±‚å·²è¢«æ¥å—ï¼Œéœ€è¦ç»§ç»­å¤„ç†ã€‚è¿™ç±»å“åº”æ˜¯ä¸´æ—¶å“åº”ï¼ŒåªåŒ…å«çŠ¶æ€è¡Œå’ŒæŸäº›å¯é€‰çš„å“åº”å¤´ä¿¡æ¯ï¼Œå¹¶ä»¥ç©ºè¡Œç»“æŸã€‚ç”±äºHTTP/1.0åè®®ä¸­æ²¡æœ‰å®šä¹‰ä»»ä½•1xxçŠ¶æ€ç ï¼Œæ‰€ä»¥é™¤éåœ¨æŸäº›è¯•éªŒæ¡ä»¶ä¸‹ï¼ŒæœåŠ¡å™¨ç¦æ­¢å‘æ­¤ç±»å®¢æˆ·ç«¯å‘é€1xxå“åº”ã€‚ è¿™äº›çŠ¶æ€ç ä»£è¡¨çš„å“åº”éƒ½æ˜¯ä¿¡æ¯æ€§çš„ï¼Œæ ‡ç¤ºå®¢æˆ·åº”è¯¥é‡‡å–çš„å…¶ä»–è¡ŒåŠ¨ã€‚</p>
<ul>
<li><p>100 Continue<br>æœåŠ¡å™¨å·²ç»æ¥æ”¶åˆ°è¯·æ±‚å¤´ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯åº”ç»§ç»­å‘é€è¯·æ±‚ä¸»ä½“ï¼ˆåœ¨éœ€è¦å‘é€èº«ä½“çš„è¯·æ±‚çš„æƒ…å†µä¸‹ï¼šä¾‹å¦‚ï¼ŒPOSTè¯·æ±‚ï¼‰ï¼Œæˆ–è€…å¦‚æœè¯·æ±‚å·²ç»å®Œæˆï¼Œå¿½ç•¥è¿™ä¸ªå“åº”ã€‚æœåŠ¡å™¨å¿…é¡»åœ¨è¯·æ±‚å®Œæˆåå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªæœ€ç»ˆå“åº”ã€‚è¦ä½¿æœåŠ¡å™¨æ£€æŸ¥è¯·æ±‚çš„å¤´éƒ¨ï¼Œå®¢æˆ·ç«¯å¿…é¡»åœ¨å…¶åˆå§‹è¯·æ±‚ä¸­å‘é€Expect: 100-continueä½œä¸ºå¤´éƒ¨ï¼Œå¹¶åœ¨å‘é€æ­£æ–‡ä¹‹å‰æ¥æ”¶100 ContinueçŠ¶æ€ä»£ç ã€‚å“åº”ä»£ç 417æœŸæœ›å¤±è´¥è¡¨ç¤ºè¯·æ±‚ä¸åº”ç»§ç»­ã€‚</p>
</li>
<li><p>101 Switching Protocols<br>æœåŠ¡å™¨å·²ç»ç†è§£äº†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¹¶å°†é€šè¿‡Upgradeæ¶ˆæ¯å¤´é€šçŸ¥å®¢æˆ·ç«¯é‡‡ç”¨ä¸åŒçš„åè®®æ¥å®Œæˆè¿™ä¸ªè¯·æ±‚ã€‚åœ¨å‘é€å®Œè¿™ä¸ªå“åº”æœ€åçš„ç©ºè¡Œåï¼ŒæœåŠ¡å™¨å°†ä¼šåˆ‡æ¢åˆ°åœ¨Upgradeæ¶ˆæ¯å¤´ä¸­å®šä¹‰çš„é‚£äº›åè®®ã€‚<br>åªæœ‰åœ¨åˆ‡æ¢æ–°çš„åè®®æ›´æœ‰å¥½å¤„çš„æ—¶å€™æ‰åº”è¯¥é‡‡å–ç±»ä¼¼æªæ–½ã€‚ä¾‹å¦‚ï¼Œåˆ‡æ¢åˆ°æ–°çš„HTTPç‰ˆæœ¬ï¼ˆå¦‚HTTP/2ï¼‰æ¯”æ—§ç‰ˆæœ¬æ›´æœ‰ä¼˜åŠ¿ï¼Œæˆ–è€…åˆ‡æ¢åˆ°ä¸€ä¸ªå®æ—¶ä¸”åŒæ­¥çš„åè®®ï¼ˆå¦‚WebSocketï¼‰ä»¥ä¼ é€åˆ©ç”¨æ­¤ç±»ç‰¹æ€§çš„èµ„æºã€‚</p>
</li>
<li><p>102 Processingï¼ˆWebDAVï¼›RFC 2518ï¼‰<br>WebDAVè¯·æ±‚å¯èƒ½åŒ…å«è®¸å¤šæ¶‰åŠæ–‡ä»¶æ“ä½œçš„å­è¯·æ±‚ï¼Œéœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½å®Œæˆè¯·æ±‚ã€‚è¯¥ä»£ç è¡¨ç¤ºæœåŠ¡å™¨å·²ç»æ”¶åˆ°å¹¶æ­£åœ¨å¤„ç†è¯·æ±‚ï¼Œä½†æ— å“åº”å¯ç”¨ã€‚[6]è¿™æ ·å¯ä»¥é˜²æ­¢å®¢æˆ·ç«¯è¶…æ—¶ï¼Œå¹¶å‡è®¾è¯·æ±‚ä¸¢å¤±ã€‚</p>
</li>
</ul>
<h2 id="2xx-æˆåŠŸ"><a href="#2xx-æˆåŠŸ" class="headerlink" title="2xx-æˆåŠŸ"></a>2xx-æˆåŠŸ</h2><p>è¿™ä¸€ç±»å‹çš„çŠ¶æ€ç ï¼Œä»£è¡¨è¯·æ±‚å·²æˆåŠŸè¢«æœåŠ¡å™¨æ¥æ”¶ã€ç†è§£ã€å¹¶æ¥å—ã€‚</p>
<ul>
<li><p>200 OK<br>è¯·æ±‚å·²æˆåŠŸï¼Œè¯·æ±‚æ‰€å¸Œæœ›çš„å“åº”å¤´æˆ–æ•°æ®ä½“å°†éšæ­¤å“åº”è¿”å›ã€‚å®é™…çš„å“åº”å°†å–å†³äºæ‰€ä½¿ç”¨çš„è¯·æ±‚æ–¹æ³•ã€‚åœ¨GETè¯·æ±‚ä¸­ï¼Œå“åº”å°†åŒ…å«ä¸è¯·æ±‚çš„èµ„æºç›¸å¯¹åº”çš„å®ä½“ã€‚åœ¨POSTè¯·æ±‚ä¸­ï¼Œå“åº”å°†åŒ…å«æè¿°æˆ–æ“ä½œç»“æœçš„å®ä½“ã€‚</p>
</li>
<li><p>201 Created<br>è¯·æ±‚å·²ç»è¢«å®ç°ï¼Œè€Œä¸”æœ‰ä¸€ä¸ªæ–°çš„èµ„æºå·²ç»ä¾æ®è¯·æ±‚çš„éœ€è¦è€Œåˆ›å»ºï¼Œä¸”å…¶URIå·²ç»éšLocationå¤´ä¿¡æ¯è¿”å›ã€‚å‡å¦‚éœ€è¦çš„èµ„æºæ— æ³•åŠæ—¶åˆ›å»ºçš„è¯ï¼Œåº”å½“è¿”å›â€™202 Acceptedâ€™ã€‚</p>
</li>
<li><p>202 Accepted<br>æœåŠ¡å™¨å·²æ¥å—è¯·æ±‚ï¼Œä½†å°šæœªå¤„ç†ã€‚æœ€ç»ˆè¯¥è¯·æ±‚å¯èƒ½ä¼šä¹Ÿå¯èƒ½ä¸ä¼šè¢«æ‰§è¡Œï¼Œå¹¶ä¸”å¯èƒ½åœ¨å¤„ç†å‘ç”Ÿæ—¶è¢«ç¦æ­¢ã€‚</p>
</li>
<li><p>203 Non-Authoritative Informationï¼ˆè‡ªHTTP / 1.1èµ·ï¼‰<br>æœåŠ¡å™¨æ˜¯ä¸€ä¸ªè½¬æ¢ä»£ç†æœåŠ¡å™¨ï¼ˆtransforming proxyï¼Œä¾‹å¦‚ç½‘ç»œåŠ é€Ÿå™¨ï¼‰ï¼Œä»¥200 OKçŠ¶æ€ç ä¸ºèµ·æºï¼Œä½†å›åº”äº†åŸå§‹å“åº”çš„ä¿®æ”¹ç‰ˆæœ¬ã€‚</p>
</li>
<li><p>204 No Content<br>æœåŠ¡å™¨æˆåŠŸå¤„ç†äº†è¯·æ±‚ï¼Œæ²¡æœ‰è¿”å›ä»»ä½•å†…å®¹ã€‚</p>
</li>
<li><p>205 Reset Content<br>æœåŠ¡å™¨æˆåŠŸå¤„ç†äº†è¯·æ±‚ï¼Œä½†æ²¡æœ‰è¿”å›ä»»ä½•å†…å®¹ã€‚ä¸204å“åº”ä¸åŒï¼Œæ­¤å“åº”è¦æ±‚è¯·æ±‚è€…é‡ç½®æ–‡æ¡£è§†å›¾ã€‚</p>
</li>
<li><p>206 Partial Content<br>æœåŠ¡å™¨å·²ç»æˆåŠŸå¤„ç†äº†éƒ¨åˆ†GETè¯·æ±‚ã€‚ç±»ä¼¼äºFlashGetæˆ–è€…è¿…é›·è¿™ç±»çš„HTTP ä¸‹è½½å·¥å…·éƒ½æ˜¯ä½¿ç”¨æ­¤ç±»å“åº”å®ç°æ–­ç‚¹ç»­ä¼ æˆ–è€…å°†ä¸€ä¸ªå¤§æ–‡æ¡£åˆ†è§£ä¸ºå¤šä¸ªä¸‹è½½æ®µåŒæ—¶ä¸‹è½½ã€‚</p>
</li>
<li><p>207 Multi-Statusï¼ˆWebDAVï¼›RFC 4918ï¼‰<br>ä»£è¡¨ä¹‹åçš„æ¶ˆæ¯ä½“å°†æ˜¯ä¸€ä¸ªXMLæ¶ˆæ¯ï¼Œå¹¶ä¸”å¯èƒ½ä¾ç…§ä¹‹å‰å­è¯·æ±‚æ•°é‡çš„ä¸åŒï¼ŒåŒ…å«ä¸€ç³»åˆ—ç‹¬ç«‹çš„å“åº”ä»£ç ã€‚</p>
</li>
<li><p>208 Already Reported ï¼ˆWebDAVï¼›RFC 5842ï¼‰<br>DAVç»‘å®šçš„æˆå‘˜å·²ç»åœ¨ï¼ˆå¤šçŠ¶æ€ï¼‰å“åº”ä¹‹å‰çš„éƒ¨åˆ†è¢«åˆ—ä¸¾ï¼Œä¸”æœªè¢«å†æ¬¡åŒ…å«ã€‚</p>
</li>
<li><p>226 IM Used ï¼ˆRFC 3229ï¼‰<br>æœåŠ¡å™¨å·²ç»æ»¡è¶³äº†å¯¹èµ„æºçš„è¯·æ±‚ï¼Œå¯¹å®ä½“è¯·æ±‚çš„ä¸€ä¸ªæˆ–å¤šä¸ªå®ä½“æ“ä½œçš„ç»“æœè¡¨ç¤ºã€‚</p>
</li>
</ul>
<h2 id="3xx-é‡å®šå‘"><a href="#3xx-é‡å®šå‘" class="headerlink" title="3xx-é‡å®šå‘"></a>3xx-é‡å®šå‘</h2><p>è¿™ç±»çŠ¶æ€ç ä»£è¡¨éœ€è¦å®¢æˆ·ç«¯é‡‡å–è¿›ä¸€æ­¥çš„æ“ä½œæ‰èƒ½å®Œæˆè¯·æ±‚ã€‚é€šå¸¸ï¼Œè¿™äº›çŠ¶æ€ç ç”¨æ¥é‡å®šå‘ï¼Œåç»­çš„è¯·æ±‚åœ°å€ï¼ˆé‡å®šå‘ç›®æ ‡ï¼‰åœ¨æœ¬æ¬¡å“åº”çš„LocationåŸŸä¸­æŒ‡æ˜ã€‚</p>
<p>å½“ä¸”ä»…å½“åç»­çš„è¯·æ±‚æ‰€ä½¿ç”¨çš„æ–¹æ³•æ˜¯GETæˆ–è€…HEADæ—¶ï¼Œç”¨æˆ·æµè§ˆå™¨æ‰å¯ä»¥åœ¨æ²¡æœ‰ç”¨æˆ·ä»‹å…¥çš„æƒ…å†µä¸‹è‡ªåŠ¨æäº¤æ‰€éœ€è¦çš„åç»­è¯·æ±‚ã€‚å®¢æˆ·ç«¯åº”å½“è‡ªåŠ¨ç›‘æµ‹æ— é™å¾ªç¯é‡å®šå‘ï¼ˆä¾‹å¦‚ï¼šAâ†’Bâ†’Câ†’â€¦â€¦â†’Aæˆ–Aâ†’Aï¼‰ï¼Œå› ä¸ºè¿™ä¼šå¯¼è‡´æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å¤§é‡ä¸å¿…è¦çš„èµ„æºæ¶ˆè€—ã€‚æŒ‰ç…§HTTP/1.0ç‰ˆè§„èŒƒçš„å»ºè®®ï¼Œæµè§ˆå™¨ä¸åº”è‡ªåŠ¨è®¿é—®è¶…è¿‡5æ¬¡çš„é‡å®šå‘ã€‚</p>
<ul>
<li><p>300 Multiple Choices<br>è¢«è¯·æ±‚çš„èµ„æºæœ‰ä¸€ç³»åˆ—å¯ä¾›é€‰æ‹©çš„å›é¦ˆä¿¡æ¯ï¼Œæ¯ä¸ªéƒ½æœ‰è‡ªå·±ç‰¹å®šçš„åœ°å€å’Œæµè§ˆå™¨é©±åŠ¨çš„å•†è®®ä¿¡æ¯ã€‚ç”¨æˆ·æˆ–æµè§ˆå™¨èƒ½å¤Ÿè‡ªè¡Œé€‰æ‹©ä¸€ä¸ªé¦–é€‰çš„åœ°å€è¿›è¡Œé‡å®šå‘ã€‚<br>é™¤éè¿™æ˜¯ä¸€ä¸ªHEADè¯·æ±‚ï¼Œå¦åˆ™è¯¥å“åº”åº”å½“åŒ…æ‹¬ä¸€ä¸ªèµ„æºç‰¹æ€§åŠåœ°å€çš„åˆ—è¡¨çš„å®ä½“ï¼Œä»¥ä¾¿ç”¨æˆ·æˆ–æµè§ˆå™¨ä»ä¸­é€‰æ‹©æœ€åˆé€‚çš„é‡å®šå‘åœ°å€ã€‚è¿™ä¸ªå®ä½“çš„æ ¼å¼ç”±Content-Typeå®šä¹‰çš„æ ¼å¼æ‰€å†³å®šã€‚æµè§ˆå™¨å¯èƒ½æ ¹æ®å“åº”çš„æ ¼å¼ä»¥åŠæµè§ˆå™¨è‡ªèº«èƒ½åŠ›ï¼Œè‡ªåŠ¨ä½œå‡ºæœ€åˆé€‚çš„é€‰æ‹©ã€‚å½“ç„¶ï¼ŒRFC 2616è§„èŒƒå¹¶æ²¡æœ‰è§„å®šè¿™æ ·çš„è‡ªåŠ¨é€‰æ‹©è¯¥å¦‚ä½•è¿›è¡Œã€‚<br>å¦‚æœæœåŠ¡å™¨æœ¬èº«å·²ç»æœ‰äº†é¦–é€‰çš„å›é¦ˆé€‰æ‹©ï¼Œé‚£ä¹ˆåœ¨Locationä¸­åº”å½“æŒ‡æ˜è¿™ä¸ªå›é¦ˆçš„URIï¼›æµè§ˆå™¨å¯èƒ½ä¼šå°†è¿™ä¸ªLocationå€¼ä½œä¸ºè‡ªåŠ¨é‡å®šå‘çš„åœ°å€ã€‚æ­¤å¤–ï¼Œé™¤éé¢å¤–æŒ‡å®šï¼Œå¦åˆ™è¿™ä¸ªå“åº”ä¹Ÿæ˜¯å¯ç¼“å­˜çš„ã€‚</p>
</li>
<li><p>301 Moved Permanently<br>è¢«è¯·æ±‚çš„èµ„æºå·²æ°¸ä¹…ç§»åŠ¨åˆ°æ–°ä½ç½®ï¼Œå¹¶ä¸”å°†æ¥ä»»ä½•å¯¹æ­¤èµ„æºçš„å¼•ç”¨éƒ½åº”è¯¥ä½¿ç”¨æœ¬å“åº”è¿”å›çš„è‹¥å¹²ä¸ªURIä¹‹ä¸€ã€‚å¦‚æœå¯èƒ½ï¼Œæ‹¥æœ‰é“¾æ¥ç¼–è¾‘åŠŸèƒ½çš„å®¢æˆ·ç«¯åº”å½“è‡ªåŠ¨æŠŠè¯·æ±‚çš„åœ°å€ä¿®æ”¹ä¸ºä»æœåŠ¡å™¨åé¦ˆå›æ¥çš„åœ°å€ã€‚é™¤éé¢å¤–æŒ‡å®šï¼Œå¦åˆ™è¿™ä¸ªå“åº”ä¹Ÿæ˜¯å¯ç¼“å­˜çš„ã€‚<br>æ–°çš„æ°¸ä¹…æ€§çš„URIåº”å½“åœ¨å“åº”çš„LocationåŸŸä¸­è¿”å›ã€‚é™¤éè¿™æ˜¯ä¸€ä¸ªHEADè¯·æ±‚ï¼Œå¦åˆ™å“åº”çš„å®ä½“ä¸­åº”å½“åŒ…å«æŒ‡å‘æ–°çš„URIçš„è¶…é“¾æ¥åŠç®€çŸ­è¯´æ˜ã€‚<br>å¦‚æœè¿™ä¸æ˜¯ä¸€ä¸ªGETæˆ–è€…HEADè¯·æ±‚ï¼Œé‚£ä¹ˆæµè§ˆå™¨ç¦æ­¢è‡ªåŠ¨è¿›è¡Œé‡å®šå‘ï¼Œé™¤éå¾—åˆ°ç”¨æˆ·çš„ç¡®è®¤ï¼Œå› ä¸ºè¯·æ±‚çš„æ¡ä»¶å¯èƒ½å› æ­¤å‘ç”Ÿå˜åŒ–ã€‚<br>æ³¨æ„ï¼šå¯¹äºæŸäº›ä½¿ç”¨HTTP/1.0åè®®çš„æµè§ˆå™¨ï¼Œå½“å®ƒä»¬å‘é€çš„POSTè¯·æ±‚å¾—åˆ°äº†ä¸€ä¸ª301å“åº”çš„è¯ï¼Œæ¥ä¸‹æ¥çš„é‡å®šå‘è¯·æ±‚å°†ä¼šå˜æˆGETæ–¹å¼ã€‚</p>
</li>
<li><p>302 Found<br>è¦æ±‚å®¢æˆ·ç«¯æ‰§è¡Œä¸´æ—¶é‡å®šå‘ï¼ˆåŸå§‹æè¿°çŸ­è¯­ä¸ºâ€œMoved Temporarilyâ€ï¼‰ã€‚ç”±äºè¿™æ ·çš„é‡å®šå‘æ˜¯ä¸´æ—¶çš„ï¼Œå®¢æˆ·ç«¯åº”å½“ç»§ç»­å‘åŸæœ‰åœ°å€å‘é€ä»¥åçš„è¯·æ±‚ã€‚åªæœ‰åœ¨Cache-Controlæˆ–Expiresä¸­è¿›è¡Œäº†æŒ‡å®šçš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå“åº”æ‰æ˜¯å¯ç¼“å­˜çš„ã€‚<br>æ–°çš„ä¸´æ—¶æ€§çš„URIåº”å½“åœ¨å“åº”çš„LocationåŸŸä¸­è¿”å›ã€‚é™¤éè¿™æ˜¯ä¸€ä¸ªHEADè¯·æ±‚ï¼Œå¦åˆ™å“åº”çš„å®ä½“ä¸­åº”å½“åŒ…å«æŒ‡å‘æ–°çš„URIçš„è¶…é“¾æ¥åŠç®€çŸ­è¯´æ˜ã€‚<br>å¦‚æœè¿™ä¸æ˜¯ä¸€ä¸ªGETæˆ–è€…HEADè¯·æ±‚ï¼Œé‚£ä¹ˆæµè§ˆå™¨ç¦æ­¢è‡ªåŠ¨è¿›è¡Œé‡å®šå‘ï¼Œé™¤éå¾—åˆ°ç”¨æˆ·çš„ç¡®è®¤ï¼Œå› ä¸ºè¯·æ±‚çš„æ¡ä»¶å¯èƒ½å› æ­¤å‘ç”Ÿå˜åŒ–ã€‚<br>æ³¨æ„ï¼šè™½ç„¶RFC 1945å’ŒRFC 2068è§„èŒƒä¸å…è®¸å®¢æˆ·ç«¯åœ¨é‡å®šå‘æ—¶æ”¹å˜è¯·æ±‚çš„æ–¹æ³•ï¼Œä½†æ˜¯å¾ˆå¤šç°å­˜çš„æµè§ˆå™¨å°†302å“åº”è§†ä½œä¸º303å“åº”ï¼Œå¹¶ä¸”ä½¿ç”¨GETæ–¹å¼è®¿é—®åœ¨Locationä¸­è§„å®šçš„URIï¼Œè€Œæ— è§†åŸå…ˆè¯·æ±‚çš„æ–¹æ³•ã€‚å› æ­¤çŠ¶æ€ç 303å’Œ307è¢«æ·»åŠ äº†è¿›æ¥ï¼Œç”¨ä»¥æ˜ç¡®æœåŠ¡å™¨æœŸå¾…å®¢æˆ·ç«¯è¿›è¡Œä½•ç§ååº”ã€‚</p>
</li>
<li><p>303 See Other<br>å¯¹åº”å½“å‰è¯·æ±‚çš„å“åº”å¯ä»¥åœ¨å¦ä¸€ä¸ªURIä¸Šè¢«æ‰¾åˆ°ï¼Œå½“å“åº”äºPOSTï¼ˆæˆ–PUT / DELETEï¼‰æ¥æ”¶åˆ°å“åº”æ—¶ï¼Œå®¢æˆ·ç«¯åº”è¯¥å‡å®šæœåŠ¡å™¨å·²ç»æ”¶åˆ°æ•°æ®ï¼Œå¹¶ä¸”åº”è¯¥ä½¿ç”¨å•ç‹¬çš„GETæ¶ˆæ¯å‘å‡ºé‡å®šå‘ã€‚è¿™ä¸ªæ–¹æ³•çš„å­˜åœ¨ä¸»è¦æ˜¯ä¸ºäº†å…è®¸ç”±è„šæœ¬æ¿€æ´»çš„POSTè¯·æ±‚è¾“å‡ºé‡å®šå‘åˆ°ä¸€ä¸ªæ–°çš„èµ„æºã€‚è¿™ä¸ªæ–°çš„URIä¸æ˜¯åŸå§‹èµ„æºçš„æ›¿ä»£å¼•ç”¨ã€‚åŒæ—¶ï¼Œ303å“åº”ç¦æ­¢è¢«ç¼“å­˜ã€‚å½“ç„¶ï¼Œç¬¬äºŒä¸ªè¯·æ±‚ï¼ˆé‡å®šå‘ï¼‰å¯èƒ½è¢«ç¼“å­˜ã€‚<br>æ–°çš„URIåº”å½“åœ¨å“åº”çš„LocationåŸŸä¸­è¿”å›ã€‚é™¤éè¿™æ˜¯ä¸€ä¸ªHEADè¯·æ±‚ï¼Œå¦åˆ™å“åº”çš„å®ä½“ä¸­åº”å½“åŒ…å«æŒ‡å‘æ–°çš„URIçš„è¶…é“¾æ¥åŠç®€çŸ­è¯´æ˜ã€‚<br>æ³¨æ„ï¼šè®¸å¤šHTTP/1.1ç‰ˆä»¥å‰çš„æµè§ˆå™¨ä¸èƒ½æ­£ç¡®ç†è§£303çŠ¶æ€ã€‚å¦‚æœéœ€è¦è€ƒè™‘ä¸è¿™äº›æµè§ˆå™¨ä¹‹é—´çš„äº’åŠ¨ï¼Œ302çŠ¶æ€ç åº”è¯¥å¯ä»¥èƒœä»»ï¼Œå› ä¸ºå¤§å¤šæ•°çš„æµè§ˆå™¨å¤„ç†302å“åº”æ—¶çš„æ–¹å¼æ°æ°å°±æ˜¯ä¸Šè¿°è§„èŒƒè¦æ±‚å®¢æˆ·ç«¯å¤„ç†303å“åº”æ—¶åº”å½“åšçš„ã€‚</p>
</li>
<li><p>304 Not Modified<br>è¡¨ç¤ºèµ„æºæœªè¢«ä¿®æ”¹ï¼Œå› ä¸ºè¯·æ±‚å¤´æŒ‡å®šçš„ç‰ˆæœ¬If-Modified-Sinceæˆ–If-None-Matchã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”±äºå®¢æˆ·ç«¯ä»ç„¶å…·æœ‰ä»¥å‰ä¸‹è½½çš„å‰¯æœ¬ï¼Œå› æ­¤ä¸éœ€è¦é‡æ–°ä¼ è¾“èµ„æºã€‚</p>
</li>
<li><p>305 Use Proxy<br>è¢«è¯·æ±‚çš„èµ„æºå¿…é¡»é€šè¿‡æŒ‡å®šçš„ä»£ç†æ‰èƒ½è¢«è®¿é—®ã€‚LocationåŸŸä¸­å°†ç»™å‡ºæŒ‡å®šçš„ä»£ç†æ‰€åœ¨çš„URIä¿¡æ¯ï¼Œæ¥æ”¶è€…éœ€è¦é‡å¤å‘é€ä¸€ä¸ªå•ç‹¬çš„è¯·æ±‚ï¼Œé€šè¿‡è¿™ä¸ªä»£ç†æ‰èƒ½è®¿é—®ç›¸åº”èµ„æºã€‚åªæœ‰åŸå§‹æœåŠ¡å™¨æ‰èƒ½åˆ›å»º305å“åº”ã€‚è®¸å¤šHTTPå®¢æˆ·ç«¯ï¼ˆåƒæ˜¯Mozillaå’ŒInternet Explorerï¼‰éƒ½æ²¡æœ‰æ­£ç¡®å¤„ç†è¿™ç§çŠ¶æ€ä»£ç çš„å“åº”ï¼Œä¸»è¦æ˜¯å‡ºäºå®‰å…¨è€ƒè™‘ã€‚<br>æ³¨æ„ï¼šRFC 2068ä¸­æ²¡æœ‰æ˜ç¡®305å“åº”æ˜¯ä¸ºäº†é‡å®šå‘ä¸€ä¸ªå•ç‹¬çš„è¯·æ±‚ï¼Œè€Œä¸”åªèƒ½è¢«åŸå§‹æœåŠ¡å™¨å»ºç«‹ã€‚å¿½è§†è¿™äº›é™åˆ¶å¯èƒ½å¯¼è‡´ä¸¥é‡çš„å®‰å…¨åæœã€‚</p>
</li>
<li><p>306 Switch Proxy<br>åœ¨æœ€æ–°ç‰ˆçš„è§„èŒƒä¸­ï¼Œ306çŠ¶æ€ç å·²ç»ä¸å†è¢«ä½¿ç”¨ã€‚æœ€åˆæ˜¯æŒ‡â€œåç»­è¯·æ±‚åº”ä½¿ç”¨æŒ‡å®šçš„ä»£ç†â€ã€‚</p>
</li>
<li><p>307 Temporary Redirect<br>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯·æ±‚åº”è¯¥ä¸å¦ä¸€ä¸ªURIé‡å¤ï¼Œä½†åç»­çš„è¯·æ±‚åº”ä»ä½¿ç”¨åŸå§‹çš„URIã€‚ ä¸302ç›¸åï¼Œå½“é‡æ–°å‘å‡ºåŸå§‹è¯·æ±‚æ—¶ï¼Œä¸å…è®¸æ›´æ”¹è¯·æ±‚æ–¹æ³•ã€‚ ä¾‹å¦‚ï¼Œåº”è¯¥ä½¿ç”¨å¦ä¸€ä¸ªPOSTè¯·æ±‚æ¥é‡å¤POSTè¯·æ±‚ã€‚</p>
</li>
<li><p>308 Permanent Redirect (RFC 7538)<br>è¯·æ±‚å’Œæ‰€æœ‰å°†æ¥çš„è¯·æ±‚åº”è¯¥ä½¿ç”¨å¦ä¸€ä¸ªURIé‡å¤ã€‚ 307å’Œ308é‡å¤302å’Œ301çš„è¡Œä¸ºï¼Œä½†ä¸å…è®¸HTTPæ–¹æ³•æ›´æ”¹ã€‚ ä¾‹å¦‚ï¼Œå°†è¡¨å•æäº¤ç»™æ°¸ä¹…é‡å®šå‘çš„èµ„æºå¯èƒ½ä¼šé¡ºåˆ©è¿›è¡Œã€‚</p>
</li>
</ul>
<h2 id="4xx-å®¢æˆ·ç«¯é”™è¯¯"><a href="#4xx-å®¢æˆ·ç«¯é”™è¯¯" class="headerlink" title="4xx-å®¢æˆ·ç«¯é”™è¯¯"></a>4xx-å®¢æˆ·ç«¯é”™è¯¯</h2><p>è¿™ç±»çš„çŠ¶æ€ç ä»£è¡¨äº†å®¢æˆ·ç«¯çœ‹èµ·æ¥å¯èƒ½å‘ç”Ÿäº†é”™è¯¯ï¼Œå¦¨ç¢äº†æœåŠ¡å™¨çš„å¤„ç†ã€‚é™¤éå“åº”çš„æ˜¯ä¸€ä¸ªHEADè¯·æ±‚ï¼Œå¦åˆ™æœåŠ¡å™¨å°±åº”è¯¥è¿”å›ä¸€ä¸ªè§£é‡Šå½“å‰é”™è¯¯çŠ¶å†µçš„å®ä½“ï¼Œä»¥åŠè¿™æ˜¯ä¸´æ—¶çš„è¿˜æ˜¯æ°¸ä¹…æ€§çš„çŠ¶å†µã€‚è¿™äº›çŠ¶æ€ç é€‚ç”¨äºä»»ä½•è¯·æ±‚æ–¹æ³•ã€‚æµè§ˆå™¨åº”å½“å‘ç”¨æˆ·æ˜¾ç¤ºä»»ä½•åŒ…å«åœ¨æ­¤ç±»é”™è¯¯å“åº”ä¸­çš„å®ä½“å†…å®¹ã€‚</p>
<p>å¦‚æœé”™è¯¯å‘ç”Ÿæ—¶å®¢æˆ·ç«¯æ­£åœ¨ä¼ é€æ•°æ®ï¼Œé‚£ä¹ˆä½¿ç”¨TCPçš„æœåŠ¡å™¨å®ç°åº”å½“ä»”ç»†ç¡®ä¿åœ¨å…³é—­å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥ä¹‹å‰ï¼Œå®¢æˆ·ç«¯å·²ç»æ”¶åˆ°äº†åŒ…å«é”™è¯¯ä¿¡æ¯çš„æ•°æ®åŒ…ã€‚å¦‚æœå®¢æˆ·ç«¯åœ¨æ”¶åˆ°é”™è¯¯ä¿¡æ¯åç»§ç»­å‘æœåŠ¡å™¨å‘é€æ•°æ®ï¼ŒæœåŠ¡å™¨çš„TCPæ ˆå°†å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªé‡ç½®æ•°æ®åŒ…ï¼Œä»¥æ¸…é™¤è¯¥å®¢æˆ·ç«¯æ‰€æœ‰è¿˜æœªè¯†åˆ«çš„è¾“å…¥ç¼“å†²ï¼Œä»¥å…è¿™äº›æ•°æ®è¢«æœåŠ¡å™¨ä¸Šçš„åº”ç”¨ç¨‹åºè¯»å–å¹¶å¹²æ‰°åè€…ã€‚</p>
<ul>
<li><p>400 Bad Request<br>ç”±äºæ˜æ˜¾çš„å®¢æˆ·ç«¯é”™è¯¯ï¼ˆä¾‹å¦‚ï¼Œæ ¼å¼é”™è¯¯çš„è¯·æ±‚è¯­æ³•ï¼Œå¤ªå¤§çš„å¤§å°ï¼Œæ— æ•ˆçš„è¯·æ±‚æ¶ˆæ¯æˆ–æ¬ºéª—æ€§è·¯ç”±è¯·æ±‚ï¼‰ï¼ŒæœåŠ¡å™¨ä¸èƒ½æˆ–ä¸ä¼šå¤„ç†è¯¥è¯·æ±‚ã€‚</p>
</li>
<li><p>401 Unauthorizedï¼ˆRFC 7235ï¼‰<br>å‚è§ï¼šHTTPåŸºæœ¬è®¤è¯ã€HTTPæ‘˜è¦è®¤è¯<br>ç±»ä¼¼äº403 Forbiddenï¼Œ401è¯­ä¹‰å³â€œæœªè®¤è¯â€ï¼Œå³ç”¨æˆ·æ²¡æœ‰å¿…è¦çš„å‡­æ®ã€‚è¯¥çŠ¶æ€ç è¡¨ç¤ºå½“å‰è¯·æ±‚éœ€è¦ç”¨æˆ·éªŒè¯ã€‚è¯¥å“åº”å¿…é¡»åŒ…å«ä¸€ä¸ªé€‚ç”¨äºè¢«è¯·æ±‚èµ„æºçš„WWW-Authenticateä¿¡æ¯å¤´ç”¨ä»¥è¯¢é—®ç”¨æˆ·ä¿¡æ¯ã€‚å®¢æˆ·ç«¯å¯ä»¥é‡å¤æäº¤ä¸€ä¸ªåŒ…å«æ°å½“çš„Authorizationå¤´ä¿¡æ¯çš„è¯·æ±‚ã€‚[33]å¦‚æœå½“å‰è¯·æ±‚å·²ç»åŒ…å«äº†Authorizationè¯ä¹¦ï¼Œé‚£ä¹ˆ401å“åº”ä»£è¡¨ç€æœåŠ¡å™¨éªŒè¯å·²ç»æ‹’ç»äº†é‚£äº›è¯ä¹¦ã€‚å¦‚æœ401å“åº”åŒ…å«äº†ä¸å‰ä¸€ä¸ªå“åº”ç›¸åŒçš„èº«ä»½éªŒè¯è¯¢é—®ï¼Œä¸”æµè§ˆå™¨å·²ç»è‡³å°‘å°è¯•äº†ä¸€æ¬¡éªŒè¯ï¼Œé‚£ä¹ˆæµè§ˆå™¨åº”å½“å‘ç”¨æˆ·å±•ç¤ºå“åº”ä¸­åŒ…å«çš„å®ä½“ä¿¡æ¯ï¼Œå› ä¸ºè¿™ä¸ªå®ä½“ä¿¡æ¯ä¸­å¯èƒ½åŒ…å«äº†ç›¸å…³è¯Šæ–­ä¿¡æ¯ã€‚<br>æ³¨æ„ï¼šå½“ç½‘ç«™ï¼ˆé€šå¸¸æ˜¯ç½‘ç«™åŸŸåï¼‰ç¦æ­¢IPåœ°å€æ—¶ï¼Œæœ‰äº›ç½‘ç«™çŠ¶æ€ç æ˜¾ç¤ºçš„401ï¼Œè¡¨ç¤ºè¯¥ç‰¹å®šåœ°å€è¢«æ‹’ç»è®¿é—®ç½‘ç«™ã€‚</p>
</li>
<li><p>402 Payment Required<br>è¯¥çŠ¶æ€ç æ˜¯ä¸ºäº†å°†æ¥å¯èƒ½çš„éœ€æ±‚è€Œé¢„ç•™çš„ã€‚è¯¥çŠ¶æ€ç æœ€åˆçš„æ„å›¾å¯èƒ½è¢«ç”¨ä½œæŸç§å½¢å¼çš„æ•°å­—ç°é‡‘æˆ–åœ¨çº¿æ”¯ä»˜æ–¹æ¡ˆçš„ä¸€éƒ¨åˆ†ï¼Œä½†å‡ ä¹æ²¡æœ‰å“ªå®¶æœåŠ¡å•†ä½¿ç”¨ï¼Œè€Œä¸”è¿™ä¸ªçŠ¶æ€ç é€šå¸¸ä¸è¢«ä½¿ç”¨ã€‚å¦‚æœç‰¹å®šå¼€å‘äººå‘˜å·²è¶…è¿‡è¯·æ±‚çš„æ¯æ—¥é™åˆ¶ï¼ŒGoogle Developers APIä¼šä½¿ç”¨æ­¤çŠ¶æ€ç ã€‚</p>
</li>
<li><p>403 Forbidden<br>ä¸»æ¡ç›®ï¼šHTTP 403<br>æœåŠ¡å™¨å·²ç»ç†è§£è¯·æ±‚ï¼Œä½†æ˜¯æ‹’ç»æ‰§è¡Œå®ƒã€‚ä¸401å“åº”ä¸åŒçš„æ˜¯ï¼Œèº«ä»½éªŒè¯å¹¶ä¸èƒ½æä¾›ä»»ä½•å¸®åŠ©ï¼Œè€Œä¸”è¿™ä¸ªè¯·æ±‚ä¹Ÿä¸åº”è¯¥è¢«é‡å¤æäº¤ã€‚å¦‚æœè¿™ä¸æ˜¯ä¸€ä¸ªHEADè¯·æ±‚ï¼Œè€Œä¸”æœåŠ¡å™¨å¸Œæœ›èƒ½å¤Ÿè®²æ¸…æ¥šä¸ºä½•è¯·æ±‚ä¸èƒ½è¢«æ‰§è¡Œï¼Œé‚£ä¹ˆå°±åº”è¯¥åœ¨å®ä½“å†…æè¿°æ‹’ç»çš„åŸå› ã€‚å½“ç„¶æœåŠ¡å™¨ä¹Ÿå¯ä»¥è¿”å›ä¸€ä¸ª404å“åº”ï¼Œå‡å¦‚å®ƒä¸å¸Œæœ›è®©å®¢æˆ·ç«¯è·å¾—ä»»ä½•ä¿¡æ¯ã€‚</p>
</li>
<li><p>404 Not Found<br>ä¸»æ¡ç›®ï¼šHTTP 404<br>è¯·æ±‚å¤±è´¥ï¼Œè¯·æ±‚æ‰€å¸Œæœ›å¾—åˆ°çš„èµ„æºæœªè¢«åœ¨æœåŠ¡å™¨ä¸Šå‘ç°ï¼Œä½†å…è®¸ç”¨æˆ·çš„åç»­è¯·æ±‚ã€‚æ²¡æœ‰ä¿¡æ¯èƒ½å¤Ÿå‘Šè¯‰ç”¨æˆ·è¿™ä¸ªçŠ¶å†µåˆ°åº•æ˜¯æš‚æ—¶çš„è¿˜æ˜¯æ°¸ä¹…çš„ã€‚å‡å¦‚æœåŠ¡å™¨çŸ¥é“æƒ…å†µçš„è¯ï¼Œåº”å½“ä½¿ç”¨410çŠ¶æ€ç æ¥å‘ŠçŸ¥æ—§èµ„æºå› ä¸ºæŸäº›å†…éƒ¨çš„é…ç½®æœºåˆ¶é—®é¢˜ï¼Œå·²ç»æ°¸ä¹…çš„ä¸å¯ç”¨ï¼Œè€Œä¸”æ²¡æœ‰ä»»ä½•å¯ä»¥è·³è½¬çš„åœ°å€ã€‚404è¿™ä¸ªçŠ¶æ€ç è¢«å¹¿æ³›åº”ç”¨äºå½“æœåŠ¡å™¨ä¸æƒ³æ­ç¤ºåˆ°åº•ä¸ºä½•è¯·æ±‚è¢«æ‹’ç»æˆ–è€…æ²¡æœ‰å…¶ä»–é€‚åˆçš„å“åº”å¯ç”¨çš„æƒ…å†µä¸‹ã€‚</p>
</li>
<li><p>405 Method Not Allowed<br>è¯·æ±‚è¡Œä¸­æŒ‡å®šçš„è¯·æ±‚æ–¹æ³•ä¸èƒ½è¢«ç”¨äºè¯·æ±‚ç›¸åº”çš„èµ„æºã€‚è¯¥å“åº”å¿…é¡»è¿”å›ä¸€ä¸ªAllowå¤´ä¿¡æ¯ç”¨ä»¥è¡¨ç¤ºå‡ºå½“å‰èµ„æºèƒ½å¤Ÿæ¥å—çš„è¯·æ±‚æ–¹æ³•çš„åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼Œéœ€è¦é€šè¿‡POSTå‘ˆç°æ•°æ®çš„è¡¨å•ä¸Šçš„GETè¯·æ±‚ï¼Œæˆ–åªè¯»èµ„æºä¸Šçš„PUTè¯·æ±‚ã€‚<br>é‰´äºPUTï¼ŒDELETEæ–¹æ³•ä¼šå¯¹æœåŠ¡å™¨ä¸Šçš„èµ„æºè¿›è¡Œå†™æ“ä½œï¼Œå› è€Œç»å¤§éƒ¨åˆ†çš„ç½‘é¡µæœåŠ¡å™¨éƒ½ä¸æ”¯æŒæˆ–è€…åœ¨é»˜è®¤é…ç½®ä¸‹ä¸å…è®¸ä¸Šè¿°è¯·æ±‚æ–¹æ³•ï¼Œå¯¹äºæ­¤ç±»è¯·æ±‚å‡ä¼šè¿”å›405é”™è¯¯ã€‚</p>
</li>
<li><p>406 Not Acceptable<br>å‚è§ï¼šå†…å®¹åå•†<br>è¯·æ±‚çš„èµ„æºçš„å†…å®¹ç‰¹æ€§æ— æ³•æ»¡è¶³è¯·æ±‚å¤´ä¸­çš„æ¡ä»¶ï¼Œå› è€Œæ— æ³•ç”Ÿæˆå“åº”å®ä½“ï¼Œè¯¥è¯·æ±‚ä¸å¯æ¥å—ã€‚<br>é™¤éè¿™æ˜¯ä¸€ä¸ªHEADè¯·æ±‚ï¼Œå¦åˆ™è¯¥å“åº”å°±åº”å½“è¿”å›ä¸€ä¸ªåŒ…å«å¯ä»¥è®©ç”¨æˆ·æˆ–è€…æµè§ˆå™¨ä»ä¸­é€‰æ‹©æœ€åˆé€‚çš„å®ä½“ç‰¹æ€§ä»¥åŠåœ°å€åˆ—è¡¨çš„å®ä½“ã€‚å®ä½“çš„æ ¼å¼ç”±Content-Typeå¤´ä¸­å®šä¹‰çš„åª’ä½“ç±»å‹å†³å®šã€‚æµè§ˆå™¨å¯ä»¥æ ¹æ®æ ¼å¼åŠè‡ªèº«èƒ½åŠ›è‡ªè¡Œä½œå‡ºæœ€ä½³é€‰æ‹©ã€‚ä½†æ˜¯ï¼Œè§„èŒƒä¸­å¹¶æ²¡æœ‰å®šä¹‰ä»»ä½•ä½œå‡ºæ­¤ç±»è‡ªåŠ¨é€‰æ‹©çš„æ ‡å‡†ã€‚</p>
</li>
<li><p>407 Proxy Authentication Requiredï¼ˆRFC 2617ï¼‰<br>ä¸401å“åº”ç±»ä¼¼ï¼Œåªä¸è¿‡å®¢æˆ·ç«¯å¿…é¡»åœ¨ä»£ç†æœåŠ¡å™¨ä¸Šè¿›è¡Œèº«ä»½éªŒè¯ã€‚ä»£ç†æœåŠ¡å™¨å¿…é¡»è¿”å›ä¸€ä¸ªProxy-Authenticateç”¨ä»¥è¿›è¡Œèº«ä»½è¯¢é—®ã€‚å®¢æˆ·ç«¯å¯ä»¥è¿”å›ä¸€ä¸ªProxy-Authorizationä¿¡æ¯å¤´ç”¨ä»¥éªŒè¯ã€‚</p>
</li>
<li><p>408 Request Timeout<br>è¯·æ±‚è¶…æ—¶ã€‚æ ¹æ®HTTPè§„èŒƒï¼Œå®¢æˆ·ç«¯æ²¡æœ‰åœ¨æœåŠ¡å™¨é¢„å¤‡ç­‰å¾…çš„æ—¶é—´å†…å®Œæˆä¸€ä¸ªè¯·æ±‚çš„å‘é€ï¼Œå®¢æˆ·ç«¯å¯ä»¥éšæ—¶å†æ¬¡æäº¤è¿™ä¸€è¯·æ±‚è€Œæ— éœ€è¿›è¡Œä»»ä½•æ›´æ”¹ã€‚</p>
</li>
<li><p>409 Conflict<br>è¡¨ç¤ºå› ä¸ºè¯·æ±‚å­˜åœ¨å†²çªæ— æ³•å¤„ç†è¯¥è¯·æ±‚ï¼Œä¾‹å¦‚å¤šä¸ªåŒæ­¥æ›´æ–°ä¹‹é—´çš„ç¼–è¾‘å†²çªã€‚</p>
</li>
<li><p>410 Gone<br>è¡¨ç¤ºæ‰€è¯·æ±‚çš„èµ„æºä¸å†å¯ç”¨ï¼Œå°†ä¸å†å¯ç”¨ã€‚å½“èµ„æºè¢«æœ‰æ„åœ°åˆ é™¤å¹¶ä¸”èµ„æºåº”è¢«æ¸…é™¤æ—¶ï¼Œåº”è¯¥ä½¿ç”¨è¿™ä¸ªã€‚åœ¨æ”¶åˆ°410çŠ¶æ€ç åï¼Œç”¨æˆ·åº”åœæ­¢å†æ¬¡è¯·æ±‚èµ„æºã€‚ä½†å¤§å¤šæ•°æœåŠ¡ç«¯ä¸ä¼šä½¿ç”¨æ­¤çŠ¶æ€ç ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨404çŠ¶æ€ç ã€‚</p>
</li>
<li><p>411 Length Required<br>æœåŠ¡å™¨æ‹’ç»åœ¨æ²¡æœ‰å®šä¹‰Content-Lengthå¤´çš„æƒ…å†µä¸‹æ¥å—è¯·æ±‚ã€‚åœ¨æ·»åŠ äº†è¡¨æ˜è¯·æ±‚æ¶ˆæ¯ä½“é•¿åº¦çš„æœ‰æ•ˆContent-Lengthå¤´ä¹‹åï¼Œå®¢æˆ·ç«¯å¯ä»¥å†æ¬¡æäº¤è¯¥è¯·æ±‚ã€‚</p>
</li>
<li><p>412 Precondition Failedï¼ˆRFC 7232ï¼‰<br>æœåŠ¡å™¨åœ¨éªŒè¯åœ¨è¯·æ±‚çš„å¤´å­—æ®µä¸­ç»™å‡ºå…ˆå†³æ¡ä»¶æ—¶ï¼Œæ²¡èƒ½æ»¡è¶³å…¶ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªã€‚è¿™ä¸ªçŠ¶æ€ç å…è®¸å®¢æˆ·ç«¯åœ¨è·å–èµ„æºæ—¶åœ¨è¯·æ±‚çš„å…ƒä¿¡æ¯ï¼ˆè¯·æ±‚å¤´å­—æ®µæ•°æ®ï¼‰ä¸­è®¾ç½®å…ˆå†³æ¡ä»¶ï¼Œä»¥æ­¤é¿å…è¯¥è¯·æ±‚æ–¹æ³•è¢«åº”ç”¨åˆ°å…¶å¸Œæœ›çš„å†…å®¹ä»¥å¤–çš„èµ„æºä¸Šã€‚</p>
</li>
<li><p>413 Request Entity Too Largeï¼ˆRFC 7231ï¼‰<br>å‰ç§°â€œRequest Entity Too Largeâ€ï¼Œè¡¨ç¤ºæœåŠ¡å™¨æ‹’ç»å¤„ç†å½“å‰è¯·æ±‚ï¼Œå› ä¸ºè¯¥è¯·æ±‚æäº¤çš„å®ä½“æ•°æ®å¤§å°è¶…è¿‡äº†æœåŠ¡å™¨æ„¿æ„æˆ–è€…èƒ½å¤Ÿå¤„ç†çš„èŒƒå›´ã€‚æ­¤ç§æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨å¯ä»¥å…³é—­è¿æ¥ä»¥å…å®¢æˆ·ç«¯ç»§ç»­å‘é€æ­¤è¯·æ±‚ã€‚<br>å¦‚æœè¿™ä¸ªçŠ¶å†µæ˜¯ä¸´æ—¶çš„ï¼ŒæœåŠ¡å™¨åº”å½“è¿”å›ä¸€ä¸ªRetry-Afterçš„å“åº”å¤´ï¼Œä»¥å‘ŠçŸ¥å®¢æˆ·ç«¯å¯ä»¥åœ¨å¤šå°‘æ—¶é—´ä»¥åé‡æ–°å°è¯•ã€‚</p>
</li>
<li><p>414 Request-URI Too Longï¼ˆRFC 7231ï¼‰<br>å‰ç§°â€œRequest-URI Too Longâ€ï¼Œè¡¨ç¤ºè¯·æ±‚çš„URIé•¿åº¦è¶…è¿‡äº†æœåŠ¡å™¨èƒ½å¤Ÿè§£é‡Šçš„é•¿åº¦ï¼Œå› æ­¤æœåŠ¡å™¨æ‹’ç»å¯¹è¯¥è¯·æ±‚æä¾›æœåŠ¡ã€‚é€šå¸¸å°†å¤ªå¤šæ•°æ®çš„ç»“æœç¼–ç ä¸ºGETè¯·æ±‚çš„æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåº”å°†å…¶è½¬æ¢ä¸ºPOSTè¯·æ±‚ã€‚è¿™æ¯”è¾ƒå°‘è§ï¼Œé€šå¸¸çš„æƒ…å†µåŒ…æ‹¬ï¼š<br>æœ¬åº”ä½¿ç”¨POSTæ–¹æ³•çš„è¡¨å•æäº¤å˜æˆäº†GETæ–¹æ³•ï¼Œå¯¼è‡´æŸ¥è¯¢å­—ç¬¦ä¸²è¿‡é•¿ã€‚<br>é‡å®šå‘URIâ€œé»‘æ´â€ï¼Œä¾‹å¦‚æ¯æ¬¡é‡å®šå‘æŠŠæ—§çš„URIä½œä¸ºæ–°çš„URIçš„ä¸€éƒ¨åˆ†ï¼Œå¯¼è‡´åœ¨è‹¥å¹²æ¬¡é‡å®šå‘åURIè¶…é•¿ã€‚<br>å®¢æˆ·ç«¯æ­£åœ¨å°è¯•åˆ©ç”¨æŸäº›æœåŠ¡å™¨ä¸­å­˜åœ¨çš„å®‰å…¨æ¼æ´æ”»å‡»æœåŠ¡å™¨ã€‚è¿™ç±»æœåŠ¡å™¨ä½¿ç”¨å›ºå®šé•¿åº¦çš„ç¼“å†²è¯»å–æˆ–æ“ä½œè¯·æ±‚çš„URIï¼Œå½“GETåçš„å‚æ•°è¶…è¿‡æŸä¸ªæ•°å€¼åï¼Œå¯èƒ½ä¼šäº§ç”Ÿç¼“å†²åŒºæº¢å‡ºï¼Œå¯¼è‡´ä»»æ„ä»£ç è¢«æ‰§è¡Œã€‚æ²¡æœ‰æ­¤ç±»æ¼æ´çš„æœåŠ¡å™¨ï¼Œåº”å½“è¿”å›414çŠ¶æ€ç ã€‚</p>
</li>
<li><p>415 Unsupported Media Type<br>å¯¹äºå½“å‰è¯·æ±‚çš„æ–¹æ³•å’Œæ‰€è¯·æ±‚çš„èµ„æºï¼Œè¯·æ±‚ä¸­æäº¤çš„äº’è”ç½‘åª’ä½“ç±»å‹å¹¶ä¸æ˜¯æœåŠ¡å™¨ä¸­æ‰€æ”¯æŒçš„æ ¼å¼ï¼Œå› æ­¤è¯·æ±‚è¢«æ‹’ç»ã€‚ä¾‹å¦‚ï¼Œå®¢æˆ·ç«¯å°†å›¾åƒä¸Šä¼ æ ¼å¼ä¸ºsvgï¼Œä½†æœåŠ¡å™¨è¦æ±‚å›¾åƒä½¿ç”¨ä¸Šä¼ æ ¼å¼ä¸ºjpgã€‚</p>
</li>
<li><p>416 Requested Range Not Satisfiableï¼ˆRFC 7233ï¼‰<br>å‰ç§°â€œRequested Range Not Satisfiableâ€ã€‚å®¢æˆ·ç«¯å·²ç»è¦æ±‚æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼ˆByte servingï¼‰ï¼Œä½†æœåŠ¡å™¨ä¸èƒ½æä¾›è¯¥éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå®¢æˆ·ç«¯è¦æ±‚æ–‡ä»¶çš„ä¸€éƒ¨åˆ†è¶…å‡ºæ–‡ä»¶å°¾ç«¯ã€‚</p>
</li>
<li><p>417 Expectation Failed<br>åœ¨è¯·æ±‚å¤´Expectä¸­æŒ‡å®šçš„é¢„æœŸå†…å®¹æ— æ³•è¢«æœåŠ¡å™¨æ»¡è¶³ï¼Œæˆ–è€…è¿™ä¸ªæœåŠ¡å™¨æ˜¯ä¸€ä¸ªä»£ç†æœæ˜¾çš„è¯æ®è¯æ˜åœ¨å½“å‰è·¯ç”±çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼ŒExpectçš„å†…å®¹æ— æ³•è¢«æ»¡è¶³ã€‚</p>
</li>
<li><p>418 Iâ€™m a teapotï¼ˆRFC 2324ï¼‰<br>æœ¬æ“ä½œç æ˜¯åœ¨1998å¹´ä½œä¸ºIETFçš„ä¼ ç»Ÿæ„šäººèŠ‚ç¬‘è¯, åœ¨RFC 2324è¶…æ–‡æœ¬å’–å•¡å£¶æ§åˆ¶åè®®â€™ä¸­å®šä¹‰çš„ï¼Œå¹¶ä¸éœ€è¦åœ¨çœŸå®çš„HTTPæœåŠ¡å™¨ä¸­å®šä¹‰ã€‚å½“ä¸€ä¸ªæ§åˆ¶èŒ¶å£¶çš„HTCPCPæ”¶åˆ°BREWæˆ–POSTæŒ‡ä»¤è¦æ±‚å…¶ç…®å’–å•¡æ—¶åº”å½“å›ä¼ æ­¤é”™è¯¯ã€‚è¿™ä¸ªHTTPçŠ¶æ€ç åœ¨æŸäº›ç½‘ç«™ï¼ˆåŒ…æ‹¬Google.comï¼‰ä¸é¡¹ç›®ï¼ˆå¦‚Node.jsã€ASP.NETå’ŒGoè¯­è¨€ï¼‰ä¸­ç”¨ä½œå½©è›‹ã€‚</p>
</li>
<li><p>420 Enhance Your Caim<br>Twitter Searchä¸Trends APIåœ¨å®¢æˆ·ç«¯è¢«é™é€Ÿçš„æƒ…å†µä¸‹è¿”å›ã€‚</p>
</li>
<li><p>421 Misdirected Request ï¼ˆRFC 7540ï¼‰<br>è¯¥è¯·æ±‚é’ˆå¯¹çš„æ˜¯æ— æ³•äº§ç”Ÿå“åº”çš„æœåŠ¡å™¨ï¼ˆä¾‹å¦‚å› ä¸ºè¿æ¥é‡ç”¨ï¼‰ã€‚</p>
</li>
<li><p>422 Unprocessable Entityï¼ˆWebDAVï¼›RFC 4918 ï¼‰<br>è¯·æ±‚æ ¼å¼æ­£ç¡®ï¼Œä½†æ˜¯ç”±äºå«æœ‰è¯­ä¹‰é”™è¯¯ï¼Œæ— æ³•å“åº”ã€‚</p>
</li>
<li><p>423 Lockedï¼ˆWebDAVï¼›RFC 4918ï¼‰<br>å½“å‰èµ„æºè¢«é”å®šã€‚</p>
</li>
<li><p>424 Failed Dependencyï¼ˆWebDAVï¼›RFC 4918ï¼‰<br>ç”±äºä¹‹å‰çš„æŸä¸ªè¯·æ±‚å‘ç”Ÿçš„é”™è¯¯ï¼Œå¯¼è‡´å½“å‰è¯·æ±‚å¤±è´¥ï¼Œä¾‹å¦‚PROPPATCHã€‚</p>
</li>
<li><p>425 Unordered Collection<br>åœ¨WebDAV Advanced Collections Protocolä¸­å®šä¹‰ï¼Œä½†Web Distributed Authoring and Versioning (WebDAV) Ordered Collections Protocolä¸­å¹¶ä¸å­˜åœ¨ã€‚</p>
</li>
<li><p>426 Upgrade Requiredï¼ˆRFC 2817ï¼‰<br>å®¢æˆ·ç«¯åº”å½“åˆ‡æ¢åˆ°TLS/1.0ï¼Œå¹¶åœ¨HTTP/1.1 Upgrade headerä¸­ç»™å‡ºã€‚</p>
</li>
<li><p>428 Precondition Required (RFC 6585)<br>åŸæœåŠ¡å™¨è¦æ±‚è¯¥è¯·æ±‚æ»¡è¶³ä¸€å®šæ¡ä»¶ã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢â€œâ€˜æœªæ›´æ–°â€™é—®é¢˜ï¼Œå³å®¢æˆ·ç«¯è¯»å–ï¼ˆGETï¼‰ä¸€ä¸ªèµ„æºçš„çŠ¶æ€ï¼Œæ›´æ”¹å®ƒï¼Œå¹¶å°†å®ƒå†™ï¼ˆPUTï¼‰å›æœåŠ¡å™¨ï¼Œä½†è¿™æœŸé—´ç¬¬ä¸‰æ–¹å·²ç»åœ¨æœåŠ¡å™¨ä¸Šæ›´æ”¹äº†è¯¥èµ„æºçš„çŠ¶æ€ï¼Œå› æ­¤å¯¼è‡´äº†å†²çªã€‚â€</p>
</li>
<li><p>429 Too Many Requests ï¼ˆRFC 6585ï¼‰<br>ç”¨æˆ·åœ¨ç»™å®šçš„æ—¶é—´å†…å‘é€äº†å¤ªå¤šçš„è¯·æ±‚ã€‚æ—¨åœ¨ç”¨äºç½‘ç»œé™é€Ÿã€‚</p>
</li>
<li><p>431 Request Header Fields Too Large ï¼ˆRFC 6585ï¼‰<br>æœåŠ¡å™¨ä¸æ„¿å¤„ç†è¯·æ±‚ï¼Œå› ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªå¤´å­—æ®µè¿‡å¤§ã€‚</p>
</li>
<li><p>444 No Response<br>Nginxä¸ŠHTTPæœåŠ¡å™¨æ‰©å±•ã€‚æœåŠ¡å™¨ä¸å‘å®¢æˆ·ç«¯è¿”å›ä»»ä½•ä¿¡æ¯ï¼Œå¹¶å…³é—­è¿æ¥ï¼ˆæœ‰åŠ©äºé˜»æ­¢æ¶æ„è½¯ä»¶ï¼‰ã€‚</p>
</li>
<li><p>450 Blocked by Windows Parental Controls<br>è¿™æ˜¯ä¸€ä¸ªç”±Windowså®¶åº­æ§åˆ¶ï¼ˆMicrosoftï¼‰HTTPé˜»æ­¢çš„450çŠ¶æ€ä»£ç çš„ç¤ºä¾‹ï¼Œç”¨äºä¿¡æ¯å’Œæµ‹è¯•ã€‚</p>
</li>
<li><p>451 Unavailable For Legal Reasons<br>è¯¥è®¿é—®å› æ³•å¾‹çš„è¦æ±‚è€Œè¢«æ‹’ç»ï¼Œç”±IETFåœ¨2015æ ¸å‡†åæ–°å¢åŠ ã€‚</p>
</li>
<li><p>494 Request Header Too Large<br>åœ¨é”™è¯¯ä»£ç 431æå‡ºä¹‹å‰Nginxä¸Šä½¿ç”¨çš„æ‰©å±•HTTPä»£ç ã€‚</p>
</li>
</ul>
<h2 id="5xx-æœåŠ¡å™¨é”™è¯¯"><a href="#5xx-æœåŠ¡å™¨é”™è¯¯" class="headerlink" title="5xx-æœåŠ¡å™¨é”™è¯¯"></a>5xx-æœåŠ¡å™¨é”™è¯¯</h2><p>è¡¨ç¤ºæœåŠ¡å™¨æ— æ³•å®Œæˆæ˜æ˜¾æœ‰æ•ˆçš„è¯·æ±‚ã€‚è¿™ç±»çŠ¶æ€ç ä»£è¡¨äº†æœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­æœ‰é”™è¯¯æˆ–è€…å¼‚å¸¸çŠ¶æ€å‘ç”Ÿï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯æœåŠ¡å™¨æ„è¯†åˆ°ä»¥å½“å‰çš„è½¯ç¡¬ä»¶èµ„æºæ— æ³•å®Œæˆå¯¹è¯·æ±‚çš„å¤„ç†ã€‚é™¤éè¿™æ˜¯ä¸€ä¸ªHEADè¯·æ±‚ï¼Œå¦åˆ™æœåŠ¡å™¨åº”å½“åŒ…å«ä¸€ä¸ªè§£é‡Šå½“å‰é”™è¯¯çŠ¶æ€ä»¥åŠè¿™ä¸ªçŠ¶å†µæ˜¯ä¸´æ—¶çš„è¿˜æ˜¯æ°¸ä¹…çš„è§£é‡Šä¿¡æ¯å®ä½“ã€‚æµè§ˆå™¨åº”å½“å‘ç”¨æˆ·å±•ç¤ºä»»ä½•åœ¨å½“å‰å“åº”ä¸­è¢«åŒ…å«çš„å®ä½“ã€‚è¿™äº›çŠ¶æ€ç é€‚ç”¨äºä»»ä½•å“åº”æ–¹æ³•ã€‚</p>
<ul>
<li><p>500 Internal Server Error<br>é€šç”¨é”™è¯¯æ¶ˆæ¯ï¼ŒæœåŠ¡å™¨é‡åˆ°äº†ä¸€ä¸ªæœªæ›¾é¢„æ–™çš„çŠ¶å†µï¼Œå¯¼è‡´äº†å®ƒæ— æ³•å®Œæˆå¯¹è¯·æ±‚çš„å¤„ç†ã€‚æ²¡æœ‰ç»™å‡ºå…·ä½“é”™è¯¯ä¿¡æ¯ã€‚</p>
</li>
<li><p>501 Not Implemented<br>æœåŠ¡å™¨ä¸æ”¯æŒå½“å‰è¯·æ±‚æ‰€éœ€è¦çš„æŸä¸ªåŠŸèƒ½ã€‚å½“æœåŠ¡å™¨æ— æ³•è¯†åˆ«è¯·æ±‚çš„æ–¹æ³•ï¼Œå¹¶ä¸”æ— æ³•æ”¯æŒå…¶å¯¹ä»»ä½•èµ„æºçš„è¯·æ±‚ã€‚ï¼ˆä¾‹å¦‚ï¼Œç½‘ç»œæœåŠ¡APIçš„æ–°åŠŸèƒ½ï¼‰</p>
</li>
<li><p>502 Bad Gateway<br>ä½œä¸ºç½‘å…³æˆ–è€…ä»£ç†å·¥ä½œçš„æœåŠ¡å™¨å°è¯•æ‰§è¡Œè¯·æ±‚æ—¶ï¼Œä»ä¸Šæ¸¸æœåŠ¡å™¨æ¥æ”¶åˆ°æ— æ•ˆçš„å“åº”ã€‚</p>
</li>
<li><p>503 Service Unavailable<br>ç”±äºä¸´æ—¶çš„æœåŠ¡å™¨ç»´æŠ¤æˆ–è€…è¿‡è½½ï¼ŒæœåŠ¡å™¨å½“å‰æ— æ³•å¤„ç†è¯·æ±‚ã€‚è¿™ä¸ªçŠ¶å†µæ˜¯æš‚æ—¶çš„ï¼Œå¹¶ä¸”å°†åœ¨ä¸€æ®µæ—¶é—´ä»¥åæ¢å¤ã€‚å¦‚æœèƒ½å¤Ÿé¢„è®¡å»¶è¿Ÿæ—¶é—´ï¼Œé‚£ä¹ˆå“åº”ä¸­å¯ä»¥åŒ…å«ä¸€ä¸ªRetry-Afterå¤´ç”¨ä»¥æ ‡æ˜è¿™ä¸ªå»¶è¿Ÿæ—¶é—´ã€‚å¦‚æœæ²¡æœ‰ç»™å‡ºè¿™ä¸ªRetry-Afterä¿¡æ¯ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯åº”å½“ä»¥å¤„ç†500å“åº”çš„æ–¹å¼å¤„ç†å®ƒã€‚</p>
</li>
<li><p>504 Gateway Timeout<br>ä½œä¸ºç½‘å…³æˆ–è€…ä»£ç†å·¥ä½œçš„æœåŠ¡å™¨å°è¯•æ‰§è¡Œè¯·æ±‚æ—¶ï¼Œæœªèƒ½åŠæ—¶ä»ä¸Šæ¸¸æœåŠ¡å™¨ï¼ˆURIæ ‡è¯†å‡ºçš„æœåŠ¡å™¨ï¼Œä¾‹å¦‚HTTPã€FTPã€LDAPï¼‰æˆ–è€…è¾…åŠ©æœåŠ¡å™¨ï¼ˆä¾‹å¦‚DNSï¼‰æ”¶åˆ°å“åº”ã€‚<br>æ³¨æ„ï¼šæŸäº›ä»£ç†æœåŠ¡å™¨åœ¨DNSæŸ¥è¯¢è¶…æ—¶æ—¶ä¼šè¿”å›400æˆ–è€…500é”™è¯¯ã€‚</p>
</li>
<li><p>505 HTTP Version Not Supported<br>æœåŠ¡å™¨ä¸æ”¯æŒï¼Œæˆ–è€…æ‹’ç»æ”¯æŒåœ¨è¯·æ±‚ä¸­ä½¿ç”¨çš„HTTPç‰ˆæœ¬ã€‚[63]è¿™æš—ç¤ºç€æœåŠ¡å™¨ä¸èƒ½æˆ–ä¸æ„¿ä½¿ç”¨ä¸å®¢æˆ·ç«¯ç›¸åŒçš„ç‰ˆæœ¬ã€‚å“åº”ä¸­åº”å½“åŒ…å«ä¸€ä¸ªæè¿°äº†ä¸ºä½•ç‰ˆæœ¬ä¸è¢«æ”¯æŒä»¥åŠæœåŠ¡å™¨æ”¯æŒå“ªäº›åè®®çš„å®ä½“ã€‚</p>
</li>
<li><p>506 Variant Also Negotiatesï¼ˆRFC 2295ï¼‰<br>ç”±ã€Šé€æ˜å†…å®¹åå•†åè®®ã€‹ï¼ˆRFC 2295ï¼‰æ‰©å±•ï¼Œä»£è¡¨æœåŠ¡å™¨å­˜åœ¨å†…éƒ¨é…ç½®é”™è¯¯ï¼Œè¢«è¯·æ±‚çš„åå•†å˜å…ƒèµ„æºè¢«é…ç½®ä¸ºåœ¨é€æ˜å†…å®¹åå•†ä¸­ä½¿ç”¨è‡ªå·±ï¼Œå› æ­¤åœ¨ä¸€ä¸ªåå•†å¤„ç†ä¸­ä¸æ˜¯ä¸€ä¸ªåˆé€‚çš„é‡ç‚¹ã€‚</p>
</li>
<li><p>507 Insufficient Storageï¼ˆWebDAVï¼›RFC 4918ï¼‰<br>æœåŠ¡å™¨æ— æ³•å­˜å‚¨å®Œæˆè¯·æ±‚æ‰€å¿…é¡»çš„å†…å®¹ã€‚è¿™ä¸ªçŠ¶å†µè¢«è®¤ä¸ºæ˜¯ä¸´æ—¶çš„ã€‚</p>
</li>
<li><p>508 Loop Detected ï¼ˆWebDAVï¼›RFC 5842ï¼‰<br>æœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶é™·å…¥æ­»å¾ªç¯ã€‚ ï¼ˆå¯ä»£æ›¿ 208çŠ¶æ€ç ï¼‰</p>
</li>
<li><p>510 Not Extendedï¼ˆRFC 2774ï¼‰<br>è·å–èµ„æºæ‰€éœ€è¦çš„ç­–ç•¥å¹¶æ²¡æœ‰è¢«æ»¡è¶³ã€‚</p>
</li>
<li><p>511 Network Authentication Required ï¼ˆRFC 6585ï¼‰<br>å®¢æˆ·ç«¯éœ€è¦è¿›è¡Œèº«ä»½éªŒè¯æ‰èƒ½è·å¾—ç½‘ç»œè®¿é—®æƒé™ï¼Œæ—¨åœ¨é™åˆ¶ç”¨æˆ·ç¾¤è®¿é—®ç‰¹å®šç½‘ç»œã€‚ï¼ˆä¾‹å¦‚è¿æ¥WiFiçƒ­ç‚¹æ—¶çš„å¼ºåˆ¶ç½‘ç»œé—¨æˆ·ï¼‰</p>
</li>
</ul>
]]></content>
      <categories>
        <category>Http</category>
      </categories>
      <tags>
        <tag>HttpCode</tag>
      </tags>
  </entry>
  <entry>
    <title>Regex</title>
    <url>/2020/10/06/Regex/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Regex"><a href="#Regex" class="headerlink" title="Regex"></a>Regex</h1><center>
    <font face="Kristen ITC" color="#555555" font-size=100px>Khighness</font><br>
</center>



<h2 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1. ç®€ä»‹"></a>1. ç®€ä»‹</h2><blockquote>
<p>Regex</p>
</blockquote>
<p><strong>æ­£åˆ™è¡¨è¾¾å¼ï¼ŒRegular Expression</strong></p>
<blockquote>
<p>ä¸ºä»€ä¹ˆéœ€è¦æ­£åˆ™è¡¨è¾¾å¼ï¼Ÿ</p>
</blockquote>
<p><strong>æ–‡æœ¬çš„å¤æ‚å¤„ç†</strong></p>
<blockquote>
<p>æ­£åˆ™è¡¨è¾¾å¼çš„ä¼˜åŠ¿å’Œç”¨é€”ï¼Ÿ</p>
</blockquote>
<ul>
<li><strong>ä¸€ç§å¼ºå¤§è€Œçµæ´»çš„æ–‡æœ¬å¤„ç†å·¥å…·</strong></li>
<li><strong>å¤§éƒ¨åˆ†ç¼–ç¨‹è¯­è¨€ã€æ•°æ®åº“ã€æ–‡æœ¬ç¼–è¾‘å™¨ã€å¼€å‘ç¯å¢ƒéƒ½æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼</strong></li>
</ul>
<blockquote>
<p>æ­£åˆ™è¡¨è¾¾å¼å®šä¹‰ï¼š</p>
</blockquote>
<p><strong>ä¸€ç§å­—ç¬¦ä¸²åŒ¹é…çš„æ¨¡å¼</strong></p>
<blockquote>
<p>å¼€å‘ä¸­ä½¿ç”¨</p>
</blockquote>
<ul>
<li>åˆ†ææ‰€è¦åŒ¹é…çš„æ•°æ®ï¼Œå†™å‡ºæµ‹è¯•ç”¨çš„å…¸å‹æ•°æ®</li>
<li>åœ¨å·¥å…·è½¯ä»¶ä¸­è¿›è¡ŒåŒ¹é…æµ‹è¯•</li>
<li>åœ¨ç¨‹åºä¸­è°ƒç”¨æµ‹è¯•çš„æ­£åˆ™è¡¨è¾¾å¼</li>
</ul>
<h2 id="2-è¯­æ³•"><a href="#2-è¯­æ³•" class="headerlink" title="2. è¯­æ³•"></a>2. è¯­æ³•</h2><h3 id="2-1-æ ‡å‡†å­—ç¬¦é›†åˆ"><a href="#2-1-æ ‡å‡†å­—ç¬¦é›†åˆ" class="headerlink" title="2.1 æ ‡å‡†å­—ç¬¦é›†åˆ"></a>2.1 æ ‡å‡†å­—ç¬¦é›†åˆ</h3><ul>
<li>èƒ½å¤Ÿä¸â€å¤šç§å­—ç¬¦â€åŒ¹é…çš„è¡¨è¾¾å¼</li>
<li>æ³¨æ„åŒºåˆ†å¤§å°å†™ï¼Œå¤§å†™æ˜¯ç›¸åçš„æ„æ€</li>
</ul>
<table>
<thead>
<tr>
<th align="center">å­—ç¬¦</th>
<th align="center">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="center">\d</td>
<td align="center">ä»»æ„ä¸€ä¸ªæ•°å­—ï¼Œ0-9ä¸­çš„ä»»æ„ä¸€ä¸ª</td>
</tr>
<tr>
<td align="center">\w</td>
<td align="center">ä»»æ„ä¸€ä¸ªå­—æ¯æˆ–æ•°å­—æˆ–ä¸‹åˆ’çº¿ï¼Œä¹Ÿå°±æ˜¯A-Zã€a-zã€0-9ã€_ä¸­ä»»æ„ä¸€ä¸ª</td>
</tr>
<tr>
<td align="center">\s</td>
<td align="center">åŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦ç­‰ç©ºç™½å­—ç¬¦çš„å…¶ä¸­ä¸€ä¸ª</td>
</tr>
<tr>
<td align="center">.</td>
<td align="center">å°æ•°ç‚¹å¯ä»¥åŒ¹é…ä»»æ„ä¸€ä¸ªå­—ç¬¦(é™¤äº†æ¢è¡Œç¬¦)ï¼Œ å¦‚æœè¦åŒ¹é…åŒ…æ‹¬â€\nâ€åœ¨å†…çš„æ‰€æœ‰å­—ç¬¦ï¼Œä¸€èˆ¬ç”¨<code>[\s\S]</code></td>
</tr>
</tbody></table>
<p>å¦‚æœè¦åŒ¹é…çœŸæ­£çš„â€™.â€™ã€â€™+â€™ã€â€™-â€˜ã€â€™\&#39; ï¼Œ å°±è¦è½¬ä¹‰ï¼Œç”¨<code>\.</code>ã€<code>\+</code>ã€<code>\-</code>ã€<code>\\</code></p>
<h3 id="2-2-è‡ªå®šä¹‰å­—ç¬¦é›†åˆ"><a href="#2-2-è‡ªå®šä¹‰å­—ç¬¦é›†åˆ" class="headerlink" title="2.2 è‡ªå®šä¹‰å­—ç¬¦é›†åˆ"></a>2.2 è‡ªå®šä¹‰å­—ç¬¦é›†åˆ</h3><ul>
<li>[]æ–¹æ‹¬å·åŒ¹é…æ–¹å¼ï¼Œèƒ½å¤ŸåŒ¹é…æ–¹æ‹¬å·ä¸­ä»»æ„ä¸€ä¸ªå­—ç¬¦</li>
<li>æ­£åˆ™è¡¨è¾¾å¼çš„ç‰¹æ®Šç¬¦å·ï¼Œè¢«åŒ…å«åˆ°ä¸­æ‹¬å·ä¸­ï¼Œåˆ™å¤±å»äº†ç‰¹æ®Šæ„ä¹‰ï¼Œé™¤äº†^ã€-ä¹‹å¤–</li>
<li>æ ‡å‡†å­—ç¬¦é›†åˆï¼Œé™¤å°æ•°ç‚¹å¤–ï¼Œå¦‚æœè¢«åŒ…å«äºä¸­æ‹¬å·ï¼Œè‡ªå®šä¹‰å­—ç¬¦é›†åˆè¢«åŒ…å«è¯¥é›†åˆ<ul>
<li>[\d.-+]å°†åŒ¹é…ï¼šæ•°å­—ã€å°æ•°ç‚¹ã€+ã€-</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th align="center">ä¾‹å¦‚</th>
<th align="center">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="center">[ab5@]</td>
<td align="center">åŒ¹é…â€aâ€æˆ–â€bâ€æˆ–â€5â€æˆ–â€@â€</td>
</tr>
<tr>
<td align="center">[^abc]</td>
<td align="center">åŒ¹é…â€aâ€ã€â€bâ€ã€â€câ€ä¹‹å¤–çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦</td>
</tr>
<tr>
<td align="center">[f-k]</td>
<td align="center">åŒ¹é…â€fâ€-â€œkâ€ä¹‹é—´çš„ä»»æ„ä¸€ä¸ªå­—æ¯</td>
</tr>
<tr>
<td align="center">[^A-F0-3]</td>
<td align="center">åŒ¹é…â€Aâ€-â€œFâ€ã€â€0â€-â€œ3â€ä¹‹å¤–çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦</td>
</tr>
</tbody></table>
<h3 id="2-3-é‡è¯"><a href="#2-3-é‡è¯" class="headerlink" title="2.3 é‡è¯"></a>2.3 é‡è¯</h3><ul>
<li>ä¿®é¥°åŒ¹é…æ¬¡æ•°çš„ç‰¹æ®Šç¬¦å·</li>
<li>åŒ¹é…æ¬¡æ•°ä¸­çš„è´ªå©ªæ¨¡å¼(åŒ¹é…å­—ç¬¦è¶Šå¤šè¶Šå¥½ï¼Œé»˜è®¤)</li>
<li>åŒ¹é…æ¬¡æ•°ä¸­çš„éè´ªå©ªæ¨¡å¼(åŒ¹é…å­—ç¬¦è¶Šå°‘è¶Šå¥½ï¼Œåœ¨ä¿®é¥°åŒ¹é…æ¬¡æ•°çš„ç‰¹æ®Šç¬¦å·åå†åŠ ä¸Šä¸€ä¸ªâ€?â€å·)</li>
</ul>
<table>
<thead>
<tr>
<th align="center">é‡è¯</th>
<th align="center">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="center">{n}</td>
<td align="center">è¡¨è¾¾å¼é‡å¤næ¬¡</td>
</tr>
<tr>
<td align="center">{m,n}</td>
<td align="center">è¡¨è¾¾å¼è‡³å°‘é‡å¤mæ¬¡ï¼Œæœ€å¤šé‡å¤næ¬¡</td>
</tr>
<tr>
<td align="center">{m,}</td>
<td align="center">è¡¨è¾¾å¼è‡³å°‘é‡å¤mæ¬¡</td>
</tr>
<tr>
<td align="center">?</td>
<td align="center">è¡¨è¾¾å¼åŒ¹é…0æ¬¡æˆ–1æ¬¡ï¼Œç›¸å½“äº{0,1}</td>
</tr>
<tr>
<td align="center">+</td>
<td align="center">è¡¨è¾¾å¼è‡³å°‘å‡ºç°1æ¬¡ï¼Œç›¸å½“äº{1,}</td>
</tr>
<tr>
<td align="center">*</td>
<td align="center">è¡¨è¾¾å¼ä¸å‡ºç°æˆ–å‡ºç°ä»»æ„æ¬¡ï¼Œç›¸å½“äº{0,}</td>
</tr>
</tbody></table>
<p>ä¾‹å¦‚ï¼š</p>
<ul>
<li><code>[A-Za-z]+</code>å¯ä»¥åŒ¹é…å•è¯</li>
</ul>
<p>ä¾‹å¦‚æ–‡æœ¬ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">6ã€7ã€8ã€9ã€</span><br><span class="line">1ã€2ã€3ã€4ã€5ã€6ã€7ã€8ã€9ã€</span><br><span class="line">ab a1b a12b a123b a1234b a12345b </span><br></pre></td></tr></table></figure>

<p><code>(\dã€)&#123;1,3&#125;</code>çš„åŒ¹é…ç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">6ã€7ã€8ã€</span><br><span class="line">9ã€</span><br><span class="line">1ã€2ã€3ã€</span><br><span class="line">4ã€5ã€6ã€</span><br><span class="line">7ã€8ã€9ã€</span><br></pre></td></tr></table></figure>

<p><code>(\dã€)&#123;1,3&#125;?</code>çš„åŒ¹é…ç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">6ã€</span><br><span class="line">7ã€</span><br><span class="line">8ã€</span><br><span class="line">9ã€</span><br><span class="line">1ã€</span><br><span class="line">2ã€</span><br><span class="line">3ã€</span><br><span class="line">4ã€</span><br><span class="line">5ã€</span><br><span class="line">6ã€</span><br><span class="line">7ã€</span><br><span class="line">8ã€</span><br><span class="line">9ã€</span><br></pre></td></tr></table></figure>

<p><code>a\d?b</code>çš„åŒ¹é…ç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ab</span><br><span class="line">a1b</span><br></pre></td></tr></table></figure>

<p><code>a\d+b</code>çš„åŒ¹é…ç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a1b</span><br><span class="line">a12b</span><br><span class="line">a123b</span><br><span class="line">a1234b</span><br><span class="line">a12345b</span><br></pre></td></tr></table></figure>

<p><code>a\d-b</code>çš„åŒ¹é…ç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ab</span><br><span class="line">a1b</span><br><span class="line">a12b</span><br><span class="line">a123b</span><br><span class="line">a1234b</span><br><span class="line">a12345b</span><br></pre></td></tr></table></figure>



<h3 id="2-4-å­—ç¬¦è¾¹ç•Œ"><a href="#2-4-å­—ç¬¦è¾¹ç•Œ" class="headerlink" title="2.4 å­—ç¬¦è¾¹ç•Œ"></a>2.4 å­—ç¬¦è¾¹ç•Œ</h3><table>
<thead>
<tr>
<th align="center">å­—ç¬¦</th>
<th align="center">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="center">^</td>
<td align="center">ä¸å­—ç¬¦ä¸²å¼€å§‹çš„åœ°æ–¹åŒ¹é…</td>
</tr>
<tr>
<td align="center">$</td>
<td align="center">ä¸å­—ç¬¦ä¸²ç»“æŸçš„åœ°æ–¹åŒ¹é…</td>
</tr>
<tr>
<td align="center">\b</td>
<td align="center">åŒ¹é…ä¸€ä¸ªå•è¯è¾¹ç•Œ</td>
</tr>
</tbody></table>
<p><code>\b</code>åŒ¹é…è¿™æ ·ä¸€ä¸ªä½ç½®ï¼šå‰é¢çš„å­—ç¬¦å’Œåé¢çš„å­—ç¬¦ä¸å…¨æ˜¯\w</p>
<p>ä¾‹å¦‚æ–‡æœ¬:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Khighness </span><br><span class="line">Khighness1 Khighness2</span><br><span class="line">3Khighness </span><br><span class="line">4Khighness </span><br><span class="line">Khighness5 Khighness6</span><br><span class="line">7Khighness </span><br><span class="line">8Khighness</span><br></pre></td></tr></table></figure>

<p><code>^K</code>åŒ¹é…æœ€åˆçš„â€Kâ€ï¼Œ<code>s$</code>åŒ¹é…æœ€åçš„â€sâ€ï¼›</p>
<p><code>Khighness\b</code>åŒ¹é…ç¬¬1ã€3ã€4ã€6ã€7è¡Œçš„â€Khighnessâ€ï¼›</p>
<p><code>\bKhighness</code>åŒ¹é…ç¬¬1ã€2ã€5è¡Œçš„â€Khighnessâ€ï¼›</p>
<p><code>\bKhighness\b</code>åŒ¹é…ç¬¬1è¡Œçš„â€Khighnessâ€ã€‚</p>
<h3 id="2-5-åŒ¹é…æ¨¡å¼"><a href="#2-5-åŒ¹é…æ¨¡å¼" class="headerlink" title="2.5 åŒ¹é…æ¨¡å¼"></a>2.5 åŒ¹é…æ¨¡å¼</h3><ul>
<li>IGNORECASE-å¿½ç•¥å¤§å°å†™æ¨¡å¼<ul>
<li>åŒ¹é…æ—¶å¿½ç•¥å¤§å°å†™</li>
<li>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­£åˆ™è¡¨è¾¾å¼æ˜¯è¦åŒºåˆ†å¤§å°å†™çš„</li>
</ul>
</li>
<li>SINGLELINE-å•è¡Œæ¨¡å¼<ul>
<li>æ•´ä¸ªæ–‡æœ¬çœ‹åšä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåªæœ‰ä¸€ä¸ªå¼€å¤´ï¼Œä¸€ä¸ªç»“å°¾</li>
<li>ä½¿å°æ•°ç‚¹â€.â€å¯ä»¥åŒ¹é…åŒ…å«æ¢è¡Œç¬¦(\n)åœ¨å†…çš„ä»»æ„å­—ç¬¦</li>
</ul>
</li>
<li>MULTILINE-å¤šè¡Œæ¨¡å¼<ul>
<li>æ¯è¡Œéƒ½æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œéƒ½æœ‰å¼€å¤´å’Œç»“å°¾</li>
<li>åœ¨æŒ‡å®šäº†MULTILINEä¹‹åï¼Œå¦‚æœéœ€è¦ä»…åŒ¹é…å­—ç¬¦ä¸²å¼€å§‹å’Œç»“æŸä¸ºæ­¢ï¼Œå¯ä»¥ä½¿ç”¨<code>\A</code>å’Œ<code>\Z</code></li>
</ul>
</li>
</ul>
<h3 id="2-7-é€‰æ‹©ç¬¦å’Œåˆ†ç»„"><a href="#2-7-é€‰æ‹©ç¬¦å’Œåˆ†ç»„" class="headerlink" title="2.7 é€‰æ‹©ç¬¦å’Œåˆ†ç»„"></a>2.7 é€‰æ‹©ç¬¦å’Œåˆ†ç»„</h3><table>
<thead>
<tr>
<th align="center">è¡¨è¾¾å¼</th>
<th align="center">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="center">åˆ†æ”¯ç»“æ„: |</td>
<td align="center">å·¦å³ä¸¤è¾¹è¡¨è¾¾å¼ä¹‹é—´â€œæˆ–â€å…³ç³»ï¼ŒåŒ¹é…å·¦è¾¹æˆ–è€…å³è¾¹</td>
</tr>
<tr>
<td align="center">æ•è·ç»„: ()</td>
<td align="center">(1) åœ¨è¢«ä¿®é¥°åŒ¹é…æ¬¡æ•°çš„æ—¶å€™ï¼Œæ‹¬å·ä¸­çš„è¡¨è¾¾å¼å¯ä»¥ä½œä¸ºæ•´ä½“è¢«ä¿®é¥°; (2) å–åŒ¹é…ç»“æœçš„æ—¶å€™ï¼Œæ‹¬å·ä¸­çš„è¡¨è¾¾å¼åŒ¹é…åˆ°çš„å†…å®¹å¯ä»¥è¢«å•ç‹¬å¾—åˆ°; (3) æ¯ä¸€å¯¹æ‹¬å·ä¼šåˆ†é…ä¸€ä¸ªç¼–å·ï¼Œä½¿ç”¨()çš„æ•è·æ ¹æ®å·¦æ‹¬å·çš„é¡ºåºä»1å¼€å§‹è‡ªåŠ¨ç¼–å·ã€‚æ•è·å…ƒç´ ç¼–å·ä¸ºé›¶çš„ç¬¬ä¸€ä¸ªæ•è·æ˜¯ç”±æ•´ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼åŒ¹é…çš„æ–‡æœ¬</td>
</tr>
<tr>
<td align="center">éæ•è·ç»„: (?:Exception)</td>
<td align="center">ä¸€äº›è¡¨è¾¾å¼ä¸­ï¼Œä¸å¾—ä¸ä½¿ç”¨()ï¼Œä½†åˆä¸éœ€è¦ä¿å­˜()ä¸­å­è¡¨è¾¾å¼åŒ¹é…çš„å†…å®¹ï¼Œè¿™æ—¶å¯ä»¥ç”¨éæ•è·ç»„æ¥æŠµæ¶ˆä½¿ç”¨()å¸¦æ¥çš„å‰¯ä½œç”¨</td>
</tr>
</tbody></table>
<ul>
<li>åå‘å¼•ç”¨(\num)<ul>
<li>æ¯ä¸€å¯¹()ä¼šåˆ†é…ä¸€ä¸ªç¼–å·ï¼Œä½¿ç”¨()çš„æ•è·æ¨¡å¼</li>
</ul>
</li>
</ul>
<p>ä¾‹å¦‚<code>([a-z]&#123;2&#125;)\1</code>å¯ä»¥åŒ¹é…ç±»ä¼¼â€ababâ€ã€â€gogoâ€ã€â€totoâ€çš„å­—ç¬¦ä¸²</p>
<h3 id="2-8-é¢„æœç´¢-é›¶å®½æ–­è¨€"><a href="#2-8-é¢„æœç´¢-é›¶å®½æ–­è¨€" class="headerlink" title="2.8 é¢„æœç´¢(é›¶å®½æ–­è¨€)"></a>2.8 é¢„æœç´¢(é›¶å®½æ–­è¨€)</h3><ul>
<li>åªè¿›è¡Œå­è¡¨è¾¾å¼çš„åŒ¹é…ï¼ŒåŒ¹é…å†…å®¹ä¸è®¡å…¥æœ€ç»ˆçš„åŒ¹é…ç»“æœï¼Œæ˜¯é›¶å®½åº¦</li>
<li>è¿™ä¸ªä½ç½®åº”è¯¥ç¬¦åˆæŸä¸ªæ¡ä»¶ã€‚åˆ¤æ–­å½“å‰ä½ç½®çš„å‰åå­—ç¬¦ï¼Œæ˜¯å¦ç¬¦åˆæŒ‡å®šçš„æ¡ä»¶ï¼Œä½†ä¸åŒ¹é…å‰åçš„å­—ç¬¦ã€‚æ˜¯å¯¹ä½ç½®çš„åŒ¹é…</li>
<li>æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå­è¡¨è¾¾å¼åŒ¹é…åˆ°çš„æ˜¯å­—ç¬¦å†…å®¹ï¼Œè€Œéä½ç½®ï¼Œå¹¶è¢«ä¿å­˜åˆ°æœ€ç»ˆçš„åŒ¹é…ç»“æœä¸­ï¼Œé‚£ä¹ˆä¹…è®¤ä¸ºè¿™ä¸ªå­è¡¨è¾¾å¼æ˜¯å æœ‰å­—ç¬¦çš„ï¼›å¦‚æœå­è¡¨è¾¾å¼åŒ¹é…çš„ä»…ä»…æ˜¯ä½ç½®ï¼Œæˆ–è€…åŒ¹é…çš„å†…å®¹å¹¶ä¸ä¿å­˜åˆ°æœ€ç»ˆçš„åŒ¹é…ç»“æœä¸­ï¼Œé‚£ä¹ˆå°±è®¤ä¸ºè¿™ä¸ªå­è¡¨è¾¾å¼æ˜¯é›¶å®½åº¦çš„ã€‚å æœ‰å­—ç¬¦è¿˜æ˜¯é›¶å®½åº¦ï¼Œæ˜¯é’ˆå¯¹åŒ¹é…çš„å†…å®¹å±å¦ä¿å­˜åˆ°æœ€ç»ˆçš„åŒ¹é…ç»“æœä¸­è€Œè¨€çš„ã€‚</li>
</ul>
<table>
<thead>
<tr>
<th align="center">è¡¨è¾¾å¼</th>
<th align="center">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="center">(?=exp)</td>
<td align="center">æ–­è¨€è‡ªèº«å‡ºç°çš„ä½ç½®çš„åé¢èƒ½åŒ¹é…è¡¨è¾¾å¼exp</td>
</tr>
<tr>
<td align="center">(?&lt;=exp)</td>
<td align="center">æ–­è¨€è‡ªèº«å‡ºç°çš„ä½ç½®çš„å‰é¢èƒ½åŒ¹é…è¡¨è¾¾å¼exp</td>
</tr>
<tr>
<td align="center">(?!exp)</td>
<td align="center">æ–­è¨€æ­¤ä½ç½®çš„åé¢ä¸èƒ½åŒ¹é…è¡¨è¾¾å¼exp</td>
</tr>
<tr>
<td align="center">(?&lt;exp)</td>
<td align="center">æ–­è¨€æ­¤ä½ç½®çš„å‰é¢ä¸èƒ½åŒ¹é…è¡¨è¾¾å¼exp</td>
</tr>
</tbody></table>
<p>ä¾‹å¦‚ï¼š</p>
<ul>
<li><p><code>[A-Za-z]+(?=ing)</code>å¯ä»¥åŒ¹é…æ‰€æœ‰ä»¥â€ingâ€ç»“å°¾çš„å•è¯(åŒ¹é…ç»“æœä¸åŒ…å«â€ingâ€ï¼Œ<code>[A-Za-z]+ing</code>çš„åŒ¹é…ç»“æœåŒ…å«â€ingâ€)</p>
</li>
<li><p><code>(?&lt;=in)[A-Za-z]+</code>å¯ä»¥åŒ¹é…æ‰€æœ‰ä»¥â€inâ€ä¸ºå‰ç¼€çš„å•è¯(åŒ¹é…ç»“æœä¸åŒ…å«â€inâ€ï¼Œ<code>in[A-Za-z]+</code>çš„åŒ¹é…ç»“æœåŒ…å«â€inâ€)</p>
</li>
</ul>
<h2 id="3-éªŒè¯"><a href="#3-éªŒè¯" class="headerlink" title="3. éªŒè¯"></a>3. éªŒè¯</h2><h3 id="3-1-ç”µè¯å·ç éªŒè¯"><a href="#3-1-ç”µè¯å·ç éªŒè¯" class="headerlink" title="3.1 ç”µè¯å·ç éªŒè¯"></a>3.1 ç”µè¯å·ç éªŒè¯</h3><blockquote>
<p>è¦æ±‚</p>
</blockquote>
<ul>
<li>å›ºå®šç”µè¯å·ç ç”±æ•°å­—å’Œâ€-â€œæ„æˆï¼Œç”µè¯å·ç ä¸º7åˆ°8ä½</li>
<li>å¦‚æœå›ºå®šç”µè¯å·ç ä¸­åŒ…å«æœ‰åŒºå·ï¼Œé‚£ä¹ˆåŒºå·ä¸ºä¸‰ä½æˆ–å››ä½ï¼Œé¦–ä½æ˜¯0ï¼ŒåŒºå·ç”¨â€-â€œå’Œå…¶ä»–éƒ¨åˆ†éš”å¼€</li>
<li>ç§»åŠ¨ç”µè¯å·ç ä¸º11ä½ï¼Œç¬¬ä¸€ä½å’Œç¬¬äºŒä½ä¸ºâ€13â€ã€â€14â€ã€15â€ã€â€17â€ã€18â€ã€â€19â€</li>
</ul>
<blockquote>
<p>åˆ†æï¼š</p>
</blockquote>
<ul>
<li>å›ºå®šç”µè¯å·ç ï¼š<code>0\d&#123;2,3&#125;-\d&#123;7,9&#125;</code></li>
<li>ç§»åŠ¨ç”µè¯å·ç : <code>1[3|4|5|7|8|9]\d&#123;9&#125;</code></li>
<li>åˆèµ·æ¥å°±æ˜¯ï¼š<code>^0\d&#123;2,3&#125;-\d&#123;7,9&#125;|1[3|4|5|7|8|9]\d&#123;9&#125;$</code></li>
</ul>
<h3 id="3-3-ç”µå­é‚®ç®±éªŒè¯"><a href="#3-3-ç”µå­é‚®ç®±éªŒè¯" class="headerlink" title="3.3 ç”µå­é‚®ç®±éªŒè¯"></a>3.3 ç”µå­é‚®ç®±éªŒè¯</h3><blockquote>
<p>è¦æ±‚</p>
</blockquote>
<ul>
<li>ç”µå­é‚®ç®±æ ¼å¼ï¼šåç§°@åŸŸå</li>
<li>é‚®ç®±åç§°éƒ¨åˆ†ï¼šå…è®¸æ±‰å­—ã€å­—æ¯ã€æ•°å­—ã€ä¸­åˆ’çº¿å’Œä¸‹åˆ’çº¿</li>
<li>é‚®ç®±åŸŸåéƒ¨åˆ†ï¼šå…è®¸å­—æ¯ã€æ•°å­—ã€è‹±è¯­å¥å·</li>
</ul>
<blockquote>
<p>åˆ†æ</p>
</blockquote>
<ul>
<li>é‚®ç®±åç§°è¡¨è¾¾å¼ï¼š<ul>
<li>æ±‰å­—<code>[\u4e00-\u9fa5]</code></li>
<li>å­—æ¯<code>[A-Za-z]</code></li>
<li>æ•°å­—<code>[0-9]</code></li>
<li>ä¸­åˆ’çº¿å’Œä¸‹åˆ’çº¿<code>[-_]</code></li>
<li>ç»¼ä¸Šå¾—åˆ°åç§°è¡¨è¾¾å¼<code>[\u4e00-\u9fa5A-Za-z0-9-_]+</code></li>
</ul>
</li>
<li>é‚®ç®±åŸŸåè¡¨è¾¾å¼ï¼š<ul>
<li>åŸŸåçš„ä¸€èˆ¬è§„å¾‹ä¸º[Nçº§åŸŸå].[ä¸‰çº§åŸŸå].[äºŒçº§åŸŸå].[ä¸€çº§åŸŸå]ï¼Œæ ¼å¼ç±»ä¼¼ä¸º<code>**.**.**.**</code></li>
<li>ä¸€çº§åŸŸååªåŒ…å«å­—æ¯(å¦‚comã€topã€cnç­‰)ï¼Œé•¿åº¦ä¸º2-4ä½</li>
<li><code>**</code>éƒ¨åˆ†å¯ä»¥è¡¨ç¤ºä¸º<code>[A-Za-z0-9-_]+</code></li>
<li><code>.**</code>éƒ¨åˆ†å¯ä»¥è¡¨ç¤ºä¸º<code>\.[A-Za-z0-9-_]+</code></li>
<li>é›¶æˆ–å¤šä¸ª<code>&quot;.**&quot;</code>å¯ä»¥è¡¨ç¤ºä¸º <code> (\.[A-Za-z0-9-_]+)*</code></li>
<li>ä¸€çº§åŸŸåéƒ¨åˆ†<code>.**</code>å¯ä»¥è¡¨ç¤ºä¸º.<code>\.[a-z]&#123;2,4&#125;</code></li>
<li>ç»¼ä¸Šå¾—åˆ°åŸŸåè¡¨è¾¾å¼<code>[A-Za-z0-9-_]+(\.[A-Za-z0-9-_]+)*\.[a-z]&#123;2,4&#125;</code></li>
</ul>
</li>
<li>é‚®ç®±æœ€ç»ˆè¡¨è¾¾å¼ï¼š<ul>
<li>ä½¿ç”¨<code>^</code>åŒ¹é…é‚®ç®±æœ€å¼€å§‹çš„éƒ¨åˆ†ï¼Œä½¿ç”¨<code>$</code>åŒ¹é…é‚®ç®±ç»“æŸéƒ¨åˆ†ä»¥ä¿è¯é‚®ç®±å‰åä¸èƒ½æœ‰å…¶ä»–å­—ç¬¦</li>
<li>ç”±â€åç§°@åŸŸåâ€å¾—åˆ°æœ€ç»ˆè¡¨è¾¾å¼ï¼š<code>[\u4e00-\u9fa5A-Za-z0-9-_]+@[A-Za-z0-9-_]+(\.[A-Za-z0-9-_]+)*\.[a-z]&#123;2,4&#125;</code></li>
<li>ç®€å†™å³ä¸ºï¼š<code>^[\u4e00-\u9fa5-\w]+@[-\w]+(\.[-\w]+)*\.[a-z]&#123;2,4&#125;$</code></li>
</ul>
</li>
</ul>
<h2 id="4-ä½¿ç”¨"><a href="#4-ä½¿ç”¨" class="headerlink" title="4. ä½¿ç”¨"></a>4. ä½¿ç”¨</h2><p>Javaç¨‹åºä¸­ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œç›¸å…³ç±»ä½äº<code>java.util.regex</code>åŒ…ä¸‹é¢</p>
<ul>
<li>ç±»<code>Pattern</code>:<ul>
<li>æ­£åˆ™è¡¨è¾¾å››çš„ç¼–è¯‘è¡¨ç¤ºå½¢å¼</li>
<li>å»ºç«‹æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¹¶å¯ç”¨ç›¸åº”æ¨¡å¼ï¼š<code>Pattern pattern = Pattern.compile(Regular Expression);</code></li>
</ul>
</li>
<li>ç±»<code>Matcher</code>:<ul>
<li>é€šè¿‡è§£é‡Š<code>Pattern</code>å¯¹<code>character squence</code>æ‰§è¡ŒåŒ¹é…æ“ä½œçš„å¼•æ“</li>
<li>åŒ¹é…strå­—ç¬¦ä¸²ï¼š<code>Matcher matcher = pattern.matcher(str);</code></li>
<li>å°†æ•´ä¸ªå­—ç¬¦ä¸²åºåˆ—ä¸è¯¥æ¨¡å¼åŒ¹é…ï¼š<code>boolean res1 = matcher.matches();</code></li>
<li>æ‰«æå­—ç¬¦ä¸²åºåˆ—ï¼ŒæŸ¥æ‰¾ä¸è¯¥æ¨¡å¼åŒ¹é…çš„ä¸‹ä¸€ä¸ªå­åºåˆ—ï¼š<code>boolean res2 = matcher.find();</code></li>
</ul>
</li>
</ul>
<h3 id="4-1-åŸºæœ¬æ“ä½œ"><a href="#4-1-åŸºæœ¬æ“ä½œ" class="headerlink" title="4.1 åŸºæœ¬æ“ä½œ"></a>4.1 åŸºæœ¬æ“ä½œ</h3><blockquote>
<p>ä»£ç </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2020/10/7 15:23</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span>: åŸºæœ¬æ“ä½œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ­£åˆ™åŒ¹é…æ¨¡å¼</span></span><br><span class="line">        Pattern pattern = Pattern.compile(<span class="string">&quot;\\w+&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŒ¹é…æ“ä½œå¼•æ“</span></span><br><span class="line">        Matcher matcher = pattern.matcher(<span class="string">&quot;KHighness||ParaK||FlowerK||18236763&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®Œæ•´åŒ¹é…</span></span><br><span class="line">        System.out.println(<span class="string">&quot;----------å®Œæ•´åŒ¹é…----------&quot;</span>);</span><br><span class="line">        <span class="keyword">boolean</span> res = matcher.matches();</span><br><span class="line">        System.out.println(<span class="string">&quot;åŒ¹é…ç»“æœï¼š&quot;</span> + res + <span class="string">&quot;ï¼ŒåŒ¹é…å­—ç¬¦ä¸²ï¼š&quot;</span> + (res ? matcher.group() : <span class="string">&quot;NULL&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¯æ¬¡æ“ä½œå®Œå¼•æ“ä¸­çš„å­—ç¬¦ä¸²éƒ½ä¼šåˆ°è¾¾æœ«å°¾ï¼Œéœ€è¦é‡æ–°å†™</span></span><br><span class="line">        matcher = pattern.matcher(<span class="string">&quot;KHighness||ParaK||FlowerK||18236763&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å­ä¸²åŒ¹é…</span></span><br><span class="line">        System.out.println(<span class="string">&quot;----------å­ä¸²åŒ¹é…----------&quot;</span>);</span><br><span class="line">        <span class="keyword">boolean</span> res1 = matcher.find();</span><br><span class="line">        System.out.println(<span class="string">&quot;åŒ¹é…ç»“æœï¼š&quot;</span> + res1 + <span class="string">&quot;ï¼ŒåŒ¹é…å­—ç¬¦ä¸²ï¼š&quot;</span> + (res1 ? matcher.group() : <span class="string">&quot;NULL&quot;</span>));</span><br><span class="line">        <span class="keyword">boolean</span> res2 = matcher.find();</span><br><span class="line">        System.out.println(<span class="string">&quot;åŒ¹é…ç»“æœï¼š&quot;</span> + res2 + <span class="string">&quot;ï¼ŒåŒ¹é…å­—ç¬¦ä¸²ï¼š&quot;</span> + (res2 ? matcher.group() : <span class="string">&quot;NULL&quot;</span>));</span><br><span class="line">        <span class="keyword">boolean</span> res3 = matcher.find();</span><br><span class="line">        System.out.println(<span class="string">&quot;åŒ¹é…ç»“æœï¼š&quot;</span> + res3 + <span class="string">&quot;ï¼ŒåŒ¹é…å­—ç¬¦ä¸²ï¼š&quot;</span> + (res3 ? matcher.group() : <span class="string">&quot;NULL&quot;</span>));</span><br><span class="line">        <span class="keyword">boolean</span> res4 = matcher.find();</span><br><span class="line">        System.out.println(<span class="string">&quot;åŒ¹é…ç»“æœï¼š&quot;</span> + res4 + <span class="string">&quot;ï¼ŒåŒ¹é…å­—ç¬¦ä¸²ï¼š&quot;</span> + (res4 ? matcher.group() : <span class="string">&quot;NULL&quot;</span>));</span><br><span class="line">        <span class="keyword">boolean</span> res5 = matcher.find();</span><br><span class="line">        System.out.println(<span class="string">&quot;åŒ¹é…ç»“æœï¼š&quot;</span> + res5 + <span class="string">&quot;ï¼ŒåŒ¹é…å­—ç¬¦ä¸²ï¼š&quot;</span> + (res5 ? matcher.group() : <span class="string">&quot;NULL&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¾ªç¯æŸ¥æ‰¾</span></span><br><span class="line">        matcher = pattern.matcher(<span class="string">&quot;KHighness||ParaK||FlowerK||18236763&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;----------å¾ªç¯åŒ¹é…----------&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span> (matcher.find()) &#123;</span><br><span class="line">            System.out.println(matcher.group());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿è¡Œ</p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">----------å®Œæ•´åŒ¹é…----------</span><br><span class="line">åŒ¹é…ç»“æœï¼šfalseï¼ŒåŒ¹é…å­—ç¬¦ä¸²ï¼šNULL</span><br><span class="line">----------å­ä¸²åŒ¹é…----------</span><br><span class="line">åŒ¹é…ç»“æœï¼štrueï¼ŒåŒ¹é…å­—ç¬¦ä¸²ï¼šKHighness</span><br><span class="line">åŒ¹é…ç»“æœï¼štrueï¼ŒåŒ¹é…å­—ç¬¦ä¸²ï¼šParaK</span><br><span class="line">åŒ¹é…ç»“æœï¼štrueï¼ŒåŒ¹é…å­—ç¬¦ä¸²ï¼šFlowerK</span><br><span class="line">åŒ¹é…ç»“æœï¼štrueï¼ŒåŒ¹é…å­—ç¬¦ä¸²ï¼š<span class="number">18236763</span></span><br><span class="line">åŒ¹é…ç»“æœï¼šfalseï¼ŒåŒ¹é…å­—ç¬¦ä¸²ï¼šNULL</span><br><span class="line">----------å¾ªç¯åŒ¹é…----------</span><br><span class="line">KHighness</span><br><span class="line">ParaK</span><br><span class="line">FlowerK</span><br><span class="line"><span class="number">18236763</span></span><br></pre></td></tr></table></figure>



<h3 id="4-2-åˆ†ç»„æ“ä½œ"><a href="#4-2-åˆ†ç»„æ“ä½œ" class="headerlink" title="4.2 åˆ†ç»„æ“ä½œ"></a>4.2 åˆ†ç»„æ“ä½œ</h3><blockquote>
<p>ä»£ç </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2020/10/7 15:46</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span>: åˆ†ç»„æ“ä½œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ­£åˆ™åŒ¹é…æ¨¡å¼</span></span><br><span class="line">        <span class="comment">// åˆ†ç»„ä¸¤ç»„åŒ¹é…ï¼šå­—æ¯å’Œæ•°å­—</span></span><br><span class="line">        Pattern pattern = Pattern.compile(<span class="string">&quot;([A-Za-z]+)([0-9]+)&quot;</span>);</span><br><span class="line">        <span class="comment">// åŒ¹é…æ“ä½œå¼•æ“</span></span><br><span class="line">        Matcher matcher = pattern.matcher(<span class="string">&quot;KHighness18||ParaK23||FlowerK67||KAG63||KAG72&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> index = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (matcher.find()) &#123;</span><br><span class="line">            System.out.printf(<span class="string">&quot;-----ç¬¬%dç»„-----\n&quot;</span>, index++);</span><br><span class="line">            System.out.println(<span class="string">&quot;group[0]: &quot;</span> + matcher.group(<span class="number">0</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;group[1]: &quot;</span> + matcher.group(<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿è¡Œ</p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">-----ç¬¬<span class="number">1</span>ç»„-----</span><br><span class="line"><span class="built_in">group</span>[<span class="number">0</span>]: KHighness18</span><br><span class="line"><span class="built_in">group</span>[<span class="number">1</span>]: KHighness</span><br><span class="line">-----ç¬¬<span class="number">2</span>ç»„-----</span><br><span class="line"><span class="built_in">group</span>[<span class="number">0</span>]: ParaK23</span><br><span class="line"><span class="built_in">group</span>[<span class="number">1</span>]: ParaK</span><br><span class="line">-----ç¬¬<span class="number">3</span>ç»„-----</span><br><span class="line"><span class="built_in">group</span>[<span class="number">0</span>]: FlowerK67</span><br><span class="line"><span class="built_in">group</span>[<span class="number">1</span>]: FlowerK</span><br><span class="line">-----ç¬¬<span class="number">4</span>ç»„-----</span><br><span class="line"><span class="built_in">group</span>[<span class="number">0</span>]: KAG63</span><br><span class="line"><span class="built_in">group</span>[<span class="number">1</span>]: KAG</span><br><span class="line">-----ç¬¬<span class="number">5</span>ç»„-----</span><br><span class="line"><span class="built_in">group</span>[<span class="number">0</span>]: KAG72</span><br><span class="line"><span class="built_in">group</span>[<span class="number">1</span>]: KAG</span><br></pre></td></tr></table></figure>



<h3 id="4-3-æ›¿æ¢æ“ä½œ"><a href="#4-3-æ›¿æ¢æ“ä½œ" class="headerlink" title="4.3 æ›¿æ¢æ“ä½œ"></a>4.3 æ›¿æ¢æ“ä½œ</h3><blockquote>
<p>ä»£ç </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2020/10/7 16:09</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span>: æ›¿æ¢æ“ä½œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo3</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ­£åˆ™åŒ¹é…æ¨¡å¼</span></span><br><span class="line">        Pattern pattern = Pattern.compile(<span class="string">&quot;[0-9]&quot;</span>);</span><br><span class="line">        <span class="comment">// åŒ¹é…æ“ä½œå¼•æ“</span></span><br><span class="line">        Matcher matcher = pattern.matcher(<span class="string">&quot;KHighness18||ParaK23||FlowerK67||KAG63||KAG72&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ•°å­—å…¨éƒ¨æ›¿æ¢ä¸º##</span></span><br><span class="line">        String newStr = matcher.replaceAll(<span class="string">&quot;#&quot;</span>);</span><br><span class="line">        System.out.println(newStr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿è¡Œ</p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">KHighness<span class="comment">##||ParaK##||FlowerK##||KAG##||KAG##</span></span><br></pre></td></tr></table></figure>



<h3 id="4-4-åˆ†å‰²æ“ä½œ"><a href="#4-4-åˆ†å‰²æ“ä½œ" class="headerlink" title="4.4 åˆ†å‰²æ“ä½œ"></a>4.4 åˆ†å‰²æ“ä½œ</h3><blockquote>
<p>ä»£ç </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2020/10/7 16:12</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span>: åˆ†å‰²æ“ä½œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo4</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String str = <span class="string">&quot;K18H23I67G63H72N18E23S67S6372&quot;</span>;</span><br><span class="line">        String[] arr = str.split(<span class="string">&quot;\\d+&quot;</span>); <span class="comment">// ä»¥æ•°å­—ä¸ºè¾¹ç•Œè¿›è¡Œåˆ‡å‰²</span></span><br><span class="line">        System.out.println(Arrays.toString(arr));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿è¡Œ</p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">[<span class="type">K</span>, <span class="type">H</span>, <span class="type">I</span>, <span class="type">G</span>, <span class="type">H</span>, <span class="type">N</span>, <span class="type">E</span>, <span class="type">S</span>, <span class="type">S</span>]</span><br></pre></td></tr></table></figure>



<h3 id="4-5-çˆ¬å–è…¾è®¯å®˜ç½‘æ‰€æœ‰çš„è¶…é“¾æ¥"><a href="#4-5-çˆ¬å–è…¾è®¯å®˜ç½‘æ‰€æœ‰çš„è¶…é“¾æ¥" class="headerlink" title="4.5 çˆ¬å–è…¾è®¯å®˜ç½‘æ‰€æœ‰çš„è¶…é“¾æ¥"></a>4.5 çˆ¬å–è…¾è®¯å®˜ç½‘æ‰€æœ‰çš„è¶…é“¾æ¥</h3><blockquote>
<p>ä»£ç </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2020/10/7 16:24</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span>: çˆ¬å–è…¾è®¯å®˜ç½‘çš„æ‰€æœ‰è¶…é“¾æ¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSpider</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šè¿‡URLè·å–html</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> urlStr</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getURLContent</span><span class="params">(String urlStr)</span> </span>&#123;</span><br><span class="line">        StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            URL url = <span class="keyword">new</span> URL(urlStr);</span><br><span class="line">            BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(url.openStream(), Charset.forName(<span class="string">&quot;UTF-8&quot;</span>)));</span><br><span class="line">            String temp = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">while</span> ((temp = reader.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                stringBuilder.append(temp + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</span><br><span class="line">            System.out.println(e.getMessage());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            System.out.println(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> stringBuilder.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†åŒ¹é…ç»“æœè£…è¿›list</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> destStr</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> regex</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">getMatcherSubs</span><span class="params">(String destStr, String regex)</span> </span>&#123;</span><br><span class="line">        Pattern pattern = Pattern.compile(regex);</span><br><span class="line">        Matcher matcher = pattern.matcher(destStr);</span><br><span class="line">        List&lt;String&gt; result = <span class="keyword">new</span> LinkedList&lt;String&gt;();</span><br><span class="line">        <span class="keyword">while</span> (matcher.find()) &#123;</span><br><span class="line">            result.add(matcher.group(<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String url = <span class="string">&quot;https://www.tencent.com/zh-cn&quot;</span>;</span><br><span class="line">        WebSpider spider = <span class="keyword">new</span> WebSpider();</span><br><span class="line">        <span class="comment">// è·å–è¶…é“¾æ¥æ ‡ç­¾açš„å†…å®¹ &lt;a\s\S]+?&lt;/a&gt;</span></span><br><span class="line">        <span class="comment">// è·å–hrefçš„å†…å®¹ href=\&quot;(.+?)\&quot;</span></span><br><span class="line">        spider.getMatcherSubs(spider.getURLContent(url), <span class="string">&quot;href=\\\&quot;([\\w\\s./:]+?)\\\&quot;&quot;</span>).stream().forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿è¡Œ</p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">/css/base.css</span><br><span class="line">/css/index.css</span><br><span class="line">https://weibo.com/tencent</span><br><span class="line">https://twitter.com/TencentGlobal</span><br><span class="line">https://www.linkedin.com/company/tencent/</span><br><span class="line">https://careers.tencent.com/</span><br><span class="line">https://join.qq.com/</span><br><span class="line">https://spd.tencent.com/portal</span><br><span class="line">https://ipr.tencent.com/</span><br><span class="line">http://beian.miit.gov.cn/</span><br><span class="line">http://beian.miit.gov.cn/</span><br><span class="line">http://beian.miit.gov.cn/</span><br><span class="line">/css/rem.css</span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Regex</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Regex</tag>
      </tags>
  </entry>
  <entry>
    <title>Mybatis-plus</title>
    <url>/2020/11/12/MybatisPlus/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="MybatiS-Plus"><a href="#MybatiS-Plus" class="headerlink" title="MybatiS-Plus"></a>MybatiS-Plus</h1><center>
    <font face="Kristen ITC" color="#555555" font-size=100px>ğŸ’Œ Khighness ğŸ’Œ</font><br>
</center>



<h2 id="ğŸ“–-å®˜æ–¹æ–‡æ¡£"><a href="#ğŸ“–-å®˜æ–¹æ–‡æ¡£" class="headerlink" title="ğŸ“– å®˜æ–¹æ–‡æ¡£"></a>ğŸ“– å®˜æ–¹æ–‡æ¡£</h2><blockquote>
<p>ğŸŒæ–‡æ¡£</p>
</blockquote>
<p>ğŸ‘‰ <a href="https://mybatis.plus/">mybatis-plus</a></p>
<blockquote>
<p>â˜„ï¸ç‰¹æ€§</p>
</blockquote>
<ul>
<li>æ¶¦ç‰©æ— å£°ï¼šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œå¼•å…¥å®ƒä¸ä¼šå¯¹ç°æœ‰å·¥ç¨‹äº§ç”Ÿå½±å“ï¼Œå¦‚ä¸èˆ¬é¡ºæ»‘ã€‚</li>
<li>æ•ˆç‡è‡³ä¸Šï¼šåªéœ€ç®€å•é…ç½®ï¼Œå³å¯å¿«é€Ÿè¿›è¡Œå•è¡¨ CRUD æ“ä½œï¼Œä»è€ŒèŠ‚çœå¤§é‡æ—¶é—´ã€‚</li>
<li>ä¸°å¯ŒåŠŸèƒ½ï¼šä»£ç ç”Ÿæˆã€ç‰©ç†åˆ†é¡µã€æ€§èƒ½åˆ†æç­‰åŠŸèƒ½ä¸€åº”ä¿±å…¨ã€‚</li>
</ul>
<blockquote>
<p>â›“ç»“æ„</p>
</blockquote>
<img src="/2020/11/12/MybatisPlus/mybatis-plus-framework.jpg" class="" title="mybatis-plus-framework">



<h2 id="â•-æ·»åŠ ä¾èµ–"><a href="#â•-æ·»åŠ ä¾èµ–" class="headerlink" title="â• æ·»åŠ ä¾èµ–"></a>â• æ·»åŠ ä¾èµ–</h2><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml</span> <span class="string">version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;project</span> <span class="string">xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="line">         <span class="attr">xmlns</span>:<span class="string">xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">         <span class="attr">xsi</span>:<span class="string">schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span></span><br><span class="line">    <span class="attr">&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">&lt;groupId&gt;top.parak&lt;/groupId&gt;</span></span><br><span class="line">    <span class="attr">&lt;artifactId&gt;Mybatis-plus&lt;/artifactId&gt;</span></span><br><span class="line">    <span class="meta">&lt;description&gt;Mybatis-plus</span> <span class="string">Learning&lt;/description&gt;</span></span><br><span class="line">    <span class="attr">&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">&lt;developers&gt;</span></span><br><span class="line">        <span class="attr">&lt;developer&gt;</span></span><br><span class="line">            <span class="attr">&lt;name&gt;KHighness&lt;/name&gt;</span></span><br><span class="line">            <span class="attr">&lt;email&gt;parakovo@gmail.com&lt;/email&gt;</span></span><br><span class="line">        <span class="attr">&lt;/developer&gt;</span></span><br><span class="line">    <span class="attr">&lt;/developers&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">&lt;parent&gt;</span></span><br><span class="line">        <span class="attr">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></span><br><span class="line">        <span class="attr">&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span></span><br><span class="line">        <span class="attr">&lt;version&gt;2.2.5.RELEASE&lt;/version&gt;</span></span><br><span class="line">    <span class="attr">&lt;/parent&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">&lt;properties&gt;</span></span><br><span class="line">        <span class="attr">&lt;mysql.version&gt;8.0.20&lt;/mysql.version&gt;</span></span><br><span class="line">        <span class="attr">&lt;fastjson.version&gt;1.2.58&lt;/fastjson.version&gt;</span></span><br><span class="line">        <span class="attr">&lt;gson.version&gt;2.8.6&lt;/gson.version&gt;</span></span><br><span class="line">        <span class="attr">&lt;mybatis-plus.version&gt;3.4.0&lt;/mybatis-plus.version&gt;</span></span><br><span class="line">        <span class="attr">&lt;common-io.version&gt;2.6&lt;/common-io.version&gt;</span></span><br><span class="line">        <span class="attr">&lt;common-fileupload.version&gt;1.4&lt;/common-fileupload.version&gt;</span></span><br><span class="line">        <span class="attr">&lt;mybatis-plus-generate.version&gt;2.3.3&lt;/mybatis-plus-generate.version&gt;</span></span><br><span class="line">    <span class="attr">&lt;/properties&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">&lt;dependencies&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">&lt;!--</span> <span class="string">Spring Web --&gt;</span></span><br><span class="line">        <span class="attr">&lt;dependency&gt;</span></span><br><span class="line">            <span class="attr">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></span><br><span class="line">            <span class="attr">&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span></span><br><span class="line">        <span class="attr">&lt;/dependency&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">&lt;!--</span> <span class="string">Spring Aop --&gt;</span></span><br><span class="line">        <span class="attr">&lt;dependency&gt;</span></span><br><span class="line">            <span class="attr">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></span><br><span class="line">            <span class="attr">&lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;</span></span><br><span class="line">        <span class="attr">&lt;/dependency&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">&lt;!--</span> <span class="string">Spring Test --&gt;</span></span><br><span class="line">        <span class="attr">&lt;dependency&gt;</span></span><br><span class="line">            <span class="attr">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></span><br><span class="line">            <span class="attr">&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span></span><br><span class="line">            <span class="attr">&lt;scope&gt;test&lt;/scope&gt;</span></span><br><span class="line">            <span class="attr">&lt;exclusions&gt;</span></span><br><span class="line">                <span class="attr">&lt;exclusion&gt;</span></span><br><span class="line">                    <span class="attr">&lt;groupId&gt;org.junit.vintage&lt;/groupId&gt;</span></span><br><span class="line">                    <span class="attr">&lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt;</span></span><br><span class="line">                <span class="attr">&lt;/exclusion&gt;</span></span><br><span class="line">            <span class="attr">&lt;/exclusions&gt;</span></span><br><span class="line">        <span class="attr">&lt;/dependency&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">&lt;!--</span> <span class="string">Spring Configuration --&gt;</span></span><br><span class="line">        <span class="attr">&lt;dependency&gt;</span></span><br><span class="line">            <span class="attr">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></span><br><span class="line">            <span class="attr">&lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;</span></span><br><span class="line">            <span class="attr">&lt;optional&gt;true&lt;/optional&gt;</span></span><br><span class="line">        <span class="attr">&lt;/dependency&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">&lt;!--</span> <span class="string">Spring Websocket --&gt;</span></span><br><span class="line">        <span class="attr">&lt;dependency&gt;</span></span><br><span class="line">            <span class="attr">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></span><br><span class="line">            <span class="attr">&lt;artifactId&gt;spring-boot-starter-websocket&lt;/artifactId&gt;</span></span><br><span class="line">        <span class="attr">&lt;/dependency&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">&lt;!--</span> <span class="string">Mybatis-plus --&gt;</span></span><br><span class="line">        <span class="attr">&lt;dependency&gt;</span></span><br><span class="line">            <span class="attr">&lt;groupId&gt;com.baomidou&lt;/groupId&gt;</span></span><br><span class="line">            <span class="attr">&lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;</span></span><br><span class="line">            <span class="attr">&lt;version&gt;$&#123;mybatis-plus.version&#125;&lt;/version&gt;</span></span><br><span class="line">        <span class="attr">&lt;/dependency&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">&lt;!--</span> <span class="string">mybatis-plus-generator --&gt;</span></span><br><span class="line">        <span class="attr">&lt;dependency&gt;</span></span><br><span class="line">            <span class="attr">&lt;groupId&gt;com.baomidou&lt;/groupId&gt;</span></span><br><span class="line">            <span class="attr">&lt;artifactId&gt;mybatis-plus-generate&lt;/artifactId&gt;</span></span><br><span class="line">            <span class="attr">&lt;version&gt;$&#123;mybatis-plus-generate.version&#125;&lt;/version&gt;</span></span><br><span class="line">        <span class="attr">&lt;/dependency&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">&lt;!--</span> <span class="string">Mysql --&gt;</span></span><br><span class="line">        <span class="attr">&lt;dependency&gt;</span></span><br><span class="line">            <span class="attr">&lt;groupId&gt;mysql&lt;/groupId&gt;</span></span><br><span class="line">            <span class="attr">&lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span></span><br><span class="line">            <span class="attr">&lt;version&gt;$&#123;mysql.version&#125;&lt;/version&gt;</span></span><br><span class="line">        <span class="attr">&lt;/dependency&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">&lt;!--</span> <span class="string">Unit Test --&gt;</span></span><br><span class="line">        <span class="attr">&lt;dependency&gt;</span></span><br><span class="line">            <span class="attr">&lt;groupId&gt;junit&lt;/groupId&gt;</span></span><br><span class="line">            <span class="attr">&lt;artifactId&gt;junit&lt;/artifactId&gt;</span></span><br><span class="line">            <span class="attr">&lt;scope&gt;test&lt;/scope&gt;</span></span><br><span class="line">        <span class="attr">&lt;/dependency&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">&lt;!--</span> <span class="string">Lombok --&gt;</span></span><br><span class="line">        <span class="attr">&lt;dependency&gt;</span></span><br><span class="line">            <span class="attr">&lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span></span><br><span class="line">            <span class="attr">&lt;artifactId&gt;lombok&lt;/artifactId&gt;</span></span><br><span class="line">            <span class="attr">&lt;scope&gt;provided&lt;/scope&gt;</span></span><br><span class="line">        <span class="attr">&lt;/dependency&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">&lt;!--</span> <span class="string">FastJSON --&gt;</span></span><br><span class="line">        <span class="attr">&lt;dependency&gt;</span></span><br><span class="line">            <span class="attr">&lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span></span><br><span class="line">            <span class="attr">&lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span></span><br><span class="line">            <span class="attr">&lt;version&gt;$&#123;fastjson.version&#125;&lt;/version&gt;</span></span><br><span class="line">        <span class="attr">&lt;/dependency&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">&lt;!--</span> <span class="string">Gson --&gt;</span></span><br><span class="line">        <span class="attr">&lt;dependency&gt;</span></span><br><span class="line">            <span class="attr">&lt;groupId&gt;com.google.code.gson&lt;/groupId&gt;</span></span><br><span class="line">            <span class="attr">&lt;artifactId&gt;gson&lt;/artifactId&gt;</span></span><br><span class="line">            <span class="attr">&lt;version&gt;$&#123;gson.version&#125;&lt;/version&gt;</span></span><br><span class="line">        <span class="attr">&lt;/dependency&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">&lt;!--</span> <span class="string">File --&gt;</span></span><br><span class="line">        <span class="attr">&lt;dependency&gt;</span></span><br><span class="line">            <span class="attr">&lt;groupId&gt;commons-fileupload&lt;/groupId&gt;</span></span><br><span class="line">            <span class="attr">&lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt;</span></span><br><span class="line">            <span class="attr">&lt;version&gt;$&#123;common-fileupload.version&#125;&lt;/version&gt;</span></span><br><span class="line">        <span class="attr">&lt;/dependency&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">&lt;!--</span> <span class="string">IO --&gt;</span></span><br><span class="line">        <span class="attr">&lt;dependency&gt;</span></span><br><span class="line">            <span class="attr">&lt;groupId&gt;commons-io&lt;/groupId&gt;</span></span><br><span class="line">            <span class="attr">&lt;artifactId&gt;commons-io&lt;/artifactId&gt;</span></span><br><span class="line">            <span class="attr">&lt;version&gt;$&#123;common-io.version&#125;&lt;/version&gt;</span></span><br><span class="line">        <span class="attr">&lt;/dependency&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">&lt;/dependencies&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">&lt;build&gt;</span></span><br><span class="line">        <span class="attr">&lt;plugins&gt;</span></span><br><span class="line">            <span class="attr">&lt;plugin&gt;</span></span><br><span class="line">                <span class="attr">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></span><br><span class="line">                <span class="attr">&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span></span><br><span class="line">                <span class="attr">&lt;configuration&gt;</span></span><br><span class="line">                    <span class="attr">&lt;mainClass&gt;top.parak.KHighnessApplication&lt;/mainClass&gt;</span></span><br><span class="line">                <span class="attr">&lt;/configuration&gt;</span></span><br><span class="line">            <span class="attr">&lt;/plugin&gt;</span></span><br><span class="line">        <span class="attr">&lt;/plugins&gt;</span></span><br><span class="line">    <span class="attr">&lt;/build&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">&lt;/project&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="ğŸ’¥é…ç½®æ—¥å¿—"><a href="#ğŸ’¥é…ç½®æ—¥å¿—" class="headerlink" title="ğŸ’¥é…ç½®æ—¥å¿—"></a>ğŸ’¥é…ç½®æ—¥å¿—</h2><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Server</span></span><br><span class="line"><span class="meta">server.port</span>=<span class="string">3333</span></span><br><span class="line"><span class="meta">server.tomcat.uri-encoding</span>=<span class="string">UTF-8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Database</span></span><br><span class="line"><span class="meta">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/test?serverTimezone=GMT%2B8&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;allowMultiQueries=true</span></span><br><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>=<span class="string">KAG1823</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Mybatis-plus</span></span><br><span class="line"><span class="meta">mybatis-plus.mapper-locations</span>=<span class="string">classpath*:/mapper/**/*.xml</span></span><br><span class="line"><span class="meta">mybatis-plus.type-aliases-package</span>=<span class="string">top.parak.entity</span></span><br><span class="line"><span class="meta">mybatis-plus.configuration.map-underscore-to-camel-case</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">mybatis-plus.global-config.banner</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">mybatis-plus.configuration.log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line"><span class="comment"># Logic-Delete</span></span><br><span class="line"><span class="meta">mybatis-plus.global-config.db-config.logic-delete-value</span>=<span class="string">1</span></span><br><span class="line"><span class="meta">mybatis-plus.global-config.db-config.logic-not-delete-value</span>=<span class="string">0</span></span><br><span class="line">        </span><br><span class="line"><span class="comment"># Log</span></span><br><span class="line"><span class="meta">logging.level.top.parak.mapper</span>=<span class="string">debug</span></span><br><span class="line"><span class="meta">logging.level.top.parak.controller</span>=<span class="string">debug</span></span><br></pre></td></tr></table></figure>



<h2 id="ğŸŒ€ä¸»é”®ç”Ÿæˆç­–ç•¥"><a href="#ğŸŒ€ä¸»é”®ç”Ÿæˆç­–ç•¥" class="headerlink" title="ğŸŒ€ä¸»é”®ç”Ÿæˆç­–ç•¥"></a>ğŸŒ€ä¸»é”®ç”Ÿæˆç­–ç•¥</h2><blockquote>
<p>â„ï¸Snowflake</p>
</blockquote>
<p><code>SnowFlake</code>æ˜¯<code>Twitter</code>å¼€æºçš„åˆ†å¸ƒå¼<code>ID</code>ç”Ÿæˆç®—æ³•ã€‚</p>
<blockquote>
<p>ğŸ†”IDç»“æ„</p>
</blockquote>
<p><code>SnowFlake</code>ç”Ÿæˆ<code>ID</code>å›ºå®šæ˜¯ä¸€ä¸ª<code>long</code>å‹çš„æ•°å­—ï¼Œä¸€ä¸ª<code>long</code>å‹å 8ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯64ä¸ª<code>bit</code>ï¼Œåˆ†é…å¦‚ä¸‹ï¼š</p>
<img src="/2020/11/12/MybatisPlus/SnowFlakeID.jpg" class="" title="SnowFlake">

<ol>
<li>ç¬¬ä¸€ä¸ªbitæ˜¯æ ‡è¯†ä½éƒ¨åˆ†ï¼Œåœ¨<code>Java</code>ä¸­ç”±äº<code>long</code>çš„æœ€é«˜ä½æ˜¯ç¬¦å·ä½ï¼Œæ­£æ•°æ˜¯<code>0</code>ï¼Œè´Ÿæ•°æ˜¯<code>1</code>ï¼Œä¸€èˆ¬ç”Ÿæˆçš„<code>ID</code>ä¸ºæ­£æ•°ï¼Œæ‰€ä»¥å›ºå®šä¸º<code>0</code>ã€‚</li>
<li>æ—¶é—´æˆ³éƒ¨åˆ†å <code>41bit</code>ï¼Œè¿™ä¸ªæ˜¯æ¯«ç§’çº§çš„æ—¶é—´ï¼Œä¸€èˆ¬å®ç°ä¸Šä¸ä¼šå­˜å‚¨å½“å‰çš„æ—¶é—´æˆ³ï¼Œè€Œæ˜¯æ—¶é—´æˆ³çš„å·®å€¼(å½“å‰æ—¶é—´-å›ºå®šçš„å¼€å§‹æ—¶é—´)ï¼Œè¿™æ ·å¯ä»¥ä½¿äº§ç”Ÿçš„<code>ID</code>ä»æ›´å°å€¼å¼€å§‹ã€‚<code>41</code>ä½çš„æ—¶é—´æˆ³å¯ä»¥ä½¿ç”¨<code>69</code>å¹´ã€‚</li>
<li>å·¥ä½œæœºå™¨<code>ID</code>å <code>10bit</code>ï¼Œè¿™é‡Œæ¯”è¾ƒçµæ´»ï¼Œæ¯”å¦‚ï¼Œå¯ä»¥ä½¿ç”¨å‰<code>5</code>ä½ä½œä¸ºæ•°æ®ä¸­å¿ƒæœºæˆ¿æ ‡è¯†ï¼Œå<code>5</code>ä½ä½œä¸ºå•æœºæˆ¿æœºå™¨æ ‡è¯†ï¼Œå¯ä»¥éƒ¨ç½²<code>1024</code>ä¸ªèŠ‚ç‚¹ã€‚</li>
<li>åºåˆ—å·éƒ¨åˆ†å <code>12bit</code>ï¼Œæ”¯æŒåŒä¸€æ¯«ç§’å†…åŒä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥ç”Ÿæˆ2^12^=<code>4096</code>ä¸ª<code>ID</code>ã€‚</li>
</ol>
<blockquote>
<p>ğŸŒ  ä¼˜ç‚¹å’Œç¼ºç‚¹</p>
</blockquote>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>æ¯«ç§’æ•°åœ¨é«˜ä½ï¼Œè‡ªå¢åºåˆ—åœ¨ä½ä½ï¼Œ<code>ID</code>è¶‹åŠ¿é€’å¢ã€‚</li>
<li>ä»¥æœåŠ¡æ–¹å¼éƒ¨ç½²ï¼Œå¯ä»¥åšé«˜å¯ç”¨ã€‚</li>
<li>æ ¹æ®ä¸šåŠ¡åˆ†é…<code>bit</code>ä½ï¼Œçµæ´»ã€‚</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>æ¯å°æœºå™¨çš„æ—¶é’Ÿä¸åŒï¼Œå½“æ—¶é’Ÿå›æ‹¨å¯èƒ½ä¼šå‘ç”Ÿé‡å¤IDã€‚</li>
<li>å½“æ•°æ®é‡å¤§æ—¶ï¼Œéœ€è¦å¯¹<code>ID</code>å–æ¨¡åˆ†åº“åˆ†è¡¨ï¼Œåœ¨è·¨æ¯«ç§’æ—¶ï¼Œåºåˆ—å·æ€»æ˜¯å½’<code>0</code>ï¼Œä¼šå‘ç”Ÿå–æ¨¡ååˆ†å¸ƒä¸å‡è¡¡ã€‚</li>
</ul>
<blockquote>
<p>ğŸ’» Javaå®ç°</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.ParseException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: Mybatis-plus &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.common &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: SnowShakeUntil &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: é›ªèŠ±ç®—æ³• &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/11/8</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SnowFlakeUntil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;å¼€å§‹æ—¶é—´æˆ³&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> START_STMP;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        String startDateTime = <span class="string">&quot;2001-09-11 00:00:00&quot;</span>;</span><br><span class="line">        SimpleDateFormat simpleDateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">/* 13ä½æ—¶é—´æˆ³ */</span></span><br><span class="line">            START_STMP = simpleDateFormat.parse(startDateTime).getTime();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;åºåˆ—å·å ç”¨çš„ä½æ•°&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">long</span> SEQUENCE_BIT = <span class="number">12</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;æ•°æ®ä¸­å¿ƒæ ‡è¯†å ç”¨çš„ä½æ•°&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">long</span> MACHINE_BIT = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;æœºå™¨æ ‡è¯†å ç”¨çš„ä½æ•°&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">long</span> DATACENTER_BIT = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* æ¯ä¸€éƒ¨åˆ†çš„æœ€å¤§å€¼ï¼šå…ˆè¿›è¡Œå·¦ç§»è¿ç®—ï¼Œå†åŒ-1è¿›è¡Œå¼‚æˆ–è¿ç®— */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;ç”¨ä½è¿ç®—è®¡ç®—å‡ºæœ€å¤§æ”¯æŒçš„æ•°æ®ä¸­å¿ƒæ•°é‡ï¼š31&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">long</span> MAX_DATACENTER_NUM = -<span class="number">1L</span> ^ (-<span class="number">1L</span> &lt;&lt; DATACENTER_BIT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;ç”¨ä½è¿ç®—è®¡ç®—å‡ºæœ€å¤§æ”¯æŒçš„æœºå™¨æ•°é‡&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">long</span> MAX_MACHINE_NUM = -<span class="number">1L</span> ^ (-<span class="number">1L</span> &lt;&lt; MACHINE_BIT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;ç”¨ä½è¿ç®—è®¡ç®—å‡ºæœ€å¤§æ”¯æŒçš„æœ€å¤§æ­£æ•´æ•°4095&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">long</span> MAX_SEQUENCE = -<span class="number">1L</span> ^ (-<span class="number">1L</span> &lt;&lt; SEQUENCE_BIT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;æœºå™¨æ ‡å¿—è¾ƒåºåˆ—å·çš„åç§»é‡&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">long</span> MACHINE_LEFT = SEQUENCE_BIT;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;æ•°æ®ä¸­å¿ƒè¾ƒæœºå™¨æ ‡å¿—çš„åç§»é‡&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">long</span> DATACENTER_LEFT = SEQUENCE_BIT + MACHINE_BIT;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;æ—¶é—´æˆ³è¾ƒæ•°æ®ä¸­å¿ƒçš„åç§»é‡&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">long</span> TIMESTMP_LEFT = DATACENTER_LEFT + DATACENTER_BIT;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;æ•°æ®ä¸­å¿ƒ&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> dataCenterId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;æœºå™¨æ ‡è¯†&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> machineId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;åºåˆ—å·&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> sequence = <span class="number">0L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 4&lt;p&gt;ä¸Šä¸€æ¬¡æ—¶é—´æˆ³&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> lastStmp = -<span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;æ­¤å¤„æ— å‚æ„é€ ç§æœ‰ï¼ŒåŒæ—¶æ²¡æœ‰ç»™å‡ºæœ‰å‚æ„é€ ï¼Œåœ¨äºé¿å…ä»¥ä¸‹ä¸¤ç‚¹é—®é¢˜ï¼š&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * &lt;li&gt;1. ç§æœ‰åŒ–é¿å…äº†é€šè¿‡newçš„æ–¹å¼è¿›è¡Œè°ƒç”¨ï¼Œä¸»è¦æ˜¯è§£å†³äº†åœ¨forå¾ªç¯ä¸­é€šè¿‡newçš„æ–¹å¼è°ƒç”¨äº§ç”Ÿçš„idä¸ä¸€å®šå”¯ä¸€é—®é¢˜é—®é¢˜ï¼Œå› ä¸ºç”¨äºè®°å½•ä¸Šä¸€æ¬¡æ—¶é—´æˆ³çš„lastStmpæ°¸è¿œæ— æ³•å¾—åˆ°æ¯”å¯¹&lt;/li&gt;</span></span><br><span class="line"><span class="comment">     * &lt;li&gt;2. æ²¡æœ‰ç»™å‡ºæœ‰å‚æ„é€ åœ¨ç¬¬ä¸€ç‚¹çš„åŸºç¡€ä¸Šè€ƒè™‘äº†ä¸€å¥—åˆ†å¸ƒå¼ç³»ç»Ÿäº§ç”Ÿçš„å”¯ä¸€åºåˆ—å·åº”è¯¥æ˜¯åŸºäºç›¸åŒçš„å‚æ•°&lt;/li&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SnowFlakeUntil</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;ç”ŸæˆID&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">long</span> <span class="title">nextID</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">/* è·å–å½“å‰æ—¶é—´æˆ³*/</span></span><br><span class="line">        <span class="keyword">long</span> currStmp = getNewStmp();</span><br><span class="line">        <span class="comment">/* å¦‚æœå½“å‰æ—¶é—´æˆ³å°äºä¸Šæ¬¡æ—¶é—´æˆ³åˆ™æŠ›å‡ºå¼‚å¸¸ */</span></span><br><span class="line">        <span class="keyword">if</span> (currStmp &lt; lastStmp) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;Clock moved backwards. Refusing to generate id&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* ç›¸åŒæ¯«ç§’å†…ï¼Œåºåˆ—å·è‡ªå¢ */</span></span><br><span class="line">        <span class="keyword">if</span> (currStmp == lastStmp) &#123;</span><br><span class="line">            sequence = (sequence + <span class="number">1</span>) &amp; MAX_SEQUENCE;</span><br><span class="line">            <span class="comment">/* åŒä¸€æ¯«ç§’çš„åºåˆ—æ•°å·²ç»è¾¾åˆ°æœ€å¤§*/</span></span><br><span class="line">            <span class="keyword">if</span> (sequence == <span class="number">0L</span>) &#123;</span><br><span class="line">                currStmp = getNextStmp();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* ä¸åŒæ¯«ç§’å†…ï¼Œåºåˆ—å·è®¾ä¸º0 */</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            sequence = <span class="number">0L</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* å½“å‰æ—¶é—´æˆ³å­˜æ¡£è®°å½•*/</span></span><br><span class="line">        lastStmp = currStmp;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (currStmp - START_STMP) &lt;&lt; TIMESTMP_LEFT  <span class="comment">// æ—¶é—´æˆ³éƒ¨åˆ†</span></span><br><span class="line">                | dataCenterId &lt;&lt; DATACENTER_LEFT        <span class="comment">// æ•°æ®ä¸­å¿ƒéƒ¨åˆ†</span></span><br><span class="line">                | machineId &lt;&lt; MACHINE_LEFT              <span class="comment">// æœºå™¨æ ‡è¯†éƒ¨åˆ†</span></span><br><span class="line">                | sequence;                              <span class="comment">// åºåˆ—å·éƒ¨åˆ†</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;å½“å‰æ—¶é—´æˆ³&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">getNewStmp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> System.currentTimeMillis();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;ä¸‹ä¸€æ—¶é—´çš„æ—¶é—´æˆ³&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">getNextStmp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> mill = getNewStmp();</span><br><span class="line">        <span class="keyword">while</span> (mill &lt;= lastStmp) &#123;</span><br><span class="line">            mill = getNewStmp();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mill;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ğŸ”±åœ¨Mybatis-plusä¸­è‡ªå®šä¹‰IDç”Ÿæˆå™¨</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomIdGenerator</span> <span class="keyword">implements</span> <span class="title">IdentifierGenerator</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">nextId</span><span class="params">(Object entity)</span> </span>&#123;</span><br><span class="line">      	<span class="comment">// å¯ä»¥å°†å½“å‰ä¼ å…¥çš„classå…¨ç±»åæ¥ä½œä¸ºbizKey,æˆ–è€…æå–å‚æ•°æ¥ç”ŸæˆbizKeyè¿›è¡Œåˆ†å¸ƒå¼Idè°ƒç”¨ç”Ÿæˆ.</span></span><br><span class="line">      	String bizKey = entity.getClass().getName();</span><br><span class="line">        <span class="comment">// æ ¹æ®bizKeyè°ƒç”¨åˆ†å¸ƒå¼IDç”Ÿæˆ</span></span><br><span class="line">        <span class="keyword">long</span> id = ....;</span><br><span class="line">      	<span class="comment">// è¿”å›ç”Ÿæˆçš„idå€¼å³å¯.</span></span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="ğŸš€-CRUDæ‹“å±•"><a href="#ğŸš€-CRUDæ‹“å±•" class="headerlink" title="ğŸš€ CRUDæ‹“å±•"></a>ğŸš€ CRUDæ‹“å±•</h2><p>å»ºè¡¨</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`user`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">bigint</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`age`</span> <span class="built_in">tinyint</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`email`</span> <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">18</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COLLATE</span>=utf8_bin;</span><br></pre></td></tr></table></figure>

<p>å®ä½“</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableId(type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Email</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="ğŸŒŒè‡ªåŠ¨å¡«å……"><a href="#ğŸŒŒè‡ªåŠ¨å¡«å……" class="headerlink" title="ğŸŒŒè‡ªåŠ¨å¡«å……"></a>ğŸŒŒè‡ªåŠ¨å¡«å……</h3><p>å¯¹äºæ™®é€šå­—æ®µ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">FieldFill</span> </span>&#123;</span><br><span class="line">    <span class="comment">/* é»˜è®¤ä¸å¤„ç† */</span></span><br><span class="line">    DEFAULT,</span><br><span class="line">    <span class="comment">/* æ’å…¥å¡«å……å­—æ®µ */</span></span><br><span class="line">    INSERT,</span><br><span class="line">    <span class="comment">/*æ›´æ–°å¡«å……å­—æ®µ */</span></span><br><span class="line">    UPDATE,</span><br><span class="line">    <span class="comment">/* æ’å…¥å’Œæ›´æ–°å¡«å……å­—æ®µ */</span></span><br><span class="line">    INSERT_UPDATE</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>æ‰€æœ‰çš„æ•°æ®åº“è¡¨éƒ½åº”è¯¥åŒ…å«åˆ›å»ºæ—¶é—´gmt_createå’Œä¿®æ”¹æ—¶é—´gmt_modifiedï¼Œè€Œä¸”éœ€è¦è‡ªåŠ¨åŒ–ã€‚â€”â€”ã€Šé˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œã€‹</p>
<blockquote>
<p>ğŸ›¢æ•°æ®åº“çº§åˆ«</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">ADD</span> update_time DATETIME <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">ADD</span> create_time DATETIME <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>âŒ¨ï¸ä»£ç çº§åˆ«</p>
</blockquote>
<ul>
<li>æ•°æ®è¡¨æ·»åŠ å­—æ®µ</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">ADD</span> update_time DATETIME;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">ADD</span> create_time DATETIME;</span><br></pre></td></tr></table></figure>

<ul>
<li>å®ä½“ç±»æ·»åŠ å­—æ®µå’Œæ³¨è§£</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line"><span class="keyword">private</span> Date createTime;</span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line"><span class="keyword">private</span> Date updateTime;</span><br></pre></td></tr></table></figure>

<ul>
<li>ç¼–å†™å¤„ç†å™¨å¤„ç†æ³¨è§£</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.handler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.reflection.MetaObject;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: Mybatis-plus &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.handler &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: DataObjectHandler &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: è‡ªåŠ¨å¡«å……å¤„ç†å™¨ &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/11/9</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataObjectHandler</span> <span class="keyword">implements</span> <span class="title">MetaObjectHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;æ’å…¥æ—¶çš„å¡«å……ç­–ç•¥&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> metaObject</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertFill</span><span class="params">(MetaObject metaObject)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setFieldValByName(<span class="string">&quot;createTime&quot;</span>, <span class="keyword">new</span> Date(), metaObject);</span><br><span class="line">        <span class="keyword">this</span>.setFieldValByName(<span class="string">&quot;updateTime&quot;</span>, <span class="keyword">new</span> Date(), metaObject);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;æ›´æ–°æ—¶çš„å¡«å……ç­–ç•¥&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> metaObject</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateFill</span><span class="params">(MetaObject metaObject)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setFieldValByName(<span class="string">&quot;updateTime&quot;</span>, <span class="keyword">new</span> Date(), metaObject);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="ğŸ”æ‚²è§‚é”"><a href="#ğŸ”æ‚²è§‚é”" class="headerlink" title="ğŸ”æ‚²è§‚é”"></a>ğŸ”æ‚²è§‚é”</h3><blockquote>
<p>ğŸ“–ç†è§£</p>
</blockquote>
<p>å½“è¦å¯¹æ•°æ®åº“çš„ä¸€æ¡æ•°æ®è¿›è¡Œä¿®æ”¹çš„æ—¶å€™ï¼Œä¸ºäº†é¿å…åŒæ—¶è¢«å…¶ä»–äººä¿®æ”¹ï¼Œæœ€å¥½çš„åŠæ³•å°±æ˜¯ç›´æ¥å¯¹æ•°æ®è¿›è¡ŒåŠ é”é˜²æ­¢å¹¶å‘ã€‚</p>
<p>è¿™ç§å€ŸåŠ©æ•°æ®åº“é”æœºåˆ¶ï¼Œåœ¨ä¿®æ”¹æ•°æ®ä¹‹å‰å…ˆé”å®šï¼Œå†ä¿®æ”¹çš„æ–¹å¼è¢«ç§°ä¸ºæ‚²è§‚å¹¶å‘æ§åˆ¶(Pessimistic Concurrency Controlï¼Œç¼©å†™PCCï¼Œåˆåæ‚²è§‚é”)ã€‚</p>
<blockquote>
<p>ğŸ’ å®ç°</p>
</blockquote>
<p>æ‚²è§‚é”çš„å®ç°ï¼Œå¾€å¾€ä¾é æ•°æ®åº“æä¾›çš„é”æœºåˆ¶(åªæœ‰æ•°æ®åº“å±‚æä¾›çš„é”æœºåˆ¶æ‰èƒ½çœŸæ­£ä¿è¯æ•°æ®è®¿é—®çš„æ’ä»–æ€§ï¼Œå¦åˆ™ï¼Œå³ä½¿åœ¨æœ¬ç³»ç»Ÿä¸­å®ç°äº†åŠ é”æœºåˆ¶ï¼Œä¹Ÿæ— æ³•ä¿è¯å¤–éƒ¨ç³»ç»Ÿä¸ä¼šä¿®æ”¹æ•°æ®)ã€‚æ‚²è§‚é”çš„å®ç°ï¼š</p>
<ul>
<li>ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ä½¿ç”¨è¿™ç§é”æœºåˆ¶ï¼Œæ¯”å¦‚è¡Œé”ã€è¡¨é”ã€è¯»é”ã€å†™é”ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”</li>
<li>Javaé‡Œé¢çš„åŒæ­¥<code>synchronized</code>å…³é”®å­—çš„å®ç°</li>
<li><code>JUC</code>ä¸­çš„<code>lock</code>åŠ é”</li>
</ul>
<blockquote>
<p>ğŸ”±åˆ†ç±» </p>
</blockquote>
<ul>
<li>å…±äº«é”ï¼šåˆç§°ä¸ºè¯»é”ï¼Œç®€ç§°Sé”ã€‚é¡¾åæ€ä¹‰ï¼Œå…±äº«é”å°±æ˜¯å¤šä¸ªäº‹åŠ¡å¯¹äºåŒä¸€ä¸ªæ•°ä¹å¯ä»¥å…±äº«ä¸€æŠŠé”ï¼Œéƒ½èƒ½è®¿é—®åˆ°æ•°æ®ï¼Œä½†æ˜¯åªèƒ½è¯»ä¸èƒ½ä¿®æ”¹ã€‚</li>
<li>æ’ä»–é”ï¼šåˆç§°ä¸ºå†™é”ï¼Œç®€ç§°Xé”ã€‚é¡¾åæ€ä¹‰ï¼Œæ’ä»–é”å°±æ˜¯ä¸èƒ½ä¸å…¶ä»–é”å¹¶å­˜ï¼Œå¦‚æœä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€ä¸ªæ•°æ®è¡Œçš„æ’å®ƒé”ï¼Œå…¶ä»–äº‹åŠ¡å°±ä¸èƒ½å†è·å–è¯¥è¡Œçš„å…¶ä»–é”ï¼ŒåŒ…æ‹¬å…±äº«é”å’Œæ’ä»–é”ï¼Œä½†æ˜¯è·å–åˆ°æ’ä»–é”çš„äº‹åŠ¡å¯ä»¥å¯¹æ•°æ®è¿›è¡Œè¯»å–å’Œä¿®æ”¹ã€‚</li>
</ul>
<blockquote>
<p>ğŸ’¬è¯´æ˜</p>
</blockquote>
<p>æ‚²è§‚å¹¶å‘æ§åˆ¶å®è´¨ä¸Šæ˜¯<strong>å…ˆå–é”å†è®¿é—®</strong>çš„ä¿å®ˆç­–ç•¥ï¼Œä¸ºæ•°æ®å¤„ç†çš„å®‰å…¨æä¾›äº†ä¿è¯ã€‚</p>
<p>ä½†æ˜¯åœ¨æ•ˆç‡æ–¹é¢ï¼Œå¤„ç†åŠ é”çš„æœºåˆ¶ä¼šè®©æ•°æ®åº“äº§ç”Ÿé¢å¤–çš„å¼€é”€ï¼Œè¿˜æœ‰å¢åŠ äº§ç”Ÿæ­»é”çš„æœºä¼šã€‚</p>
<p>å¦å¤–è¿˜ä¼šé™ä½å¹¶è¡Œæ€§ï¼Œä¸€ä¸ªäº‹åŠ¡å¦‚æœé”å®šäº†æŸè¡Œæ•°æ®ï¼Œå…¶ä»–äº‹åŠ¡å°±å¿…é¡»ç­‰å¾…è¯¥äº‹åŠ¡å¤„ç†å®Œæ‰å¯ä»¥å¤„ç†é‚£è¡Œæ•°æ®ã€‚</p>
<h3 id="ğŸ”“ä¹è§‚é”"><a href="#ğŸ”“ä¹è§‚é”" class="headerlink" title="ğŸ”“ä¹è§‚é”"></a>ğŸ”“ä¹è§‚é”</h3><blockquote>
<p>ğŸ“–ç†è§£</p>
</blockquote>
<p>ä¹è§‚é”å‡è®¾æ•°æ®åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šé€ æˆå†²çªï¼Œæ‰€ä»¥åœ¨æ•°æ®è¿›è¡Œæäº¤æ›´æ–°çš„æ—¶å€™ï¼Œæ‰ä¼šæ­£å¼å¯¹æ•°æ®çš„å†²çªä¸å¦è¿›è¡Œæ£€æµ‹ï¼Œå¦‚æœå‘ç°å†²çªäº†ï¼Œåˆ™è¿”å›ç»™ç”¨æˆ·é”™è¯¯çš„ä¿¡æ¯ï¼Œè®©ç”¨æˆ·å†³å®šå¦‚ä½•å»åšã€‚ä¹è§‚é”é€‚ç”¨äºè¯»æ“ä½œå¤šçš„åœºæ™¯ï¼Œè¿™æ ·å¯ä»¥æé«˜ç¨‹åºçš„ååé‡ã€‚</p>
<blockquote>
<p>ğŸ’ å®ç°</p>
</blockquote>
<p>ä¹è§‚é”ä¸ä¼šå¯ä»¥ä½¿ç”¨æ•°æ®åº“æœ¬èº«çš„é”æœºåˆ¶ï¼Œè€Œæ˜¯ä¾æ®æ•°æ®æœ¬èº«æ¥ä¿è¯æ•°æ®çš„æ­£ç¡®æ€§ã€‚ä¹è§‚é”çš„å®ç°ï¼š</p>
<ul>
<li><p>CASå®ç°ï¼š<code>Java </code>ä¸­<code>java.concurrent.atomic</code>åŒ…ä¸‹é¢çš„åŸå­å˜é‡ä½¿ç”¨äº†ä¹è§‚é”çš„ä¸€ç§ <code>CAS</code> å®ç°æ–¹å¼</p>
</li>
<li><p>ç‰ˆæœ¬å·æ§åˆ¶ï¼šä¸€èˆ¬æ˜¯åœ¨æ•°æ®è¡¨ä¸­æ·»åŠ ä¸€ä¸ªæ•°æ®ç‰ˆæœ¬å·<code>version</code>å­—æ®µï¼Œè¡¨ç¤ºæ•°æ®è¢«ä¿®æ”¹çš„æ¬¡æ•°ã€‚å½“æ•°æ®è¢«ä¿®æ”¹æ—¶ï¼Œ<code>version</code>å€¼ä¼š+1ã€‚å½“çº¿ç¨‹Aæ›´æ–°æ•°æ®å€¼æ—¶ï¼Œåœ¨è¯»å–æ•°æ®çš„åŒæ—¶ä¹Ÿä¼šè¯»å–<code>version</code>å€¼ï¼Œåœ¨æäº¤æ›´æ–°æ—¶ï¼Œè‹¥åˆšæ‰è¯»å–åˆ°<code>version</code>å€¼ä¸å½“å‰æ•°æ®åº“ä¸­çš„<code>version</code>å€¼ç›¸ç­‰æ—¶æ‰æ›´æ–°ï¼Œå¦åˆ™é‡è¯•æ›´æ–°æ“ä½œï¼Œç›´åˆ°æ›´æ–°æˆåŠŸã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 1 æŸ¥è¯¢ç‰ˆæœ¬å·</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">version</span> <span class="keyword">as</span> oldversion <span class="keyword">where</span> <span class="keyword">id</span> = <span class="comment">#&#123;id&#125;</span></span><br><span class="line"><span class="comment">-- 2 æ›´æ–°æ“ä½œ</span></span><br><span class="line"><span class="keyword">update</span> <span class="keyword">set</span> ... , <span class="keyword">version</span> = <span class="keyword">version</span>  + <span class="number">1</span> <span class="keyword">where</span> <span class="keyword">id</span> = <span class="comment">#&#123;id&#125;  and version = oldversion</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<blockquote>
<p>ğŸ’¬è¯´æ˜</p>
</blockquote>
<p>ä¹è§‚å¹¶å‘æ§åˆ¶ç›¸ä¿¡äº‹åŠ¡ä¹‹é—´çš„æ•°æ®ç«äº‰æ¦‚ç‡æ˜¯æ¯”è¾ƒå°çš„ã€‚å› æ­¤å°½å¯èƒ½ç›´æ¥åšä¸‹å»ï¼Œç›´åˆ°æäº¤çš„æ—¶å€™æ‰å»é”å®šï¼Œæ‰€ä»¥ä¸ä¼šäº§ç”Ÿä»»ä½•é”æˆ–æ­»é”ã€‚</p>
<blockquote>
<p>ğŸ”§æ’ä»¶</p>
</blockquote>
<ul>
<li>æ•°æ®è¡¨æ·»åŠ å­—æ®µ</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">ADD</span> <span class="keyword">version</span> <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>; </span><br></pre></td></tr></table></figure>

<ul>
<li>å®ä½“ç±»æ·»åŠ å±æ€§å’Œæ³¨è§£</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* ä¹è§‚é” */</span></span><br><span class="line"><span class="meta">@Version</span></span><br><span class="line"><span class="keyword">private</span> Integer version;</span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨mybatis-plusé…ç½®ç±»ä¸­å¢åŠ ä¹è§‚é”æ‹¦æˆªå™¨</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisPlusConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MybatisPlusInterceptor <span class="title">mybatisPlusInterceptor</span><span class="params">()</span>  </span>&#123;</span><br><span class="line">        MybatisPlusInterceptor mybatisPlusInterceptor = <span class="keyword">new</span> MybatisPlusInterceptor();</span><br><span class="line">        <span class="comment">/* ä¹è§‚é”æ’ä»¶ */</span></span><br><span class="line">        mybatisPlusInterceptor.addInnerInterceptor(<span class="keyword">new</span> OptimisticLockerInnerInterceptor());</span><br><span class="line">        <span class="keyword">return</span> mybatisPlusInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ä¹è§‚é”æµ‹è¯•</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * &lt;p&gt;ä¹è§‚é”æµ‹è¯•1&lt;/p&gt;</span></span><br><span class="line"><span class="comment">    */</span>    </span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">optimisticLock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="comment">// æŸ¥è¯¢ä¿¡æ¯</span></span><br><span class="line">       User user1 = userMapper.selectById(<span class="number">10L</span>);</span><br><span class="line">       <span class="comment">// ä¿®æ”¹ä¿¡æ¯</span></span><br><span class="line">       user1.setName(<span class="string">&quot;Khighness10&quot;</span>);</span><br><span class="line">       user1.setAge(<span class="number">10</span>);</span><br><span class="line">       user1.setEmail(<span class="string">&quot;khighness10@qq.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// æ’é˜Ÿæ“ä½œ: æŠ¢å…ˆæ›´æ–°ï¼Œä¼šæ›´æ–°ç‰ˆæœ¬å·</span></span><br><span class="line">       User user2 = userMapper.selectById(<span class="number">10L</span>);</span><br><span class="line">       user2.setAge(<span class="number">100</span>);</span><br><span class="line">       userMapper.updateById(user2);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// æ‰§è¡Œæ›´æ–°ï¼šæ›´æ–°å¤±è´¥ï¼Œç‰ˆæœ¬å·ä¸å¯¹</span></span><br><span class="line">       userMapper.updateById(user1);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æµ‹è¯•ç»“æœ</span><br><span class="line">JDBC Connection [HikariProxyConnection@597623166 wrapping com.mysql.cj.jdbc.ConnectionImpl@38cedb7d] will not be managed by Spring</span><br><span class="line">&#x3D;&#x3D;&gt;  Preparing: SELECT id,name,age,email,create_time,update_time,version FROM user WHERE id&#x3D;? </span><br><span class="line">&#x3D;&#x3D;&gt; Parameters: 10(Long)</span><br><span class="line">&lt;&#x3D;&#x3D;    Columns: id, name, age, email, create_time, update_time, version</span><br><span class="line">&lt;&#x3D;&#x3D;        Row: 10, Khighness10, 10, khighness10@qq.com, 2020-11-09 13:30:04, 2020-11-09 13:35:49, 2</span><br><span class="line">&lt;&#x3D;&#x3D;      Total: 1</span><br><span class="line">Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@12a14b74]</span><br><span class="line">Creating a new SqlSession</span><br><span class="line">SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@6a9344f5] was not registered for synchronization because synchronization is not active</span><br><span class="line">JDBC Connection [HikariProxyConnection@1434769862 wrapping com.mysql.cj.jdbc.ConnectionImpl@38cedb7d] will not be managed by Spring</span><br><span class="line">&#x3D;&#x3D;&gt;  Preparing: SELECT id,name,age,email,create_time,update_time,version FROM user WHERE id&#x3D;? </span><br><span class="line">&#x3D;&#x3D;&gt; Parameters: 10(Long)</span><br><span class="line">&lt;&#x3D;&#x3D;    Columns: id, name, age, email, create_time, update_time, version</span><br><span class="line">&lt;&#x3D;&#x3D;        Row: 10, Khighness10, 10, khighness10@qq.com, 2020-11-09 13:30:04, 2020-11-09 13:35:49, 2</span><br><span class="line">&lt;&#x3D;&#x3D;      Total: 1</span><br><span class="line">Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@6a9344f5]</span><br><span class="line">Creating a new SqlSession</span><br><span class="line">SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@3234474] was not registered for synchronization because synchronization is not active</span><br><span class="line">JDBC Connection [HikariProxyConnection@1137013089 wrapping com.mysql.cj.jdbc.ConnectionImpl@38cedb7d] will not be managed by Spring</span><br><span class="line">&#x3D;&#x3D;&gt;  Preparing: UPDATE user SET name&#x3D;?, age&#x3D;?, email&#x3D;?, create_time&#x3D;?, update_time&#x3D;?, version&#x3D;? WHERE id&#x3D;? AND version&#x3D;? </span><br><span class="line">&#x3D;&#x3D;&gt; Parameters: Khighness10(String), 100(Integer), khighness10@qq.com(String), 2020-11-09 13:30:04.0(Timestamp), 2020-11-09 13:59:41.434(Timestamp), 3(Integer), 10(Long), 2(Integer)</span><br><span class="line">&lt;&#x3D;&#x3D;    Updates: 1   &#x2F;&#x2F; æ’é˜Ÿæ›´æ–°ï¼Œå½±å“è¡Œæ•°ä¸º1&#x3D;&gt;æˆåŠŸ</span><br><span class="line">Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@3234474]</span><br><span class="line">Creating a new SqlSession</span><br><span class="line">SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@58658f63] was not registered for synchronization because synchronization is not active</span><br><span class="line">JDBC Connection [HikariProxyConnection@1424043852 wrapping com.mysql.cj.jdbc.ConnectionImpl@38cedb7d] will not be managed by Spring</span><br><span class="line">&#x3D;&#x3D;&gt;  Preparing: UPDATE user SET name&#x3D;?, age&#x3D;?, email&#x3D;?, create_time&#x3D;?, update_time&#x3D;?, version&#x3D;? WHERE id&#x3D;? AND version&#x3D;? </span><br><span class="line">&#x3D;&#x3D;&gt; Parameters: Khighness10(String), 10(Integer), khighness10@qq.com(String), 2020-11-09 13:30:04.0(Timestamp), 2020-11-09 13:59:41.45(Timestamp), 3(Integer), 10(Long), 2(Integer)</span><br><span class="line">&lt;&#x3D;&#x3D;    Updates: 0   &#x2F;&#x2F; æ‰§è¡Œæ›´æ–°ï¼Œå½±å“è¡Œæ•°ä¸º0&#x3D;&gt;å¤±è´¥</span><br><span class="line">Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@58658f63]</span><br></pre></td></tr></table></figure>



<h3 id="ğŸ”–åˆ†é¡µæŸ¥è¯¢"><a href="#ğŸ”–åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="ğŸ”–åˆ†é¡µæŸ¥è¯¢"></a>ğŸ”–åˆ†é¡µæŸ¥è¯¢</h3><ul>
<li>mybatis-plusé…ç½®ç±»ä¸­å¢åŠ åˆ†é¡µæ‹¦æˆªå™¨</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisPlusConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MybatisPlusInterceptor <span class="title">mybatisPlusInterceptor</span><span class="params">()</span>  </span>&#123;</span><br><span class="line">        MybatisPlusInterceptor mybatisPlusInterceptor = <span class="keyword">new</span> MybatisPlusInterceptor();</span><br><span class="line">        <span class="comment">/* åˆ†é¡µæ’ä»¶ */</span></span><br><span class="line">        mybatisPlusInterceptor.addInnerInterceptor(<span class="keyword">new</span> PaginationInnerInterceptor(DbType.MYSQL));</span><br><span class="line">        <span class="keyword">return</span> mybatisPlusInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ç›´æ¥ä½¿ç”¨<code>Page</code>å¯¹è±¡</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†é¡µæŸ¥è¯¢ï¼Œä½¿ç”¨page</span></span><br><span class="line"><span class="comment"> * æ„é€ å‡½æ•°Page(current, size)</span></span><br><span class="line"><span class="comment"> * current: é¡µå·</span></span><br><span class="line"><span class="comment"> * size: é¡µé¢å¤§å°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">page</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Page&lt;User&gt; userPage = <span class="keyword">new</span> Page&lt;&gt;(<span class="number">3</span>, <span class="number">3</span>);</span><br><span class="line">    userMapper.selectPage(userPage, <span class="keyword">null</span>);</span><br><span class="line">    log.info(<span class="string">&quot;æ€»è®°å½•æ•°é‡: &#123;&#125;&quot;</span>, userPage.getTotal());</span><br><span class="line">    log.info(<span class="string">&quot;ç¬¬3é¡µç»“æœå¦‚ä¸‹&quot;</span>);</span><br><span class="line">    userPage.getRecords().stream().forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æµ‹è¯•ç»“æœ</span><br><span class="line">Creating a new SqlSession</span><br><span class="line">SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@d5556bf] was not registered for synchronization because synchronization is not active</span><br><span class="line">2020-11-09 15:44:02.969  INFO 6560 --- [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...</span><br><span class="line">2020-11-09 15:44:03.107  INFO 6560 --- [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.</span><br><span class="line">JDBC Connection [HikariProxyConnection@2068279617 wrapping com.mysql.cj.jdbc.ConnectionImpl@784223e9] will not be managed by Spring</span><br><span class="line">&#x3D;&#x3D;&gt;  Preparing: SELECT COUNT(1) FROM user</span><br><span class="line">&#x3D;&#x3D;&gt; Parameters: </span><br><span class="line">&lt;&#x3D;&#x3D;    Columns: COUNT(1)</span><br><span class="line">&lt;&#x3D;&#x3D;        Row: 12</span><br><span class="line">&lt;&#x3D;&#x3D;      Total: 1</span><br><span class="line">&#x3D;&#x3D;&gt;  Preparing: SELECT id,name,age,email,create_time,update_time,version FROM user LIMIT ?,?</span><br><span class="line">&#x3D;&#x3D;&gt; Parameters: 6(Long), 3(Long)</span><br><span class="line">&lt;&#x3D;&#x3D;    Columns: id, name, age, email, create_time, update_time, version</span><br><span class="line">&lt;&#x3D;&#x3D;        Row: 7, UnknownK, 3, unknownk@gmail.@32423.com, 2020-11-09 15:33:38, 2020-11-09 15:33:38, 1</span><br><span class="line">&lt;&#x3D;&#x3D;        Row: 8, UnknownK, 3, unknownk@gmail.@32423.com, 2020-11-09 15:33:38, 2020-11-09 15:33:38, 1</span><br><span class="line">&lt;&#x3D;&#x3D;        Row: 9, UnknownK, 3, unknownk@gmail.com, 2020-11-09 13:28:49, 2020-11-09 13:28:49, 1</span><br><span class="line">&lt;&#x3D;&#x3D;      Total: 3</span><br><span class="line">Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@d5556bf]</span><br><span class="line">2020-11-09 15:44:03.170  INFO 6560 --- [           main] top.parak.mapper.UserMapperTest          : æ€»è®°å½•æ•°é‡: 12</span><br><span class="line">2020-11-09 15:44:03.170  INFO 6560 --- [           main] top.parak.mapper.UserMapperTest          : ç¬¬3é¡µç»“æœå¦‚ä¸‹</span><br><span class="line">User(id&#x3D;7, name&#x3D;UnknownK, age&#x3D;3, email&#x3D;unknownk@gmail.@32423.com, createTime&#x3D;Mon Nov 09 15:33:38 CST 2020, updateTime&#x3D;Mon Nov 09 15:33:38 CST 2020, version&#x3D;1)</span><br><span class="line">User(id&#x3D;8, name&#x3D;UnknownK, age&#x3D;3, email&#x3D;unknownk@gmail.@32423.com, createTime&#x3D;Mon Nov 09 15:33:38 CST 2020, updateTime&#x3D;Mon Nov 09 15:33:38 CST 2020, version&#x3D;1)</span><br><span class="line">User(id&#x3D;9, name&#x3D;UnknownK, age&#x3D;3, email&#x3D;unknownk@gmail.com, createTime&#x3D;Mon Nov 09 13:28:49 CST 2020, updateTime&#x3D;Mon Nov 09 13:28:49 CST 2020, version&#x3D;1)</span><br></pre></td></tr></table></figure>

<p>ã€</p>
<h3 id="ğŸ“›é€»è¾‘åˆ é™¤"><a href="#ğŸ“›é€»è¾‘åˆ é™¤" class="headerlink" title="ğŸ“›é€»è¾‘åˆ é™¤"></a>ğŸ“›é€»è¾‘åˆ é™¤</h3><blockquote>
<p>ç‰©ç†åˆ é™¤ï¼šä»æ•°æ®åº“ä¸­ç›´æ¥åˆ é™¤ã€‚</p>
<p>é€»è¾‘åˆ é™¤ï¼šä¸ä»æ•°æ®åº“ä¸­ç§»é™¤ï¼Œé€šè¿‡ä¸€ä¸ªå˜é‡ä½¿å…¶å¤±æ•ˆã€‚å®è´¨ä¸Šæ˜¯æ›´æ–°ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±ã€‚</p>
</blockquote>
<ul>
<li>æ•°æ®åº“æ·»åŠ å­—æ®µ</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">ADD</span> deleted </span><br></pre></td></tr></table></figure>
<ul>
<li>å®ä½“ç±»æ·»åŠ å±æ€§å’Œæ³¨è§£</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* é€»è¾‘åˆ é™¤ */</span></span><br><span class="line"><span class="meta">@TableLogic</span></span><br><span class="line"><span class="keyword">private</span> Integer deleted;</span><br></pre></td></tr></table></figure>

<ul>
<li>Application.propertiesä¸­å¢åŠ é…ç½®</li>
</ul>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é€»è¾‘åˆ é™¤</span></span><br><span class="line"><span class="meta">mybatis-plus.global-config.db-config.logic-delete-value</span>=<span class="string">1</span></span><br><span class="line"><span class="meta">mybatis-plus.global-config.db-config.logic-not-delete-value</span>=<span class="string">0</span></span><br></pre></td></tr></table></figure>



<h3 id="ğŸ”æ€§èƒ½åˆ†æ"><a href="#ğŸ”æ€§èƒ½åˆ†æ" class="headerlink" title="ğŸ”æ€§èƒ½åˆ†æ"></a><del>ğŸ”æ€§èƒ½åˆ†æ</del></h3><p>3.4.Xç‰ˆæœ¬ä¸­è¯¥æ’ä»¶å·²ç»ç§»é™¤ã€‚</p>
<h3 id="ğŸ’¤æ¡ä»¶æ„é€ å™¨"><a href="#ğŸ’¤æ¡ä»¶æ„é€ å™¨" class="headerlink" title="ğŸ’¤æ¡ä»¶æ„é€ å™¨"></a>ğŸ’¤æ¡ä»¶æ„é€ å™¨</h3><img src="/2020/11/12/MybatisPlus/image-20201112160607792.png" class="" title="image-20201112160607792">

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WrapperTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">        <span class="comment">// å§“åä¸ä¸ºç©º</span></span><br><span class="line">        <span class="comment">// é‚®ç®±ä¸ä¸ºç©º</span></span><br><span class="line">        <span class="comment">// å¹´é¾„å¤§äºç­‰äº18</span></span><br><span class="line">        wrapper</span><br><span class="line">                .isNotNull(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">                .isNotNull(<span class="string">&quot;email&quot;</span>)</span><br><span class="line">                .ge(<span class="string">&quot;age&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        userMapper.selectList(wrapper).stream().forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">        wrapper.eq(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;RubbishK&quot;</span>);</span><br><span class="line">        <span class="comment">// åªèƒ½æŸ¥è¯¢ä¸€ä¸ªç”¨æˆ·ï¼Œç»“æœå¤šäº1ä¸ªä¼šæŠ¥é”™</span></span><br><span class="line">        System.out.println(userMapper.selectOne(wrapper));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">        <span class="comment">// æŸ¥è¯¢å¹´é¾„åœ¨13åˆ°19çš„ç”¨æˆ·æ•°é‡</span></span><br><span class="line">        wrapper.between(<span class="string">&quot;age&quot;</span>, <span class="number">13</span>, <span class="number">19</span>);</span><br><span class="line">        System.out.println(userMapper.selectCount(wrapper));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">        <span class="comment">// æ¨¡ç³ŠæŸ¥è¯¢</span></span><br><span class="line">        wrapper</span><br><span class="line">                .likeRight(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;K&quot;</span>)  <span class="comment">// K%</span></span><br><span class="line">                .likeLeft(<span class="string">&quot;email&quot;</span>, <span class="string">&quot;@gmail.com&quot;</span>);  <span class="comment">// %@gmail.com</span></span><br><span class="line">        userMapper.selectList(wrapper).stream().forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">test5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">        <span class="comment">// æ‹¼æ¥sqlè¯­å¥</span></span><br><span class="line">        wrapper.inSql(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;select id from user where id &lt; 3&quot;</span>);</span><br><span class="line">        userMapper.selectList(wrapper).stream().forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">test6</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">        <span class="comment">// é€šè¿‡IDé™åºæ’åº</span></span><br><span class="line">        wrapper.orderByDesc(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        userMapper.selectList(wrapper).stream().forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="ğŸ”°ä»£ç ç”Ÿæˆå™¨"><a href="#ğŸ”°ä»£ç ç”Ÿæˆå™¨" class="headerlink" title="ğŸ”°ä»£ç ç”Ÿæˆå™¨"></a>ğŸ”°ä»£ç ç”Ÿæˆå™¨</h3><blockquote>
<p>è‡ªåŠ¨ç”Ÿæˆ entityã€mapperã€serviceã€controllerå±‚çš„ä»£ç </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.generator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.DbType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.FieldFill;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.IdType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.AutoGenerator;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.InjectionConfig;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.DataSourceConfig;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.GlobalConfig;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.PackageConfig;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.StrategyConfig;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.po.TableFill;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.rules.DateType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.rules.NamingStrategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: Mybatis-plus &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.generator &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: ParaKCode &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/11/12</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParaKCodeGenerator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ä»£ç ç”Ÿæˆå™¨</span></span><br><span class="line">        AutoGenerator autoGenerator = <span class="keyword">new</span> AutoGenerator();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…¨å±€é…ç½®</span></span><br><span class="line">        GlobalConfig globalConfig = <span class="keyword">new</span> GlobalConfig();</span><br><span class="line">        String projectPath = System.getProperty(<span class="string">&quot;user.dir&quot;</span>);</span><br><span class="line">        globalConfig.setOutputDir(projectPath + <span class="string">&quot;/src/main/java&quot;</span>);</span><br><span class="line">        <span class="comment">// è®¾ç½®ä½œè€…å</span></span><br><span class="line">        globalConfig.setAuthor(<span class="string">&quot;KHighness&quot;</span>);</span><br><span class="line">        <span class="comment">// æ“ä½œå®Œæˆæ˜¯å¦æ‰“å¼€èµ„æºç®¡ç†å™¨</span></span><br><span class="line">        globalConfig.setOpen(<span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">// æ˜¯å¦è¦†ç›–åŸæœ‰æ–‡ä»¶</span></span><br><span class="line">        globalConfig.setFileOverride(<span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">// å»Serviceçš„Iå‰ç¼€</span></span><br><span class="line">        globalConfig.setServiceName(<span class="string">&quot;%sService&quot;</span>); </span><br><span class="line">        globalConfig.setIdType(IdType.ID_WORKER);</span><br><span class="line">        globalConfig.setDateType(DateType.ONLY_DATE);</span><br><span class="line">        autoGenerator.setGlobalConfig(globalConfig);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ•°æ®æºé…ç½®</span></span><br><span class="line">        DataSourceConfig dataSourceConfig = <span class="keyword">new</span> DataSourceConfig();</span><br><span class="line">        dataSourceConfig.setDbType(DbType.MYSQL);</span><br><span class="line">        dataSourceConfig.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/test?serverTimezone=GMT%2B8&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&quot;</span>);</span><br><span class="line">        dataSourceConfig.setDriverName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        dataSourceConfig.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dataSourceConfig.setPassword(<span class="string">&quot;KAG1823&quot;</span>);</span><br><span class="line">        autoGenerator.setDataSource(dataSourceConfig);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŒ…é…ç½®</span></span><br><span class="line">        PackageConfig packageConfig = <span class="keyword">new</span> PackageConfig();</span><br><span class="line">        packageConfig.setModuleName(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">        packageConfig.setParent(<span class="string">&quot;top.parak&quot;</span>);</span><br><span class="line">        packageConfig.setEntity(<span class="string">&quot;entity&quot;</span>);</span><br><span class="line">        packageConfig.setMapper(<span class="string">&quot;mapper&quot;</span>);</span><br><span class="line">        packageConfig.setService(<span class="string">&quot;service&quot;</span>);</span><br><span class="line">        packageConfig.setController(<span class="string">&quot;controller&quot;</span>);</span><br><span class="line">        autoGenerator.setPackageInfo(packageConfig);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç­–ç•¥é…ç½®</span></span><br><span class="line">        StrategyConfig strategyConfig = <span class="keyword">new</span> StrategyConfig();</span><br><span class="line">        <span class="comment">// æ˜ å°„è¡¨å</span></span><br><span class="line">        strategyConfig.setInclude(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        strategyConfig.setNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        strategyConfig.setColumnNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        <span class="comment">// Lombokå®ä½“ç±»</span></span><br><span class="line">        strategyConfig.setEntityLombokModel(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">// é©¼å³°å‘½å</span></span><br><span class="line">        strategyConfig.setRestControllerStyle(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">// é€»è¾‘åˆ é™¤</span></span><br><span class="line">        strategyConfig.setLogicDeleteFieldName(<span class="string">&quot;deleted&quot;</span>);</span><br><span class="line">        <span class="comment">// åˆ›å»ºæ—¶é—´</span></span><br><span class="line">        TableFill gmt_create = <span class="keyword">new</span> TableFill(<span class="string">&quot;create_time&quot;</span>, FieldFill.INSERT);</span><br><span class="line">        <span class="comment">// æ›´æ–°æ—¶é—´</span></span><br><span class="line">        TableFill gmt_modify = <span class="keyword">new</span> TableFill(<span class="string">&quot;update_time&quot;</span>, FieldFill.INSERT);</span><br><span class="line">        List&lt;TableFill&gt; tableFills = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        tableFills.add(gmt_create);</span><br><span class="line">        tableFills.add(gmt_modify);</span><br><span class="line">        strategyConfig.setTableFillList(tableFills);</span><br><span class="line">        <span class="comment">// ä¹è§‚é”</span></span><br><span class="line">        strategyConfig.setVersionFieldName(<span class="string">&quot;version&quot;</span>);</span><br><span class="line">        strategyConfig.setControllerMappingHyphenStyle(<span class="keyword">true</span>);</span><br><span class="line">        autoGenerator.setStrategy(strategyConfig);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è‡ªå®šä¹‰é…ç½®</span></span><br><span class="line">        InjectionConfig injectionConfig = <span class="keyword">new</span> InjectionConfig() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰§è¡Œç”Ÿæˆ</span></span><br><span class="line">        autoGenerator.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç”Ÿæˆç»“æœ</p>
</blockquote>
<img src="/2020/11/12/MybatisPlus/image-20201112182336874.png" class="" title="image-20201112182336874">]]></content>
      <categories>
        <category>Mybatis-plus</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤§æ•°æ®</title>
    <url>/2020/10/02/Hadoop/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å¤§æ•°æ®ä¸äº‘è®¡ç®—"><a href="#å¤§æ•°æ®ä¸äº‘è®¡ç®—" class="headerlink" title="å¤§æ•°æ®ä¸äº‘è®¡ç®—"></a>å¤§æ•°æ®ä¸äº‘è®¡ç®—</h1><center>
    <font face="åæ–‡æ¥·ä½“" color="#33CCFF" size=5>Khighness</font><br>
</center>





<h2 id="1-å®‰è£…CentOS7"><a href="#1-å®‰è£…CentOS7" class="headerlink" title="1. å®‰è£…CentOS7"></a>1. å®‰è£…CentOS7</h2><h3 id="1-ä¸‹è½½é•œåƒ"><a href="#1-ä¸‹è½½é•œåƒ" class="headerlink" title="1. ä¸‹è½½é•œåƒ"></a>1. ä¸‹è½½é•œåƒ</h3><blockquote>
<p>ISO: <a href="https://www.centos.org/download/">CentOS7 X86_64</a></p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200915192222693.png" class="" title="image-20200915192222693">





<h3 id="2-å®‰è£…ç³»ç»Ÿ"><a href="#2-å®‰è£…ç³»ç»Ÿ" class="headerlink" title="2. å®‰è£…ç³»ç»Ÿ"></a>2. å®‰è£…ç³»ç»Ÿ</h3><img src="/2020/10/02/Hadoop/image-20200914201854650.png" class="" title="image-20200914201854650">

<img src="/2020/10/02/Hadoop/image-20200914201950325.png" class="" title="image-20200914201950325">



<img src="/2020/10/02/Hadoop/image-20200914202216056.png" class="" title="image-20200914202216056">



<h3 id="3-è™šæ‹Ÿæœºå®Œæˆ"><a href="#3-è™šæ‹Ÿæœºå®Œæˆ" class="headerlink" title="3. è™šæ‹Ÿæœºå®Œæˆ"></a>3. è™šæ‹Ÿæœºå®Œæˆ</h3><img src="/2020/10/02/Hadoop/image-20200914204312121.png" class="" title="image-20200914204312121">



<h3 id="4-å®‰è£…Docker"><a href="#4-å®‰è£…Docker" class="headerlink" title="4. å®‰è£…Docker"></a>4. å®‰è£…Docker</h3><blockquote>
<p>Dockerè¦æ±‚CentOSç³»ç»Ÿçš„å†…æ ¸ç‰ˆæœ¬é«˜äº 3.10ï¼ŒæŸ¥çœ‹CentOSç‰ˆæœ¬æ˜¯å¦æ”¯æŒ Docker</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">uname -r</span><br></pre></td></tr></table></figure>

<p><img src="Hadoop%5Cimage-20200922202458823.png" alt="image-20200922202458823"></p>
<blockquote>
<p>ç¡®ä¿yumåŒ…æ›´æ–°åˆ°æœ€æ–°</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum update</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200922202118583.png" class="" title="image-20200922202118583">

<img src="/2020/10/02/Hadoop/image-20200922202544937.png" class="" title="image-20200922202544937">

<blockquote>
<p>å®‰è£…è¿‡Dockeråˆ™å¸è½½æ—§ç‰ˆæœ¬</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum remove docker  docker-common docker-selinux docker-engine</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200922204747806.png" class="" title="image-20200922204747806">

<blockquote>
<p>å®‰è£…éœ€è¦çš„è½¯ä»¶åŒ…ï¼Œ yum-util æä¾›yum-config-manageråŠŸèƒ½ï¼Œå¦å¤–ä¸¤ä¸ªæ˜¯devicemapperé©±åŠ¨ä¾èµ–çš„</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200922203530629.png" class="" title="image-20200922203530629">

<blockquote>
<p>è®¾ç½®yumæºï¼ˆä½¿ç”¨é˜¿é‡Œäº‘åœ°å€ï¼‰</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200922203620500.png" class="" title="image-20200922203620500">

<blockquote>
<p>å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ä»“åº“ä¸­æ‰€æœ‰çš„dockerç‰ˆæœ¬ï¼Œå¹¶é€‰æ‹©ç‰¹å®šç‰ˆæœ¬å®‰è£…</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum list docker-ce --showduplicates | sort -r</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200922203726104.png" class="" title="image-20200922203726104">

<blockquote>
<p>å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ Docker Engine-Community å’Œ containerd</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200922204125206.png" class="" title="image-20200922204125206">

<blockquote>
<p>éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200922204248819.png" class="" title="image-20200922204248819">

<blockquote>
<p>å¯åŠ¨Docker</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo systemctl start docker</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200922204613291.png" class="" title="image-20200922204613291">

<blockquote>
<p>è¿è¡ŒHello World</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo docker run hello-world</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200922204637363.png" class="" title="image-20200922204637363">



<h2 id="2-æ­å»ºHadoopé›†ç¾¤"><a href="#2-æ­å»ºHadoopé›†ç¾¤" class="headerlink" title="2. æ­å»ºHadoopé›†ç¾¤"></a>2. æ­å»ºHadoopé›†ç¾¤</h2><h3 id="1-ä¸‹è½½å¹¶é…ç½®JDK"><a href="#1-ä¸‹è½½å¹¶é…ç½®JDK" class="headerlink" title="1. ä¸‹è½½å¹¶é…ç½®JDK"></a>1. ä¸‹è½½å¹¶é…ç½®JDK</h3><blockquote>
<p>ä¸‹è½½ jdk</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install java-1.8.0-openjdk* -y</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200914205909499.png" class="" title="image-20200914205909499">

<blockquote>
<p>è·å–JAVA_HOME</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">dirname $(readlink $(readlink $(which java))) </span><br></pre></td></tr></table></figure>

<blockquote>
<p>é…ç½®ç¯å¢ƒå˜é‡</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi /etc/profile</span><br><span class="line"></span><br><span class="line">export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.262.b10-0.el7_8.x86_64</span><br><span class="line">export JRE_HOME=$JAVA_HOME/jre</span><br><span class="line">export CLASSPATH=$JAVA_HOME/lib:$JRE_HOME/lib:$CLASSPATH</span><br><span class="line">export PATH=$JAVA_HOME/bin:$JRE_HOME/bin:$PATH</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200914210707353.png" class="" title="image-20200914210707353">

<blockquote>
<p>æŸ¥çœ‹JAVA_HOME</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">source /etc/profile</span><br><span class="line">echo $JAVA_HOME</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200930135506971.png" class="" title="image-20200930135506971">

<blockquote>
<p>æµ‹è¯•</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200930135637993.png" class="" title="image-20200930135637993">



<h3 id="2-é…ç½®Hostsåˆ—è¡¨"><a href="#2-é…ç½®Hostsåˆ—è¡¨" class="headerlink" title="2. é…ç½®Hostsåˆ—è¡¨"></a>2. é…ç½®Hostsåˆ—è¡¨</h3><p>ç”±äºä¸¤å°è™šæ‹Ÿæœºæ˜¯åŒä¸€å°è™šæ‹Ÿæœºå¤åˆ¶è€Œæ¥ï¼Œæ‰€ä»¥å¿…é¡»å…ˆé‡æ–°ç”ŸæˆMacåœ°å€</p>
<img src="/2020/10/02/Hadoop/image-20200930135951474.png" class="" title="image-20200930135951474">

<blockquote>
<p>master å’Œ slave ç¦ç”¨é˜²ç«å¢™</p>
</blockquote>
<p>åœæ­¢é˜²ç«å¢™ </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl stop firewalld</span><br></pre></td></tr></table></figure>

<p>ç¦ç”¨é˜²ç«å¢™</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl disable firewalld</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200913225928453.png" class="" title="image-20200913225928453">

<blockquote>
<p>master å’Œ slave ä¿®æ”¹ä¸»æœºå</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;sysconfig&#x2F;network</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200913230804529.png" class="" title="image-20200913230804529">

<img src="/2020/10/02/Hadoop/image-20200913230917724.png" class="" title="image-20200913230917724">

<blockquote>
<p>ç¡®è®¤ä¿®æ”¹</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200913231003539.png" class="" title="image-20200913231003539">

<img src="/2020/10/02/Hadoop/image-20200913231047961.png" class="" title="image-20200913231047961">

<blockquote>
<p>master å’Œ slave æ‰§è¡Œ ifconfig æŸ¥è¯¢ IP</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ifconfig</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200914215339951.png" class="" title="image-20200914215339951">

<img src="/2020/10/02/Hadoop/image-20200914215731073.png" class="" title="image-20200914215731073">

<blockquote>
<p> master å’Œ slave å°†IPåœ°å€å’Œä¸»æœºååˆ†åˆ«æ·»åŠ è‡³/etc/hostsä¸­</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi /etc/hosts</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200914215942690.png" class="" title="image-20200914215942690">

<blockquote>
<p>master å’Œ slave ä¹‹é—´äº’ping</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200914220102245.png" class="" title="image-20200914220102245">

<img src="/2020/10/02/Hadoop/image-20200914220213547.png" class="" title="image-20200914220213547">



<h3 id="3-é›†ç¾¤sshå…å¯†ç™»å½•"><a href="#3-é›†ç¾¤sshå…å¯†ç™»å½•" class="headerlink" title="3. é›†ç¾¤sshå…å¯†ç™»å½•"></a>3. é›†ç¾¤sshå…å¯†ç™»å½•</h3><p>å¯¹masteræ“ä½œï¼š</p>
<blockquote>
<p>master ç”Ÿæˆå…¬é’¥</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200914220829338.png" class="" title="image-20200914220829338">

<blockquote>
<p>å°†å…¬é’¥è¿½åŠ åˆ°æˆæƒåˆ—è¡¨</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200914221008829.png" class="" title="image-20200914221008829">

<blockquote>
<p>ä¿®æ”¹authorized_keysæ–‡ä»¶çš„æƒé™</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod 600 ~/.ssh/authorized_keys </span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200914221036706.png" class="" title="image-20200914221036706">

<blockquote>
<p>å°†authorized_keysæ–‡ä»¶å¤åˆ¶åˆ°slaveèŠ‚ç‚¹</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">scp ~/.ssh/authorized_keys parak@slave:~/.ssh</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200914221427275.png" class="" title="image-20200914221427275">

<blockquote>
<p>æŸ¥çœ‹slaveçš„.sshçš„ç›®å½•</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200914221514758.png" class="" title="image-20200914221514758">

<blockquote>
<p>ä¿®æ”¹masterå’Œslaveçš„SSHé…ç½®</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">su root</span><br><span class="line">vi /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200914221856072.png" class="" title="image-20200914221856072">

<blockquote>
<p>ä½¿ç”¨ssh-addæŒ‡ä»¤å°†ç§é’¥åŠ å…¥å¹¶é‡å¯sshdæœåŠ¡</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh-add ~/.ssh/id_rsa</span><br><span class="line">service sshd restart</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æµ‹è¯•å…å¯†ç™»å½•</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200914223950719.png" class="" title="image-20200914223950719">

<p>sshç™»å½•ä¾ç„¶éœ€è¦å¯†ç ï¼Œæˆ‘ä»¬å¯ä»¥å»çœ‹ä¸€ä¸‹masterçš„æ—¥å¿—æ–‡ä»¶</p>
<blockquote>
<p>cat  var/log/secure </p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200916160625256.png" class="" title="image-20200916160625256">

<blockquote>
<p><strong>åŸå› </strong></p>
<p>sshdä¸ºäº†å®‰å…¨ï¼Œå¯¹å±ä¸»çš„ç›®å½•å’Œæ–‡ä»¶æƒé™æœ‰æ‰€è¦æ±‚ã€‚</p>
<p>å¦‚æœæƒé™ä¸å¯¹ï¼Œåˆ™sshçš„å…å¯†ç ç™»é™†ä¸ç”Ÿæ•ˆã€‚</p>
</blockquote>
<blockquote>
<p><strong>è§£å†³</strong></p>
<p>å°†.sshç›®å½•çš„æƒé™æ”¹ä¸º755</p>
<p>id_rsa.pubå’Œauthorized_keysæƒé™æ”¹ä¸º644</p>
<p>id_rsaæƒé™å¿…é¡»ä¸º600</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod 755 .ssh</span><br><span class="line">cd .ssh</span><br><span class="line">chmod 644 id_rsa.pub authorized_keys</span><br><span class="line">chmod 600 id_rsa</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å†æ¬¡æµ‹è¯•å…å¯†ç™»å½•</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200914224837430.png" class="" title="image-20200914224837430">



<h3 id="4-ä¸‹è½½å¹¶é…ç½®Hadoop"><a href="#4-ä¸‹è½½å¹¶é…ç½®Hadoop" class="headerlink" title="4. ä¸‹è½½å¹¶é…ç½®Hadoop"></a>4. ä¸‹è½½å¹¶é…ç½®Hadoop</h3><blockquote>
<p>ä¸‹è½½ï¼š<a href="https://www.apache.org/dyn/closer.cgi/hadoop/common/hadoop-3.3.0/hadoop-3.3.0.tar.gz">hadoop-2.9.2</a>    é€‰æ‹©bsfuçš„åŒ—äº¬å¤–å›½è¯­å­¦é™¢çš„é•œåƒ, é€Ÿåº¦æµæ‰¹</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200914211714263.png" class="" title="image-20200914211714263">

<blockquote>
<p>è§£å‹ä¸‹è½½çš„å‹ç¼©åŒ…</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tar -zxvf hadoop-2.3.2.tar.gz</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200914211633182.png" class="" title="image-20200914211633182">

<blockquote>
<p>ä¿®æ”¹æ–‡ä»¶æƒé™</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod 777 hadoop-env.sh core-site.xml hdfs-site.xml yarn-site.xml mapred-site.xml slaves</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200914212318855.png" class="" title="image-20200914212318855">

<blockquote>
<p>é…ç½®ç¯å¢ƒå˜é‡</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gedit /home/parak/hadoop/hadoop-2.9.2/etc/hadoop/hadoop-env.sh</span><br><span class="line"></span><br><span class="line">æ·»åŠ </span><br><span class="line">export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.262.b10-0.el7_8.x86_64</span><br><span class="line">export HADOOP_HOME=/home/parak/hadoop/hadoop-2.9.2</span><br><span class="line">export PATH=$&#123;JAVA_HOME&#125;/bin:$&#123;HADOOP_HOME&#125;/bin:$&#123;HADOOP_HOME&#125;/sbin:$PATH</span><br></pre></td></tr></table></figure>

<blockquote>
<p>é…ç½®æ ¸å¿ƒç»„ä»¶  <strong><em>core-site.xml</em></strong></p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment">  you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment">  You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment">  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment">  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment">  See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment">  limitations under the License. See accompanying LICENSE file.</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Put site-specific property overrides in this file. --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://master:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/parak/hadoopdata<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>



<img src="/2020/10/02/Hadoop/image-20200914213003704.png" class="" title="image-20200914213003704">

<blockquote>
<p>é…ç½®æ–‡ä»¶ç³»ç»Ÿ  <strong><em>hdfs.site.xml</em></strong></p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment">  you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment">  You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment">  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment">  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment">  See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment">  limitations under the License. See accompanying LICENSE file.</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Put site-specific property overrides in this file. --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>



<img src="/2020/10/02/Hadoop/image-20200914213047280.png" class="" title="image-20200914213047280">

<blockquote>
<p>é…ç½®æ–‡ä»¶ç³»ç»Ÿ  <strong><em>yarn-site.xml</em></strong></p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment">  you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment">  You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment">  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment">  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment">  See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment">  limitations under the License. See accompanying LICENSE file.</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Site specific YARN configuration properties --&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>master:18040<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.scheduler.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>master:18030<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.resource-tracker.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">value</span>&gt;</span>master:18025<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.admin.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">value</span>&gt;</span>master:18141<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.webapp.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">value</span>&gt;</span>master:18088<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>



<img src="/2020/10/02/Hadoop/image-20200914213215770.png" class="" title="image-20200914213215770">

<blockquote>
<p>é…ç½®è®¡ç®—æ¡†æ¶  <strong><em>mapred-site.xml</em></strong></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span><br><span class="line">&lt;!--</span><br><span class="line">  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span><br><span class="line">  you may not use this file except in compliance with the License.</span><br><span class="line">  You may obtain a copy of the License at</span><br><span class="line"></span><br><span class="line">    http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="line"></span><br><span class="line">  Unless required by applicable law or agreed to in writing, software</span><br><span class="line">  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="line">  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="line">  See the License for the specific language governing permissions and</span><br><span class="line">  limitations under the License. See accompanying LICENSE file.</span><br><span class="line"><span class="meta">--&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;!-- Put site-specific property overrides in this file. --&gt;</span><br><span class="line"></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">	&lt;property&gt;</span><br><span class="line">		&lt;name&gt;mapreduce.framework.name&lt;/name&gt;</span><br><span class="line">		&lt;value&gt;yarn&lt;/value&gt;</span><br><span class="line">	&lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>



<img src="/2020/10/02/Hadoop/image-20200914213254714.png" class="" title="image-20200914213254714">

<blockquote>
<p>åœ¨masterèŠ‚ç‚¹é…ç½®slavesæ–‡ä»¶ </p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200914225547865.png" class="" title="image-20200914225547865">



<h3 id="5-å¯åŠ¨Hadooé›†ç¾¤"><a href="#5-å¯åŠ¨Hadooé›†ç¾¤" class="headerlink" title="5. å¯åŠ¨Hadooé›†ç¾¤"></a>5. å¯åŠ¨Hadooé›†ç¾¤</h3><blockquote>
<p>åˆ‡æ¢ç”¨æˆ·  <strong><em>parak</em></strong></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">su parak</span><br></pre></td></tr></table></figure>

<blockquote>
<p>é…ç½®Hadoopå¯åŠ¨çš„ç³»ç»Ÿç¯å¢ƒå˜é‡</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd</span><br><span class="line">gedit ~/.bash_profile</span><br><span class="line"></span><br><span class="line">æ·»åŠ ï¼š</span><br><span class="line"><span class="meta">#</span><span class="bash">HADOOP</span></span><br><span class="line">export HADOOP_HOME=/home/parak/hadoop/hadoop-2.9.2</span><br><span class="line">export PATH=$HADOOP_HOME/bin:$HADOOP_HOME/sbin:$PATH</span><br><span class="line"></span><br><span class="line">æ‰§è¡Œï¼š</span><br><span class="line">source ~/.bash_profile</span><br><span class="line"></span><br><span class="line">éªŒè¯ï¼š</span><br><span class="line">echo $&#123;HADOOP_HOME&#125;</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200914213558226.png" class="" title="image-20200914213558226">

<img src="/2020/10/02/Hadoop/image-20200914230053210.png" class="" title="image-20200914230053210">

<blockquote>
<p>åˆ›å»ºæ•°æ®ç›®å½•  <strong><em>hadoopdata</em></strong></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir /home/parak/hadoopdata</span><br><span class="line">chmod 777 hadoopdata/</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200914225858363.png" class="" title="image-20200914225858363">

<blockquote>
<p>æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿ</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hdfs namenode -format</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200914230347627.png" class="" title="image-20200914230347627">

<img src="/2020/10/02/Hadoop/image-20200914230450.png" class="" title="image-20200914230450">

<blockquote>
<p>å¯åŠ¨Hadoop</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sbin/start-all.sh</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200914232331519.png" class="" title="image-20200914232331519">

<blockquote>
<p>æŸ¥çœ‹è¿›ç¨‹</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">jps</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200914232056642.png" class="" title="image-20200914232056642">

<img src="/2020/10/02/Hadoop/image-20200914232211741.png" class="" title="image-20200914232211741">



<blockquote>
<p>è¿›å…¥ <strong>FireFox</strong> è¾“å…¥ï¼š<a href="http://master:50070/">http://master:50070/</a>   </p>
<p>æ£€æŸ¥ <strong>namenode</strong> å’Œ <strong>datanode</strong> æ˜¯å¦æ­£å¸¸</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200914232603284.png" class="" title="image-20200914232603284">



<blockquote>
<p>è¿›å…¥ <strong>FireFox</strong> è¾“å…¥ï¼š<a href="http://master:18088/">http://master:18088/</a></p>
<p>æ£€æŸ¥ <strong>Yarn</strong> æ˜¯å¦æ­£å¸¸</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200914232824073.png" class="" title="image-20200914232824073">



<blockquote>
<p>è¿è¡ŒPIå®ä¾‹æ£€æŸ¥Hadoopé›†ç¾¤æ˜¯å¦æ­å»ºæˆåŠŸ</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd ~/hadoop/hadoop-2.9.2/share/hadoop/mapreduce/</span><br><span class="line">hadoop jar hadoop-mapreduce-examples-2.9.2.jar pi 10 10</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200915083538083.png" class="" title="image-20200915083538083">

<blockquote>
<p> <strong>æŠ¥é”™</strong>ï¼šæœªæ‰¾åˆ°ä¸»æœºè·¯ç”±</p>
<p><strong>åˆ†æ</strong>ï¼šslaveçš„é˜²ç«å¢™æ²¡æœ‰å…³é—­</p>
</blockquote>
<blockquote>
<p>æ£€æŸ¥slaveçš„é˜²ç«å¢™</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl status firewalld</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200915084136061.png" class="" title="image-20200915084136061">

<blockquote>
<p>å…³é—­ä¸”ç¦ç”¨é˜²ç«å¢™</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl disable firewalld</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200915084354244.png" class="" title="image-20200915084354244">

<blockquote>
<p>å†æ¬¡è¿è¡ŒPIå®ä¾‹</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200915084909905.png" class="" title="image-20200915084909905">

<img src="/2020/10/02/Hadoop/image-20200915084933355.png" class="" title="image-20200915084933355">

<p>å¯ä»¥çœ‹åˆ°è¿è¡Œç»“æœï¼šPI = 3.20000000000000000000</p>
<p><strong>ç»¼ä¸Šï¼Œé›†ç¾¤æ­£å¸¸å¯åŠ¨</strong></p>
<blockquote>
<p>å…³é—­Hadoopé›†ç¾¤</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200915085606053.png" class="" title="image-20200915085606053">





<h2 id="3-åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸHDFSä¸Šçš„æ“ä½œ"><a href="#3-åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸHDFSä¸Šçš„æ“ä½œ" class="headerlink" title="3. åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸHDFSä¸Šçš„æ“ä½œ"></a>3. åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸHDFSä¸Šçš„æ“ä½œ</h2><h3 id="1-åˆ©ç”¨Shellå‘½ä»¤ä¸HDFSè¿›è¡Œäº¤äº’"><a href="#1-åˆ©ç”¨Shellå‘½ä»¤ä¸HDFSè¿›è¡Œäº¤äº’" class="headerlink" title="1. åˆ©ç”¨Shellå‘½ä»¤ä¸HDFSè¿›è¡Œäº¤äº’"></a>1. åˆ©ç”¨Shellå‘½ä»¤ä¸HDFSè¿›è¡Œäº¤äº’</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hadoop fs    //é€‚ç”¨äºä»»ä½•ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ¯”å¦‚æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿå’ŒHDFSæ–‡ä»¶ç³»ç»Ÿ</span><br><span class="line">hadoop dfa   //åªèƒ½é€‚ç”¨äºHDFSæ–‡ä»¶ç³»ç»Ÿ</span><br><span class="line">hdfs dfs     //è·Ÿhadoop dfsçš„å‘½ä»¤ä½œç”¨ä¸€æ ·ï¼Œä¹Ÿåªèƒ½é€‚ç”¨äºHDFSæ–‡ä»¶ç³»ç»Ÿ</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200915091307833.png" class="" title="image-20200915091307833">

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hadoop fs -help put</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200915091423474.png" class="" title="image-20200915091423474">



<h4 id="1-ç›®å½•æ“ä½œ"><a href="#1-ç›®å½•æ“ä½œ" class="headerlink" title="(1) ç›®å½•æ“ä½œ"></a>(1) ç›®å½•æ“ä½œ</h4><blockquote>
<p>åœ¨HDFSä¸­ä¸ºparakç”¨æˆ·åˆ›å»ºä¸€ä¸ªç”¨æˆ·ç›®å½•ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hadoop fs -mkdir -p /user/parak</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ˜¾ç¤ºHDFSä¸­/userç›®å½•ä¸‹çš„å†…å®¹ï¼š</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hadoop fs -ls /user</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200915091936795.png" class="" title="image-20200915091936795">

<blockquote>
<p>åˆ›å»º/user/parak/inputç›®å½•</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hadoop fs -mkdir -p /user/parak/input</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æŸ¥çœ‹/user/parak/inputç›®å½•æ˜¯å¦åˆ›å»ºæˆåŠŸ</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hadoop fs -ls /user/parak</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200915094202790.png" class="" title="image-20200915094202790">

<blockquote>
<p>åˆ›å»º/inputç›®å½•</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hadoop fs -mkdir -p /input</span><br></pre></td></tr></table></figure>

<blockquote>
<p>åˆ é™¤/inputç›®å½•</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hadoop fs -rm -r /input</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æŸ¥çœ‹/inputç›®å½•æ˜¯å¦åˆ é™¤æˆåŠŸ</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hadoop fs -ls /</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200915094415033.png" class="" title="image-20200915094415033">



<h4 id="2-æ–‡ä»¶æ“ä½œ"><a href="#2-æ–‡ä»¶æ“ä½œ" class="headerlink" title="(2) æ–‡ä»¶æ“ä½œ"></a>(2) æ–‡ä»¶æ“ä½œ</h4><p>â€‹       åœ¨å®é™…åº”ç”¨ä¸­ï¼Œç»å¸¸éœ€è¦ä»æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿå‘HDFSä¸­ä¸Šä¼ æ–‡ä»¶ï¼Œæˆ–è€…æŠŠHDFSä¸­çš„æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚</p>
<blockquote>
<p>é¦–å…ˆï¼Œä½¿ç”¨vimç¼–è¾‘å™¨ï¼Œåœ¨æœ¬åœ°Linuxæ–‡ä»¶ç³»ç»Ÿçš„â€œ/home/parak/â€ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶myLocalFile.txtï¼Œé‡Œé¢è¾“å…¥ï¼š</p>
</blockquote>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">Hadoop</span><br><span class="line">MapReduce</span><br><span class="line">Spark</span><br><span class="line">Khighness</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç„¶åï¼ŒæŠŠæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„â€œ/home/parak/myLocalFile.txtâ€ä¸Šä¼ åˆ°HDFSä¸­çš„å½“å‰ç”¨æˆ·ç›®å½•çš„inputç›®å½•ä¸‹ï¼Œä¹Ÿå°±æ˜¯ä¸Šä¼ åˆ°HDFSçš„â€œ/user/parak/input/â€ç›®å½•ä¸‹ï¼š</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hadoop fs -put /home/parak/myLocalFile.txt /user/parak/input</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æŸ¥çœ‹ä¸€ä¸‹æ–‡ä»¶æ˜¯å¦æˆåŠŸä¸Šä¼ åˆ°HDFSä¸­ï¼š</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hadoop fs -ls /user/parak/input</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æŸ¥çœ‹HDFSä¸­çš„myLocalFile.txtè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hadoop fs -cat /user/parak/input/myLocalFile.txt</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200915094905208.png" class="" title="image-20200915094905208">

<blockquote>
<p>æŠŠHDFSä¸­çš„myLocalFile.txtæ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­çš„â€œ/home/parak/ä¸‹è½½/â€è¿™ä¸ªç›®å½•ä¸‹</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hadoop fs -get /user/parak/input/myLocalFile.txt /home/parak/ä¸‹è½½</span><br></pre></td></tr></table></figure>

<blockquote>
<p>åœ¨æœ¬åœ°æŸ¥çœ‹ä¸‹è½½ä¸‹æ¥çš„æ–‡ä»¶myLocalFile.txt</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd ä¸‹è½½</span><br><span class="line">ll</span><br><span class="line">cat myLocalFile.txt</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200915100241999.png" class="" title="image-20200915100241999">

<blockquote>
<p>æŠŠHDFSçš„â€œ/user/parak/input/myLocalFile.txtâ€æ–‡ä»¶ï¼Œæ‹·è´åˆ°HDFSçš„å¦å¤–ä¸€ä¸ªç›®å½•â€œ/inputâ€ä¸­</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hadoop fs -mkdir /input</span><br><span class="line">hadoop fs -cp /user/parak/input/myLocalFile.txt /input</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200915100148440.png" class="" title="image-20200915100148440">



<h3 id="2-åˆ©ç”¨Webç•Œé¢ç®¡ç†HDFS"><a href="#2-åˆ©ç”¨Webç•Œé¢ç®¡ç†HDFS" class="headerlink" title="2. åˆ©ç”¨Webç•Œé¢ç®¡ç†HDFS"></a>2. åˆ©ç”¨Webç•Œé¢ç®¡ç†HDFS</h3><blockquote>
<p>åœ¨æœ¬æœºChormeè¾“å…¥ <a href="http://192.168.117.141:50070/">http://192.168.117.141:50070</a> , å³å¯çœ‹åˆ°HDFSçš„Webç®¡ç†ç•Œé¢</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200915093904228.png" class="" title="image-20200915093904228">





<h2 id="4-åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸHDFSä¸Šçš„ç¼–ç¨‹å®è·µ"><a href="#4-åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸHDFSä¸Šçš„ç¼–ç¨‹å®è·µ" class="headerlink" title="4. åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸHDFSä¸Šçš„ç¼–ç¨‹å®è·µ"></a>4. åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸHDFSä¸Šçš„ç¼–ç¨‹å®è·µ</h2><h3 id="1-å®‰è£…Eclipse"><a href="#1-å®‰è£…Eclipse" class="headerlink" title="1. å®‰è£…Eclipse"></a>1. å®‰è£…Eclipse</h3><h4 id="1-å®˜ç½‘ä¸‹è½½å®‰è£…åŒ…"><a href="#1-å®˜ç½‘ä¸‹è½½å®‰è£…åŒ…" class="headerlink" title="(1) å®˜ç½‘ä¸‹è½½å®‰è£…åŒ…"></a>(1) å®˜ç½‘ä¸‹è½½å®‰è£…åŒ…</h4><blockquote>
<p>è¿›å…¥FireFoxæ‰“å¼€ä¸‹è½½: <a href="http://www.eclipse.org/downloads/packages/release/neon/1a/eclipse-ide-java-ee-developers">eclipe</a></p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200915190751901.png" class="" title="image-20200915190751901">

<blockquote>
<p>æˆ–è€…</p>
<p>ç™¾åº¦ç½‘ç›˜ä¸‹è½½</p>
<p>é“¾æ¥: <a href="https://pan.baidu.com/s/1P4vDgBEj_eOSakabM93rew">https://pan.baidu.com/s/1P4vDgBEj_eOSakabM93rew</a></p>
<p>å¯†ç : eujp</p>
</blockquote>
<h4 id="2-è§£å‹å®‰è£…åŒ…"><a href="#2-è§£å‹å®‰è£…åŒ…" class="headerlink" title="(2) è§£å‹å®‰è£…åŒ…"></a>(2) è§£å‹å®‰è£…åŒ…</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tar xzvf eclipse-inst-linux64.tar.gz </span><br><span class="line">cd eclipse-installer/</span><br><span class="line">ll</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200915191250751.png" class="" title="image-20200915191250751">

<img src="/2020/10/02/Hadoop/image-20200915191446018.png" class="" title="image-20200915191446018">

<h4 id="3-å®‰è£…Eclipse-For-JavaEE"><a href="#3-å®‰è£…Eclipse-For-JavaEE" class="headerlink" title="(3) å®‰è£…Eclipse For JavaEE"></a>(3) å®‰è£…Eclipse For JavaEE</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">eclipse-inst.ini</span><br></pre></td></tr></table></figure>




<img src="/2020/10/02/Hadoop/image-20200915191721107.png" class="" title="image-20200915191721107.png">

<img src="/2020/10/02/Hadoop/image-20200915191841247.png" class="" title="image-20200915191841247.png">

<img src="/2020/10/02/Hadoop/image-20200915192946961.png" class="" title="image-20200915192946961.png">



<h4 id="4-åˆ›å»ºæ¡Œé¢å¿«æ·æ–¹å¼"><a href="#4-åˆ›å»ºæ¡Œé¢å¿«æ·æ–¹å¼" class="headerlink" title="(4) åˆ›å»ºæ¡Œé¢å¿«æ·æ–¹å¼"></a>(4) åˆ›å»ºæ¡Œé¢å¿«æ·æ–¹å¼</h4><blockquote>
<p>1ã€åˆ‡æ¢rootèº«ä»½ï¼šsu root</p>
<p>2ã€è¿›å…¥usr/share/applicationsç›®å½•ï¼šcd /usr/share/applications</p>
<p>3ã€åˆ›å»ºeclipase.desktopæ–‡ä»¶ï¼štouch eclipase.desktop</p>
<p>4ã€è¾“å…¥ä»¥ä¸‹å†…å®¹åä¿å­˜ï¼švi eclipase.desktop</p>
<p>5ã€æœ€åå°†å¿«æ·æ–¹å¼å¤åˆ¶åˆ°æ¡Œé¢ï¼Œå¹¶æ·»åŠ ä¿¡ä»»å³å¯</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[Desktop Entry]</span><br><span class="line">Name&#x3D;Eclipse</span><br><span class="line">Exec&#x3D;&#x2F;home&#x2F;parak&#x2F;eclipse&#x2F;eclipse-j2e&#x2F;eclipse&#x2F;eclipse</span><br><span class="line">Type&#x3D;Application</span><br><span class="line">Icon&#x3D;&#x2F;home&#x2F;parak&#x2F;eclipse&#x2F;eclipse-j2e&#x2F;eclipse&#x2F;icon.xpm</span><br><span class="line">Terminal&#x3D;false</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200915195019210.png" class="" title="image-20200915195019210">



<h3 id="2-åˆ›å»ºeclipseå·¥ç¨‹"><a href="#2-åˆ›å»ºeclipseå·¥ç¨‹" class="headerlink" title="2. åˆ›å»ºeclipseå·¥ç¨‹"></a>2. åˆ›å»ºeclipseå·¥ç¨‹</h3><blockquote>
<p>åŒå‡»eclipseæ¡Œé¢å¿«æ·æ–¹å¼</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200915195625107.png" class="" title="image-20200915195625107">

<blockquote>
<p>è¿›å…¥eclipseIDE</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200915195720416.png" class="" title="image-20200915195720416">

<blockquote>
<p>ç‚¹å‡»ï¼šFile â€”&gt; Project â€”&gt; Java Project</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200915200231455.png" class="" title="image-20200915200231455">

<blockquote>
<p>è®¾ç½®JRE</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200915200448059.png" class="" title="image-20200915200448059">

<blockquote>
<p>æ·»åŠ JAR</p>
</blockquote>
<ul>
<li><strong>/home/parak/hadoop/hadoop-2.9.2/share/hadoop/common/</strong>:  <strong>hadoop-common-2.9.2.jar</strong>å’Œ<strong>hadoop-nfs-2.9.2.jar</strong></li>
<li><strong>/home/parak/hadoop/hadoop-2.9.2/share/hadoop/common/</strong>:  <strong>lib</strong>ç›®å½•ä¸‹çš„æ‰€æœ‰jaråŒ…</li>
<li><strong>/home/parak/hadoop/hadoop-2.9.2/share/hadoop/hdfs/</strong>:  <strong>hadoop-hdfs-2.9.2.jar</strong>å’Œ<strong>hadoop-hdfs-nfs-2.9.2.jar</strong></li>
<li><strong>/home/parak/hadoop/hadoop-2.9.2/share/hadoop/hdfs/</strong>:  <strong>lib</strong>ç›®å½•ä¸‹çš„æ‰€æœ‰jaråŒ…</li>
</ul>
<img src="/2020/10/02/Hadoop/image-20200915202106984.png" class="" title="image-20200915202106984">

<blockquote>
<p>ç‚¹å‡»Finishï¼Œç‚¹å‡»Open Perspectiveï¼Œå¹¶ä¸”å‹¾é€‰Remember my decision</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200915202239806.png" class="" title="image-20200915202239806">

<img src="/2020/10/02/Hadoop/image-20200915202452808.png" class="" title="image-20200915202452808">



<h3 id="3-ç¼–å†™ä¸€ä¸ªJavaåº”ç”¨ç¨‹åºæ£€æµ‹HDFSä¸­æ˜¯å¦å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶"><a href="#3-ç¼–å†™ä¸€ä¸ªJavaåº”ç”¨ç¨‹åºæ£€æµ‹HDFSä¸­æ˜¯å¦å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶" class="headerlink" title="3. ç¼–å†™ä¸€ä¸ªJavaåº”ç”¨ç¨‹åºæ£€æµ‹HDFSä¸­æ˜¯å¦å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶"></a>3. ç¼–å†™ä¸€ä¸ªJavaåº”ç”¨ç¨‹åºæ£€æµ‹HDFSä¸­æ˜¯å¦å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶</h3><h4 id="1-ç¼–å†™Javaç¨‹åº"><a href="#1-ç¼–å†™Javaç¨‹åº" class="headerlink" title="(1) ç¼–å†™Javaç¨‹åº"></a>(1) ç¼–å†™Javaç¨‹åº</h4><blockquote>
<p>å³å‡»HDFSExample â€”&gt; New â€”&gt; Class</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200915203644447.png" class="" title="image-20200915203644447">

<blockquote>
<p>Name = HDFSFileIfExistï¼Œç„¶åFinish</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200915203811679.png" class="" title="image-20200915203811679">

<blockquote>
<p>ç¼–å†™ä»£ç </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FileSystem;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> parak</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>   2020-9-15 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HDFSFileIfExist</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            String fileName = <span class="string">&quot;/user/parak/input/myLocalFile.txt&quot;</span>;</span><br><span class="line">            Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">            conf.set(<span class="string">&quot;fs.defaultFS&quot;</span>, <span class="string">&quot;hdfs://master:9000&quot;</span>);</span><br><span class="line">            conf.set(<span class="string">&quot;fs.hdfs.impl&quot;</span>, <span class="string">&quot;org.apache.hadoop.hdfs.DistributedFileSystem&quot;</span>);</span><br><span class="line">            FileSystem fs = FileSystem.get(conf);</span><br><span class="line">            <span class="keyword">if</span>(fs.exists(<span class="keyword">new</span> Path(fileName)))&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;æ–‡ä»¶å­˜åœ¨&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;æ–‡ä»¶ä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-è¿è¡Œç¨‹åº"><a href="#2-è¿è¡Œç¨‹åº" class="headerlink" title="(2) è¿è¡Œç¨‹åº"></a>(2) è¿è¡Œç¨‹åº</h4><blockquote>
<p>å¯åŠ¨Hadoopé›†ç¾¤</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200915204824967.png" class="" title="image-20200915204824967">

<blockquote>
<p>è¿è¡Œç¨‹åº</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200915205051079.png" class="" title="image-20200915205051079">

<blockquote>
<p>è¿è¡Œç»“æœ</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200915205218013.png" class="" title="image-20200915205218013">

<h4 id="3-éƒ¨ç½²åˆ°Hadoopå¹³å°ä¸Šè¿è¡Œ"><a href="#3-éƒ¨ç½²åˆ°Hadoopå¹³å°ä¸Šè¿è¡Œ" class="headerlink" title="(3) éƒ¨ç½²åˆ°Hadoopå¹³å°ä¸Šè¿è¡Œ"></a>(3) éƒ¨ç½²åˆ°Hadoopå¹³å°ä¸Šè¿è¡Œ</h4><blockquote>
<p>åœ¨hadoopå®‰è£…ç›®å½•ä¸‹æ–°å»ºmyappç›®å½•ï¼Œå­˜æ”¾Hadoopåº”ç”¨ç¨‹åº</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir ~/hadoop/hadoop-2.9.2/myapp</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200915205811634.png" class="" title="image-20200915205811634">

<blockquote>
<p>å³å‡»HDFSExample â€”&gt; Export â€”&gt; Java â€”&gt; Runnable JAR file â€”&gt; Next</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200915210022617.png" class="" title="image-20200915210022617">

<blockquote>
<p>Lauch configuration: HDFSFileIfExist -HDFSExsmple</p>
<p>Export destination: /home/parak/hadoop/hadoop-2.9.2/myapp/HDFSExample.jar</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200915210640358.png" class="" title="image-20200915210640358">

<blockquote>
<p>å‡ºç°è­¦å‘Šï¼Œé€‰æ‹©OK</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200915210911473.png" class="" title="image-20200915210911473">

<img src="/2020/10/02/Hadoop/image-20200915211215820.png" class="" title="image-20200915211215820">

<blockquote>
<p>æŸ¥çœ‹myappä¸­ç”Ÿæˆçš„HDFSExample.jaræ–‡ä»¶</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200915211618901.png" class="" title="image-20200915211618901">

<blockquote>
<p>è¿è¡Œç¨‹åº</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">java -jar ~/hadoop/hadoop-2.9.2/myapp/HDFSExample.jar </span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200915211802010.png" class="" title="image-20200915211802010">



<h3 id="4-ç¼–å†™ä¸€ä¸ªJavaåº”ç”¨ç¨‹åºè¯»-å†™HDFSæ–‡ä»¶"><a href="#4-ç¼–å†™ä¸€ä¸ªJavaåº”ç”¨ç¨‹åºè¯»-å†™HDFSæ–‡ä»¶" class="headerlink" title="4. ç¼–å†™ä¸€ä¸ªJavaåº”ç”¨ç¨‹åºè¯»/å†™HDFSæ–‡ä»¶"></a>4. ç¼–å†™ä¸€ä¸ªJavaåº”ç”¨ç¨‹åºè¯»/å†™HDFSæ–‡ä»¶</h3><h4 id="1-è¯»å–HDFSæ–‡ä»¶ç¨‹åº"><a href="#1-è¯»å–HDFSæ–‡ä»¶ç¨‹åº" class="headerlink" title="(1) è¯»å–HDFSæ–‡ä»¶ç¨‹åº"></a>(1) è¯»å–HDFSæ–‡ä»¶ç¨‹åº</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FSDataInputStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FileSystem;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> parak</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020-9-15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HDFSReadFile</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">			conf.set(<span class="string">&quot;fs.defaultFS&quot;</span>, <span class="string">&quot;hdfs://master:9000&quot;</span>);</span><br><span class="line">			conf.set(<span class="string">&quot;fs.hdfs.impl&quot;</span>,</span><br><span class="line">					<span class="string">&quot;org.apache.hadoop.hdfs.DistributedFileSystem&quot;</span>);</span><br><span class="line">			FileSystem fs = FileSystem.get(conf);</span><br><span class="line">			Path file = <span class="keyword">new</span> Path(<span class="string">&quot;/user/parak/input/myLocalFile.txt&quot;</span>);</span><br><span class="line">			FSDataInputStream getIt = fs.open(file);</span><br><span class="line">			BufferedReader d = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(getIt));</span><br><span class="line">			String content = <span class="keyword">null</span>;</span><br><span class="line">			<span class="keyword">while</span>((content = d.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">				System.out.println(content);</span><br><span class="line">			&#125;</span><br><span class="line">			d.close(); <span class="comment">// å…³é—­æ–‡ä»¶</span></span><br><span class="line">			fs.close(); <span class="comment">// å…³é—­hdfs</span></span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿è¡Œ</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200915213406899.png" class="" title="image-20200915213406899">

<h4 id="2-å†™HDFSæ–‡ä»¶ç¨‹åº"><a href="#2-å†™HDFSæ–‡ä»¶ç¨‹åº" class="headerlink" title="(2) å†™HDFSæ–‡ä»¶ç¨‹åº"></a>(2) å†™HDFSæ–‡ä»¶ç¨‹åº</h4> <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FileSystem;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FSDataOutputStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> parak</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020-9-15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HDFSWriteFile</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">			conf.set(<span class="string">&quot;fs.defaultFS&quot;</span>, <span class="string">&quot;hdfs://master:9000&quot;</span>);</span><br><span class="line">			conf.set(<span class="string">&quot;fs.hdfs.impl&quot;</span>,</span><br><span class="line">					<span class="string">&quot;org.apache.hadoop.hdfs.DistributedFileSystem&quot;</span>);</span><br><span class="line">			FileSystem fs = FileSystem.get(conf);</span><br><span class="line">			<span class="keyword">byte</span>[] buff = <span class="string">&quot;Hello, Khighness&quot;</span>.getBytes(); <span class="comment">// è¦å†™å…¥çš„å†…å®¹</span></span><br><span class="line">			String filename = <span class="string">&quot;/user/parak/test.txt&quot;</span>; <span class="comment">// è¦å†™å…¥çš„æ–‡ä»¶å</span></span><br><span class="line">			FSDataOutputStream os = fs.create(<span class="keyword">new</span> Path(filename));</span><br><span class="line">			os.write(buff, <span class="number">0</span>, buff.length);</span><br><span class="line">			System.out.println(<span class="string">&quot;Create:&quot;</span> + filename);</span><br><span class="line">			os.close();</span><br><span class="line">			fs.close();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿è¡Œ</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200915213012019.png" class="" title="image-20200915213012019">



<h2 id="5-Eclipseä¸Šçš„HDFSæ“ä½œ"><a href="#5-Eclipseä¸Šçš„HDFSæ“ä½œ" class="headerlink" title="5. Eclipseä¸Šçš„HDFSæ“ä½œ"></a>5. Eclipseä¸Šçš„HDFSæ“ä½œ</h2><h3 id="1-å®‰è£…Hadoop-Eclipse-Plugin"><a href="#1-å®‰è£…Hadoop-Eclipse-Plugin" class="headerlink" title="1. å®‰è£…Hadoop-Eclipse-Plugin"></a>1. å®‰è£…Hadoop-Eclipse-Plugin</h3><p>(1) ä¸‹è½½ç›¸å…³æ’ä»¶ï¼š<a href="https://github.com/winghc/hadoop2x-eclipse-plugin">hadoop-eclipse-plugin</a></p>
<img src="/2020/10/02/Hadoop/image-20200922203150692.png" class="" title="image-20200922203150692">

<p>æˆ‘æ˜¯vpnä¸‹è½½ä¸‹æ¥çš„ï¼Œåˆ†äº«ä¸€ä¸‹ï¼š</p>
<blockquote>
<p>å®Œæ•´åŒ…</p>
<p>ç½‘ç›˜é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1Q72HyCSUnh-Q0JRQK03Jjg">https://pan.baidu.com/s/1Q72HyCSUnh-Q0JRQK03Jjg</a></p>
<p>æå–ç ï¼škkkk</p>
<p>æ’ä»¶åŒ…</p>
<p>ç½‘ç›˜é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1dfBm7JB4ZXTR3bwF7PSaKA">https://pan.baidu.com/s/1dfBm7JB4ZXTR3bwF7PSaKA</a></p>
<p>æå–ç ï¼škkkk</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200922222447098.png" class="" title="image-20200922222447098">



<p>(2) ä¸‹è½½åå°†releaseä¸­çš„<code>hadoop-eclipse-plugin-2.6.0.jar</code>å¤åˆ¶åˆ° Eclipse å®‰è£…ç›®å½•çš„ plugins æ–‡ä»¶å¤¹ä¸­</p>
<img src="/2020/10/02/Hadoop/image-20200922223813270.png" class="" title="image-20200922223813270">

<p>(3) è¿è¡Œ <code>eclipse-clean</code> é‡å¯ Eclipse</p>
<h3 id="2-é…ç½®Hadoop-Eclipse-Plugin"><a href="#2-é…ç½®Hadoop-Eclipse-Plugin" class="headerlink" title="2. é…ç½®Hadoop-Eclipse-Plugin"></a>2. é…ç½®Hadoop-Eclipse-Plugin</h3><p>é…ç½®å‰å¼€å¯Hadoop</p>
<img src="/2020/10/02/Hadoop/image-20200928131439434.png" class="" title="image-20200928131439434">

<p>(1) åˆ‡æ¢åˆ°â€œMap/Reduceâ€å¼€å‘è§†å›¾</p>
<img src="/2020/10/02/Hadoop/image-20200928131546990.png" class="" title="image-20200928131546990">



<p>(2) å»ºç«‹ä¸Hadoopé›†ç¾¤çš„è¿æ¥</p>
<img src="/2020/10/02/Hadoop/image-20200928131720837.png" class="" title="image-20200928131720837">

<p>(3) å¡«å†™Hadoopè¿æ¥é…ç½®</p>
<img src="/2020/10/02/Hadoop/image-20200928131907971.png" class="" title="image-20200928131907971">



<h3 id="3-åœ¨Eclipseä¸­æ“ä½œHDFSä¸­çš„æ–‡ä»¶"><a href="#3-åœ¨Eclipseä¸­æ“ä½œHDFSä¸­çš„æ–‡ä»¶" class="headerlink" title="3. åœ¨Eclipseä¸­æ“ä½œHDFSä¸­çš„æ–‡ä»¶"></a>3. åœ¨Eclipseä¸­æ“ä½œHDFSä¸­çš„æ–‡ä»¶</h3><p>ç‚¹å‡»å·¦ä¾§DFS Locationså³å¯æŸ¥çœ‹HDFSçš„æ–‡ä»¶åˆ—è¡¨</p>
<img src="/2020/10/02/Hadoop/image-20200928132219334.png" class="" title="image-20200928132219334">



<h2 id="6-åœ¨Eclipseä¸­è¿è¡Œâ€Wold-Countâ€MapReduceç¨‹åº"><a href="#6-åœ¨Eclipseä¸­è¿è¡Œâ€Wold-Countâ€MapReduceç¨‹åº" class="headerlink" title="6. åœ¨Eclipseä¸­è¿è¡Œâ€Wold Countâ€MapReduceç¨‹åº"></a>6. åœ¨Eclipseä¸­è¿è¡Œâ€Wold Countâ€MapReduceç¨‹åº</h2><h3 id="1-åœ¨Eclipseä¸­åˆ›å»ºâ€WordCountâ€MapReduceé¡¹ç›®"><a href="#1-åœ¨Eclipseä¸­åˆ›å»ºâ€WordCountâ€MapReduceé¡¹ç›®" class="headerlink" title="1. åœ¨Eclipseä¸­åˆ›å»ºâ€WordCountâ€MapReduceé¡¹ç›®"></a>1. åœ¨Eclipseä¸­åˆ›å»ºâ€WordCountâ€MapReduceé¡¹ç›®</h3><blockquote>
<p>é€‰æ‹©File -&gt; New -&gt; Project -&gt; Map/Reduce Project</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200928133415156.png" class="" title="image-20200928133415156">

<blockquote>
<p>é¡¹ç›®åç§°=MyWordCountï¼Œç„¶åConfigure Hadoop install directory -&gt; Finish</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200928133508525.png" class="" title="image-20200928133508525">

<blockquote>
<p>æ–°å»ºJavaæ–‡ä»¶ï¼Œname = WordCountTest</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200928134118935.png" class="" title="image-20200928134118935">

<blockquote>
<p>ä»£ç å¦‚ä¸‹</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.StringTokenizer;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.util.GenericOptionsParser;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> parak</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>   2020-9-28</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordCountTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WordCountTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">        String[] otherArgs = (<span class="keyword">new</span> GenericOptionsParser(conf, args)).getRemainingArgs();</span><br><span class="line">        <span class="keyword">if</span>(otherArgs.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;Usage: wordcount &lt;in&gt; [&lt;in&gt;...] &lt;out&gt;&quot;</span>);</span><br><span class="line">            System.exit(<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        Job job = Job.getInstance(conf, <span class="string">&quot;word count test&quot;</span>);</span><br><span class="line">        job.setJarByClass(WordCountTest.class);</span><br><span class="line">        job.setMapperClass(WordCountTest.TokenizerMapper.class);</span><br><span class="line">        job.setCombinerClass(WordCountTest.IntSumReducer.class);</span><br><span class="line">        job.setReducerClass(WordCountTest.IntSumReducer.class);</span><br><span class="line">        job.setOutputKeyClass(Text.class);</span><br><span class="line">        job.setOutputValueClass(IntWritable.class);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; otherArgs.length - <span class="number">1</span>; ++i) &#123;</span><br><span class="line">            FileInputFormat.addInputPath(job, <span class="keyword">new</span> Path(otherArgs[i]));</span><br><span class="line"> </span><br><span class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(otherArgs[otherArgs.length - <span class="number">1</span>]));</span><br><span class="line">        System.exit(job.waitForCompletion(<span class="keyword">true</span>)?<span class="number">0</span>:<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">IntSumReducer</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>, <span class="title">IntWritable</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> IntWritable result = <span class="keyword">new</span> IntWritable();</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">IntSumReducer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key, Iterable&lt;IntWritable&gt; values, Reducer&lt;Text, IntWritable, Text, IntWritable&gt;.Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">            IntWritable val;</span><br><span class="line">            <span class="keyword">for</span>(Iterator itr = values.iterator(); itr.hasNext(); sum += val.get()) &#123;</span><br><span class="line">                val = (IntWritable)itr.next();</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">this</span>.result.set(sum);</span><br><span class="line">            context.write(key, <span class="keyword">this</span>.result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TokenizerMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">Object</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> IntWritable one = <span class="keyword">new</span> IntWritable(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">private</span> Text word = <span class="keyword">new</span> Text();</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">TokenizerMapper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(Object key, Text value, Mapper&lt;Object, Text, Text, IntWritable&gt;.Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">            StringTokenizer itr = <span class="keyword">new</span> StringTokenizer(value.toString());</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">while</span>(itr.hasMoreTokens()) &#123;</span><br><span class="line">                <span class="keyword">this</span>.word.set(itr.nextToken());</span><br><span class="line">                context.write(<span class="keyword">this</span>.word, one);</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-æ·»åŠ log4j-propertiesé…ç½®æ–‡ä»¶åˆ°srcç›®å½•ä¸‹"><a href="#2-æ·»åŠ log4j-propertiesé…ç½®æ–‡ä»¶åˆ°srcç›®å½•ä¸‹" class="headerlink" title="2. æ·»åŠ log4j.propertiesé…ç½®æ–‡ä»¶åˆ°srcç›®å½•ä¸‹"></a>2. æ·»åŠ log4j.propertiesé…ç½®æ–‡ä»¶åˆ°srcç›®å½•ä¸‹</h3><blockquote>
<p>æ–°å»ºæ–‡ä»¶</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200928205438905.png" class="" title="image-20200928205438905">

<blockquote>
<p>å†…å®¹å¦‚ä¸‹</p>
</blockquote>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">log4j.rootLogger</span> = <span class="string">INFO,KAG,CONSOLE</span></span><br><span class="line"></span><br><span class="line"><span class="meta">log4j.appender.KAG.Threshold</span>=<span class="string">INFO</span></span><br><span class="line"><span class="meta">log4j.appender.KAG.encoding</span>=<span class="string">UTF-8</span></span><br><span class="line"></span><br><span class="line"><span class="meta">log4j.appender.KAG</span> = <span class="string">org.apache.log4j.DailyRollingFileAppender</span></span><br><span class="line"><span class="meta">log4j.appender.KAG.File</span>=<span class="string">log/sHadoop.log</span></span><br><span class="line"><span class="meta">log4j.appender.KAG.ImmediateFlush</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">log4j.appender.KAG.DatePattern</span>=<span class="string">&#x27;_&#x27;yyyy-MM-dd</span></span><br><span class="line"><span class="meta">log4j.appender.KAG.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.KAG.layout.ConversionPattern</span>=<span class="string">%-d&#123;yyyy-MM-dd HH:mm:ss&#125; KAG %-5p [%c] - %m%n</span></span><br><span class="line"></span><br><span class="line"><span class="meta">log4j.appender.CONSOLE</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="meta">log4j.appender.Threshold</span>=<span class="string">INFO</span></span><br><span class="line"></span><br><span class="line"><span class="meta">log4j.appender.CONSOLE.Target</span>=<span class="string">System.out</span></span><br><span class="line"><span class="meta">log4j.appender.CONSOLE.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.CONSOLE.layout.ConversionPattern</span>=<span class="string">%-d&#123;yyyy-MM-dd HH:mm:ss&#125; KAG %-5p [%c] - %m%n</span></span><br></pre></td></tr></table></figure>



<h3 id="3-é€šè¿‡Eclipseè¿è¡Œâ€œMyWordCountâ€-MapReduceé¡¹ç›®"><a href="#3-é€šè¿‡Eclipseè¿è¡Œâ€œMyWordCountâ€-MapReduceé¡¹ç›®" class="headerlink" title="3. é€šè¿‡Eclipseè¿è¡Œâ€œMyWordCountâ€ MapReduceé¡¹ç›®"></a>3. é€šè¿‡Eclipseè¿è¡Œâ€œMyWordCountâ€ MapReduceé¡¹ç›®</h3><blockquote>
<p>æ›´æ”¹è¿è¡Œé…ç½®</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200928183606296.png" class="" title="image-20200928183606296"> 

<blockquote>
<p>è¿è¡Œç»“æœ</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200928184930876.png" class="" title="image-20200928184930876">

<img src="/2020/10/02/Hadoop/image-20200928184947160.png" class="" title="image-20200928184947160">

<blockquote>
<p>æŸ¥çœ‹/user/parak/outputç›®å½•ï¼Œå’Œç›®å½•ä¸‹çš„æ–‡ä»¶</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200928185257730.png" class="" title="image-20200928185257730">

<blockquote>
<p>é‡å¯Eclipseï¼Œåœ¨Eclipseä¸­æŸ¥çœ‹HDFSæ–‡ä»¶ç³»ç»Ÿï¼Œ/user/parak/output</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200928185548345.png" class="" title="image-20200928185548345">



<h3 id="4-åœ¨Hadoopå¹³å°ä¸Šéƒ¨ç½²WordCountç¨‹åº"><a href="#4-åœ¨Hadoopå¹³å°ä¸Šéƒ¨ç½²WordCountç¨‹åº" class="headerlink" title="4. åœ¨Hadoopå¹³å°ä¸Šéƒ¨ç½²WordCountç¨‹åº"></a>4. åœ¨Hadoopå¹³å°ä¸Šéƒ¨ç½²WordCountç¨‹åº</h3><blockquote>
<p>å³é”® WordCountTest â€”&gt; Export</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200928205719777.png" class="" title="image-20200928205719777">

<blockquote>
<p>é€‰æ‹© Java â€”&gt; Runnable JAR File â€”&gt; Next</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200928205756522.png" class="" title="image-20200928205756522">

<blockquote>
<p>å¡«å…¥å†…å®¹ï¼š</p>
<p>Lauch configuration: WordCountTest - MyWordCount</p>
<p>Export destination: /home/parak/hadoop/hadoop-2.9.2/myapp/WordCount.jar</p>
<p>ç„¶åFinishå³å¯</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200928210235072.png" class="" title="image-20200928210235072">

<blockquote>
<p>è¿è¡Œç¨‹åº</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">java -jar /home/parak/hadoop/hadoop-<span class="number">2.9</span>.<span class="number">2</span>/myapp/WordCount.jar</span><br></pre></td></tr></table></figure>



<h2 id="7-ç»Ÿè®¡æŸç”µå•†ç½‘ç«™ä¹°å®¶æ”¶è—å•†å“æ•°é‡"><a href="#7-ç»Ÿè®¡æŸç”µå•†ç½‘ç«™ä¹°å®¶æ”¶è—å•†å“æ•°é‡" class="headerlink" title="7. ç»Ÿè®¡æŸç”µå•†ç½‘ç«™ä¹°å®¶æ”¶è—å•†å“æ•°é‡"></a>7. ç»Ÿè®¡æŸç”µå•†ç½‘ç«™ä¹°å®¶æ”¶è—å•†å“æ•°é‡</h2><p><strong>è¦æ±‚</strong></p>
<p>ç°æœ‰æŸç”µå•†ç½‘ç«™ç”¨æˆ·å¯¹å•†å“çš„æ”¶è—æ•°æ®ï¼Œè®°å½•äº†ç”¨æˆ·æ”¶è—çš„å•†å“idä»¥åŠæ”¶è—æ—¥æœŸï¼Œåä¸ºbuyer_favorite1ã€‚buyer_favorite1åŒ…å«ï¼šä¹°å®¶idï¼Œå•†å“idï¼Œæ”¶è—æ—¥æœŸè¿™ä¸‰ä¸ªå­—æ®µï¼Œæ•°æ®ä»¥â€œ\tâ€åˆ†å‰²ï¼Œæ ·æœ¬æ•°æ®åŠæ ¼å¼å¦‚ä¸‹ï¼š</p>
<ol>
<li><p>ä¹°å®¶id  å•†å“id  æ”¶è—æ—¥æœŸ </p>
</li>
<li><p>10181  1000481  2010-04-04 16:54:31 </p>
</li>
<li><p>20001  1001597  2010-04-07 15:07:52 </p>
</li>
<li><p>20001  1001560  2010-04-07 15:08:27 </p>
</li>
<li><p>20042  1001368  2010-04-08 08:20:30 </p>
</li>
<li><p>20067  1002061  2010-04-08 16:45:33 </p>
</li>
<li><p>20056  1003289  2010-04-12 10:50:55 </p>
</li>
<li><p>20056  1003290  2010-04-12 11:57:35 </p>
</li>
<li><p>20056  1003292  2010-04-12 12:05:29 </p>
</li>
<li><p>20054  1002420  2010-04-14 15:24:12 </p>
</li>
<li><p>20055  1001679  2010-04-14 19:46:04 </p>
</li>
<li><p>20054  1010675  2010-04-14 15:23:53 </p>
</li>
<li><p>20054  1002429  2010-04-14 17:52:45 </p>
</li>
<li><p>20076  1002427  2010-04-14 19:35:39 </p>
</li>
<li><p>20054  1003326  2010-04-20 12:54:44 </p>
</li>
<li><p>20056  1002420  2010-04-15 11:24:49 </p>
</li>
<li><p>20064  1002422  2010-04-15 11:35:54 </p>
</li>
<li><p>20056  1003066  2010-04-15 11:43:01 </p>
</li>
<li><p>20056  1003055  2010-04-15 11:43:06 </p>
</li>
<li><p>20056  1010183  2010-04-15 11:45:24 </p>
</li>
<li><p>20056  1002422  2010-04-15 11:45:49 </p>
</li>
<li><p>20056  1003100  2010-04-15 11:45:54 </p>
</li>
<li><p>20056  1003094  2010-04-15 11:45:57 </p>
</li>
<li><p>20056  1003064  2010-04-15 11:46:04 </p>
</li>
<li><p>20056  1010178  2010-04-15 16:15:20 </p>
</li>
<li><p>20076  1003101  2010-04-15 16:37:27 </p>
</li>
<li><p>20076  1003103  2010-04-15 16:37:05 </p>
</li>
<li><p>20076  1003100  2010-04-15 16:37:18 </p>
</li>
<li><p>20076  1003066  2010-04-15 16:37:31 </p>
</li>
<li><p>20054  1003103  2010-04-15 16:40:14 </p>
</li>
<li><p>20054  1003100  2010-04-15 16:40:16 </p>
</li>
</ol>
<p>è¦æ±‚ç¼–å†™MapReduceç¨‹åºï¼Œç»Ÿè®¡æ¯ä¸ªä¹°å®¶æ”¶è—å•†å“æ•°é‡ã€‚</p>
<h3 id="1-åœ¨æ–‡æ¡£ä¸‹æ–°å»ºæ–‡ä»¶buyer-favourite9"><a href="#1-åœ¨æ–‡æ¡£ä¸‹æ–°å»ºæ–‡ä»¶buyer-favourite9" class="headerlink" title="1. åœ¨æ–‡æ¡£ä¸‹æ–°å»ºæ–‡ä»¶buyer_favourite9"></a>1. åœ¨æ–‡æ¡£ä¸‹æ–°å»ºæ–‡ä»¶buyer_favourite9</h3><blockquote>
<p>å†™å…¥æ•°æ®</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">10181   1000481   2010-04-04æ·»åŠ åˆ°æ—¥å† 16:54:31</span><br><span class="line">20001   1001597   2010-04-07 15:07:52</span><br><span class="line">20001   1001560   2010-04-07 15:08:27</span><br><span class="line">20042   1001368   2010-04-08 08:20:30</span><br><span class="line">20067   1002061   2010-04-08 16:45:33</span><br><span class="line">20056   1003289   2010-04-12 10:50:55</span><br><span class="line">20056   1003290   2010-04-12 11:57:35</span><br><span class="line">20056   1003292   2010-04-12 12:05:29</span><br><span class="line">20054   1002420   2010-04-14 15:24:12</span><br><span class="line">20055   1001679   2010-04-14 19:46:04</span><br><span class="line">20054   1010675   2010-04-14 15:23:53</span><br><span class="line">20054   1002429   2010-04-14 17:52:45</span><br><span class="line">20076   1002427   2010-04-14 19:35:39</span><br><span class="line">20054   1003326   2010-04-20 12:54:44</span><br><span class="line">20056   1002420   2010-04-15 11:24:49</span><br><span class="line">20064   1002422   2010-04-15 11:35:54</span><br><span class="line">20056   1003066   2010-04-15 11:43:01</span><br><span class="line">20056   1003055   2010-04-15 11:43:06</span><br><span class="line">20056   1010183   2010-04-15 11:45:24</span><br><span class="line">20056   1002422   2010-04-15 11:45:49</span><br><span class="line">20056   1003100   2010-04-15 11:45:54</span><br><span class="line">20056   1003094   2010-04-15 11:45:57</span><br><span class="line">20056   1003064   2010-04-15 11:46:04</span><br><span class="line">20056   1010178   2010-04-15 16:15:20</span><br><span class="line">20076   1003101   2010-04-15 16:37:27</span><br><span class="line">20076   1003103   2010-04-15 16:37:05</span><br><span class="line">20076   1003100   2010-04-15 16:37:18</span><br><span class="line">20076   1003066   2010-04-15 16:37:31</span><br><span class="line">20054   1003103   2010-04-15 16:40:14</span><br><span class="line">20054   1003100   2010-04-15 16:40:16 </span><br></pre></td></tr></table></figure>



<h3 id="2-å°†buyer-favourite9ä¸Šä¼ åˆ°HDFSæ–‡ä»¶ç³»ç»Ÿ"><a href="#2-å°†buyer-favourite9ä¸Šä¼ åˆ°HDFSæ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="2. å°†buyer_favourite9ä¸Šä¼ åˆ°HDFSæ–‡ä»¶ç³»ç»Ÿ"></a>2. å°†buyer_favourite9ä¸Šä¼ åˆ°HDFSæ–‡ä»¶ç³»ç»Ÿ</h3><blockquote>
<p>å³é”®input â€”&gt; Upload files to DFS</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200928222920023.png" class="" title="image-20200928222920023">

<blockquote>
<p>é€‰æ‹©buyer_favourite1åç¡®å®š</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200928225427432.png" class="" title="image-20200928225427432">



<h3 id="3-æ–°å»ºjavaæ–‡ä»¶ProductNumber"><a href="#3-æ–°å»ºjavaæ–‡ä»¶ProductNumber" class="headerlink" title="3. æ–°å»ºjavaæ–‡ä»¶ProductNumber"></a>3. æ–°å»ºjavaæ–‡ä»¶ProductNumber</h3><blockquote>
<p>ä»£ç å¦‚ä¸‹</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kag;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;  </span><br><span class="line"><span class="keyword">import</span> java.util.StringTokenizer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;  </span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;  </span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;  </span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;  </span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;  </span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;  </span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;  </span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat; </span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> parak</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020-9-28</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductNumber</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException, InterruptedException </span>&#123;</span><br><span class="line">		Job job = Job.getInstance();</span><br><span class="line">		job.setJobName(<span class="string">&quot;ProductNumber&quot;</span>);</span><br><span class="line">		job.setJarByClass(ProductNumber.class);</span><br><span class="line">		job.setMapperClass(MapperHandler.class);  </span><br><span class="line">		job.setReducerClass(ReducerHandler.class);  </span><br><span class="line">		job.setOutputKeyClass(Text.class);  </span><br><span class="line">		job.setOutputValueClass(IntWritable.class);  </span><br><span class="line">		Path inputPath = <span class="keyword">new</span> Path(<span class="string">&quot;hdfs://master:9000/user/parak/input/buyer_favourite1&quot;</span>);</span><br><span class="line">		Path outputPath = <span class="keyword">new</span> Path(<span class="string">&quot;hdfs://master:9000/user/parak/output/buyer_favourite1_analysis_result&quot;</span>);</span><br><span class="line">		FileInputFormat.addInputPath(job, inputPath);</span><br><span class="line">		FileOutputFormat.setOutputPath(job, outputPath);</span><br><span class="line">		<span class="keyword">boolean</span> flag = job.waitForCompletion(<span class="keyword">true</span>);</span><br><span class="line">		Logger log = Logger.getLogger(ProductNumber.class);</span><br><span class="line">		log.info(<span class="string">&quot;Falg = &quot;</span> + flag);</span><br><span class="line">		System.exit(flag ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MapperHandler</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">Object</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt; </span>&#123;</span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> IntWritable intWritable = <span class="keyword">new</span> IntWritable(<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">static</span> Text word = <span class="keyword">new</span> Text();</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(Object key, Text value, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">			StringTokenizer tokenizer = <span class="keyword">new</span> StringTokenizer(value.toString(), <span class="string">&quot;   &quot;</span>);</span><br><span class="line">			word.set(tokenizer.nextToken());</span><br><span class="line">			context.write(word, intWritable);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ReducerHandler</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>, <span class="title">IntWritable</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt; </span>&#123;</span><br><span class="line">		<span class="keyword">private</span> IntWritable intWritable = <span class="keyword">new</span> IntWritable(<span class="number">1</span>);</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key, Iterable&lt;IntWritable&gt; values, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">			<span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span> (IntWritable value : values) &#123;</span><br><span class="line">				sum += value.get();</span><br><span class="line">			&#125;</span><br><span class="line">			intWritable.set(sum);</span><br><span class="line">			context.write(key, intWritable);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿è¡Œç»“æœ</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200928223752502.png" class="" title="image-20200928223752502">

<blockquote>
<p>è¿è¡Œåçš„HDFSæ–‡ä»¶ç³»ç»Ÿ</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200928225133967.png" class="" title="image-20200928225133967">



<blockquote>
<p>part-r-00000æ–‡ä»¶å†…å®¹å³ä¸ºç»Ÿè®¡ç»“æœ</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200928225154667.png" class="" title="image-20200928225154667">





<h2 id="8-å®‰è£…éƒ¨ç½²HBase"><a href="#8-å®‰è£…éƒ¨ç½²HBase" class="headerlink" title="8. å®‰è£…éƒ¨ç½²HBase"></a>8. å®‰è£…éƒ¨ç½²HBase</h2><p>HBaseä¸Hadoopç‰ˆæœ¬æ”¯æŒå…³ç³»</p>
<img src="/2020/10/02/Hadoop/image-20201002211137852.png" class="" title="image-20201002211137852">





<h3 id="1-ä¸‹è½½å®‰è£…HBase-1-6-0"><a href="#1-ä¸‹è½½å®‰è£…HBase-1-6-0" class="headerlink" title="1. ä¸‹è½½å®‰è£…HBase-1.6.0"></a>1. ä¸‹è½½å®‰è£…HBase-1.6.0</h3><blockquote>
<p>ä½¿ç”¨é•œåƒï¼š<a href="https://mirrors.bfsu.edu.cn/apache/hbase/">https://mirrors.bfsu.edu.cn/apache/hbase/</a></p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200929100114445.png" class="" title="image-20200929100114445">

<blockquote>
<p>é€‰æ‹©1.6.0ï¼Œä¸‹è½½tar.gzå‹ç¼©åŒ…</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200929100159559.png" class="" title="image-20200929100159559">

<blockquote>
<p>è§£å‹</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar xzvf hbase-1.6.0-bin.tar.gz </span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200929102107183.png" class="" title="image-20200929102107183">

<blockquote>
<p>æŸ¥çœ‹</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200929102212291.png" class="" title="image-20200929102212291">



<h3 id="2-é…ç½®Hbase"><a href="#2-é…ç½®Hbase" class="headerlink" title="2. é…ç½®Hbase"></a>2. é…ç½®Hbase</h3><blockquote>
<p>è¿›å…¥HBaseå®‰è£…ä¸»ç›®å½•çš„confç›®å½•ï¼Œç„¶åä¿®æ”¹é…ç½®æ–‡ä»¶</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd conf/</span><br></pre></td></tr></table></figure>



<h4 id="1-ä¿®æ”¹é…ç½®æ–‡ä»¶hbase-env-sh"><a href="#1-ä¿®æ”¹é…ç½®æ–‡ä»¶hbase-env-sh" class="headerlink" title="(1) ä¿®æ”¹é…ç½®æ–‡ä»¶hbase-env.sh"></a>(1) ä¿®æ”¹é…ç½®æ–‡ä»¶hbase-env.sh</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gedit hbase-env.sh</span><br><span class="line"></span><br><span class="line">ä¿®æ”¹JAVA_HOME:</span><br><span class="line">export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.262.b10-0.el7_8.x86_64</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200929103119874.png" class="" title="image-20200929103119874">

<h4 id="2-ä¿®æ”¹é…ç½®æ–‡ä»¶hbase-site-xml"><a href="#2-ä¿®æ”¹é…ç½®æ–‡ä»¶hbase-site-xml" class="headerlink" title="(2) ä¿®æ”¹é…ç½®æ–‡ä»¶hbase-site.xml"></a>(2) ä¿®æ”¹é…ç½®æ–‡ä»¶hbase-site.xml</h4><blockquote>
<p>å°†hbase-site.xmlä¿®æ”¹ä¸ºâ€˜</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Licensed to the Apache Software Foundation (ASF) under one</span></span><br><span class="line"><span class="comment"> * or more contributor license agreements.  See the NOTICE file</span></span><br><span class="line"><span class="comment"> * distributed with this work for additional information</span></span><br><span class="line"><span class="comment"> * regarding copyright ownership.  The ASF licenses this file</span></span><br><span class="line"><span class="comment"> * to you under the Apache License, Version 2.0 (the</span></span><br><span class="line"><span class="comment"> * &quot;License&quot;); you may not use this file except in compliance</span></span><br><span class="line"><span class="comment"> * with the License.  You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"> * limitations under the License.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.cluster.distributed<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.rootdir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://master:9000/hbase<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>master<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.master.info.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>60010<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200929103343424.png" class="" title="image-20200929103343424">

<h4 id="3-è®¾ç½®-regionservers"><a href="#3-è®¾ç½®-regionservers" class="headerlink" title="(3) è®¾ç½® regionservers"></a>(3) è®¾ç½® regionservers</h4><blockquote>
<p>å°†regionserversä¸­çš„localhostä¿®æ”¹ä¸º: slave</p>
</blockquote>
<h4 id="4-è®¾ç½®ç¯å¢ƒå˜é‡"><a href="#4-è®¾ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="(4) è®¾ç½®ç¯å¢ƒå˜é‡"></a>(4) è®¾ç½®ç¯å¢ƒå˜é‡</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gedit ~/.bash_profile</span><br><span class="line"></span><br><span class="line">å°†ä¸‹é¢ä»£ç æ·»åŠ åˆ°æ–‡ä»¶æœ«å°¾ï¼š</span><br><span class="line"><span class="meta">#</span><span class="bash">HBase</span></span><br><span class="line">export HBASE_HOME=/home/parak/HBase/hbase-1.6.0</span><br><span class="line">export PATH=$HBASE_HOME/bin:$PATH</span><br><span class="line">export HADOOP_CLASSPATH=$HBASE_HOME/lib/*</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200929104148521.png" class="" title="image-20200929104148521">

<h4 id="5-å°†HBaseå¤åˆ¶åˆ°Slaveç»“ç‚¹"><a href="#5-å°†HBaseå¤åˆ¶åˆ°Slaveç»“ç‚¹" class="headerlink" title="(5) å°†HBaseå¤åˆ¶åˆ°Slaveç»“ç‚¹"></a>(5) å°†HBaseå¤åˆ¶åˆ°Slaveç»“ç‚¹</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">scp -r /home/parak/HBase/hbase-1.6.0 slave:/home/parak/HBase/</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200929104703378.png" class="" title="image-20200929104703378">

<blockquote>
<p>æŸ¥çœ‹slaveç»“ç‚¹çš„HBaseæ–‡ä»¶å¤¹</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200929104827983.png" class="" title="image-20200929104827983">



<h3 id="3-éªŒè¯å¹¶å¯åŠ¨HBase"><a href="#3-éªŒè¯å¹¶å¯åŠ¨HBase" class="headerlink" title="3. éªŒè¯å¹¶å¯åŠ¨HBase"></a>3. éªŒè¯å¹¶å¯åŠ¨HBase</h3><blockquote>
<p>å…ˆå¯åŠ¨Hadoop: start-all.sh</p>
<p>å†å¯åŠ¨Hbase: start-hbase.sh</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200929105006101.png" class="" title="image-20200929105006101">

<blockquote>
<p>å¯åŠ¨HBaseå‡ºç°é”™è¯¯</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200929110647176.png" class="" title="image-20200929110647176">

<p>æˆ‘æ„è¯†åˆ°æ˜¯Hadoop-2.9.2ä¸HBase-1.6.0çš„ç‰ˆæœ¬åŒ¹é…é—®é¢˜ï¼Œäºæ˜¯æˆ‘ä¸‹è½½HBase-2.2.6ã€‚</p>
<h3 id="4-é‡æ–°ä¸‹è½½é…ç½®HBase-2-2-6"><a href="#4-é‡æ–°ä¸‹è½½é…ç½®HBase-2-2-6" class="headerlink" title="4. é‡æ–°ä¸‹è½½é…ç½®HBase-2.2.6"></a>4. é‡æ–°ä¸‹è½½é…ç½®HBase-2.2.6</h3><blockquote>
<p>ä¸‹è½½</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200929110514041.png" class="" title="image-20200929110514041">

<img src="/2020/10/02/Hadoop/image-20200929110553845.png" class="" title="image-20200929110553845">

<blockquote>
<p>è§£å‹: tar xzvf hbase-2.2.6-bin.tar.gz</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200929110818266.png" class="" title="image-20200929110818266">

<blockquote>
<p>ä¿®æ”¹é…ç½®æ–‡ä»¶hbase-env.sh</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200929111024747.png" class="" title="image-20200929111024747">

<blockquote>
<p>ä¿®æ”¹é…ç½®æ–‡ä»¶hbase-site.xml</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Licensed to the Apache Software Foundation (ASF) under one</span></span><br><span class="line"><span class="comment"> * or more contributor license agreements.  See the NOTICE file</span></span><br><span class="line"><span class="comment"> * distributed with this work for additional information</span></span><br><span class="line"><span class="comment"> * regarding copyright ownership.  The ASF licenses this file</span></span><br><span class="line"><span class="comment"> * to you under the Apache License, Version 2.0 (the</span></span><br><span class="line"><span class="comment"> * &quot;License&quot;); you may not use this file except in compliance</span></span><br><span class="line"><span class="comment"> * with the License.  You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"> * limitations under the License.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    The following properties are set for running HBase as a single process on a</span></span><br><span class="line"><span class="comment">    developer workstation. With this configuration, HBase is running in</span></span><br><span class="line"><span class="comment">    &quot;stand-alone&quot; mode and without a distributed file system. In this mode, and</span></span><br><span class="line"><span class="comment">    without further configuration, HBase and ZooKeeper data are stored on the</span></span><br><span class="line"><span class="comment">    local filesystem, in a path under the value configured for `hbase.tmp.dir`.</span></span><br><span class="line"><span class="comment">    This value is overridden from its default value of `/tmp` because many</span></span><br><span class="line"><span class="comment">    systems clean `/tmp` on a regular basis. Instead, it points to a path within</span></span><br><span class="line"><span class="comment">    this HBase installation directory.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    Running against the `LocalFileSystem`, as opposed to a distributed</span></span><br><span class="line"><span class="comment">    filesystem, runs the risk of data integrity issues and data loss. Normally</span></span><br><span class="line"><span class="comment">    HBase will refuse to run in such an environment. Setting</span></span><br><span class="line"><span class="comment">    `hbase.unsafe.stream.capability.enforce` to `false` overrides this behavior,</span></span><br><span class="line"><span class="comment">    permitting operation. This configuration is for the developer workstation</span></span><br><span class="line"><span class="comment">    only and __should not be used in production!__</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    See also https://hbase.apache.org/book.html#standalone_dist</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.cluster.distributed<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>./tmp<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.unsafe.stream.capability.enforce<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.rootdir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://master:9000/hbase<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>master<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.master.info.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>60010<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200929111344171.png" class="" title="image-20200929111344171">

<blockquote>
<p>ä¿®æ”¹regionserversæ–‡ä»¶</p>
</blockquote>
<p><img src="Hadoop%5Cimage-20200929113716160.png" alt="image-20200929113716160"></p>
<blockquote>
<p>å°†HBaseå¤åˆ¶åˆ°SlaveèŠ‚ç‚¹</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">scp -r /home/parak/HBase/hbase-2.2.6 slave:/home/parak/HBase</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200929112324004.png" class="" title="image-20200929112324004">

<blockquote>
<p>å†æ¬¡å¯åŠ¨Hbase</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200929113827901.png" class="" title="image-20200929113827901">

<blockquote>
<p>æ‰“å¼€FireFoxï¼Œè¿›å…¥<a href="http://master:60010/">http://master:60010</a></p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200929113959833.png" class="" title="image-20200929113959833">

<p>è¯´æ˜HBaseå¯åŠ¨æˆåŠŸ</p>
<h3 id="4-å…³é—­HBase"><a href="#4-å…³é—­HBase" class="headerlink" title="4. å…³é—­HBase"></a>4. å…³é—­HBase</h3><blockquote>
<p>å…ˆå…³é—­HBase: stop-hbase.sh</p>
<p>å†å…³é—­Hadoop: stop-all.sh</p>
</blockquote>
<img src="/2020/10/02/Hadoop/image-20200929114148065.png" class="" title="image-20200929114148065">



<h2 id="9-HBase-Shellå‘½ä»¤æ“ä½œ"><a href="#9-HBase-Shellå‘½ä»¤æ“ä½œ" class="headerlink" title="9. HBase Shellå‘½ä»¤æ“ä½œ"></a>9. HBase Shellå‘½ä»¤æ“ä½œ</h2><h3 id="1-å¯åŠ¨HBase-Shell"><a href="#1-å¯åŠ¨HBase-Shell" class="headerlink" title="1. å¯åŠ¨HBase Shell"></a>1. å¯åŠ¨HBase Shell</h3><h4 id="1-å¯åŠ¨HBase-Shellç•Œé¢"><a href="#1-å¯åŠ¨HBase-Shellç•Œé¢" class="headerlink" title="(1) å¯åŠ¨HBase Shellç•Œé¢"></a>(1) å¯åŠ¨HBase Shellç•Œé¢</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hbase shell</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200929191351747.png" class="" title="image-20200929191351747">

<h4 id="2-HBase-Shellçš„helpå‘½ä»¤"><a href="#2-HBase-Shellçš„helpå‘½ä»¤" class="headerlink" title="(2) HBase Shellçš„helpå‘½ä»¤"></a>(2) HBase Shellçš„helpå‘½ä»¤</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">help</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200929191531507.png" class="" title="image-20200929191531507">

<blockquote>
<p>æŸ¥çœ‹HBaseå»ºè¡¨å‘½ä»¤createçš„ç”¨æ³•</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">help &quot;create&quot;</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200929191618099.png" class="" title="image-20200929191618099">



<h3 id="2-åˆ›å»ºHBaseæ•°æ®è¡¨"><a href="#2-åˆ›å»ºHBaseæ•°æ®è¡¨" class="headerlink" title="2. åˆ›å»ºHBaseæ•°æ®è¡¨"></a>2. åˆ›å»ºHBaseæ•°æ®è¡¨</h3><blockquote>
<p>HBaseä¸­ç”¨createå‘½ä»¤åˆ›å»ºè¡¨</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="string">&#x27;student&#x27;</span>, <span class="string">&#x27;Sname&#x27;</span>, <span class="string">&#x27;Ssex&#x27;</span>, <span class="string">&#x27;Sage&#x27;</span>, <span class="string">&#x27;Sdept&#x27;</span>, <span class="string">&#x27;course&#x27;</span></span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200929191856923.png" class="" title="image-20200929191856923">

<blockquote>
<p>æŸ¥çœ‹â€™studentâ€™è¡¨çš„å±æ€§</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">describe &#x27;student&#x27;</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200929191953519.png" class="" title="image-20200929191953519">



<h3 id="3-HBaseæ•°æ®åº“åŸºæœ¬æ“ä½œ"><a href="#3-HBaseæ•°æ®åº“åŸºæœ¬æ“ä½œ" class="headerlink" title="3. HBaseæ•°æ®åº“åŸºæœ¬æ“ä½œ"></a>3. HBaseæ•°æ®åº“åŸºæœ¬æ“ä½œ</h3><h4 id="1-æ·»åŠ æ•°æ®"><a href="#1-æ·»åŠ æ•°æ®" class="headerlink" title="(1) æ·»åŠ æ•°æ®"></a>(1) æ·»åŠ æ•°æ®</h4><blockquote>
<p>putå‘½ä»¤æ·»åŠ æ•°æ®ï¼Œä¸€æ¬¡åªèƒ½ä¸ºä¸€ä¸ªè¡¨çš„ä¸€è¡Œæ•°æ®çš„ä¸€ä¸ªåˆ—æ·»åŠ ä¸€ä¸ªæ•°æ®</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">put &#x27;student&#x27;, &#x27;95001&#x27;, &#x27;Sname&#x27;, &#x27;Li Ying&#x27;</span><br><span class="line">put &#x27;student&#x27;, &#x27;95001&#x27;, &#x27;Sdept&#x27;, &#x27;CS&#x27;</span><br><span class="line">put &#x27;student&#x27;, &#x27;95001&#x27;, &#x27;course:math&#x27;, &#x27;81&#x27;</span><br><span class="line">put &#x27;student&#x27;, &#x27;95001&#x27;, &#x27;course:english&#x27;, &#x27;85&#x27;</span><br><span class="line">put &#x27;student&#x27;, &#x27;95002&#x27;, &#x27;course:math&#x27;, &#x27;83&#x27;</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200929193655517.png" class="" title="image-20200929193655517">



<h4 id="2-æŸ¥çœ‹æ•°æ®"><a href="#2-æŸ¥çœ‹æ•°æ®" class="headerlink" title="(2) æŸ¥çœ‹æ•°æ®"></a>(2) æŸ¥çœ‹æ•°æ®</h4><blockquote>
<p>æŸ¥çœ‹è¡¨æŸä¸€è¡Œçš„æ•°æ®</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">get &#x27;student&#x27;, &#x27;95001&#x27;</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200929194017359.png" class="" title="image-20200929194017359">

<blockquote>
<p>æŸ¥çœ‹è¡¨çš„å…¨éƒ¨æ•°æ®</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">scan &#x27;student&#x27;</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200929194135877.png" class="" title="image-20200929194135877">



<h4 id="3-åˆ é™¤æ•°æ®"><a href="#3-åˆ é™¤æ•°æ®" class="headerlink" title="(3) åˆ é™¤æ•°æ®"></a>(3) åˆ é™¤æ•°æ®</h4><blockquote>
<p>deleteå‘½ä»¤åˆ é™¤æŸä¸€é¡¹æ•°æ®</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">delete &#x27;student&#x27;, &#x27;95001&#x27;, &#x27;Ssex&#x27;</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200929194514884.png" class="" title="image-20200929194514884">

<blockquote>
<p>deleteå‘½ä»¤åˆ é™¤æŸè¡Œçš„å…¨éƒ¨æ•°æ®</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">delete &#x27;student&#x27;,&#x27;95001&#x27;</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200929194626605.png" class="" title="image-20200929194626605">



<h4 id="4-åˆ é™¤è¡¨"><a href="#4-åˆ é™¤è¡¨" class="headerlink" title="(4) åˆ é™¤è¡¨"></a>(4) åˆ é™¤è¡¨</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">disable &#x27;student&#x27;</span><br><span class="line">drop &#x27;student&#x27;</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200929193442627.png" class="" title="image-20200929193442627">



<h3 id="4-æŸ¥è¯¢HBaseæ•°æ®è¡¨çš„å†å²æ•°æ®"><a href="#4-æŸ¥è¯¢HBaseæ•°æ®è¡¨çš„å†å²æ•°æ®" class="headerlink" title="4. æŸ¥è¯¢HBaseæ•°æ®è¡¨çš„å†å²æ•°æ®"></a>4. æŸ¥è¯¢HBaseæ•°æ®è¡¨çš„å†å²æ•°æ®</h3><blockquote>
<p>åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™ï¼ŒæŒ‡å®šä¿å­˜çš„ç‰ˆæœ¬æ•°</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">create &#x27;teacher&#x27;, &#123;NAME=&gt;&#x27;username&#x27;, VERSIONS=&gt;5&#125;</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200929203801474.png" class="" title="image-20200929203801474">

<blockquote>
<p>æ’å…¥æ•°æ®ç„¶åæ›´æ–°æ•°æ®ï¼Œä½¿å…¶äº§ç”Ÿå†å²ç‰ˆæœ¬æ•°æ®</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">put &#x27;teacher&#x27;, &#x27;91001&#x27;, &#x27;username&#x27;, &#x27;Mary&#x27;</span><br><span class="line">put &#x27;teacher&#x27;, &#x27;91001&#x27;, &#x27;username&#x27;, &#x27;Mary1&#x27;</span><br><span class="line">put &#x27;teacher&#x27;, &#x27;91001&#x27;, &#x27;username&#x27;, &#x27;Mary2&#x27;</span><br><span class="line">put &#x27;teacher&#x27;, &#x27;91001&#x27;, &#x27;username&#x27;, &#x27;Mary3&#x27;</span><br><span class="line">put &#x27;teacher&#x27;, &#x27;91001&#x27;, &#x27;username&#x27;, &#x27;Mary4&#x27;</span><br><span class="line">put &#x27;teacher&#x27;, &#x27;91001&#x27;, &#x27;username&#x27;, &#x27;Mary5&#x27;</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200929204220031.png" class="" title="image-20200929204220031">

<blockquote>
<p>æŸ¥è¯¢æ—¶ï¼ŒæŒ‡å®šæŸ¥è¯¢çš„å†å²ç‰ˆæœ¬ä¹¦ï¼ˆé»˜è®¤ä¼šæŸ¥è¯¢å‡ºæœ€æ–°çš„æ•°æ®ï¼‰</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">get &#x27;teacher&#x27;, &#x27;91001&#x27;, &#123;COLUMN=&gt;&#x27;username&#x27;, VERSIONS=&gt;5&#125;</span><br></pre></td></tr></table></figure>

<img src="/2020/10/02/Hadoop/image-20200929204245861.png" class="" title="image-20200929204245861">



<h3 id="5-é€€å‡ºHBase-Shell"><a href="#5-é€€å‡ºHBase-Shell" class="headerlink" title="5. é€€å‡ºHBase Shell"></a>5. é€€å‡ºHBase Shell</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure>



<h2 id="10-HBase-Java-API-ç¼–ç¨‹å®è·µ"><a href="#10-HBase-Java-API-ç¼–ç¨‹å®è·µ" class="headerlink" title="10. HBase Java API ç¼–ç¨‹å®è·µ"></a>10. HBase Java API ç¼–ç¨‹å®è·µ</h2><p>Updating~</p>
]]></content>
      <categories>
        <category>BigData</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Hadoop</tag>
        <tag>HBase</tag>
        <tag>CentOS7</tag>
      </tags>
  </entry>
  <entry>
    <title>çº¢é»‘æ ‘</title>
    <url>/2020/11/07/RBTree/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="çº¢é»‘æ ‘"><a href="#çº¢é»‘æ ‘" class="headerlink" title="çº¢é»‘æ ‘"></a>çº¢é»‘æ ‘</h1><center>
    <font face="Kristen ITC" color="#555555" font-size=100px>ğŸ’Œ Khighness ğŸ’Œ</font><br>
</center>



<h2 id="ğŸ““-å®šä¹‰"><a href="#ğŸ““-å®šä¹‰" class="headerlink" title="ğŸ““ å®šä¹‰"></a>ğŸ““ å®šä¹‰</h2><p>çº¢é»‘æ ‘æ˜¯ä¸€ç§å«æœ‰çº¢é»‘èŠ‚ç‚¹å¹¶èƒ½è‡ªå¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘</p>
<blockquote>
<p>ğŸŒ²äºŒå‰æŸ¥æ‰¾æ ‘</p>
<p>æ»¡è¶³çº¦æŸï¼šå·¦ç»“ç‚¹çš„å€¼å°äºçˆ¶ç»“ç‚¹ï¼Œçˆ¶ç»“ç‚¹çš„å€¼å°äºå³ç»“ç‚¹çš„å€¼ã€‚</p>
<p>åœºæ™¯ç†è§£ï¼šå‡è®¾äºŒå‰æŸ¥æ‰¾æ ‘å»ºç«‹åœ¨x-yç¬›å¡å°”åæ ‡ç³»ä¸­ï¼Œåˆ™æ‰€æœ‰ç»“ç‚¹å‘xè½´æŠ•å½±ï¼Œå€¼æ­£å¥½æ²¿ç€xè½´é€’å¢ã€‚</p>
</blockquote>
<h2 id="ğŸ”°-æ€§è´¨"><a href="#ğŸ”°-æ€§è´¨" class="headerlink" title="ğŸ”° æ€§è´¨"></a>ğŸ”° æ€§è´¨</h2><ul>
<li>æ¯ä¸ªç»“ç‚¹è¦ä¹ˆæ˜¯é»‘è‰²ï¼Œè¦ä¹ˆæ˜¯çº¢è‰²</li>
<li>æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²</li>
<li>æ¯ä¸ªå¶å­ç»“ç‚¹(NIL)æ˜¯é»‘è‰²çš„(è™šç»“ç‚¹)</li>
<li>æ¯ä¸ªçº¢è‰²ç»“ç‚¹çš„ä¸¤ä¸ªå­ç»“ç‚¹ä¸€å®šéƒ½æ˜¯é»‘è‰²</li>
<li>ä»»æ„ä¸€ç»“ç‚¹åˆ°æ¯ä¸ªå¶å­ç»“ç‚¹çš„è·¯å¾„éƒ½åŒ…å«æ•°é‡ç›¸åŒçš„é»‘ç»“ç‚¹(é»‘è‰²å®Œç¾å¹³è¡¡)</li>
</ul>
<p>ä»¥ä¸Šä¸ºæœ€ç®€æ€§è´¨ï¼Œä»»ä½•ä¸€æ¡ä¸å¯ç¼ºå°‘ï¼Œä»»æ„å››æ¡ä¸èƒ½æ¨å‡ºå¦å¤–ä¸€æ¡ã€‚</p>
<h2 id="ğŸŒ—-å¹³è¡¡"><a href="#ğŸŒ—-å¹³è¡¡" class="headerlink" title="ğŸŒ— å¹³è¡¡"></a>ğŸŒ— å¹³è¡¡</h2><p>çº¢é»‘æ ‘æ˜¯éå®Œç¾å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæ˜¯å®Œç¾é»‘è‰²å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ã€‚</p>
<blockquote>
<p>â­•çº¢é»‘æ ‘è‡ªå¹³è¡¡çš„æœ€å°å•å…ƒ</p>
</blockquote>
<img src="/2020/11/07/RBTree/image-20201106225159861.png" class="" title="image-20201106225159861">

<p>çº¢é»‘æ ‘çš„è‡ªå¹³è¡¡</p>
<p>æ’å…¥åªè€ƒè™‘G-{P, U}-Cä¸‰ä»£ï¼Œåˆ é™¤åªè€ƒè™‘P-{C, B}-{CL, CR, BL, BR}ä¸‰ä»£</p>
<blockquote>
<p>ğŸ”±çº¢é»‘æ ‘è‡ªå¹³è¡¡çš„åŸå­æ“ä½œ</p>
</blockquote>
<p>åŒ…æ‹¬ï¼šå˜è‰²ã€å·¦æ—‹ã€å³æ—‹</p>
<p>æ—‹è½¬è¦æœ‰åœ†å¿ƒï¼Œæœ‰æ–¹å‘ã€‚</p>
<p>æ—‹è½¬ç»“ç‚¹æ˜¯çˆ¶ç»“ç‚¹å›´ç»•å­èŠ‚ç‚¹æ—‹è½¬(å­èŠ‚ç‚¹ä¸ºåœ†å¿ƒ)ã€‚</p>
<img src="/2020/11/07/RBTree/image-20201103220142748.png" class="" title="image-20201103220142748">

<center>
    <font face="Kristen ITC" color="#555555" font-size=100px>â˜¬ æ—‹è½¬ç»“ç‚¹ â˜¬</font><br>
</center>



<blockquote>
<p>ğŸŒå˜è‰²ï¼šP-Black=&gt;Red,CB-Red=&gt;Black</p>
</blockquote>
<img src="/2020/11/07/RBTree/image-20201103221816468.png" class="" title="image-20201103221816468">

<center>
    <font face="Kristen ITC" color="#555555" font-size=100px>â˜¬ å˜è‰²æ“ä½œ â˜¬</font><br>
</center>

<blockquote>
<p>ğŸŒ”å·¦æ—‹ï¼šæ—‹è½¬ç»“ç‚¹ç»•åœ†å¿ƒé€†æ—¶é’ˆæ–¹å‘æ—‹è½¬ã€‚åŸºäºæœ€çŸ­è·¯å¾„æ¥ç¡®å®šæ–¹å‘ã€‚</p>
</blockquote>
<img src="/2020/11/07/RBTree/image-20201103222025132.png" class="" title="image-20201103222025132">

<center>
    <font face="Kristen ITC" color="#555555" font-size=100px>â˜¬ å·¦æ—‹æ“ä½œ â˜¬</font><br>
</center>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;å·¦æ—‹&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;è¿‡ç¨‹ï¼šçˆ¶äº²ä¸‹æ²‰ï¼Œå³å­ä¸Šå‡ï¼Œå³å­çš„å·¦å­å˜ä¸ºåŸçˆ¶çš„å³å­&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å·¦æ—‹Xç»“ç‚¹</span></span><br><span class="line"><span class="comment"> *             P                                P</span></span><br><span class="line"><span class="comment"> *            /                                /</span></span><br><span class="line"><span class="comment"> *           X                                Y</span></span><br><span class="line"><span class="comment"> *         /  \        --(å·¦æ—‹)--&gt;           / \</span></span><br><span class="line"><span class="comment"> *       lX    Y                           X  rY</span></span><br><span class="line"><span class="comment"> *            / \                        /  \</span></span><br><span class="line"><span class="comment"> *          lY   r                      lX  lY</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> x</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">leftRotate</span><span class="params">(RBTNode&lt;T, D&gt; x)</span> </span>&#123;</span><br><span class="line">    <span class="comment">/* å³å­ç»“ç‚¹ */</span></span><br><span class="line">    RBTNode&lt;T, D&gt; y = x.getRight();</span><br><span class="line">    <span class="comment">/* çˆ¶äº²ç»“ç‚¹ */</span></span><br><span class="line">    RBTNode&lt;T, D&gt; p = x.getParent();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Yçš„å·¦å­ å˜æˆ Xçš„å³å­</span></span><br><span class="line"><span class="comment">    * è‹¥Xä¸Yçš„å·¦å­ä¸ä¸ºç©º</span></span><br><span class="line"><span class="comment">    * åˆ™è®¾ç½®Yçš„å·¦å­çš„çˆ¶äº²ä¸ºX */</span></span><br><span class="line">    x.setRight(y.getLeft());</span><br><span class="line">    <span class="keyword">if</span> (y.getLeft() != <span class="keyword">null</span>) &#123;</span><br><span class="line">        y.getLeft().setParent(x);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* è®¾ç½®Yçš„çˆ¶äº²ä¸ºP</span></span><br><span class="line"><span class="comment">    * 1. Pä¸ºç©ºï¼Œåˆ™æ ¹èŠ‚ç‚¹è®¾ç½®ä¸ºY</span></span><br><span class="line"><span class="comment">    * 2. Xä¸ºPçš„å·¦å­ï¼Œ åˆ™Pçš„å·¦å­è®¾ç½®ä¸ºY</span></span><br><span class="line"><span class="comment">    * 3. Xä¸ºPçš„å³å­ï¼Œåˆ™Pçš„å³å­è®¾ç½®ä¸ºY */</span></span><br><span class="line">    y.setParent(p);</span><br><span class="line">    <span class="keyword">if</span> (p == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.root = y;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (p.getLeft() == x) &#123;</span><br><span class="line">            p.setLeft(y);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            p.setRight(y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* å°†Xçš„çˆ¶äº²è®¾ç½®ä¸ºY</span></span><br><span class="line"><span class="comment">    * å°†Yçš„å·¦å­è®¾ç½®ä¸ºX */</span></span><br><span class="line">    x.setParent(y);</span><br><span class="line">    y.setLeft(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>ğŸŒ–å³æ—‹ï¼šæ—‹è½¬ç»“ç‚¹ç»•åœ†å¿ƒé¡ºæ—¶é’ˆæ–¹å‘æ—‹è½¬ã€‚åŸºäºæœ€çŸ­è·¯å¾„ç¡®å®šæ–¹å‘ã€‚</p>
</blockquote>
<img src="/2020/11/07/RBTree/image-20201103223223997.png" class="" title="image-20201103223223997">

<center>
    <font face="Kristen ITC" color="#555555" font-size=100px>â˜¬ å³æ—‹æ“ä½œ â˜¬</font><br>
</center>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;å³æ—‹&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;è¿‡ç¨‹ï¼šçˆ¶äº²ä¸‹æ²‰ï¼Œå·¦å­ä¸Šå‡ï¼Œå·¦å­çš„å³å­å˜æˆåŸçˆ¶çš„å·¦å­&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å³æ—‹Xç»“ç‚¹</span></span><br><span class="line"><span class="comment"> *             P                                P</span></span><br><span class="line"><span class="comment"> *            /                                /</span></span><br><span class="line"><span class="comment"> *           X                                Y</span></span><br><span class="line"><span class="comment"> *         /  \        --(å³æ—‹)--&gt;           /  \</span></span><br><span class="line"><span class="comment"> *        Y   rX                           lY   X</span></span><br><span class="line"><span class="comment"> *       / \                                   / \</span></span><br><span class="line"><span class="comment"> *     lY  rY                                rY  rX</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> x</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rightRotate</span><span class="params">(RBTNode&lt;T, D&gt; x)</span> </span>&#123;</span><br><span class="line">    <span class="comment">/* å·¦å­ç»“ç‚¹ */</span></span><br><span class="line">    RBTNode&lt;T, D&gt; y = x.getLeft();</span><br><span class="line">    <span class="comment">/* çˆ¶äº²ç»“ç‚¹ */</span></span><br><span class="line">    RBTNode&lt;T, D&gt; p = x.getParent();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Yçš„å³å­ å˜æˆ Xçš„å·¦å­</span></span><br><span class="line"><span class="comment">    * è‹¥Yçš„å³å­ä¸ä¸ºç©º</span></span><br><span class="line"><span class="comment">    * åˆ™è®¾ç½®Yçš„å³å­çš„çˆ¶äº²ä¸ºX */</span></span><br><span class="line">    x.setLeft(y.getRight());</span><br><span class="line">    <span class="keyword">if</span> (y.getRight() != <span class="keyword">null</span>) &#123;</span><br><span class="line">        y.getRight().setParent(x);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* è®¾ç½®Yçš„çˆ¶äº²ä¸ºP</span></span><br><span class="line"><span class="comment">     * 1. Pä¸ºç©ºï¼Œåˆ™æ ¹èŠ‚ç‚¹è®¾ç½®ä¸ºY</span></span><br><span class="line"><span class="comment">     * 2. Xä¸ºPçš„å·¦å­ï¼Œ åˆ™Pçš„å·¦å­è®¾ç½®ä¸ºY</span></span><br><span class="line"><span class="comment">     * 3. Xä¸ºPçš„å³å­ï¼Œåˆ™Pçš„å³å­è®¾ç½®ä¸ºY */</span></span><br><span class="line">    y.setParent(p);</span><br><span class="line">    <span class="keyword">if</span> (p == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.root = y;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (p.getLeft() == x) &#123;</span><br><span class="line">            p.setLeft(y);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            p.setRight(y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* å°†Xçš„çˆ¶äº²è®¾ç½®ä¸ºY</span></span><br><span class="line"><span class="comment">    * å°†Yçš„å³å­è®¾ç½®ä¸ºX */</span></span><br><span class="line">    x.setParent(y);</span><br><span class="line">    y.setRight(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="ğŸŒ€-å¢åˆ "><a href="#ğŸŒ€-å¢åˆ " class="headerlink" title="ğŸŒ€ å¢åˆ "></a>ğŸŒ€ å¢åˆ </h2><blockquote>
<p>â•æ’å…¥ç»“ç‚¹</p>
</blockquote>
<p>æ–°å¢ç»“ç‚¹é»˜è®¤ä¸ºçº¢è‰²ï¼Œé¿å…ç ´åé»‘è‰²å®Œç¾å¹³è¡¡ã€‚</p>
<p>é¦–å…ˆå¯»æ‰¾æ–°ç»“ç‚¹çš„æ’å…¥ä½ç½®ï¼Œå³æ‰¾åˆ°æ–°ç»“ç‚¹çš„çˆ¶äº²ï¼Œç„¶åå†³å®šå°†æ–°ç»“ç‚¹æ’å…¥åˆ°çˆ¶äº²çš„å·¦è¾¹è¿˜æ˜¯å³è¾¹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;æ’å…¥ç»“ç‚¹&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertNode</span><span class="params">(T key, D data)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> cmp;</span><br><span class="line">    RBTNode&lt;T, D&gt; x = <span class="keyword">this</span>.root;</span><br><span class="line">    RBTNode&lt;T, D&gt; y = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* å¯»æ‰¾æ–°ç»“ç‚¹çš„æ’å…¥ä½ç½® */</span></span><br><span class="line">    <span class="keyword">while</span> (x != <span class="keyword">null</span>) &#123;</span><br><span class="line">        y = x;</span><br><span class="line">        cmp = key.compareTo(x.getKey());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (cmp == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">/* keyå·²å­˜åœ¨ï¼Œç›´æ¥æ›´æ–° */</span></span><br><span class="line">            System.out.println(getCurrentTime() + <span class="string">&quot; [WARN] keyå·²å­˜åœ¨&quot;</span>);</span><br><span class="line">            System.out.println(getCurrentTime() + <span class="string">&quot; [INFO] æ›´æ–°value: &quot;</span> + get(key) + <span class="string">&quot; =&gt; &quot;</span> + data);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmp &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">/* keyè¾ƒå¤§ï¼Œç»§ç»­å‘å³æŸ¥è¯¢ */</span></span><br><span class="line">            x = x.getRight();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">/* keyè¾ƒå°ï¼Œç»§ç»­å‘å·¦æŸ¥è¯¢ */</span></span><br><span class="line">            x = x.getLeft();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* ç”Ÿæˆä¸€ä¸ªæ–°çš„ç»“ç‚¹ */</span></span><br><span class="line">    RBTNode&lt;T, D&gt; node = <span class="keyword">new</span> RBTNode&lt;&gt;(RBTColor.red, key, data, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">    System.out.println(getCurrentTime() + <span class="string">&quot; [INFO] æ–°å¢ç»“ç‚¹ (&quot;</span> + key + <span class="string">&quot;, &quot;</span> + data + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">    <span class="comment">/* æ€»ç»“ç‚¹æ•°é‡+1 */</span></span><br><span class="line">    <span class="keyword">this</span>.count.incrementAndGet();</span><br><span class="line">    <span class="comment">/* è®¾ç½®æ–°ç»“ç‚¹çš„çˆ¶äº²ä¸ºY */</span></span><br><span class="line">    node.setParent(y);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* å†æ¬¡æ¯”è¾ƒå†³å®šæ–°ç»“ç‚¹æ˜¯yçš„å·¦å­è¿˜æ˜¯å³å­*/</span></span><br><span class="line">    <span class="keyword">if</span> (y == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.root = node;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        cmp = key.compareTo(y.getKey());</span><br><span class="line">        <span class="keyword">if</span> (cmp &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            y.setRight(node);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            y.setLeft(node);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* æœ€åè¿›è¡Œè‡ªå¹³è¡¡ */</span></span><br><span class="line">    balanceInsertion(node);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>ğŸ’‰æ’å…¥ä¿®å¤</p>
</blockquote>
<p>æ’å…¥ç»“ç‚¹ä¸ºçº¢è‰²ï¼Œå› æ­¤åªæœ‰å½“çˆ¶äº²ç»“ç‚¹ä¸ºçº¢è‰²æ—¶æ‰éœ€è¦ä¿®å¤ã€‚</p>
<p>G-ç¥–çˆ¶ã€P-çˆ¶äº²ã€U-å”å”ã€C-æ’å…¥ã€‚</p>
<p>æˆ‘æ€»ç»“äº†äº”ç§æƒ…å†µä»¥åŠè§£å†³å£è¯€:</p>
<p>ï¼ˆ1ï¼‰å”å”ä¸ºçº¢</p>
<p>CASE 1</p>
<p>Description: å”å”ä¸ºçº¢</p>
<p>Solution: GPUå˜è‰²ï¼Œè‹¥ä¸æ»¡è¶³çº¢é»‘æ ‘çº¦æŸåˆ™é€’å½’å˜è‰²</p>
<p>ï¼ˆ2ï¼‰å”å”ä¸ºé»‘</p>
<p>CASE 2</p>
<p>Description: çˆ¶ä¸ºå·¦å­ï¼ŒGPCä¸‰ç‚¹ä¸€çº¿</p>
<p>Solution: å³æ—‹ç¥–çˆ¶ï¼ŒGPå˜è‰²</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">*         (<span class="number">1</span>) å³æ—‹ç¥–çˆ¶ç»“ç‚¹</span><br><span class="line">*           é»‘ç¥–                        çº¢çˆ¶</span><br><span class="line">*           / \                         / \</span><br><span class="line">*        çº¢çˆ¶  é»‘å”    --(å³æ—‹)--&gt;    çº¢æ’  é»‘ç¥–</span><br><span class="line">*         /                                 \</span><br><span class="line">*       çº¢æ’                                é»‘å”</span><br><span class="line">*         (<span class="number">2</span>) ç¥–çˆ¶å’Œçˆ¶äº²å˜è‰²</span><br><span class="line">*           çº¢çˆ¶                        é»‘çˆ¶</span><br><span class="line">*           / \                         / \</span><br><span class="line">*        çº¢æ’  é»‘ç¥–    --(å˜è‰²)--&gt;    çº¢æ’  çº¢ç¥–</span><br><span class="line">*              \                            \</span><br><span class="line">*              é»‘å”                         é»‘å”</span><br></pre></td></tr></table></figure>



<p>CASE 3: </p>
<p>Description: çˆ¶ä¸ºå·¦å­ï¼ŒGPCä¸‰è§’å…³ç³»</p>
<p>Solution: å·¦æ—‹çˆ¶äº²ï¼Œäº¤æ¢PCï¼Œå³æ—‹ç¥–çˆ¶ï¼ŒGPå˜è‰²</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">*         (<span class="number">1</span>) å·¦æ—‹çˆ¶äº²ç»“ç‚¹ï¼Œå¹¶ä¸”äº¤æ¢çˆ¶å­èº«ä»½ï¼Œæ­¤æ—¶GPCä¸‰ç‚¹ä¸€çº¿</span><br><span class="line">*          é»‘ç¥–                        é»‘ç¥–                        é»‘ç¥–</span><br><span class="line">*          / \                         / \                        / \</span><br><span class="line">*       çº¢çˆ¶  é»‘å”    --(å·¦æ—‹)--&gt;    çº¢æ’  é»‘å”    --(äº¤æ¢)--&gt;    çº¢çˆ¶  é»‘å”</span><br><span class="line">*        \                          /                           /</span><br><span class="line">*        çº¢æ’                     çº¢çˆ¶                         çº¢æ’</span><br><span class="line">*        (<span class="number">2</span>) å³æ—‹ç¥–çˆ¶ç»“ç‚¹</span><br><span class="line">*          é»‘ç¥–                        çº¢çˆ¶</span><br><span class="line">*          / \                         / \</span><br><span class="line">*       çº¢çˆ¶  é»‘å”    --(å³æ—‹)--&gt;    çº¢æ’  é»‘ç¥–</span><br><span class="line">*        /                                 \</span><br><span class="line">*      çº¢æ’                                é»‘å”</span><br><span class="line">*        (<span class="number">3</span>) ç¥–çˆ¶å’Œçˆ¶äº²å˜è‰²</span><br><span class="line">*          çº¢çˆ¶                        é»‘çˆ¶</span><br><span class="line">*          / \                         / \</span><br><span class="line">*       çº¢æ’  é»‘ç¥–    --(å˜è‰²)--&gt;    çº¢æ’  çº¢ç»„</span><br><span class="line">*              \                           \</span><br><span class="line">*              é»‘å”                        é»‘å”</span><br></pre></td></tr></table></figure>



<p>CASE 4</p>
<p>Description: çˆ¶ä¸ºå³å­ï¼ŒGPCä¸‰ç‚¹ä¸€çº¿</p>
<p>Solution: å·¦æ—‹ç¥–çˆ¶ï¼ŒGPå˜è‰²</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">*         (<span class="number">1</span>) å·¦æ—‹ç¥–çˆ¶ç»“ç‚¹</span><br><span class="line">*           é»‘ç¥–                        çº¢çˆ¶</span><br><span class="line">*           / \                         / \</span><br><span class="line">*        é»‘å”  çº¢çˆ¶    --(å³æ—‹)--&gt;    é»‘ç¥–  çº¢æ’</span><br><span class="line">*               \                     /</span><br><span class="line">*               çº¢æ’                é»‘å”</span><br><span class="line">*         (<span class="number">2</span>) ç¥–çˆ¶å’Œçˆ¶äº²å˜è‰²</span><br><span class="line">*           çº¢çˆ¶                        é»‘çˆ¶</span><br><span class="line">*           / \                         / \</span><br><span class="line">*        é»‘ç¥–  çº¢æ’    --(å˜è‰²)--&gt;    çº¢ç¥–  çº¢æ’</span><br><span class="line">*         /                           /</span><br><span class="line">*       é»‘å”                        é»‘å”</span><br></pre></td></tr></table></figure>



<p>CASE 5</p>
<p>Description: çˆ¶ä¸ºå³å­ï¼ŒGPCä¸‰è§’å…³ç³»</p>
<p>Solution: å³æ—‹çˆ¶äº²ï¼Œäº¤æ¢PCï¼Œå·¦æ—‹ç¥–çˆ¶ï¼ŒGPå˜è‰²</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">*          (<span class="number">1</span>) å³æ—‹çˆ¶äº²ç»“ç‚¹ï¼Œå¹¶ä¸”äº¤æ¢çˆ¶å­èº«ä»½ï¼Œæ­¤æ—¶GPCä¸‰ç‚¹ä¸€çº¿</span><br><span class="line">*           é»‘ç¥–                        é»‘ç¥–                        é»‘ç¥–</span><br><span class="line">*           / \                         / \                        / \</span><br><span class="line">*        é»‘å”  çº¢çˆ¶    --(å³æ—‹)--&gt;    é»‘ç¥–  çº¢æ’    --(äº¤æ¢)--&gt;    é»‘ç¥–  çº¢çˆ¶</span><br><span class="line">*              /                            \                          \</span><br><span class="line">*            çº¢æ’                           çº¢çˆ¶                        çº¢æ’</span><br><span class="line">*          (<span class="number">2</span>) å·¦æ—‹ç¥–çˆ¶</span><br><span class="line">*           é»‘ç¥–                        çº¢çˆ¶</span><br><span class="line">*           / \                         / \</span><br><span class="line">*        é»‘å”  çº¢çˆ¶    --(å·¦æ—‹)--&gt;    é»‘ç¥–  çº¢æ’</span><br><span class="line">*               \                    /</span><br><span class="line">*               çº¢æ’               é»‘å”</span><br><span class="line">*          (<span class="number">3</span>) ç¥–çˆ¶å’Œçˆ¶äº²å˜è‰²</span><br><span class="line">*           çº¢çˆ¶                        é»‘çˆ¶</span><br><span class="line">*           / \                         / \</span><br><span class="line">*        é»‘å”  çº¢æ’    --(å˜è‰²)--&gt;    çº¢ç¥–  çº¢æ’</span><br><span class="line">*         /                         /</span><br><span class="line">*       é»‘å”                      é»‘å”</span><br></pre></td></tr></table></figure>



<blockquote>
<p>â–åˆ é™¤ç»“ç‚¹</p>
</blockquote>
<p>ä¸‰ç§æƒ…å†µï¼Œè§£å†³æ–¹æ¡ˆä¸»è¦ä¸ºå¯»æ‰¾åè£”é¡¶æ›¿è‡ªå·±</p>
<p>CASE 1</p>
<p>Description: å¾…åˆ ç»“ç‚¹å·¦å­å’Œå³å­éƒ½å­˜åœ¨:</p>
<p>Solution: æ›¿ä»£ç»“ç‚¹ä¸ºå³å­æ ‘çš„æœ€å·¦å­©å­ï¼Œç„¶åè°ƒæ•´å…³ç³»</p>
<p>CASE 2:</p>
<p>Description: å¾…åˆ ç»“ç‚¹æ²¡æœ‰å·¦å­å’Œå³å­:</p>
<p>Solution: ç›´æ¥åˆ é™¤ï¼Œç„¶åè°ƒæ•´å…³ç³»</p>
<p>CASE 3:</p>
<p>Description: å¾…åˆ ç»“ç‚¹åªæœ‰å·¦å­æˆ–è€…å³å­:</p>
<p>Solution: æ›¿ä»£ç»“ç‚¹ä¸ºå­˜åœ¨çš„å­©å­ï¼Œç„¶åè°ƒæ•´å…³ç³»</p>
<blockquote>
<p>ğŸ’‰åˆ é™¤ä¿®å¤</p>
</blockquote>
<p>ä»…åˆ é™¤é»‘è‰²ç»“ç‚¹éœ€è¦ä¿®å¤ï¼Œåˆ é™¤çº¢è‰²ä¸éœ€è¦ã€‚</p>
<p>P-çˆ¶äº²ã€D-åˆ é™¤ã€B-å…„å¼Ÿã€BR-å…„å¼Ÿå³å­ã€BL-å…„å¼Ÿå·¦å­ã€‚</p>
<ul>
<li>Dä¸ºå·¦å­<ul>
<li>Bä¸ºçº¢è‰²ï¼šå·¦æ—‹çˆ¶äº²ï¼Œçˆ¶äº²æŸ“çº¢ï¼Œå…„å¼ŸæŸ“é»‘ï¼Œç„¶åcontinue</li>
<li>Bä¸ºé»‘è‰²<ul>
<li>BLä¸ºé»‘è‰²ä¸”BRé»‘è‰²ï¼šå…„å¼ŸæŸ“çº¢ï¼Œçˆ¶äº²å›æº¯</li>
<li>BLä¸ºçº¢è‰²ä¸”BRä¸ºé»‘è‰²ï¼šå³æ—‹å…„å¼Ÿï¼Œå…„å¼ŸæŸ“çº¢ï¼ŒBLæŸ“é»‘</li>
<li>BRä¸ºçº¢è‰²ï¼šå·¦æ—‹çˆ¶äº²ï¼Œçˆ¶äº²çš„é¢œè‰²ç»™å…„å¼Ÿï¼Œçˆ¶äº²é»‘åŒ–ï¼ŒBRé»‘åŒ–ï¼Œç„¶åbreak</li>
</ul>
</li>
</ul>
</li>
<li>Dä¸ºå³å­<ul>
<li>Bä¸ºçº¢è‰²ï¼šå³æ—‹çˆ¶äº²ï¼Œçˆ¶äº²æŸ“çº¢ï¼Œå…„å¼ŸæŸ“é»‘ï¼Œç„¶åcontinue</li>
<li>Bä¸ºé»‘è‰²ï¼š<ul>
<li>BLä¸ºé»‘è‰²ä¸”BRä¸ºé»‘è‰²ï¼šå…„å¼ŸæŸ“çº¢ï¼Œçˆ¶äº²å›æº¯</li>
<li>BLä¸ºçº¢è‰²ä¸”BRä¸ºé»‘è‰²ï¼šå·¦æ—‹å…„å¼Ÿï¼Œçˆ¶äº²æŸ“çº¢ï¼ŒBRæŸ“é»‘</li>
<li>BLä¸ºçº¢è‰²ï¼šå³æ—‹çˆ¶äº²ï¼Œçˆ¶äº²çš„é¢œè‰²ç»™å…„å¼Ÿï¼Œçˆ¶äº²é»‘åŒ–ï¼ŒBLé»‘åŒ–ï¼Œç„¶åbreak</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="ğŸ“‘-æºç "><a href="#ğŸ“‘-æºç " class="headerlink" title="ğŸ“‘ æºç "></a>ğŸ“‘ æºç </h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.DataStructures.RBTree;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicLong;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: Algorithm &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.DataStructures.RBTree &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: RBTree &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: çº¢é»‘æ ‘ &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/11/5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* çº¢é»‘é¢œè‰² */</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">RBTColor</span> </span>&#123;</span><br><span class="line">    red,</span><br><span class="line">    black</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* çº¢é»‘ç»“ç‚¹ */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RBTNode</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">T</span>&gt;, <span class="title">D</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* ç»“ç‚¹é¢œè‰² */</span></span><br><span class="line">    <span class="keyword">private</span> RBTColor color;</span><br><span class="line">    <span class="comment">/* ç»“ç‚¹é”®å€¼ */</span></span><br><span class="line">    <span class="keyword">private</span> T key;</span><br><span class="line">    <span class="comment">/* ç»“ç‚¹æ•°æ® */</span></span><br><span class="line">    <span class="keyword">private</span> D data;</span><br><span class="line">    <span class="comment">/* çˆ¶äº²ç»“ç‚¹ */</span></span><br><span class="line">    <span class="keyword">private</span> RBTNode&lt;T, D&gt; parent;</span><br><span class="line">    <span class="comment">/* å·¦å­ç»“ç‚¹ */</span></span><br><span class="line">    <span class="keyword">private</span> RBTNode left;</span><br><span class="line">    <span class="comment">/* å³å­ç»“ç‚¹ */</span></span><br><span class="line">    <span class="keyword">private</span> RBTNode right;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RBTNode</span><span class="params">(RBTColor color, T key, D data, RBTNode&lt;T, D&gt; parent, RBTNode left, RBTNode right)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">        <span class="keyword">this</span>.key = key;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">        <span class="keyword">this</span>.parent = parent;</span><br><span class="line">        <span class="keyword">this</span>.left = left;</span><br><span class="line">        <span class="keyword">this</span>.right = right;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RBTColor <span class="title">getColor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> color;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setColor</span><span class="params">(RBTColor color)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateColor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.color == RBTColor.red) &#123;</span><br><span class="line">            <span class="keyword">this</span>.color = RBTColor.black;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.color = RBTColor.red;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> key;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setKey</span><span class="params">(T key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.key = key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> D <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(D data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RBTNode&lt;T, D&gt; <span class="title">getParent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> parent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setParent</span><span class="params">(RBTNode&lt;T, D&gt; parent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.parent = parent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RBTNode <span class="title">getLeft</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> left;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLeft</span><span class="params">(RBTNode left)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.left = left;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RBTNode <span class="title">getRight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> right;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRight</span><span class="params">(RBTNode right)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.right = right;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;RBTNode[&quot;</span> +</span><br><span class="line">                <span class="string">&quot;color=&quot;</span> + color +</span><br><span class="line">                <span class="string">&quot;, key=&quot;</span> + key +</span><br><span class="line">                <span class="string">&quot;, data=&quot;</span> + data +</span><br><span class="line">                <span class="string">&#x27;]&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* çº¢é»‘æ ‘ */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedBlackTree</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">T</span>&gt;, <span class="title">D</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* æ—¶é—´æ ¼å¼ */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> SimpleDateFormat SDF = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* æ ¹èŠ‚ç‚¹ */</span></span><br><span class="line">    <span class="keyword">private</span> RBTNode&lt;T, D&gt; root;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* æ ‘ç»“ç‚¹æ•°é‡ */</span></span><br><span class="line">    <span class="keyword">private</span> AtomicLong count = <span class="keyword">new</span> AtomicLong(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;è·å–æ—¶é—´&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getCurrentTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SDF.format(<span class="keyword">new</span> Date());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;å¤§å°&lt;p/&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> count.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;æŸ¥è¯¢&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> D <span class="title">get</span><span class="params">(T key)</span> </span>&#123;</span><br><span class="line">        RBTNode&lt;T, D&gt; node = search(key, <span class="keyword">this</span>.root);</span><br><span class="line">        <span class="keyword">return</span> node == <span class="keyword">null</span> ? <span class="keyword">null</span> : node.getData();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;æ’å…¥&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(T key, D data)</span> </span>&#123;</span><br><span class="line">        insertNode(key, data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;åˆ é™¤&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">del</span><span class="params">(T key)</span> </span>&#123;</span><br><span class="line">        RBTNode&lt;T, D&gt; node = search(key, <span class="keyword">this</span>.root);</span><br><span class="line">        <span class="keyword">if</span> (node != <span class="keyword">null</span>) &#123;</span><br><span class="line">            deleteNode(node);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(getCurrentTime() + <span class="string">&quot; [ERROR] &quot;</span> + <span class="string">&quot;keyä¸º&quot;</span> + key + <span class="string">&quot;çš„ç»“ç‚¹ä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;root-getter&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RBTNode&lt;T, D&gt; <span class="title">getRoot</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;åˆ¤æ–­ç»“ç‚¹æ˜¯å¦ä¸ºçº¢è‰²&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">isRed</span><span class="params">(RBTNode&lt;T, D&gt; node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (node != <span class="keyword">null</span> &amp;&amp; node.getColor() == RBTColor.red) ? <span class="keyword">true</span> : <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;åˆ¤æ–­ç»“ç‚¹æ˜¯å¦ä¸ºé»‘è‰²&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">isBlack</span><span class="params">(RBTNode&lt;T, D&gt; node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (node == <span class="keyword">null</span> || node.getColor() == RBTColor.black) ? <span class="keyword">true</span> : <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;æŸ¥è¯¢keyå€¼çš„ç»“ç‚¹&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;é€’å½’æŸ¥è¯¢: æ¯”è¾ƒkeyï¼Œç›¸ç­‰ç›´æ¥è¿”å›ï¼Œè¿‡å¤§åˆ™ç»§ç»­å‘å³ï¼Œè¿‡å°åˆ™ç»§ç»­å‘å·¦&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RBTNode&lt;T, D&gt; <span class="title">search</span><span class="params">(T key, RBTNode&lt;T, D&gt; node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> cmp = key.compareTo(node.getKey());</span><br><span class="line">            <span class="keyword">if</span> (cmp == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> node;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmp &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> search(key, node.getRight());</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> search(key, node.getLeft());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;å·¦æ—‹&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;è¿‡ç¨‹ï¼šçˆ¶äº²ä¸‹æ²‰ï¼Œå³å­ä¸Šå‡ï¼Œå³å­çš„å·¦å­å˜ä¸ºåŸçˆ¶çš„å³å­&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     *     å·¦æ—‹Xç»“ç‚¹</span></span><br><span class="line"><span class="comment">     *             P                                P</span></span><br><span class="line"><span class="comment">     *            /                                /</span></span><br><span class="line"><span class="comment">     *           X                                Y</span></span><br><span class="line"><span class="comment">     *         /  \        --(å·¦æ—‹)--&gt;           / \</span></span><br><span class="line"><span class="comment">     *       lX    Y                           X  rY</span></span><br><span class="line"><span class="comment">     *            / \                        /  \</span></span><br><span class="line"><span class="comment">     *          lY   r                      lX  lY</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> x</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">leftRotate</span><span class="params">(RBTNode&lt;T, D&gt; x)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/* å³å­ç»“ç‚¹ */</span></span><br><span class="line">        RBTNode&lt;T, D&gt; y = x.getRight();</span><br><span class="line">        <span class="comment">/* çˆ¶äº²ç»“ç‚¹ */</span></span><br><span class="line">        RBTNode&lt;T, D&gt; p = x.getParent();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Yçš„å·¦å­ å˜æˆ Xçš„å³å­</span></span><br><span class="line"><span class="comment">        * è‹¥Xä¸Yçš„å·¦å­ä¸ä¸ºç©º</span></span><br><span class="line"><span class="comment">        * åˆ™è®¾ç½®Yçš„å·¦å­çš„çˆ¶äº²ä¸ºX */</span></span><br><span class="line">        x.setRight(y.getLeft());</span><br><span class="line">        <span class="keyword">if</span> (y.getLeft() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            y.getLeft().setParent(x);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* è®¾ç½®Yçš„çˆ¶äº²ä¸ºP</span></span><br><span class="line"><span class="comment">        * 1. Pä¸ºç©ºï¼Œåˆ™æ ¹èŠ‚ç‚¹è®¾ç½®ä¸ºY</span></span><br><span class="line"><span class="comment">        * 2. Xä¸ºPçš„å·¦å­ï¼Œ åˆ™Pçš„å·¦å­è®¾ç½®ä¸ºY</span></span><br><span class="line"><span class="comment">        * 3. Xä¸ºPçš„å³å­ï¼Œåˆ™Pçš„å³å­è®¾ç½®ä¸ºY */</span></span><br><span class="line">        y.setParent(p);</span><br><span class="line">        <span class="keyword">if</span> (p == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.root = y;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (p.getLeft() == x) &#123;</span><br><span class="line">                p.setLeft(y);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                p.setRight(y);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* å°†Xçš„çˆ¶äº²è®¾ç½®ä¸ºY</span></span><br><span class="line"><span class="comment">        * å°†Yçš„å·¦å­è®¾ç½®ä¸ºX */</span></span><br><span class="line">        x.setParent(y);</span><br><span class="line">        y.setLeft(x);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;å³æ—‹&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;è¿‡ç¨‹ï¼šçˆ¶äº²ä¸‹æ²‰ï¼Œå·¦å­ä¸Šå‡ï¼Œå·¦å­çš„å³å­å˜æˆåŸçˆ¶çš„å·¦å­&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     *     å³æ—‹Xç»“ç‚¹</span></span><br><span class="line"><span class="comment">     *             P                                P</span></span><br><span class="line"><span class="comment">     *            /                                /</span></span><br><span class="line"><span class="comment">     *           X                                Y</span></span><br><span class="line"><span class="comment">     *         /  \        --(å³æ—‹)--&gt;           /  \</span></span><br><span class="line"><span class="comment">     *        Y   rX                           lY   X</span></span><br><span class="line"><span class="comment">     *       / \                                   / \</span></span><br><span class="line"><span class="comment">     *     lY  rY                                rY  rX</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> x</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rightRotate</span><span class="params">(RBTNode&lt;T, D&gt; x)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/* å·¦å­ç»“ç‚¹ */</span></span><br><span class="line">        RBTNode&lt;T, D&gt; y = x.getLeft();</span><br><span class="line">        <span class="comment">/* çˆ¶äº²ç»“ç‚¹ */</span></span><br><span class="line">        RBTNode&lt;T, D&gt; p = x.getParent();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Yçš„å³å­ å˜æˆ Xçš„å·¦å­</span></span><br><span class="line"><span class="comment">        * è‹¥Yçš„å³å­ä¸ä¸ºç©º</span></span><br><span class="line"><span class="comment">        * åˆ™è®¾ç½®Yçš„å³å­çš„çˆ¶äº²ä¸ºX */</span></span><br><span class="line">        x.setLeft(y.getRight());</span><br><span class="line">        <span class="keyword">if</span> (y.getRight() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            y.getRight().setParent(x);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* è®¾ç½®Yçš„çˆ¶äº²ä¸ºP</span></span><br><span class="line"><span class="comment">         * 1. Pä¸ºç©ºï¼Œåˆ™æ ¹èŠ‚ç‚¹è®¾ç½®ä¸ºY</span></span><br><span class="line"><span class="comment">         * 2. Xä¸ºPçš„å·¦å­ï¼Œ åˆ™Pçš„å·¦å­è®¾ç½®ä¸ºY</span></span><br><span class="line"><span class="comment">         * 3. Xä¸ºPçš„å³å­ï¼Œåˆ™Pçš„å³å­è®¾ç½®ä¸ºY */</span></span><br><span class="line">        y.setParent(p);</span><br><span class="line">        <span class="keyword">if</span> (p == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.root = y;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (p.getLeft() == x) &#123;</span><br><span class="line">                p.setLeft(y);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                p.setRight(y);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* å°†Xçš„çˆ¶äº²è®¾ç½®ä¸ºY</span></span><br><span class="line"><span class="comment">        * å°†Yçš„å³å­è®¾ç½®ä¸ºX */</span></span><br><span class="line">        x.setParent(y);</span><br><span class="line">        y.setRight(x);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;æ’å…¥ç»“ç‚¹&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">insertNode</span><span class="params">(T key, D data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> cmp;</span><br><span class="line">        RBTNode&lt;T, D&gt; x = <span class="keyword">this</span>.root;</span><br><span class="line">        RBTNode&lt;T, D&gt; y = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* å¯»æ‰¾æ–°ç»“ç‚¹çš„æ’å…¥ä½ç½® */</span></span><br><span class="line">        <span class="keyword">while</span> (x != <span class="keyword">null</span>) &#123;</span><br><span class="line">            y = x;</span><br><span class="line">            cmp = key.compareTo(x.getKey());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (cmp == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">/* keyå·²å­˜åœ¨ï¼Œç›´æ¥æ›´æ–° */</span></span><br><span class="line">                System.out.println(getCurrentTime() + <span class="string">&quot; [WARN] keyå·²å­˜åœ¨&quot;</span>);</span><br><span class="line">                System.out.println(getCurrentTime() + <span class="string">&quot; [INFO] æ›´æ–°value: &quot;</span> + get(key) + <span class="string">&quot; =&gt; &quot;</span> + data);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmp &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="comment">/* keyè¾ƒå¤§ï¼Œç»§ç»­å‘å³æŸ¥è¯¢ */</span></span><br><span class="line">                x = x.getRight();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">/* keyè¾ƒå°ï¼Œç»§ç»­å‘å·¦æŸ¥è¯¢ */</span></span><br><span class="line">                x = x.getLeft();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* ç”Ÿæˆä¸€ä¸ªæ–°çš„ç»“ç‚¹ */</span></span><br><span class="line">        RBTNode&lt;T, D&gt; node = <span class="keyword">new</span> RBTNode&lt;&gt;(RBTColor.red, key, data, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">        System.out.println(getCurrentTime() + <span class="string">&quot; [INFO] æ–°å¢ç»“ç‚¹ (&quot;</span> + key + <span class="string">&quot;, &quot;</span> + data + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">        <span class="comment">/* æ€»ç»“ç‚¹æ•°é‡+1 */</span></span><br><span class="line">        <span class="keyword">this</span>.count.incrementAndGet();</span><br><span class="line">        <span class="comment">/* è®¾ç½®æ–°ç»“ç‚¹çš„çˆ¶äº²ä¸ºY */</span></span><br><span class="line">        node.setParent(y);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* å†æ¬¡æ¯”è¾ƒå†³å®šæ–°ç»“ç‚¹æ˜¯yçš„å·¦å­è¿˜æ˜¯å³å­*/</span></span><br><span class="line">        <span class="keyword">if</span> (y == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.root = node;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            cmp = key.compareTo(y.getKey());</span><br><span class="line">            <span class="keyword">if</span> (cmp &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                y.setRight(node);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                y.setLeft(node);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* æœ€åè¿›è¡Œè‡ªå¹³è¡¡ */</span></span><br><span class="line">        balanceInsertion(node);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;æ’å…¥ç»“ç‚¹çš„è‡ªå¹³è¡¡æ“ä½œ&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;ç”±äºæ’å…¥èŠ‚ç‚¹é»˜è®¤é¢œè‰²ä¸ºçº¢è‰²ï¼Œæ‰€ä»¥åªæœ‰çˆ¶ç»“ç‚¹ä¸ºçº¢è‰²æ—¶å€™æ‰éœ€è¦ä¿®å¤</span></span><br><span class="line"><span class="comment">     *   åˆ†ä¸‰ç§æƒ…å†µè®¨è®º&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * &lt;li&gt;case1. å”å”ç»“ç‚¹ä¹Ÿä¸ºçº¢è‰²&lt;/li&gt;</span></span><br><span class="line"><span class="comment">     * &lt;li&gt;case2. å”å”ç»“ç‚¹ä¸ºç©ºï¼Œä¸”ç¥–çˆ¶å­ä¸‰ç‚¹ä¸€çº¿&lt;/li&gt;</span></span><br><span class="line"><span class="comment">     * &lt;li&gt;case3. å”å”ç»“ç‚¹ä¸ºç©ºï¼Œä¸”ç¥–çˆ¶å­ä¸‰è§’å…³ç³»&lt;/li&gt;</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;G-ç¥–çˆ¶ã€P-çˆ¶äº²ã€U-å”å”ã€C-æ’å…¥&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">balanceInsertion</span><span class="params">(RBTNode&lt;T, D&gt; node)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/* çˆ¶äº² Â· ç¥–çˆ¶ */</span></span><br><span class="line">        RBTNode&lt;T, D&gt; paren, grand;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* å½“çˆ¶äº²èŠ‚ç‚¹ä¸ºé»‘è‰²æ—¶ï¼Œç»“æŸä¿®å¤ */</span></span><br><span class="line">        <span class="keyword">while</span> (((paren = node.getParent()) != <span class="keyword">null</span>) &amp;&amp; isRed(paren)) &#123;</span><br><span class="line">            grand = paren.getParent();</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* ç¡®å®šçˆ¶äº²å’Œå”å”çš„å·¦å³å…³ç³» */</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">/* CASE: çˆ¶å·¦å”å³ */</span></span><br><span class="line">            <span class="keyword">if</span> (grand.getLeft() == paren) &#123;</span><br><span class="line">                RBTNode&lt;T, D&gt; uncle = grand.getRight();</span><br><span class="line"></span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                 * case1: PUåŒçº¢</span></span><br><span class="line"><span class="comment">                 * solution1: GPUå˜è‰²</span></span><br><span class="line"><span class="comment">                 * å¦‚æœæ­¤æ—¶æ•´æ£µæ ‘ä¸æ»¡è¶³çº¦æŸï¼Œåˆ™é€’å½’è¿›è¡ŒGPUå˜è‰²</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="keyword">if</span> (isRed(uncle)) &#123;</span><br><span class="line">                    grand.setColor(RBTColor.red);</span><br><span class="line">                    paren.setColor(RBTColor.black);</span><br><span class="line">                    uncle.setColor(RBTColor.black);</span><br><span class="line">                    node = grand;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                 * case2: Pçº¢Ué»‘ï¼Œçˆ¶ä¸ºå·¦å­ï¼ŒGPCä¸‰ç‚¹ä¸€çº¿</span></span><br><span class="line"><span class="comment">                 * solution2: å³æ—‹ç¥–çˆ¶ï¼ŒGPå˜è‰²</span></span><br><span class="line"><span class="comment">                 *         (1) å³æ—‹ç¥–çˆ¶ç»“ç‚¹</span></span><br><span class="line"><span class="comment">                 *           é»‘ç¥–                        çº¢çˆ¶</span></span><br><span class="line"><span class="comment">                 *           / \                         / \</span></span><br><span class="line"><span class="comment">                 *        çº¢çˆ¶  é»‘å”    --(å³æ—‹)--&gt;    çº¢æ’  é»‘ç¥–</span></span><br><span class="line"><span class="comment">                 *         /                                 \</span></span><br><span class="line"><span class="comment">                 *       çº¢æ’                                é»‘å”</span></span><br><span class="line"><span class="comment">                 *         (2) ç¥–çˆ¶å’Œçˆ¶äº²å˜è‰²</span></span><br><span class="line"><span class="comment">                 *           çº¢çˆ¶                        é»‘çˆ¶</span></span><br><span class="line"><span class="comment">                 *           / \                         / \</span></span><br><span class="line"><span class="comment">                 *        çº¢æ’  é»‘ç¥–    --(å˜è‰²)--&gt;    çº¢æ’  çº¢ç¥–</span></span><br><span class="line"><span class="comment">                 *              \                            \</span></span><br><span class="line"><span class="comment">                 *              é»‘å”                         é»‘å”</span></span><br><span class="line"><span class="comment">                 *</span></span><br><span class="line"><span class="comment">                 *</span></span><br><span class="line"><span class="comment">                * case3: Pçº¢Ué»‘ï¼Œçˆ¶ä¸ºå·¦å­ï¼ŒGPCä¸‰è§’å…³ç³»</span></span><br><span class="line"><span class="comment">                * solution3: å·¦æ—‹çˆ¶äº²ï¼Œäº¤æ¢PCï¼Œå³æ—‹ç¥–çˆ¶ï¼ŒGPå˜è‰²</span></span><br><span class="line"><span class="comment">                *         (1) å·¦æ—‹çˆ¶äº²ç»“ç‚¹ï¼Œå¹¶ä¸”äº¤æ¢çˆ¶å­èº«ä»½ï¼Œæ­¤æ—¶GPCä¸‰ç‚¹ä¸€çº¿</span></span><br><span class="line"><span class="comment">                *          é»‘ç¥–                        é»‘ç¥–                        é»‘ç¥–</span></span><br><span class="line"><span class="comment">                *          / \                         / \                        / \</span></span><br><span class="line"><span class="comment">                *       çº¢çˆ¶  é»‘å”    --(å·¦æ—‹)--&gt;    çº¢æ’  é»‘å”    --(äº¤æ¢)--&gt;    çº¢çˆ¶  é»‘å”</span></span><br><span class="line"><span class="comment">                *        \                          /                           /</span></span><br><span class="line"><span class="comment">                *        çº¢æ’                     çº¢çˆ¶                         çº¢æ’</span></span><br><span class="line"><span class="comment">                *        (2) å³æ—‹ç¥–çˆ¶ç»“ç‚¹</span></span><br><span class="line"><span class="comment">                *          é»‘ç¥–                        çº¢çˆ¶</span></span><br><span class="line"><span class="comment">                *          / \                         / \</span></span><br><span class="line"><span class="comment">                *       çº¢çˆ¶  é»‘å”    --(å³æ—‹)--&gt;    çº¢æ’  é»‘ç¥–y</span></span><br><span class="line"><span class="comment">                *        /                                 \</span></span><br><span class="line"><span class="comment">                *      çº¢æ’                                é»‘å”</span></span><br><span class="line"><span class="comment">                *        (3) ç¥–çˆ¶å’Œçˆ¶äº²å˜è‰²</span></span><br><span class="line"><span class="comment">                *          çº¢çˆ¶                        é»‘</span></span><br><span class="line"><span class="comment">                *          / \                         / \</span></span><br><span class="line"><span class="comment">                *       çº¢æ’  é»‘ç¥–    --(å˜è‰²)--&gt;    çº¢æ’  çº¢ç»„</span></span><br><span class="line"><span class="comment">                *              \                           \</span></span><br><span class="line"><span class="comment">                *              é»‘å”                        é»‘å”</span></span><br><span class="line"><span class="comment">                 *</span></span><br><span class="line"><span class="comment">                 * attention:</span></span><br><span class="line"><span class="comment">                 * ä¸‰è§’å…³ç³»ç»è¿‡ä¸€æ­¥æ—‹è½¬å³å¯è½¬æ¢æˆä¸‰ç‚¹ä¸€çº¿</span></span><br><span class="line"><span class="comment">                 * å› æ­¤case3å…ˆç»è¿‡ä¸€æ­¥å¤„ç†åˆ°case2ï¼Œå†è¿›è¡Œcase2çš„å¤„ç†</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (paren.getRight() == node) &#123; <span class="comment">// case3</span></span><br><span class="line">                        leftRotate(paren);</span><br><span class="line">                        RBTNode&lt;T, D&gt; temp = node;</span><br><span class="line">                        node = paren;</span><br><span class="line">                        paren = temp;</span><br><span class="line">                    &#125; <span class="comment">// case2</span></span><br><span class="line">                    rightRotate(grand);</span><br><span class="line">                    grand.updateColor();</span><br><span class="line">                    paren.updateColor();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">/* CASE: çˆ¶å³å”å·¦ */</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                RBTNode&lt;T, D&gt; uncle = grand.getLeft();</span><br><span class="line"></span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                 * case1: PUåŒçº¢(çˆ¶äº²å’Œå”å”éƒ½ä¸ºçº¢è‰²)</span></span><br><span class="line"><span class="comment">                 * solution1: GPUå˜è‰²(ç¥–çˆ¶å˜ä¸ºçº¢è‰²ï¼Œçˆ¶äº²å’Œå”å”éƒ½å˜ä¸ºé»‘è‰²)</span></span><br><span class="line"><span class="comment">                 * å¦‚æœæ­¤æ—¶æ•´æ£µæ ‘ä¸æ»¡è¶³çº¦æŸï¼Œåˆ™é€’å½’è¿›è¡ŒGPUå˜è‰²</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="keyword">if</span> (isRed(uncle)) &#123;</span><br><span class="line">                    grand.setColor(RBTColor.red);</span><br><span class="line">                    paren.setColor(RBTColor.black);</span><br><span class="line">                    uncle.setColor(RBTColor.black);</span><br><span class="line">                    node = grand;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                 * case4: Pçº¢Ué»‘ï¼Œçˆ¶ä¸ºå·¦å­ï¼ŒGPCä¸‰ç‚¹ä¸€çº¿</span></span><br><span class="line"><span class="comment">                 * solution4: å·¦æ—‹ç¥–çˆ¶ï¼ŒGPå˜è‰²</span></span><br><span class="line"><span class="comment">                 *         (1) å·¦æ—‹ç¥–çˆ¶ç»“ç‚¹</span></span><br><span class="line"><span class="comment">                 *           é»‘ç¥–                        çº¢çˆ¶</span></span><br><span class="line"><span class="comment">                 *           / \                         / \</span></span><br><span class="line"><span class="comment">                 *        é»‘å”  çº¢çˆ¶    --(å³æ—‹)--&gt;    é»‘ç¥–  çº¢æ’</span></span><br><span class="line"><span class="comment">                 *               \                     /</span></span><br><span class="line"><span class="comment">                 *               çº¢æ’                é»‘å”</span></span><br><span class="line"><span class="comment">                 *          (2) ç¥–çˆ¶å’Œçˆ¶äº²å˜è‰²</span></span><br><span class="line"><span class="comment">                 *           çº¢çˆ¶                        é»‘çˆ¶</span></span><br><span class="line"><span class="comment">                 *           / \                         / \</span></span><br><span class="line"><span class="comment">                 *        é»‘ç¥–  çº¢æ’    --(å˜è‰²)--&gt;    çº¢ç¥–  çº¢æ’</span></span><br><span class="line"><span class="comment">                 *         /                           /</span></span><br><span class="line"><span class="comment">                 *       é»‘å”                        é»‘å”</span></span><br><span class="line"><span class="comment">                 *</span></span><br><span class="line"><span class="comment">                 * case5: Pçº¢Ué»‘ï¼Œçˆ¶ä¸ºå³å­ï¼ŒGPCä¸‰è§’å…³ç³»</span></span><br><span class="line"><span class="comment">                 * solution5: å³æ—‹çˆ¶äº²ï¼Œäº¤æ¢PCï¼Œå·¦æ—‹ç¥–çˆ¶ï¼ŒGPå˜è‰²</span></span><br><span class="line"><span class="comment">                 *          (1) å³æ—‹çˆ¶äº²ç»“ç‚¹ï¼Œå¹¶ä¸”äº¤æ¢çˆ¶å­èº«ä»½ï¼Œæ­¤æ—¶GPCä¸‰ç‚¹ä¸€çº¿</span></span><br><span class="line"><span class="comment">                 *           é»‘ç¥–                        é»‘ç¥–                        é»‘ç¥–</span></span><br><span class="line"><span class="comment">                 *           / \                         / \                        / \</span></span><br><span class="line"><span class="comment">                 *        é»‘å”  çº¢çˆ¶    --(å³æ—‹)--&gt;    é»‘ç¥–  çº¢æ’    --(äº¤æ¢)--&gt;    é»‘ç¥–  çº¢çˆ¶</span></span><br><span class="line"><span class="comment">                 *              /                            \                          \</span></span><br><span class="line"><span class="comment">                 *            çº¢æ’                           çº¢çˆ¶                        çº¢æ’</span></span><br><span class="line"><span class="comment">                 *          (2) å·¦æ—‹ç¥–çˆ¶</span></span><br><span class="line"><span class="comment">                 *           é»‘ç¥–                        çº¢çˆ¶</span></span><br><span class="line"><span class="comment">                 *           / \                         / \</span></span><br><span class="line"><span class="comment">                 *        é»‘å”  çº¢çˆ¶    --(å·¦æ—‹)--&gt;    é»‘ç¥–  çº¢æ’</span></span><br><span class="line"><span class="comment">                 *               \                    /</span></span><br><span class="line"><span class="comment">                 *               çº¢æ’               é»‘å”</span></span><br><span class="line"><span class="comment">                 *          (3) ç¥–çˆ¶å’Œçˆ¶äº²å˜è‰²</span></span><br><span class="line"><span class="comment">                 *           çº¢çˆ¶                        é»‘çˆ¶</span></span><br><span class="line"><span class="comment">                 *           / \                         / \</span></span><br><span class="line"><span class="comment">                 *        é»‘å”  çº¢æ’    --(å˜è‰²)--&gt;    çº¢ç¥–  çº¢æ’</span></span><br><span class="line"><span class="comment">                 *         /                         /</span></span><br><span class="line"><span class="comment">                 *       é»‘å”                      é»‘å”</span></span><br><span class="line"><span class="comment">                 *</span></span><br><span class="line"><span class="comment">                 * attention:</span></span><br><span class="line"><span class="comment">                 * ä¸‰è§’å…³ç³»ç»è¿‡ä¸€æ­¥æ—‹è½¬å³å¯è½¬æ¢æˆä¸‰ç‚¹ä¸€çº¿</span></span><br><span class="line"><span class="comment">                 * å› æ­¤case3å…ˆç»è¿‡ä¸€æ­¥å¤„ç†åˆ°case2ï¼Œå†è¿›è¡Œcase2çš„å¤„ç†</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (paren.getLeft() == node) &#123; <span class="comment">// case3</span></span><br><span class="line">                        rightRotate(paren);</span><br><span class="line">                        RBTNode&lt;T, D&gt; temp = node;</span><br><span class="line">                        node = paren;</span><br><span class="line">                        paren = temp;</span><br><span class="line">                    &#125; <span class="comment">// case2</span></span><br><span class="line">                    leftRotate(grand);</span><br><span class="line">                    grand.updateColor();</span><br><span class="line">                    paren.updateColor();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* ä¿è¯æ ¹èŠ‚ç‚¹ä¸ºé»‘è‰² */</span></span><br><span class="line">        <span class="keyword">if</span> (root == node) &#123;</span><br><span class="line">            node.setColor(RBTColor.black);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;åˆ é™¤ç»“ç‚¹&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;ä¸‰ç§æƒ…å†µ&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * &lt;li&gt;case1. å¾…åˆ ç»“ç‚¹å·¦å­å’Œå³å­éƒ½å­˜åœ¨&lt;/li&gt;</span></span><br><span class="line"><span class="comment">     * &lt;li&gt;case2. å¾…åˆ ç»“ç‚¹æ²¡æœ‰å·¦å­å’Œå³å­&lt;/li&gt;</span></span><br><span class="line"><span class="comment">     * &lt;li&gt;case3. å¾…åˆ ç»“ç‚¹åªæœ‰å·¦å­æˆ–è€…å³å­&lt;/li&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">deleteNode</span><span class="params">(RBTNode&lt;T, D&gt; node)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/* çˆ¶äº² Â· å„¿å­ Â· ç»§æ‰¿è€… */</span></span><br><span class="line">        RBTNode&lt;T, D&gt; paren, child, replace;</span><br><span class="line">        RBTColor color;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * case1: å¾…åˆ ç»“ç‚¹å·¦å­å’Œå³å­éƒ½å­˜åœ¨</span></span><br><span class="line"><span class="comment">         * solution1:</span></span><br><span class="line"><span class="comment">         * - æ‰¾åˆ°è¯¥ç»“ç‚¹çš„å³å­æ ‘ä¸­çš„æœ€å·¦å­ç»“ç‚¹</span></span><br><span class="line"><span class="comment">         * - æŠŠå®ƒçš„å€¼å’Œè¦åˆ é™¤çš„ç»“ç‚¹çš„å€¼è¿›è¡Œäº¤æ¢</span></span><br><span class="line"><span class="comment">         * - ç„¶ååˆ é™¤è¿™ä¸ªç»“ç‚¹å³ç›¸å½“äºåˆ é™¤æ‰€éœ€åˆ é™¤ç»“ç‚¹</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span> ((node.getLeft() != <span class="keyword">null</span>) &amp;&amp; (node.getRight() != <span class="keyword">null</span>))  &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/*  è·å–å…¶åç»§ç»“ç‚¹: å³å­æ ‘ä¸­çš„æœ€å·¦å­ç»“ç‚¹ */</span></span><br><span class="line">            replace = descendants(node);</span><br><span class="line">            paren = replace.getParent();</span><br><span class="line">            child = replace.getRight();</span><br><span class="line">            color = replace.getColor();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (node == replace.getParent()) &#123;</span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                 * case:</span></span><br><span class="line"><span class="comment">                 *    node              replace</span></span><br><span class="line"><span class="comment">                 *      \                  \</span></span><br><span class="line"><span class="comment">                 *      replace    --&gt;    child</span></span><br><span class="line"><span class="comment">                 *         \</span></span><br><span class="line"><span class="comment">                 *         child</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                paren = replace;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                 * case:</span></span><br><span class="line"><span class="comment">                 *     node                replace</span></span><br><span class="line"><span class="comment">                 *       \                   \</span></span><br><span class="line"><span class="comment">                 *        X                   X</span></span><br><span class="line"><span class="comment">                 *       / \                 / \</span></span><br><span class="line"><span class="comment">                 *  paren   X    --&gt;    paren   X</span></span><br><span class="line"><span class="comment">                 *     /                  /</span></span><br><span class="line"><span class="comment">                 *  replace            child</span></span><br><span class="line"><span class="comment">                 *     \</span></span><br><span class="line"><span class="comment">                 *     child</span></span><br><span class="line"><span class="comment">                 *</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="comment">/* å»ºç«‹æ›¿ä»£ç»“ç‚¹çš„çˆ¶äº²ä¸æ›¿æ¢ç»“ç‚¹çš„å³å­çš„çˆ¶å­å…³ç³»ï¼Œå³çˆ·å­™å¤‰çˆ¶å­ */</span></span><br><span class="line">                <span class="keyword">if</span> (child != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    child.setParent(replace.getParent());</span><br><span class="line">                &#125;</span><br><span class="line">                replace.getParent().setLeft(child);</span><br><span class="line">                <span class="comment">/* å»ºç«‹æ›¿ä»£èŠ‚ç‚¹ä¸å¾…åˆ èŠ‚ç‚¹çš„å³å­çš„çˆ¶å­å…³ç³» */</span></span><br><span class="line">                replace.setRight(node.getRight());</span><br><span class="line">                node.getRight().setParent(replace);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* å¾…åˆ èŠ‚ç‚¹çš„çˆ¶äº²è®¾ç½®ä¸ºæ›¿ä»£ç»“ç‚¹çš„çˆ¶äº² */</span></span><br><span class="line">            replace.setParent(node.getParent());</span><br><span class="line">            <span class="comment">/* å»ºç«‹æ›¿æ¢ç»“ç‚¹ä¸å¾…åˆ èŠ‚ç‚¹å·¦å­çš„çˆ¶å­å…³ç³» */</span></span><br><span class="line">            replace.setLeft(node.getLeft());</span><br><span class="line">            node.getLeft().setParent(replace);</span><br><span class="line">            <span class="comment">/* æ›¿ä»£ç»“ç‚¹æ²¿ç”¨å¾…åˆ èŠ‚ç‚¹çš„é¢œè‰² */</span></span><br><span class="line">            replace.setColor(node.getColor());</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* å¾…åˆ ç»“ç‚¹çš„çˆ¶äº²ä¸ä¸ºç©ºï¼Œåˆ™è°ƒæ•´å·¦å³å­ */</span></span><br><span class="line">            <span class="keyword">if</span> (node.getParent() != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (node.getParent().getLeft() == node) &#123;</span><br><span class="line">                    node.getParent().setLeft(replace);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    node.getParent().setRight(replace);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">/* å¾…åˆ ç»“ç‚¹çš„çˆ¶äº²ä¸ºç©ºï¼Œåˆ™è®¾ç½®æ ¹ç»“ç‚¹ */</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.root = replace;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* åˆ é™¤é»‘è‰²ç»“ç‚¹éœ€è¦è°ƒæ•´å¹³è¡¡ï¼Œçº¢è‰²ä¸éœ€è¦ */</span></span><br><span class="line">            <span class="keyword">if</span> (color == RBTColor.black) &#123;</span><br><span class="line">                balanceDeletion(child, paren);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * case2: å¾…åˆ ç»“ç‚¹æ²¡æœ‰å·¦å­å’Œå³å­</span></span><br><span class="line"><span class="comment">         * solution2: ç›´æ¥åˆ é™¤ç»“ç‚¹</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>((node.getLeft() == <span class="keyword">null</span>) &amp;&amp; (node.getRight() == <span class="keyword">null</span>)) &#123;</span><br><span class="line">            paren = node.getParent();</span><br><span class="line">            <span class="keyword">if</span> (node == paren.getLeft()) &#123;</span><br><span class="line">                paren.setLeft(node.getLeft());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                paren.setRight(node.getRight());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * case3: å¾…åˆ ç»“ç‚¹åªæœ‰å·¦å­æˆ–è€…å³å­</span></span><br><span class="line"><span class="comment">         * solution3: å¾…åˆ èŠ‚ç‚¹çš„çˆ¶äº²æŒ‡å‘å­˜åœ¨çš„å­å—£</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">/* ç¡®å®šæ›¿ä»£ç»“ç‚¹ */</span></span><br><span class="line">            <span class="keyword">if</span> (node.getLeft() != <span class="keyword">null</span>) &#123;</span><br><span class="line">                replace = node.getLeft();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                replace = node.getRight();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* å¾…åˆ ç»“ç‚¹çš„çˆ¶äº² */</span></span><br><span class="line">            paren = node.getParent();</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* å¾…åˆ ç»“ç‚¹çš„çˆ¶äº²æ˜¯å¦ä¸ºç©º */</span></span><br><span class="line">            <span class="keyword">if</span> (paren != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (paren.getLeft() == node) &#123;</span><br><span class="line">                    paren.setLeft(replace);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    paren.setRight(replace);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.root = replace;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* å¾…åˆ èŠ‚ç‚¹çš„çˆ¶äº²æŒ‡å‘æ›¿ä»£ç»“ç‚¹ */</span></span><br><span class="line">            replace.setParent(paren);</span><br><span class="line"></span><br><span class="line">            color = node.getColor();</span><br><span class="line">            child = replace;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* åˆ é™¤é»‘è‰²ç»“ç‚¹éœ€è¦è°ƒæ•´å¹³è¡¡ï¼Œçº¢è‰²ä¸éœ€è¦ */</span></span><br><span class="line">            <span class="keyword">if</span> (color == RBTColor.black) &#123;</span><br><span class="line">                balanceDeletion(child, paren);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* ç»“ç‚¹æ•°é‡-1 */</span></span><br><span class="line">        count.decrementAndGet();</span><br><span class="line">        System.out.println(getCurrentTime() + <span class="string">&quot; [INFO] keyä¸º&quot;</span> + node.getKey() + <span class="string">&quot;çš„ç»“ç‚¹åˆ é™¤æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;å¯»æ‰¾ç»§æ‰¿çš„åè£”&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RBTNode&lt;T, D&gt; <span class="title">descendants</span><span class="params">(RBTNode&lt;T, D&gt; node)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/* æŸ¥è¯¢å¤§äºè¯¥èŠ‚ç‚¹çš„æœ€å°ç»“ç‚¹ï¼Œå³å³å­æ ‘çš„æœ€å·¦ç»“ç‚¹ */</span></span><br><span class="line">        <span class="keyword">if</span> (node.getRight() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            RBTNode&lt;T, D&gt; right = node.getRight();</span><br><span class="line">            <span class="keyword">if</span> (right.getLeft() == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> right;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> (right.getLeft() != <span class="keyword">null</span>) &#123;</span><br><span class="line">                right = right.getLeft();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> right;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* @deprecated */</span></span><br><span class="line">        RBTNode&lt;T, D&gt; paren = node.getParent();</span><br><span class="line">        <span class="keyword">while</span> ((paren != <span class="keyword">null</span>) &amp;&amp; (paren.getRight() == node)) &#123;</span><br><span class="line">            node = paren;</span><br><span class="line">            paren = paren.getParent();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> paren;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;åˆ é™¤ç»“ç‚¹çš„è‡ªå¹³è¡¡æ“ä½œ&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * P-çˆ¶äº²ã€D-åˆ é™¤ã€B-å…„å¼Ÿã€BR-å…„å¼Ÿå³å­ã€BL-å…„å¼Ÿå·¦å­ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * - Dä¸ºå·¦å­</span></span><br><span class="line"><span class="comment">     *   - Bä¸ºçº¢è‰²ï¼šå·¦æ—‹çˆ¶äº²ï¼Œçˆ¶äº²æŸ“çº¢ï¼Œå…„å¼ŸæŸ“é»‘ï¼Œç„¶åcontinue</span></span><br><span class="line"><span class="comment">     *   - Bä¸ºé»‘è‰²</span></span><br><span class="line"><span class="comment">     *     - BLä¸ºé»‘è‰²ä¸”BRé»‘è‰²ï¼šå…„å¼ŸæŸ“çº¢ï¼Œçˆ¶äº²å›æº¯</span></span><br><span class="line"><span class="comment">     *     - BLä¸ºçº¢è‰²ä¸”BRä¸ºé»‘è‰²ï¼šå³æ—‹å…„å¼Ÿï¼Œå…„å¼ŸæŸ“çº¢ï¼ŒBLæŸ“é»‘</span></span><br><span class="line"><span class="comment">     *     - BRä¸ºçº¢è‰²ï¼šå·¦æ—‹çˆ¶äº²ï¼Œçˆ¶äº²çš„é¢œè‰²ç»™å…„å¼Ÿï¼Œçˆ¶äº²é»‘åŒ–ï¼ŒBRé»‘åŒ–ï¼Œç„¶åbreak</span></span><br><span class="line"><span class="comment">     * - Dä¸ºå³å­</span></span><br><span class="line"><span class="comment">     *   - Bä¸ºçº¢è‰²ï¼šå³æ—‹çˆ¶äº²ï¼Œçˆ¶äº²æŸ“çº¢ï¼Œå…„å¼ŸæŸ“é»‘ï¼Œç„¶åcontinue</span></span><br><span class="line"><span class="comment">     *   - Bä¸ºé»‘è‰²ï¼š</span></span><br><span class="line"><span class="comment">     *     - BLä¸ºé»‘è‰²ä¸”BRä¸ºé»‘è‰²ï¼šå…„å¼ŸæŸ“çº¢ï¼Œçˆ¶äº²å›æº¯</span></span><br><span class="line"><span class="comment">     *     - BLä¸ºçº¢è‰²ä¸”BRä¸ºé»‘è‰²ï¼šå·¦æ—‹å…„å¼Ÿï¼Œçˆ¶äº²æŸ“çº¢ï¼ŒBRæŸ“é»‘</span></span><br><span class="line"><span class="comment">     *     - BLä¸ºçº¢è‰²ï¼šå³æ—‹çˆ¶äº²ï¼Œçˆ¶äº²çš„é¢œè‰²ç»™å…„å¼Ÿï¼Œçˆ¶äº²é»‘åŒ–ï¼ŒBLé»‘åŒ–ï¼Œç„¶åbreak</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> paren</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     *     å…¥å‚æƒ…å†µ:</span></span><br><span class="line"><span class="comment">     *     1. node=æ›¿æ¢èŠ‚ç‚¹ paren=æ›¿æ¢èŠ‚ç‚¹çš„çˆ¶äº²èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     *     2. node=æ›¿æ¢èŠ‚ç‚¹çš„å­©å­èŠ‚ç‚¹ paren=æ›¿æ¢èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     *     3. node=æ›¿æ¢èŠ‚ç‚¹çš„å­©å­èŠ‚ç‚¹ parent=æ›¿æ¢èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">balanceDeletion</span><span class="params">(RBTNode&lt;T, D&gt; node, RBTNode&lt;T, D&gt; paren)</span> </span>&#123;</span><br><span class="line">        RBTNode&lt;T, D&gt; broth;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (isBlack(node) &amp;&amp; node != <span class="keyword">this</span>.root) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (paren.getLeft() == node) &#123;</span><br><span class="line">                broth = paren.getRight();</span><br><span class="line"></span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                 * case1: Dä¸ºå·¦å­ã€‚Bä¸ºçº¢è‰²</span></span><br><span class="line"><span class="comment">                 * solution1: å·¦æ—‹çˆ¶äº²ï¼Œçˆ¶äº²æŸ“çº¢ï¼Œå…„å¼ŸæŸ“é»‘ï¼Œç„¶åcontinue</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="keyword">if</span> (isRed(broth)) &#123;</span><br><span class="line">                    leftRotate(paren);</span><br><span class="line">                    paren.setColor(RBTColor.red);</span><br><span class="line">                    broth.setColor(RBTColor.black);</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">/**</span></span><br><span class="line"><span class="comment">                     * case2: Dä¸ºå·¦å­ã€‚Bä¸ºé»‘è‰²ï¼ŒBLä¸ºé»‘è‰²ä¸”BRä¸ºé»‘è‰²</span></span><br><span class="line"><span class="comment">                     * solution2: å…„å¼ŸæŸ“çº¢ï¼Œçˆ¶äº²å›æº¯</span></span><br><span class="line"><span class="comment">                     */</span></span><br><span class="line">                    <span class="keyword">if</span> (isBlack(broth.getLeft()) &amp;&amp; isBlack(broth.getRight())) &#123;</span><br><span class="line">                        broth.setColor(RBTColor.red);</span><br><span class="line">                        node = paren;</span><br><span class="line">                        paren = paren.getParent();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">/**</span></span><br><span class="line"><span class="comment">                     * case3: Dä¸ºå·¦å­ã€‚Bä¸ºé»‘è‰²ï¼ŒBLä¸ºçº¢è‰²ä¸”BRä¸ºé»‘è‰²</span></span><br><span class="line"><span class="comment">                     * solution3: å³æ—‹å…„å¼Ÿï¼Œå…„å¼ŸæŸ“çº¢ï¼ŒBLæŸ“é»‘</span></span><br><span class="line"><span class="comment">                     */</span></span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (isRed(broth.getLeft()) &amp;&amp; isBlack(broth.getRight())) &#123;</span><br><span class="line">                        rightRotate(broth);</span><br><span class="line">                        broth.setColor(RBTColor.red);</span><br><span class="line">                        broth.getLeft().setColor(RBTColor.black);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">/**</span></span><br><span class="line"><span class="comment">                     * case4: Dä¸ºå·¦å­ï¼ŒBä¸ºé»‘è‰²ï¼ŒBRä¸ºçº¢è‰²</span></span><br><span class="line"><span class="comment">                     * solution4: å·¦æ—‹çˆ¶äº²ï¼Œçˆ¶äº²çš„é¢œè‰²ç»™å…„å¼Ÿï¼Œçˆ¶äº²é»‘åŒ–ï¼ŒBRé»‘åŒ–ï¼Œç„¶åbreak</span></span><br><span class="line"><span class="comment">                     */</span></span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (isRed(broth.getRight())) &#123;</span><br><span class="line">                        leftRotate(paren);</span><br><span class="line">                        broth.setColor(paren.getColor());</span><br><span class="line">                        paren.setColor(RBTColor.black);</span><br><span class="line">                        broth.getRight().setColor(RBTColor.black);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                broth = paren.getLeft();</span><br><span class="line"></span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                 * case5: Dä¸ºå³å­ã€‚Bä¸ºçº¢è‰²</span></span><br><span class="line"><span class="comment">                 * solution5: å³æ—‹çˆ¶äº²ï¼Œçˆ¶äº²æŸ“çº¢ï¼Œå…„å¼ŸæŸ“é»‘ï¼Œç„¶åcontinue</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="keyword">if</span> (isRed(broth)) &#123;</span><br><span class="line">                    rightRotate(paren);</span><br><span class="line">                    paren.setColor(RBTColor.red);</span><br><span class="line">                    broth.setColor(RBTColor.black);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">/**</span></span><br><span class="line"><span class="comment">                     * case6: Dä¸ºå³å­ã€‚Bä¸ºé»‘è‰²ï¼ŒBLä¸ºé»‘è‰²ä¸”BRä¸ºé»‘è‰²</span></span><br><span class="line"><span class="comment">                     * solution6: å…„å¼ŸæŸ“çº¢ï¼Œçˆ¶äº²å›æº¯</span></span><br><span class="line"><span class="comment">                     */</span></span><br><span class="line">                    <span class="keyword">if</span> (isBlack(broth.getLeft()) &amp;&amp; isBlack(broth.getRight())) &#123;</span><br><span class="line">                        broth.setColor(RBTColor.red);</span><br><span class="line">                        node = paren;</span><br><span class="line">                        paren = paren.getParent();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">/**</span></span><br><span class="line"><span class="comment">                     * case7: Dä¸ºå³å­ã€‚Bä¸ºé»‘è‰²ï¼ŒBLä¸ºçº¢è‰²ä¸”BRä¸ºé»‘è‰²</span></span><br><span class="line"><span class="comment">                     * solution7: å·¦æ—‹å…„å¼Ÿï¼Œçˆ¶äº²æŸ“çº¢ï¼ŒBRæŸ“é»‘</span></span><br><span class="line"><span class="comment">                     */</span></span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (isRed(broth.getLeft()) &amp;&amp; isBlack(broth.getRight())) &#123;</span><br><span class="line">                        leftRotate(broth);</span><br><span class="line">                        paren.setColor(RBTColor.red);</span><br><span class="line">                        broth.getRight().setColor(RBTColor.black);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">/**</span></span><br><span class="line"><span class="comment">                     * case8: Dä¸ºå³å­ï¼ŒBä¸ºé»‘è‰²ï¼ŒBRä¸ºçº¢è‰²</span></span><br><span class="line"><span class="comment">                     * solution8: å³æ—‹çˆ¶äº²ï¼Œçˆ¶äº²çš„é¢œè‰²ç»™å…„å¼Ÿï¼Œçˆ¶äº²é»‘åŒ–ï¼ŒBLé»‘åŒ–ï¼Œç„¶åbreak</span></span><br><span class="line"><span class="comment">                     */</span></span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (isRed(broth.getRight())) &#123;</span><br><span class="line">                        rightRotate(paren);</span><br><span class="line">                        broth.setColor(paren.getColor());</span><br><span class="line">                        paren.setColor(RBTColor.black);</span><br><span class="line">                        broth.getRight().setColor(RBTColor.black);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* nodeæŸ“æˆè¢«åˆ ç»“ç‚¹çš„é¢œè‰² */</span></span><br><span class="line">        node.setColor(RBTColor.black);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;å±‚æ¬¡éå†&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">levelOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;List&lt;RBTNode&lt;T, D&gt;&gt;&gt; levelList = levelOrder(<span class="keyword">this</span>.root);</span><br><span class="line">        <span class="keyword">for</span> (List&lt;RBTNode&lt;T, D&gt;&gt; list:levelList) &#123;</span><br><span class="line">            <span class="keyword">for</span> (RBTNode node : list) &#123;</span><br><span class="line">                System.out.print(node.getKey() + <span class="string">&quot; &quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;å±‚æ¬¡éå†&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;List&lt;RBTNode&lt;T, D&gt;&gt;&gt; levelOrder(RBTNode&lt;T, D&gt; node) &#123;</span><br><span class="line">        List&lt;List&lt;RBTNode&lt;T, D&gt;&gt;&gt; res = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">        Queue&lt;RBTNode&lt;T, D&gt;&gt; queue = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">        queue.add(node);</span><br><span class="line">        <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">int</span> count = queue.size();</span><br><span class="line">            List&lt;RBTNode&lt;T, D&gt;&gt; cur = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">            <span class="keyword">while</span> (count != <span class="number">0</span>) &#123;</span><br><span class="line">                RBTNode&lt;T, D&gt; temp = queue.poll();</span><br><span class="line">                cur.add(temp);</span><br><span class="line">                <span class="keyword">if</span> (temp.getLeft() != <span class="keyword">null</span>) queue.add(temp.getLeft());</span><br><span class="line">                <span class="keyword">if</span> (temp.getRight() != <span class="keyword">null</span>) queue.add(temp.getRight());</span><br><span class="line">                count--;</span><br><span class="line">            &#125;</span><br><span class="line">            res.add(cur);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;è¾“å‡ºçº¢é»‘æ ‘çš„å±‚çº§ç»“æ„&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printRBTreeLevel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(getCurrentTime() + <span class="string">&quot; [INFO] å¼€å§‹æ‰“å°çº¢é»‘æ ‘çš„å±‚çº§ç»“æ„&quot;</span>);</span><br><span class="line">        ConcurrentHashMap&lt;Integer, List&lt;RBTNode&gt;&gt; map = showTree();</span><br><span class="line">        <span class="keyword">int</span> size = map.size();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; map.size(); i++) &#123;</span><br><span class="line">            System.out.println();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; map.get(i).size(); j++) &#123;</span><br><span class="line">                System.out.print( makeSpace(size, i) +</span><br><span class="line">                        (map.get(i).get(j).getKey() == <span class="keyword">null</span> ? <span class="string">&quot; &quot;</span> : (map.get(i).get(j).getKey()) + (map.get(i).get(j).getColor() == RBTColor.black ? <span class="string">&quot;(é»‘)&quot;</span> : <span class="string">&quot;(çº¢)&quot;</span>)) + makeSpace(size, i));</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(getCurrentTime() + <span class="string">&quot; [INFO] çº¢é»‘æ ‘çš„å±‚çº§ç»“æ„æ‰“å°å®Œæ¯•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;è¾“å‡ºæ•´æ£µæ ‘çš„Graphvizç»“æ„&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printGraphviz</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(getCurrentTime() + <span class="string">&quot; [INFO] å¼€å§‹æ‰“å°æ ‘çš„Graphvizç»“æ„&quot;</span>);</span><br><span class="line">        ConcurrentHashMap&lt;Integer, List&lt;RBTNode&gt;&gt; map = showTree();</span><br><span class="line">        <span class="keyword">int</span> size = map.size();</span><br><span class="line">        System.out.println(<span class="string">&quot;digraph &#123;&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; map.size(); i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; map.get(i).size(); j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(map.get(i).get(j).getKey() != <span class="keyword">null</span>)&#123;</span><br><span class="line">                    System.out.println(map.get(i).get(j).getKey() + <span class="string">&quot; [color=&quot;</span>  + (map.get(i).get(j).getColor()) + <span class="string">&quot;] &quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; map.size(); i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; map.get(i).size(); j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(map.get(i).get(j).getKey() != <span class="keyword">null</span>)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(map.get(i).get(j).getLeft() != <span class="keyword">null</span>)&#123;</span><br><span class="line">                        System.out.println(map.get(i).get(j).getKey() + <span class="string">&quot;-&gt;&quot;</span> + map.get(i).get(j).getLeft().getKey() + <span class="string">&quot;[label=left]&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span>(map.get(i).get(j).getRight() != <span class="keyword">null</span>)&#123;</span><br><span class="line">                        System.out.println(map.get(i).get(j).getKey() + <span class="string">&quot;-&gt;&quot;</span> + map.get(i).get(j).getRight().getKey() + <span class="string">&quot;[label=right]&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">        System.out.println(getCurrentTime() + <span class="string">&quot; [INFO] æ ‘çš„Graphvizç»“æ„æ‰“å°å®Œæ¯•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">makeSpace</span><span class="params">(<span class="keyword">int</span> size, <span class="keyword">int</span> index)</span></span>&#123;</span><br><span class="line">        StringBuilder builder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1</span> &lt;&lt; (size - index); i++) &#123;</span><br><span class="line">            builder.append(<span class="string">&quot;  &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> builder.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ConcurrentHashMap&lt;Integer, List&lt;RBTNode&gt;&gt; showTree()&#123;</span><br><span class="line">        ConcurrentHashMap&lt;Integer, List&lt;RBTNode&gt;&gt; map = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line">        showTree(root, <span class="number">0</span>, map);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showTree</span><span class="params">(RBTNode root, <span class="keyword">int</span> count, ConcurrentHashMap&lt;Integer, List&lt;RBTNode&gt;&gt; map)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (map.get(count) == <span class="keyword">null</span>)&#123;</span><br><span class="line">            map.put(count, <span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line">        &#125;</span><br><span class="line">        map.get(count).add(root);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (root.getLeft() != <span class="keyword">null</span>)&#123;</span><br><span class="line">            showTree(root.getLeft(), count+<span class="number">1</span> , map);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(map.get(count+<span class="number">1</span>) == <span class="keyword">null</span>)&#123;</span><br><span class="line">                map.put(count+<span class="number">1</span>, <span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line">            &#125;</span><br><span class="line">            map.get(count+<span class="number">1</span>).add(<span class="keyword">new</span> RBTNode(RBTColor.red, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (root.getRight() != <span class="keyword">null</span>)&#123;</span><br><span class="line">            showTree(root.getRight(), count+<span class="number">1</span> , map);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(map.get(count+<span class="number">1</span>) == <span class="keyword">null</span>)&#123;</span><br><span class="line">                map.put(count+<span class="number">1</span>, <span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line">            &#125;</span><br><span class="line">            map.get(count+<span class="number">1</span>).add(<span class="keyword">new</span> RBTNode(RBTColor.red, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;èœå•&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RBT</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RedBlackTree KTree = <span class="keyword">new</span> RedBlackTree();</span><br><span class="line">        Scanner scanner = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            System.out.println((<span class="string">&quot;â”â”â”â”â”â”â”â”â”â” â–¶ â–¶ â–¶ â–¶ â–¶ RED â¤ BLACK â—€ â—€ â—€ â—€ â—€ â”â”â”â”â”â”â”â”â”â”â”“&quot;</span>));</span><br><span class="line">            System.out.println((<span class="string">&quot;   âœªâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 1. æ’å…¥èŠ‚ç‚¹ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”âœª&quot;</span>));</span><br><span class="line">            System.out.println((<span class="string">&quot;   âœªâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 2. æŸ¥è¯¢èŠ‚ç‚¹ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”âœª&quot;</span>));</span><br><span class="line">            System.out.println((<span class="string">&quot;   âœªâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 3. åˆ é™¤ç»“ç‚¹ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”âœª&quot;</span>));</span><br><span class="line">            System.out.println((<span class="string">&quot;   âœªâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 4. æŸ¥è¯¢æ•°é‡ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”âœª&quot;</span>));</span><br><span class="line">            System.out.println((<span class="string">&quot;   âœªâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 5. å±‚æ¬¡ç»“æ„ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”âœª&quot;</span>));</span><br><span class="line">            System.out.println((<span class="string">&quot;   âœªâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 6. Graphviz â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”âœª&quot;</span>));</span><br><span class="line">            System.out.println((<span class="string">&quot;   âœªâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 7. é€€å‡ºç³»ç»Ÿ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”âœª&quot;</span>));</span><br><span class="line">            System.out.println((<span class="string">&quot;â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›&quot;</span>));</span><br><span class="line"></span><br><span class="line">            System.out.print(getCurrentTime() + <span class="string">&quot; [input] è¾“å…¥é€‰æ‹©ï¼š&quot;</span>);</span><br><span class="line">            <span class="keyword">int</span> choice = scanner.nextInt();</span><br><span class="line">            <span class="keyword">int</span> key;</span><br><span class="line">            String value;</span><br><span class="line">            <span class="keyword">switch</span> (choice) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                    System.out.print(getCurrentTime() + <span class="string">&quot; [INPUT] è¾“å…¥é”®å€¼ï¼š&quot;</span>);</span><br><span class="line">                    key = scanner.nextInt();</span><br><span class="line">                    System.out.print(getCurrentTime() + <span class="string">&quot; [INPUT] è¾“å…¥æ•°æ®ï¼š&quot;</span>);</span><br><span class="line">                    value = scanner.next();</span><br><span class="line">                    KTree.add(key, value);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                    System.out.print(getCurrentTime() + <span class="string">&quot; [INPUT] è¾“å…¥é”®å€¼ï¼š&quot;</span>);</span><br><span class="line">                    key = scanner.nextInt();</span><br><span class="line">                    System.out.println(getCurrentTime() + <span class="string">&quot; [INFO] æŸ¥è¯¢ç»“æœ value = &quot;</span> + KTree.get(key));</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                    System.out.print(getCurrentTime() + <span class="string">&quot; [INPUT] è¾“å…¥é”®å€¼ï¼š&quot;</span>);</span><br><span class="line">                    key = scanner.nextInt();</span><br><span class="line">                    KTree.del(key);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                    System.out.println(getCurrentTime() + <span class="string">&quot; [INFO] æŸ¥è¯¢ç»“æœ size = &quot;</span> + KTree.size());</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">                    KTree.printRBTreeLevel();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">                    KTree.printGraphviz();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">                    System.out.println(getCurrentTime() + <span class="string">&quot; [INFO] é€€å‡ºæˆåŠŸ&quot;</span>);</span><br><span class="line">                    System.exit(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    System.out.println(getCurrentTime() + <span class="string">&quot; [ERROR] è¾“å…¥é”™è¯¯&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        RedBlackTree redBlackTree = <span class="keyword">new</span> RedBlackTree();</span><br><span class="line">        redBlackTree.RBT();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





]]></content>
      <categories>
        <category>Algorithm</category>
      </categories>
      <tags>
        <tag>RedBlackTree</tag>
      </tags>
  </entry>
  <entry>
    <title>Netty</title>
    <url>/2020/10/01/Netty/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Netty"><a href="#Netty" class="headerlink" title="Netty"></a>Netty</h1><center>
    <font face="Kristen ITC" color="#555555" font-size=100px>Khighness</font><br>
</center>

<h2 id="1-IO"><a href="#1-IO" class="headerlink" title="1. IO"></a>1. IO</h2><h3 id="1-1-BIO"><a href="#1-1-BIO" class="headerlink" title="1.1 BIO"></a>1.1 BIO</h3><h4 id="1-1-1-ä»‹ç»"><a href="#1-1-1-ä»‹ç»" class="headerlink" title="1.1.1 ä»‹ç»"></a>1.1.1 ä»‹ç»</h4><ul>
<li>Java BIOå°±æ˜¯ä¼ ç»Ÿçš„Java IOç¼–ç¨‹ï¼Œç›¸å…³APIéƒ½åœ¨java.io</li>
<li>BIO (<strong>blocking I/O</strong>)ï¼š<strong>åŒæ­¥å¹¶é˜»å¡</strong>ï¼ŒæœåŠ¡å™¨å®ç°æ¨¡å¼ä¸ºä¸€ä¸ªè¿æ¥ä¸€ä¸ªçº¿ç¨‹ï¼Œå³æœ‰è¿æ¥è¯·æ±‚æ—¶æœåŠ¡å™¨å°±éœ€è¦å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œå¦‚æœè¿™ä¸ªè¿æ¥ä¸åšä»»ä½•äº‹æƒ…ä¼šé€ æˆä¸å¿…è¦çš„çº¿ç¨‹å¼€é”€</li>
<li>BIOæ–¹å¼é€‚ç”¨äºè¿æ¥æ•°ç›®è¾ƒå°ä¸”å›ºå®šçš„æ¶æ„ï¼Œè¿™ç§æ–¹å¼å¯¹æœåŠ¡å™¨èµ„æºè¦æ±‚æ¯”è¾ƒé«˜ï¼Œå¹¶å‘å±€é™äºåº”ç”¨ä¸­ï¼ŒJDK1.4ä»¥å‰çš„å”¯ä¸€é€‰æ‹©</li>
</ul>
<h4 id="1-1-2-å®ä¾‹"><a href="#1-1-2-å®ä¾‹" class="headerlink" title="1.1.2 å®ä¾‹"></a>1.1.2 å®ä¾‹</h4><blockquote>
<p>BIOæœåŠ¡å™¨</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kag.bio;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2020/9/13 11:07</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: BIOæœåŠ¡å™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BIOServer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Logger logger = Logger.getLogger(BIOServer.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  å¯åŠ¨æœåŠ¡å™¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * çº¿ç¨‹æ± æœºåˆ¶</span></span><br><span class="line"><span class="comment">         * æ€è·¯</span></span><br><span class="line"><span class="comment">         * 1ã€åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± </span></span><br><span class="line"><span class="comment">         * 2ã€å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹æ± è”æœºå‘ƒï¼Œå°±åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä¸ä¹‹é€šè®¯</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">        ExecutorService newCachedThreadPool = Executors.newCachedThreadPool();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºServerSocket</span></span><br><span class="line">        ServerSocket serverSocket = <span class="keyword">new</span> ServerSocket(<span class="number">6666</span>);</span><br><span class="line">        logger.info(<span class="string">&quot;NIO æœåŠ¡å™¨å¯åŠ¨ &quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="comment">// ç›‘å¬ï¼Œç­‰å¾…å®¢æˆ·ç«¯æ¥å—</span></span><br><span class="line">            <span class="keyword">final</span> Socket socket = serverSocket.accept();</span><br><span class="line">            logger.info(<span class="string">&quot;æ–°å¢ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥&quot;</span>);</span><br><span class="line">            <span class="comment">// åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä¸ä¹‹é€šè®¯</span></span><br><span class="line">            newCachedThreadPool.execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    handler(socket);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * handlerï¼Œå’Œå®¢æˆ·ç«¯é€šè®¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> socket</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handler</span><span class="params">(Socket socket)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="comment">// é€šè¿‡socketè·å–è¾“å…¥æµ</span></span><br><span class="line">            InputStream inputStream = socket.getInputStream();</span><br><span class="line">            <span class="comment">// å¾ªç¯è¯»å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ®</span></span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="comment">// è¾“å‡ºçº¿ç¨‹ä¿¡æ¯</span></span><br><span class="line">                logger.info(<span class="string">&quot;çº¿ç¨‹ä¿¡æ¯ï¼š&#123; PID = &quot;</span> + Thread.currentThread().getId()</span><br><span class="line">                        + <span class="string">&quot;, Name = &quot;</span> + Thread.currentThread().getName() + <span class="string">&quot; &#125;&quot;</span>);</span><br><span class="line">                <span class="keyword">int</span> read = inputStream.read(bytes);</span><br><span class="line">                <span class="keyword">if</span> (read != -<span class="number">1</span>) &#123;</span><br><span class="line">                    logger.info(<span class="string">&quot;[å®¢æˆ·ç«¯ï¼š&quot;</span> + <span class="keyword">new</span> String(bytes, <span class="number">0</span>, read) + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.info(e.getMessage());</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;å…³é—­ä¸å®¢æˆ·ç«¯çš„è¿æ¥&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                socket.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">new</span> BIOServer().start();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="1-1-3-é…ç½®"><a href="#1-1-3-é…ç½®" class="headerlink" title="1.1.3 é…ç½®"></a>1.1.3 é…ç½®</h4><img src="/2020/10/01/Netty/image-20200913115739418.png" class="" title="image-20200913115739418">

<img src="/2020/10/01/Netty/image-20200913115851769.png" class="" title="image-20200913115851769">

<img src="/2020/10/01/Netty/image-20200913115947574.png" class="" title="image-20200913115947574">



<h4 id="1-1-4-è¿è¡Œ"><a href="#1-1-4-è¿è¡Œ" class="headerlink" title="1.1.4 è¿è¡Œ"></a>1.1.4 è¿è¡Œ</h4><img src="/2020/10/01/Netty/image-20200913120322526.png" class="" title="image-20200913120322526">



<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">telnet 127.0.0.1 6666</span><br></pre></td></tr></table></figure>

<img src="/2020/10/01/Netty/image-20200913120406689.png" class="" title="image-20200913120406689">



<img src="/2020/10/01/Netty/image-20200913121954652.png" class="" title="image-20200913121954652">

<img src="/2020/10/01/Netty/image-20200913122028056.png" class="" title="image-20200913122028056">



<h4 id="1-1-5-ä¸è¶³"><a href="#1-1-5-ä¸è¶³" class="headerlink" title="1.1.5 ä¸è¶³"></a>1.1.5 ä¸è¶³</h4><p>1ï½æ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦åˆ›å»ºç‹¬ç«‹çš„çº¿ç¨‹ï¼Œä¸å¯¹åº”çš„å®¢æˆ·ç«¯è¿›è¡Œæ•°æ®Readï¼Œä¸šåŠ¡å¤„ç†ï¼Œæ•°æ®Write</p>
<p>2ï¼‰å½“å¹¶å‘æ•°è¾ƒå¤§æ—¶ï¼Œéœ€è¦åˆ›å»ºå¤§é‡çº¿ç¨‹æ¥å¤„ç†è¿æ¥ï¼Œç³»ç»Ÿèµ„æºå ç”¨è¾ƒå¤§</p>
<p>3ï¼‰è¿æ¥å»ºç«‹åï¼Œå¦‚æœå½“å½“å‰çº¿ç¨‹æš‚å­˜æ²¡æœ‰æ•°æ®å¯è¯»ï¼Œåˆ™çº¿ç¨‹å°±é˜»å¡åœ¨Readä¸Šï¼Œé€ æˆçº¿ç¨‹èµ„æºæµªè´¹</p>
<h3 id="1-2-NIO"><a href="#1-2-NIO" class="headerlink" title="1.2 NIO"></a>1.2 NIO</h3><h4 id="1-2-1-ä»‹ç»"><a href="#1-2-1-ä»‹ç»" class="headerlink" title="1.2.1 ä»‹ç»"></a>1.2.1 ä»‹ç»</h4><ul>
<li>Java NIO å…¨ç§° <strong>java non-blocking IO</strong>ï¼Œæ˜¯æŒ‡JDKæä¾›çš„å¿ƒAPIï¼Œæ˜¯<strong>åŒæ­¥éé˜»å¡</strong>çš„ã€‚</li>
<li>NIO ç›¸å…³ç±»éƒ½è¢«æ”¾åœ¨ java.nioåŒ…åŠå­åŒ…ä¸‹ï¼Œå¹¶ä¸”å¯¹åŸ java.ioåŒ…ä¸­çš„å¾ˆå¤šç±»è¿›è¡Œæ”¹å†™</li>
<li>NIO ä¸‰å¤§æ ¸å¿ƒéƒ¨åˆ†ï¼š<u>Channel</u>(é€šé“)ã€<u>Buffer</u>(ç¼“å†²åŒº)ã€<u>Selector</u>(é€‰æ‹©å™¨)</li>
<li>NIO æ˜¯é¢å‘ç¼“å†²åŒºæˆ–è€…é¢å‘å—ç¼–ç¨‹çš„ã€‚æ•°æ®è¯»å–åˆ°ä¸€ä¸ªå®ƒç¨åå¤„ç†çš„ç¼“å†²åŒºï¼Œéœ€è¦æ—¶å¯åœ¨ç¼“å†²åŒºå‰åç§»åŠ¨ï¼Œè¿™å°±å¢åŠ å¤„ç†è¿‡ç¨‹ä¸­çš„çµæ´»æ€§ï¼Œä½¿ç”¨å®ƒå¯ä»¥æä¾›éé˜»å¡çš„é«˜ä¼¸ç¼©æ€§ç½‘ç»œ</li>
</ul>
<h4 id="1-2-2-æ¯”è¾ƒ"><a href="#1-2-2-æ¯”è¾ƒ" class="headerlink" title="1.2.2 æ¯”è¾ƒ"></a>1.2.2 æ¯”è¾ƒ</h4><blockquote>
<p><code>BIO</code> VS <code>NIO</code></p>
</blockquote>
<ul>
<li><p>BIOä»¥æµçš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œè€ŒNIOä»¥å—çš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œå—I/Oçš„æ•ˆç‡æ¯”æµI/Oé«˜å¾ˆå¤š</p>
</li>
<li><p>BIOæ˜¯é˜»å¡çš„ï¼ŒNIOåˆ™æ˜¯éé˜»å¡çš„</p>
</li>
<li><p>BIOåŸºäºå­—èŠ‚æµå’Œå­—ç¬¦æµè¿›è¡Œæ“ä½œï¼Œè€ŒNIOåŸºäº<code>Channel</code>(é€šé“)å’Œ<code>Buffer</code>(ç¼“å†²åŒº)è¿›è¡Œæ“ä½œï¼Œæ•°æ®æ€»æ˜¯ä»é€šé“è¯»å–åˆ°ç¼“å†²åŒºä¸­ï¼Œæˆ–è€…ä»ç¼“å†²åŒºå†™å…¥åˆ°åŒé“ä¸­äººã€‚<code>Selectors</code>(é€‰æ‹©å™¨)ç”¨äºç›‘å¬å¤šä¸ªé€šé“çš„äº‹ä»¶ï¼ˆæ¯”å¦‚ï¼šè¿æ¥è¯·æ±‚ã€æ•°æ®åˆ°è¾¾ç­‰ï¼‰ï¼Œå› æ­¤ä½¿ç”¨å•ä¸ªçº¿ç¨‹å°±å¯ä»¥ç›‘å¬å¤šä¸ªå®¢æˆ·ç«¯é€šé“</p>
</li>
</ul>
<h4 id="1-2-3-ç»„ä»¶"><a href="#1-2-3-ç»„ä»¶" class="headerlink" title="1.2.3 ç»„ä»¶"></a>1.2.3 ç»„ä»¶</h4><p>ä¸‰å¤§ç»„ä»¶ï¼š<code>Selector</code>ã€<code>Channe</code>å’Œ<code>Buffer</code></p>
<blockquote>
<p>å…³ç³»å›¾</p>
</blockquote>
<img src="/2020/10/01/Netty/image-20200913164017187.png" class="" title="image-20200913164017187">

<blockquote>
<p>è¯´æ˜</p>
</blockquote>
<ul>
<li>æ¯ä¸ª<code>channel</code>éƒ½ä¼šå¯¹åº”ä¸€ä¸ª<code>Buffer</code></li>
<li><code>Selector</code>å¯¹åº”ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹åº”å¤šä¸ª<code>channel</code></li>
<li>è¯¥å›¾ååº”æœ‰ä¸‰ä¸ª<code>channel</code>æ³¨å†Œåˆ°äº†è¯¥<code>Selector</code>ç¨‹åº</li>
<li>ç¨‹åºåˆ‡æ¢åˆ°å“ªä¸ª<code>channel</code>æ˜¯æœ‰äº‹ä»¶å†³å®šçš„ï¼Œ<code>Event</code>å°±æ˜¯ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µ</li>
<li><code>Selector</code>ä¼šæ ¹æ®ä¸åŒçš„äº‹ä»¶ï¼Œåœ¨å„ä¸ªé€šé“ä¸Šåˆ‡æ¢</li>
<li><code>Buffer</code>å°±æ˜¯ä¸€ä¸ªå†…å­˜å—ï¼Œåº•å±‚æ˜¯æœ‰ä¸€ä¸ªæ•°ç»„</li>
<li>æ•°æ®çš„è¯»å–å†™å…¥éƒ½é€šè¿‡<code>Buffer</code>ï¼Œè¿™ä¸ªå’ŒBIOä¸åŒã€‚BIOè¦ä¹ˆæ˜¯è¾“å…¥æµï¼Œè¦ä¹ˆæ˜¯è¾“å‡ºæµï¼Œä¸èƒ½åŒå‘ï¼Œä½†æ˜¯NIOçš„<code>buffer</code>æ˜¯å¯ä»¥è¯»ä¹Ÿå¯ä»¥å†™ï¼Œéœ€è¦<code>flip</code>æ–¹æ³•åˆ‡æ¢</li>
<li><code>channel</code>æ˜¯åŒå‘çš„ï¼Œå¯ä»¥è¿”å›åº•å±‚æ“ä½œç³»ç»Ÿçš„æƒ…å†µï¼Œæ¯”å¦‚<code>Linux</code>ï¼Œåº•å±‚çš„æ“ä½œç³»ç»Ÿé€šé“å°±æ˜¯åŒå‘çš„</li>
</ul>
<h5 id="1-2-3-1-Buffer"><a href="#1-2-3-1-Buffer" class="headerlink" title="1.2.3.1 Buffer"></a>1.2.3.1 Buffer</h5><blockquote>
<p>è¯´æ˜</p>
</blockquote>
<p>ç¼“å†²åŒºï¼šç¼“å†²åŒºæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¯ä»¥è¯»å†™æ•°æ®çš„å†…å­˜å—</p>
<blockquote>
<p>å¸¸ç”¨Bufferå­ç±»ï¼š</p>
</blockquote>
<ul>
<li>ByteBuffer</li>
<li>ShortBuffer</li>
<li>CharBuffer</li>
<li>IntBuffer</li>
<li>LongBuffer</li>
<li>DoubleBuffer</li>
<li>FloatBuffer</li>
</ul>
<blockquote>
<p>Bufferç±»å®šä¹‰äº†æ‰€æœ‰çš„ç¼“å†²åŒºéƒ½å…·æœ‰çš„å››ä¸ªå±æ€§æ¥æä¾›å…³äºå…¶æ‰€åŒ…å«çš„æ•°æ®å…ƒç´ </p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">å±æ€§</th>
<th align="center">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Capacity</td>
<td align="center">å®¹é‡ï¼Œçº§å¯ä»¥å®¹çº³çš„æœ€å¤§æ•°æ®é‡ï¼›åœ¨ç¼“å†²åŒºåˆ›å»ºæ—¶è¢«è®¾å®šä¸”ä¸èƒ½æ”¹å˜</td>
</tr>
<tr>
<td align="center">Limit</td>
<td align="center">è¡¨ç¤ºç¼“å†²åŒºçš„å½“å‰é‡ç‚¹ï¼Œä¸èƒ½å¯¹ç¼“å†²åŒºè¶…è¿‡æé™çš„ä½ç½®è¿›è¡Œè¯»å†™æ“ä½œï¼Œä¸”æé™æ˜¯å¯ä»¥ä¿®æ”¹çš„</td>
</tr>
<tr>
<td align="center">Position</td>
<td align="center">ä½ç½®ï¼Œä¸‹ä¸€ä¸ªè¦è¢«è¯»æˆ–å†™çš„å…ƒç´ çš„ç´¢å¼•ï¼Œæ¯æ¬¡è¯»å†™ç¼“å†²åŒºæ•°æ®æ—¶éƒ½ä¼šæ”¹å˜çš„å€¼ï¼Œä¸ºä¸‹æ¬¡è¯»å†™ä½œå‡†å¤‡</td>
</tr>
<tr>
<td align="center">Mark</td>
<td align="center">æ ‡è®°</td>
</tr>
</tbody></table>
<blockquote>
<p>mark &lt;= position &lt;= limit &lt;= capacity</p>
</blockquote>
<h5 id="1-2-3-2-Channel"><a href="#1-2-3-2-Channel" class="headerlink" title="1.2.3.2 Channel"></a>1.2.3.2 Channel</h5><blockquote>
<p>è¯´æ˜</p>
</blockquote>
<p>é€šé“ï¼šNIOçš„é€šé“ç±»ä¼¼äºæµï¼Œä½†æœ‰äº›åŒºåˆ«</p>
<ul>
<li>é€šé“å¯ä»¥åŒæ—¶è¿›è¡Œè¯»å†™ï¼Œè€Œæµåªèƒ½è¯»æˆ–è€…åªèƒ½å†™</li>
<li>é€šé“å¯ä»¥å®ç°å¼‚æ­¥è¯»å†™æ•°æ®</li>
<li>é€šé“å¯ä»¥ä»ç¼“å†²è¯»æ•°æ®ï¼Œä¹Ÿå¯ä»¥å†™æ•°æ®åˆ°ç¼“å†²</li>
</ul>
<blockquote>
<p> å¸¸ç”¨çš„Channelç±»ï¼š</p>
</blockquote>
<ul>
<li>FileChannel                      â”â”â”â”â”â–¶          æ–‡ä»¶çš„æ•°æ®è¯»å†™</li>
<li>DatagramChannel            â”â”â”â”â”â–¶          UDPçš„æ•°æ®è¯»å†™</li>
<li>ServerSocketChannel      â”â”â”â”â”â–¶          TCPçš„æ•°æ®è¯»å†™</li>
<li>SocketChannel                 â”â”â”â”â”â–¶          TCPçš„æ•°æ®è¯»å†™</li>
</ul>
<blockquote>
<p>FileChannelçš„ä¸»è¦IOæ“ä½œ</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">æ–¹æ³•</th>
<th align="center">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="center">public int read(ByteBuffer dst)</td>
<td align="center">ä»é€šé“è¯»å–æ•°æ®å¹¶æ”¾åˆ°ç¼“å†²åŒºä¸­</td>
</tr>
<tr>
<td align="center">public int write(ByteBuffer src)</td>
<td align="center">æŠŠç¼“å†²åŒºçš„æ•°æ®å†™åˆ°é€šé“ä¸­</td>
</tr>
<tr>
<td align="center">public long transferFrom(ReadableByteChannel src, long position, long count)</td>
<td align="center">ä»ç›®æ ‡é€šé“ä¸­å¤åˆ¶æ•°æ®åˆ°å½“å‰é€šé“</td>
</tr>
<tr>
<td align="center">public long transferTo(long position, long count, WritableByteChannel target)</td>
<td align="center">æŠŠæ•°æ®ä»å½“å‰é€šé“å¤åˆ¶ç»™ç›®æ ‡é€šé“</td>
</tr>
</tbody></table>
<h5 id="1-2-3-3-Selector"><a href="#1-2-3-3-Selector" class="headerlink" title="1.2.3.3 Selector"></a>1.2.3.3 Selector</h5><blockquote>
<p>è¯´æ˜</p>
</blockquote>
<p>é€‰æ‹©å™¨ï¼š</p>
<ul>
<li>Javaçš„NIOï¼Œç”¨éé˜»å¡çš„IOæ–¹å¼ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼Œå¤„ç†å¤šä¸ªçš„å®¢æˆ·ç«¯è¿æ¥ï¼Œå°±ä¼šä½¿ç”¨åˆ°<code>Selector</code></li>
<li><code>Selector</code>èƒ½å¤Ÿæ£€æµ‹å¤šä¸ªæ³¨å†Œçš„é€šé“ä¸Šæ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿï¼ˆå¤šä¸ª<code>Channel</code>ä»¥äº‹ä»¶çš„æ–¹å¼å¯ä»¥æ³¨å†Œåˆ°åŒä¸€ä¸ª<code>Selector</code>ï¼‰ï¼Œå¦‚æœæœ‰äº‹ä»¶å‘ç”Ÿï¼Œä¾¿è·å–äº‹ä»¶ç„¶åé’ˆå¯¹æ¯ä¸ªäº‹ä»¶è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚è¿™æ ·å°±å¯ä»¥åªç”¨ä¸€ä¸ªå•çº¿ç¨‹å»ç®¡ç†å¤šä¸ªé€šé“ï¼Œä¹Ÿå°±æ˜¯ç®¡ç†å¤šä¸ªè¿æ¥å’Œè¯·æ±‚</li>
<li>åªæœ‰åœ¨è¿æ¥çœŸæ­£æœ‰è¯»å†™äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæ‰ä¼šè¿›è¡Œè¯»å†™ï¼Œå°±å¤§å¤§åœ°å‡å°‘äº†ç³»ç»Ÿå¼€é”€ï¼Œå¹¶ä¸”ä¸å¿…ä¸ºæ¯ä¸ªè¿æ¥éƒ½åˆ›å»ºä¸€ä¸ªçº¿ç¨‹</li>
<li>é¿å…äº†å¤šçº¿ç¨‹ä¹‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¯¼è‡´çš„å¼€é”€</li>
</ul>
<blockquote>
<p>ç±»åŠç›¸å…³æ–¹æ³•</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">Class | Method</th>
<th align="center">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="center">public abstract class Selector implements Closeable</td>
<td align="center">æŠ½è±¡ç±»</td>
</tr>
<tr>
<td align="center">public static Selector open()</td>
<td align="center">å¾—åˆ°ä¸€ä¸ªé€‰æ‹©å™¨å¯¹è±¡</td>
</tr>
<tr>
<td align="center">public int select(long timeout)</td>
<td align="center">ç›‘æ§æ‰€æœ‰æ³¨å†Œçš„é€šé“ï¼Œå‚æ•°ç”¨æ¥è®¾ç½®è¶…æ—¶æ—¶é—´</td>
</tr>
<tr>
<td align="center">public Set<SelectionKey> selectedKeys()</td>
<td align="center">ä»å†…éƒ¨é›†åˆä¸­å¾—åˆ°æ‰€æœ‰çš„SelectionKeâ€™y</td>
</tr>
</tbody></table>
<blockquote>
<p>è¯´æ˜</p>
</blockquote>
<ul>
<li>å½“å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼Œä¼šé€šè¿‡<code>ServerSocketChannel</code>å¾—åˆ°<code>SocketChannel</code></li>
<li>å°†<code>SocketChannel</code>æ³¨å†Œåˆ°<code>Selector</code>ä¸Šï¼Œæ³¨å†Œåè¿”å›ä¸€ä¸ª<code>SelectionKey</code></li>
<li><code>Selector</code>è¿›è¡Œç›‘å¬<code>select</code>æ–¹æ³•ï¼Œè¿”å›æœ‰äº‹ä»¶å‘ç”Ÿçš„é€šé“çš„ä¸ªæ•°</li>
<li>è¿›ä¸€æ­¥å¾—åˆ°å„ä¸ª<code>SelectionKey</code></li>
<li>åœ¨é€šé“<code>SelectionKey</code>åå‘è·å–<code>SocketChannel</code>ï¼Œæ–¹æ³•<code>channel()</code></li>
<li>å¯ä»¥å¾—åˆ°æ‰€æœ‰çš„<code>channel</code>ï¼Œå®Œæˆä¸šåŠ¡å¤„ç†</li>
</ul>
<h4 id="1-2-3-ç¼–ç¨‹"><a href="#1-2-3-ç¼–ç¨‹" class="headerlink" title="1.2.3 ç¼–ç¨‹"></a>1.2.3 ç¼–ç¨‹</h4><blockquote>
<p>å°†æ•°æ®å†™å…¥åˆ°æœ¬åœ°æ–‡ä»¶</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(String s)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºè¾“å‡ºæµ â€”â€”&gt; channel</span></span><br><span class="line">    FileOutputStream fileOutputStream = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;D:\\Java\\Test\\K1.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡ fileOutputStream è·å– å¯¹åº”çš„ FileChannel</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ª fileChannel çœŸå®ç±»å‹æ˜¯  FileChannelImpl</span></span><br><span class="line">    FileChannel fileChannel = fileOutputStream.getChannel();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªç¼“å†²åŒº ByteBuffer</span></span><br><span class="line">    ByteBuffer byteBuffer = ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°† s æ”¾å…¥ byteBuffer</span></span><br><span class="line">    byteBuffer.put(s.getBytes());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯¹ byteBuffer è¿›è¡Œflip</span></span><br><span class="line">    byteBuffer.flip();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°† byteBuffer æ•°æ®å†™å…¥åˆ° fileChannel</span></span><br><span class="line">    fileChannel.write(byteBuffer);</span><br><span class="line">    fileOutputStream.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä»æœ¬åœ°æ–‡ä»¶è¯»å–æ•°æ®</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(String path)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºæ–‡ä»¶çš„è¾“å…¥æµ</span></span><br><span class="line">    File file = <span class="keyword">new</span> File(path);</span><br><span class="line">    FileInputStream fileInputStream = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡ fileInputStream è·å–å¯¹åº”çš„ FileChannel â€”â€”&gt;  å®é™…ç±»å‹ FileChannelImpl</span></span><br><span class="line">    FileChannel fileChannel = fileInputStream.getChannel();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªç¼“å†²åŒºByteBuffer</span></span><br><span class="line">    ByteBuffer byteBuffer = ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°† é€šé“çš„æ•°æ® è¯»å…¥åˆ° Buffer</span></span><br><span class="line">    fileChannel.read(byteBuffer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†byteBufferçš„å­—èŠ‚æ•°æ®è½¬æˆå­—ç¬¦ä¸²</span></span><br><span class="line">    System.out.println(<span class="keyword">new</span> String(byteBuffer.array()));</span><br><span class="line">    fileInputStream.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ‹·è´æ–‡ä»¶</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">copy</span><span class="params">(String source, String destination)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    FileInputStream fileInputStream = <span class="keyword">new</span> FileInputStream(source);</span><br><span class="line">    FileChannel fileChannel1 = fileInputStream.getChannel();</span><br><span class="line"></span><br><span class="line">    FileOutputStream fileOutputStream = <span class="keyword">new</span> FileOutputStream(destination);</span><br><span class="line">    FileChannel fileChannel2 = fileOutputStream.getChannel();</span><br><span class="line"></span><br><span class="line">    ByteBuffer byteBuffer = ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">        <span class="comment">// å¤ä½ï¼Œé‡ç½®æ ‡å¿—ä½</span></span><br><span class="line">        byteBuffer.clear();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> read = fileChannel1.read(byteBuffer);</span><br><span class="line">        <span class="keyword">if</span> (read == -<span class="number">1</span>) &#123;<span class="comment">// è¡¨ç¤ºè¯»å®Œ</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å°†bufferä¸­çš„æ•°æ®å†™å…¥åˆ°fileChannel02 -- K2.txt</span></span><br><span class="line">        byteBuffer.flip();</span><br><span class="line">        fileChannel2.write(byteBuffer);</span><br><span class="line">    &#125;</span><br><span class="line">    fileOutputStream.close();</span><br><span class="line">    fileInputStream.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä½¿ç”¨transferFromå®Œæˆæ‹·è´</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">copyImage</span><span class="params">(String fromPath, String toPath)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºç›¸å…³æµ</span></span><br><span class="line">    FileInputStream fileInputStream = <span class="keyword">new</span> FileInputStream(fromPath);</span><br><span class="line">    FileOutputStream fileOutputStream = <span class="keyword">new</span> FileOutputStream(toPath);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–Channel</span></span><br><span class="line">    FileChannel sourceChannel = fileInputStream.getChannel();</span><br><span class="line">    FileChannel destinChannel = fileOutputStream.getChannel();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨transferFromå®Œæˆæ‹·è´</span></span><br><span class="line">    destinChannel.transferFrom(sourceChannel, <span class="number">0</span>, sourceChannel.size());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³é—­ç›¸å…³æµ</span></span><br><span class="line">    sourceChannel.close();</span><br><span class="line">    destinChannel.close();</span><br><span class="line">    fileInputStream.close();</span><br><span class="line">    fileOutputStream.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>bufferæ•°ç»„å®Œæˆè¯»å†™æ“ä½œ</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Scattering: å°†æ•°æ®å†™å…¥åˆ°bufferæ—¶ï¼Œå¯ä»¥é‡‡ç”¨bufferæ•°ç»„ï¼Œä¾æ¬¡å†™å…¥[åˆ†æ•£]</span></span><br><span class="line"><span class="comment">// Gathering: ä»bufferè¯»å–æ•°æ®æ—¶ï¼Œå¯ä»¥é‡‡ç”¨bufferæ•°ç»„ï¼Œä¾æ¬¡è¯»å–[èšé›†]</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScatteringAndGatheringTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">demo</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ServerSocketChannel å’Œ SocketChannel ç½‘ç»œ</span></span><br><span class="line">        ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();</span><br><span class="line">        InetSocketAddress inetSocketAddress = <span class="keyword">new</span> InetSocketAddress(<span class="number">7000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç»‘å®šç«¯å£åˆ°Socketï¼Œå¹¶å¯åŠ¨</span></span><br><span class="line">        serverSocketChannel.socket().bind(inetSocketAddress);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºbufferæ•°ç»„</span></span><br><span class="line">        ByteBuffer[] byteBuffers = <span class="keyword">new</span> ByteBuffer[<span class="number">2</span>];</span><br><span class="line">        byteBuffers[<span class="number">0</span>] = ByteBuffer.allocate(<span class="number">5</span>);</span><br><span class="line">        byteBuffers[<span class="number">1</span>] = ByteBuffer.allocate(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç­‰å®¢æˆ·ç«¯è¿æ¥</span></span><br><span class="line">        SocketChannel socketChannel = serverSocketChannel.accept();</span><br><span class="line">        <span class="keyword">int</span> messageLength = <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¾ªç¯çš„è¯»å–</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> byteRead = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (byteRead &lt; messageLength) &#123;</span><br><span class="line">                <span class="keyword">long</span> l = socketChannel.read(byteBuffers);</span><br><span class="line">                byteRead  += l;</span><br><span class="line">                System.out.println(<span class="string">&quot;byteRead = &quot;</span> + byteRead);</span><br><span class="line">                Arrays.asList(byteBuffers)</span><br><span class="line">                        .stream()</span><br><span class="line">                        .map(buffer -&gt; <span class="string">&quot;position = &quot;</span></span><br><span class="line">                                + buffer.position()</span><br><span class="line">                                + <span class="string">&quot;, limit = &quot;</span></span><br><span class="line">                                + buffer.limit())</span><br><span class="line">                        .forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// å°†æ‰€æœ‰çš„bufferåè½¬</span></span><br><span class="line">                Arrays.asList(byteBuffers).forEach(buffer -&gt; buffer.flip());</span><br><span class="line"></span><br><span class="line">                <span class="comment">// å°†æ•°æ®è¯»å‡ºæ˜¾ç¤ºåˆ°å®¢æˆ·ç«¯</span></span><br><span class="line">                <span class="keyword">long</span> byteWrite = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">while</span> (byteWrite &lt; messageLength) &#123;</span><br><span class="line">                    socketChannel.write(byteBuffers);</span><br><span class="line">                    byteWrite += <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// å°†æ‰€æ¬²çš„bufferè¿›è¡Œclear</span></span><br><span class="line">                Arrays.asList(byteBuffers).forEach(buffer -&gt; &#123;</span><br><span class="line">                    buffer.clear();</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">                System.out.println(</span><br><span class="line">                                <span class="string">&quot;byteRead = &quot;</span> + byteRead</span><br><span class="line">                                + <span class="string">&quot;, byteWrite = &quot;</span> + byteWrite</span><br><span class="line">                                + <span class="string">&quot;, messageLength = &quot;</span> + messageLength);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h4 id="1-2-4-å®ä¾‹"><a href="#1-2-4-å®ä¾‹" class="headerlink" title="1.2.4 å®ä¾‹"></a>1.2.4 å®ä¾‹</h4><p><strong>ç¾¤èŠç³»ç»ŸDemo</strong></p>
<p>ç¼–ç æ­¥éª¤ï¼š</p>
<ol>
<li>å½“å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼Œä¼šé€šè¿‡<code>ServerSocketChannel</code> å¾—åˆ° SocketChannel</li>
<li>Selector è¿›è¡Œç›‘å¬ select æ–¹æ³•, è¿”å›æœ‰äº‹ä»¶å‘ç”Ÿçš„é€šé“çš„ä¸ªæ•°.</li>
<li>å°†socketChannelæ³¨å†Œåˆ°Selectorä¸Š, register(Selector sel, int ops), ä¸€ä¸ªselectorä¸Šå¯ä»¥æ³¨å†Œå¤šä¸ªSocketChannel</li>
<li>æ³¨å†Œåè¿”å›ä¸€ä¸ª SelectionKey, ä¼šå’Œè¯¥Selector å…³è”(é›†åˆ)</li>
<li>è¿›ä¸€æ­¥å¾—åˆ°å„ä¸ª SelectionKey (æœ‰äº‹ä»¶å‘ç”Ÿ)</li>
<li>åœ¨é€šè¿‡ SelectionKey åå‘è·å– SocketChannel , æ–¹æ³• channel()</li>
<li>åˆ¤æ–­è¯¥Channelçš„äº‹ä»¶ç±»å‹ï¼Œå¯¹ä¸åŒäº‹ä»¶è¿›è¡Œä¸åŒçš„ä¸šåŠ¡å¤„ç†</li>
</ol>
<blockquote>
<p>NIOServer</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kag.nio.groupchat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2020/9/19 22:59</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GroupChatServer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(GroupChatServer.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Selector selector;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ServerSocketChannel listenChannel;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> PORT = <span class="number">3333</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GroupChatServer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1ã€è·å–é€‰æ‹©å™¨</span></span><br><span class="line">            selector = Selector.open();</span><br><span class="line">            <span class="comment">// 2ã€è·å–é€šé“</span></span><br><span class="line">            listenChannel = ServerSocketChannel.open();</span><br><span class="line">            <span class="comment">// 3ã€ç»‘å®šç«¯å£</span></span><br><span class="line">            listenChannel.socket().bind(<span class="keyword">new</span> InetSocketAddress(PORT));</span><br><span class="line">            <span class="comment">// 4ã€è®¾ç½®éé˜»å¡</span></span><br><span class="line">            listenChannel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">            <span class="comment">// 5ã€å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ï¼Œæ³¨å†Œæ“ä½œï¼šâ€œæ¥æ”¶â€</span></span><br><span class="line">            listenChannel.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.info(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç›‘å¬</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listen</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 6ã€é‡‡ç”¨è½®è¯¢çš„æ–¹å¼ï¼ŒæŸ¥è¯¢è·å–â€œå‡†å¤‡å°±ç»ªâ€çš„æ³¨å†Œè¿‡çš„æ“ä½œ</span></span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="keyword">int</span> count = selector.select();</span><br><span class="line">                <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="comment">// 7ã€è·å–å½“å‰é€‰æ‹©å™¨ä¸­æ‰€æœ‰æ³¨å†Œçš„é€‰æ‹©é”®</span></span><br><span class="line">                    Iterator&lt;SelectionKey&gt; iterator = selector.selectedKeys().iterator();</span><br><span class="line">                    <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">                        <span class="comment">// 8ã€è·å–â€œå‡†å¤‡å°±ç»ªâ€çš„æ—¶é—´</span></span><br><span class="line">                        SelectionKey selectionKey = iterator.next();</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// 9ã€åˆ¤æ–­selectionKeyæ˜¯å…·ä½“çš„ä»€ä¹ˆäº‹ä»¶</span></span><br><span class="line">                        <span class="comment">// ç›‘å¬åˆ°acceptäº‹ä»¶</span></span><br><span class="line">                        <span class="keyword">if</span> (selectionKey.isAcceptable()) &#123;</span><br><span class="line">                            <span class="comment">// 10ã€è‹¥æ¥å—çš„äº‹ä»¶æ˜¯â€œæ¥æ”¶å°±ç»ªâ€æ“ä½œï¼Œå°±è·å–å®¢æˆ·ç«¯è¿æ¥</span></span><br><span class="line">                            SocketChannel socketChannel = listenChannel.accept();</span><br><span class="line">                            <span class="comment">// 11ã€åˆ‡æ¢ä¸ºéé˜»å¡æ¨¡å¼</span></span><br><span class="line">                            socketChannel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">                            <span class="comment">// å°†è¯¥é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Š</span></span><br><span class="line">                            socketChannel.register(selector, SelectionKey.OP_READ);</span><br><span class="line">                            log.info(<span class="string">&quot;[&quot;</span> + socketChannel.getRemoteAddress().toString().substring(<span class="number">1</span>) + <span class="string">&quot;]ä¸Šçº¿&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// ç›‘å¬åˆ°readäº‹ä»¶</span></span><br><span class="line">                        <span class="keyword">if</span> (selectionKey.isReadable()) &#123;</span><br><span class="line">                            <span class="comment">// å¤„ç†è¯» (ä¸“é—¨æ–¹æ³•)</span></span><br><span class="line">                            readMessage(selectionKey);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// endï¼šç§»é™¤é€‰æ‹©é”®ï¼Œé˜²æ­¢é‡å¤æ“ä½œ</span></span><br><span class="line">                        iterator.remove();</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    log.info(<span class="string">&quot;ç­‰å¾…Â·Â·Â·Â·&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯»å–å®¢æˆ·ç«¯æ¶ˆæ¯</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readMessage</span><span class="params">(SelectionKey selectionKey)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å®šä¹‰ä¸€ä¸ª SocketChannel</span></span><br><span class="line">        SocketChannel socketChannel = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 13ã€è·å–è¯¥é€‰æ‹©å™¨ä¸Šçš„â€œè¯»å°±ç»ªâ€çŠ¶æ€çš„é€šé“</span></span><br><span class="line">            socketChannel = (SocketChannel) selectionKey.channel();</span><br><span class="line">            <span class="comment">// 14ã€è¯»å–æ•°æ®</span></span><br><span class="line">            ByteBuffer buffer = ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> count = socketChannel.read(buffer);</span><br><span class="line">            <span class="comment">// æ ¹æ®countçš„hå€¼åšå¤„ç†</span></span><br><span class="line">            <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// æŠŠç¼“å­˜åŒºçš„æ•°æ®è½¬æˆå­—ç¬¦ä¸²</span></span><br><span class="line">                String msg = <span class="keyword">new</span> String(buffer.array());</span><br><span class="line">                <span class="comment">// è¾“å‡ºè¯¥æ¶ˆæ¯</span></span><br><span class="line">                log.info(<span class="string">&quot;å®¢æˆ·ç«¯-&quot;</span> + msg);</span><br><span class="line">                <span class="comment">// å‘å…¶ä»–å®¢æˆ·ç«¯è½¬å‘æ¶ˆæ¯(æ’é™¤è‡ªå·±)ï¼Œä¸“é—¨å†™ä¸€ä¸ªæ–¹æ³•æ¥å¤„ç†</span></span><br><span class="line">                sendMessageToOtherClients(msg, socketChannel);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                log.info(<span class="string">&quot;[&quot;</span> + socketChannel.getRemoteAddress().toString().substring(<span class="number">1</span>) + <span class="string">&quot;]ç¦»çº¿&quot;</span>);</span><br><span class="line">                <span class="comment">// å–æ¶ˆæ³¨å†Œ</span></span><br><span class="line">                selectionKey.cancel();</span><br><span class="line">                <span class="comment">// å…³é—­é€šé“</span></span><br><span class="line">                socketChannel.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException ioException) &#123;</span><br><span class="line">                log.error(e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è½¬å‘æ¶ˆæ¯ç»™å…¶ä»–å®¢æˆ·</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendMessageToOtherClients</span><span class="params">(String msg, SocketChannel self)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;æœåŠ¡å™¨è½¬å‘æ¶ˆæ¯&quot;</span>);</span><br><span class="line">        <span class="comment">// éå†æ‰€æœ‰æ³¨å†Œåˆ° selector ä¸Šçš„SocketChannelï¼Œå¹¶æ’é™¤self</span></span><br><span class="line">        <span class="keyword">for</span> (SelectionKey key : selector.keys()) &#123;</span><br><span class="line">            <span class="comment">// é€šè¿‡ key å–å‡º å¯¹åº”çš„ SocketChannel</span></span><br><span class="line">            Channel targetChannel = key.channel();</span><br><span class="line">            <span class="comment">// æ’é™¤è‡ªå·±</span></span><br><span class="line">            <span class="keyword">if</span> (targetChannel <span class="keyword">instanceof</span> SocketChannel &amp;&amp; targetChannel != self) &#123;</span><br><span class="line">                <span class="comment">// è½¬å‹</span></span><br><span class="line">                SocketChannel dest = (SocketChannel) targetChannel;</span><br><span class="line">                <span class="comment">// å°†msgå­˜å‚¨åˆ°buffer</span></span><br><span class="line">                ByteBuffer byteBuffer = ByteBuffer.wrap(msg.getBytes());</span><br><span class="line">                <span class="comment">// å°†bufferçš„æ•°æ®å†™å…¥é€šé“</span></span><br><span class="line">                dest.write(byteBuffer);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºæœåŠ¡å™¨å¯¹è±¡</span></span><br><span class="line">        GroupChatServer groupChatServer = <span class="keyword">new</span> GroupChatServer();</span><br><span class="line">        groupChatServer.listen();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>NIOClient</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kag.nio.groupchat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SelectionKey;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.Selector;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2020/9/20 0:53</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GroupChatClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(GroupChatClient.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String HOST = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span>    PORT = <span class="number">3333</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Selector selector;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> SocketChannel socketChannel;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„é€ å™¨</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GroupChatClient</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        selector = Selector.open();</span><br><span class="line">        <span class="comment">// è¿æ¥æœåŠ¡å™¨</span></span><br><span class="line">        socketChannel = socketChannel.open(<span class="keyword">new</span> InetSocketAddress(HOST, PORT));</span><br><span class="line">        <span class="comment">// è®¾ç½®éé˜»å¡</span></span><br><span class="line">        socketChannel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">// å°†socketChannelæ³¨å†Œåˆ°selector</span></span><br><span class="line">        socketChannel.register(selector, SelectionKey.OP_READ);</span><br><span class="line">        <span class="comment">// å¾—åˆ°username</span></span><br><span class="line">        username = socketChannel.getLocalAddress().toString().substring(<span class="number">1</span>);</span><br><span class="line">        log.info(<span class="string">&quot;[&quot;</span> + username + <span class="string">&quot;]å·²å°±ç»ªÂ·Â·Â·&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘æœåŠ¡å™¨å‘é€æ¶ˆæ¯</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        msg = username + <span class="string">&quot;: &quot;</span> + msg;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            socketChannel.write(ByteBuffer.wrap(msg.getBytes()));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»æœåŠ¡å™¨å›å¤çš„æ¶ˆæ¯</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> readChannels = selector.select();</span><br><span class="line">            <span class="keyword">if</span> (readChannels &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                Iterator&lt;SelectionKey&gt; iterator = selector.selectedKeys().iterator();</span><br><span class="line">                <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">                    SelectionKey key = iterator.next();</span><br><span class="line">                    <span class="keyword">if</span> (key.isReadable()) &#123;</span><br><span class="line">                        <span class="comment">// å¾—åˆ°ç›¸å…³çš„é€šé“</span></span><br><span class="line">                        SocketChannel socketChannel = (SocketChannel) key.channel();</span><br><span class="line">                        <span class="comment">// å¾—åˆ°ä¸€ä¸ªbuffer</span></span><br><span class="line">                        ByteBuffer buffer = ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">                        <span class="comment">// è¯»å–</span></span><br><span class="line">                        socketChannel.read(buffer);</span><br><span class="line">                        <span class="comment">// æŠŠè¯»åˆ°çš„ç¼“å†²åŒºçš„æ•°æ®è½¬æˆå­—ç¬¦ä¸²</span></span><br><span class="line">                        String msg = <span class="keyword">new</span> String(buffer.array());</span><br><span class="line">                        log.info(msg);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// åˆ é™¤å½“å‰ SelectionKey</span></span><br><span class="line">                iterator.remove();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//log.error(&quot;æ— å¯ç”¨çš„é€šé“Â·Â·Â·&quot;);</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">// å¯åŠ¨å®¢æˆ·ç«¯</span></span><br><span class="line">        GroupChatClient chatClient = <span class="keyword">new</span> GroupChatClient();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œæ¯éš”3ç§’ï¼Œè¯»å–ä»æœåŠ¡å™¨</span></span><br><span class="line">        <span class="keyword">new</span> Thread() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                    chatClient.readMessage();</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.currentThread().sleep(<span class="number">3000</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        System.err.println(e.getMessage());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘é€æ•°æ®ç»™æœåŠ¡å™¨</span></span><br><span class="line">        Scanner scanner = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        <span class="keyword">while</span> (scanner.hasNextLine()) &#123;</span><br><span class="line">            String s = scanner.nextLine();</span><br><span class="line">            chatClient.sendMessage(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h4 id="1-2-5-é›¶æ‹·è´"><a href="#1-2-5-é›¶æ‹·è´" class="headerlink" title="1.2.5 é›¶æ‹·è´"></a>1.2.5 é›¶æ‹·è´</h4><blockquote>
<p>è¯´æ˜</p>
</blockquote>
<ul>
<li><p>é›¶æ‹·è´ï¼Œæ˜¯ä»OS(æ“ä½œç³»ç»Ÿ)çš„è§’åº¦æ¥è¯´çš„ã€‚å› ä¸ºå†…æ ¸ç¼“å†²åŒºä¹‹é—´ï¼Œæ²¡æœ‰æ•°æ®æ˜¯é‡å¤çš„</p>
</li>
<li><p>é›¶æ‹·è´ä¸ä»…ä»…å¸¦æ¥æ›´å°‘çš„æ•°æ®å¤åˆ¶ï¼Œè¿˜èƒ½å¸¦æ¥å…¶ä»–çš„æ€§èƒ½ä¼˜åŠ¿ï¼Œæ›´å°‘çš„CPUç¼“å­˜ä¼ªå…±äº«ä»¥åŠæ— CPUæ ¡éªŒå’Œè®¡ç®—</p>
</li>
</ul>
<blockquote>
<p>mmap</p>
</blockquote>
<ul>
<li>mmapé€šè¿‡å†…å­˜æ˜ å°„ï¼Œå°†æ–‡ä»¶æ˜ å°„åˆ°å†…æ ¸ç¼“å†²åŒºï¼ŒåŒæ—¶ï¼Œç”¨æˆ·ç©ºé—´å¯ä»¥å…±äº«å†…æ ¸ç©ºé—´çš„æ•°æ®ã€‚è¿™æ ·ï¼Œåœ¨è¿›è¡Œç½‘ç»œä¼ è¾“æ—¶ï¼Œå°±å¯ä»¥å‡å°‘å†…æ ¸ç©ºé—´åˆ°ç”¨æˆ·ç©ºé—´çš„æ‹·è´æ¬¡æ•°</li>
</ul>
<blockquote>
<p>mmapå’ŒsendFileçš„åŒºåˆ«</p>
</blockquote>
<ul>
<li>mmpé€‚åˆå°æ•°æ®é‡è¯»å†™ï¼ŒsendFileé€‚åˆå¤§æ–‡ä»¶ä¼ è¾“</li>
<li>mmapéœ€è¦4æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œ3æ¬¡æ•°æ®æ‹·è´ï¼›sendFileéœ€è¦3æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæœ€å°‘2æ¬¡æ•°æ®æ‹·è´</li>
<li>sendFileå¯ä»¥åˆ©ç”¨DMA(direct memory access: ç›´æ¥å†…å­˜æ‹·è´)æ–¹å¼ï¼Œå‡å°‘CPUæ‹·è´ï¼Œmmapåˆ™ä¸èƒ½(å¿…é¡»ä»å†…æ ¸æ‹·è´åˆ°Socketç¼“å†²åŒº)</li>
</ul>
<h2 id="2-æ¦‚è¿°"><a href="#2-æ¦‚è¿°" class="headerlink" title="2. æ¦‚è¿°"></a>2. æ¦‚è¿°</h2><p>å®˜ç½‘: <a href="https://netty.io/">Netty.io</a></p>
<h3 id="1-1-ä»‹ç»"><a href="#1-1-ä»‹ç»" class="headerlink" title="1.1 ä»‹ç»"></a>1.1 ä»‹ç»</h3><p>Nettyæ˜¯ä¸€ä¸ªå¼‚æ­¥äº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨ç¨‹åºæ¡†æ¶ï¼Œç”¨äºå¿«é€Ÿå¼€å‘å¯ç»´æŠ¤çš„é«˜æ€§èƒ½åè®®æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚</p>
<h3 id="1-2-è®¾è®¡"><a href="#1-2-è®¾è®¡" class="headerlink" title="1.2 è®¾è®¡"></a>1.2 è®¾è®¡</h3><ul>
<li>é€‚ç”¨äºå„ç§ä¼ è¾“ç±»å‹çš„ç»Ÿä¸€API-é˜»å¡å’Œéé˜»å¡å¥—æ¥å­—</li>
<li>åŸºäºçµæ´»ä¸”å¯æ‰©å±•çš„äº‹ä»¶æ¨¡å‹ï¼Œå¯å°†å…³æ³¨ç‚¹æ˜ç¡®åˆ†ç¦»</li>
<li>é«˜åº¦å¯å®šåˆ¶çš„çº¿ç¨‹æ¨¡å‹-å•çº¿ç¨‹ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹æ± ï¼Œä¾‹å¦‚SEDA</li>
<li>çœŸæ­£çš„æ— è¿æ¥æ•°æ®æŠ¥å¥—æ¥å­—æ”¯æŒï¼ˆä»3.1å¼€å§‹ï¼‰</li>
</ul>
<h3 id="1-3-æ€§èƒ½"><a href="#1-3-æ€§èƒ½" class="headerlink" title="1.3 æ€§èƒ½"></a>1.3 æ€§èƒ½</h3><ul>
<li>æ›´é«˜çš„ååé‡ï¼Œæ›´ä½çš„å»¶è¿Ÿ</li>
<li>å‡å°‘èµ„æºæ¶ˆè€—</li>
<li>å‡å°‘ä¸å¿…è¦çš„å†…å­˜å¤åˆ¶</li>
</ul>
<h3 id="1-4-æ¶æ„"><a href="#1-4-æ¶æ„" class="headerlink" title="1.4 æ¶æ„"></a>1.4 æ¶æ„</h3><img src="/2020/10/01/Netty/image-20200921092848809.png" class="" title="image-20200921092848809">



<h2 id="3-Reactor"><a href="#3-Reactor" class="headerlink" title="3. Reactor"></a>3. Reactor</h2><h3 id="2-1-ä»‹ç»"><a href="#2-1-ä»‹ç»" class="headerlink" title="2.1 ä»‹ç»"></a>2.1 ä»‹ç»</h3><blockquote>
<p>ååº”å™¨æ¨¡å¼  |  åˆ†å‘è€…æ¨¡å¼  |  é€šçŸ¥è€…æ¨¡å¼</p>
</blockquote>
<ul>
<li>åŸºäºI/Oå¤ç”¨æ¨¡å‹: å¤šä¸ªè¿æ¥å…±ç”¨ä¸€ä¸ªé˜»å¡å¯¹è±¡ï¼Œåº”ç”¨ç¨‹åºåªéœ€è¦å†ä¸€ä¸ªé˜»å¡å¯¹è±¡ç­‰å¾…ï¼Œæ— éœ€é˜»å¡ç­‰å¾…æ‰€æœ‰è¿æ¥ã€‚å½“æŸä¸ªè¿æ¥æœ‰æ–°çš„æ•°æ®å¯ä»¥å¤„ç†æ—¶ï¼Œæ“ä½œç³»ç»Ÿé€šçŸ¥åº”ç”¨ç¨‹åºï¼Œçº¿ç¨‹ä»é˜»å¡çŠ¶æ€è¿”å›ï¼Œå¼€å§‹è¿›è¡Œä¸šåŠ¡å¤„ç†</li>
<li>åŸºäºçº¿ç¨‹æ± å¤ç”¨çº¿ç¨‹èµ„æº: ä¸å¿…å†ä¸ºæ¯ä¸ªè¿æ¥åˆ›å»ºçº¿ç¨‹ï¼Œé”®è¿æ¥å®Œæˆåçš„ä¸šåŠ¡å¤„ç†çƒ­èˆåˆ†é…ç»™çº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤„ç†å¤šä¸ªè¿æ¥çš„ä¸šåŠ¡</li>
</ul>
<h3 id="2-2-ç»„æˆ"><a href="#2-2-ç»„æˆ" class="headerlink" title="2.2 ç»„æˆ"></a>2.2 ç»„æˆ</h3><ul>
<li>Reactor: Reactoråœ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ä¸­è¿è¡Œï¼Œè´Ÿè´£ç›‘å¬å’Œåˆ†å‘äº‹ä»¶ï¼Œåˆ†å‘ç»™é€‚å½“çš„å¤„ç†ç¨‹åºæ¥å¯¹IOäº‹ä»¶åšå‡ºååº”ã€‚</li>
<li>Handlers: å¤„ç†ç¨‹åºæ‰§è¡ŒI/Oäº‹ä»¶è¦å®Œæˆçš„å®é™…äº‹ä»¶ã€‚Reactoré€šè¿‡è°ƒåº¦é€‚å½“çš„å¤„ç†ç¨‹åºæ¥å“åº”I/Oäº‹ä»¶ï¼Œå¤„ç†ç¨‹åºæ‰§è¡Œéé˜»å¡æ“ä½œã€‚</li>
</ul>
<h3 id="2-3-åˆ†ç±»"><a href="#2-3-åˆ†ç±»" class="headerlink" title="2.3 åˆ†ç±»"></a>2.3 åˆ†ç±»</h3><ul>
<li>å•Reactorå•çº¿ç¨‹        â”â”â”â”â”â–¶    å‰å°æ¥å¾…å‘˜å’ŒæœåŠ¡å‘˜æ˜¯åŒä¸€ä¸ªäººï¼Œå…¨ç¨‹ä¸ºé¡¾å®¢æœåŠ¡</li>
<li>å•Reactorå¤šçº¿ç¨‹        â”â”â”â”â”â–¶    1ä¸ªå‰å°æ¥å¾…å‘˜ï¼Œå¤šä¸ªæœåŠ¡å‘˜ï¼Œæ¥å¾…å‘˜åªè´Ÿè´£æ¥å¾…</li>
<li>ä¸»ä»Reactorå¤šçº¿ç¨‹    â”â”â”â”â”â–¶    å¤šä¸ªå‰å°æ¥å¾…å‘˜ï¼Œå¤šä¸ªæœåŠ¡ç”Ÿ</li>
</ul>
<h4 id="2-2-1-å•Reactorå•çº¿ç¨‹"><a href="#2-2-1-å•Reactorå•çº¿ç¨‹" class="headerlink" title="2.2.1 å•Reactorå•çº¿ç¨‹"></a>2.2.1 å•Reactorå•çº¿ç¨‹</h4><blockquote>
<p>å›¾ç¤º</p>
</blockquote>
<img src="/2020/10/01/Netty/image-20200921181936951.png" class="" title="image-20200921181936951">

<blockquote>
<p>åˆ†æ</p>
</blockquote>
<ol>
<li>ä¼˜ç‚¹ï¼šæ¨¡å‹ç®€å•ï¼Œæ²¡æœ‰å¤šçº¿ç¨‹ã€è¿›ç¨‹é€šä¿¡ã€ç«äº‰çš„é—®é¢˜ï¼Œå…¨éƒ¨éƒ½åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å®Œæˆ</li>
<li>ç¼ºç‚¹ï¼šæ€§èƒ½é—®é¢˜ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œæ— æ³•å‘æŒ¥å¤šæ ¸CPUçš„æ€§èƒ½ã€‚<code>Handler</code>åœ¨å¤„ç†æŸä¸ªè¿æ¥ä¸Šçš„ä¸šåŠ¡æ—¶ï¼Œæ•´ä¸ªè¿›ç¨‹æ— æ³•å¤„ç†å…¶ä»–è¿æ¥äº‹ä»¶ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´æ€§èƒ½ç“¶é¢ˆ</li>
<li>ç¼ºç‚¹ï¼šå¯é æ€§é—®é¢˜ï¼Œçº¿ç¨‹æ„å¤–ç»ˆæ­¢ï¼Œæˆ–è€…è¿›å…¥æ­»å¾ªç¯ï¼Œä¼šå¯¼è‡´æ•´ä¸ªç³»ç»Ÿé€šä¿¡æ¨¡å—ä¸å¯ç”¨ï¼Œä¸èƒ½æ¥æ”¶å’Œå¤„ç†å¤–éƒ¨æ¶ˆæ¯ï¼Œé€ æˆèŠ‚ç‚¹æ•…éšœ</li>
<li>ä½¿ç”¨åœºæ™¯ï¼šå®¢æˆ·ç«¯çš„æ•°é‡æœ‰é™ï¼Œä¸šåŠ¡å¤„ç†éå¸¸å¿«é€Ÿ</li>
</ol>
<h4 id="2-2-2-å•Reactorå¤šçº¿ç¨‹"><a href="#2-2-2-å•Reactorå¤šçº¿ç¨‹" class="headerlink" title="2.2.2 å•Reactorå¤šçº¿ç¨‹"></a>2.2.2 å•Reactorå¤šçº¿ç¨‹</h4><blockquote>
<p>å›¾ç¤º</p>
</blockquote>
<img src="/2020/10/01/Netty/image-20200921182914960.png" class="" title="image-20200921182914960">

<blockquote>
<p>æ–¹æ¡ˆè¯´æ˜</p>
</blockquote>
<ol>
<li><code>Reactor</code>å¯¹è±¡é€šè¿‡<code>select</code>ç›‘æ§å®¢æˆ·ç«¯è¯·æ±‚äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åï¼Œé€šè¿‡<code>dispatch</code>è¿›è¡Œåˆ†å‘</li>
<li>å¦‚æœå»ºç«‹è¿æ¥è¯·æ±‚ï¼Œåˆ™ç”±<code>Acceptor</code>é€šè¿‡<code>accept</code>å¤„ç†è¿æ¥è¯·æ±‚ï¼Œç„¶åä»é»„å¥ä¸€ä¸ªHandlerå¯¹è±¡å¤„ç†å®Œæˆè¿æ¥åçš„å„ç§äº‹ä»¶</li>
<li>å¦‚æœä¸æ˜¯è¿æ¥è¯·æ±‚ï¼Œåˆ™ç”±<code>Reactor</code>åˆ†å‘è°ƒç”¨è¿æ¥å¯¹åº”çš„<code>handler</code>è¯»å–æ•°æ®åï¼Œä¼šåˆ†å‘ç»™åé¢çš„<code>Worker</code>çº¿ç¨‹æ± çš„æŸä¸ªçº¿ç¨‹å¤„ç†ä¸šåŠ¡</li>
<li><code>Handler</code>åªè´Ÿè´£å“åº”äº‹ä»¶ï¼Œä¸åšå…·ä½“çš„ä¸šåŠ¡å¤„ç†ï¼Œé€šè¿‡<code>read</code>è¯»å–æ•°æ®åï¼Œä¼šåˆ†å‘ç»™åé¢çš„<code>worker</code>çº¿ç¨‹æ± çš„æŸä¸ªçº¿ç¨‹å¤„ç†ä¸šåŠ¡</li>
<li><code>Worker</code>çº¿ç¨‹æ± ä¼šåˆ†é…ç‹¬ç«‹çº¿ç¨‹å®ŒæˆçœŸæ­£çš„ä¸šåŠ¡ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™<code>Handler</code></li>
<li><code>Handler</code>æ”¶åˆ°å“åº”åï¼Œé€šè¿‡<code>send</code>å°†ç»“æœè¿”å›ç»™<code>Client</code></li>
</ol>
<blockquote>
<p>åˆ†æ</p>
</blockquote>
<ol>
<li>ä¼˜ç‚¹ï¼šå¯ä»¥å……åˆ†çš„åˆ©ç”¨å¤šæ ¸<code>CPU</code>çš„å¤„ç†èƒ½åŠ›</li>
<li>ç¼ºç‚¹ï¼šå¤šçº¿ç¨‹æ•°æ®å…±äº«å’Œè®¿é—®æ¯”è¾ƒå¤æ‚ï¼Œ<code>Reactor</code>å¤„ç†æ‰€æœ‰çš„äº‹ä»¶çš„ç›‘å¬å’Œå“åº”ï¼Œåœ¨å•çº¿ç¨‹è¿è¡Œï¼Œåœ¨é«˜å¹¶å‘åœºæ™¯å®¹æ˜“æˆä¸ºæ€§èƒ½ç“¶é¢ˆ</li>
</ol>
<h4 id="2-2-3-ä¸»ä»Reactorå¤šçº¿ç¨‹"><a href="#2-2-3-ä¸»ä»Reactorå¤šçº¿ç¨‹" class="headerlink" title="2.2.3 ä¸»ä»Reactorå¤šçº¿ç¨‹"></a>2.2.3 ä¸»ä»Reactorå¤šçº¿ç¨‹</h4><blockquote>
<p>å›¾ç¤º</p>
</blockquote>
<img src="/2020/10/01/Netty/image-20200921191731035.png" class="" title="image-20200921191731035">

<blockquote>
<p>æ–¹æ¡ˆè¯´æ˜</p>
</blockquote>
<ol>
<li><code>Reactor</code>ä¸»çº¿ç¨‹<code>MainReactor</code>å¯¹è±¡é€šè¿‡<code>select</code>ç›‘å¬è¿æ¥äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åï¼Œé€šè¿‡<code>Acceptor</code>å¤„ç†è¿æ¥äº‹ä»¶</li>
<li>å½“<code>Acceptor</code>å¤„ç†è¿æ¥äº‹ä»¶åï¼Œ<code>MainReactor</code>å°†è¿æ¥åˆ†é…ç»™<code>SubReactor</code></li>
<li><code>SubReactor</code>å°†è¿æ¥åŠ å…¥åˆ°è¿æ¥é˜Ÿåˆ—è¿›è¡Œç›‘å¬ï¼Œå¹¶åˆ›å»º<code>Handler</code>è¿›è¡Œå„ç§äº‹ä»¶å¤„ç†</li>
<li>å½“æœ‰æ–°äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œ<code>SubReactor</code>å°±ä¼šè°ƒç”¨å¯¹åº”çš„Handlerå¤„ç†</li>
<li><code>Worker</code>çº¿ç¨‹æ± åˆ†é…ç‹¬ç«‹çš„<code>Worker</code>çº¿ç¨‹è¿›è¡Œä¸šåŠ¡å¤„ç†ï¼Œå¹¶è¿”å›ç»“æœ</li>
<li><code>Handler</code>æ”¶åˆ°å“åº”çš„ç»“æœåï¼Œå†é€šè¿‡<code>send</code>å°†ç»“æœè¿”å›ç»™<code>Client</code></li>
<li><code>Reactor</code>ä¸»çº¿ç¨‹å¯ä»¥å¯¹äºå¤šä¸ª<code>Reactor</code>å­çº¿ç¨‹ï¼Œå³<code>MainReactor</code>ï¼Œå¯ä»¥å…³è”å¤šä¸ª<code>SubReactor</code></li>
</ol>
<blockquote>
<p>åˆ†æ</p>
</blockquote>
<ol>
<li><p>ä¼˜ç‚¹ï¼šçˆ¶çº¿ç¨‹ä¸å­çº¿ç¨‹çš„èŒè´£æ˜ç¡®ï¼Œçˆ¶çº¿ç¨‹åªéœ€è¦æ¥æ”¶æ–°è¿æ¥ï¼Œå­çº¿ç¨‹å®Œæˆåç»­çš„ä¸šåŠ¡å¤„ç†</p>
</li>
<li><p>ä¼˜ç‚¹ï¼šçˆ¶çº¿ç¨‹ä¸å­çº¿ç¨‹çš„æ•°æ®äº¤äº’ç®€å•ï¼Œ<code>Reactor</code>ä¸»çº¿ç¨‹åªéœ€è¦æŠŠæ–°è¿æ¥ä¼ ç»™å­çº¿ç¨‹ï¼Œå­çº¿ç¨‹æ— éœ€è¿”å›æ•°æ®</p>
</li>
<li><p>ç¼ºç‚¹ï¼šç¼–ç¨‹å¤æ‚åº¦è¾ƒé«˜</p>
</li>
</ol>
<h3 id="2-4-ä¼˜ç‚¹"><a href="#2-4-ä¼˜ç‚¹" class="headerlink" title="2.4 ä¼˜ç‚¹"></a>2.4 ä¼˜ç‚¹</h3><ul>
<li>å“åº”å¿«ï¼Œä¸å¿…ä¸ºå•ä¸ªåŒæ­¥æ—¶é—´æ‰€é˜»å¡ï¼Œè™½ç„¶<code>Reactor</code>æœ¬èº«ä¾ç„¶æ˜¯åŒæ­¥çš„</li>
<li>å¯ä»¥æœ€å¤§ç¨‹åº¦çš„æ¯”æ›¼å¤æ‚çš„å¤šçº¿ç¨‹åŠåŒæ­¥é—®é¢˜ï¼Œå¹¶ä¸”é¿å…äº†å¤šçº¿ç¨‹/è¿›ç¨‹çš„åˆ‡æ¢å¼€é”€</li>
<li>æ‰©å±•æ€§å¥½ï¼Œå¯ä»¥æ–¹ä¾¿çš„é€šè¿‡å¢åŠ <code>Reactor</code>å®ä¾‹ä¸ªæ•°æ¥å……åˆ†åˆ©ç”¨CPUèµ„æº</li>
<li>å¤ç”¨æ€§å¥½ï¼Œ<code>Reactor</code>æ¨¡å‹æœ¬èº«ä¸å…·ä½“äº‹ä»¶å¤„ç†é€»è¾‘æ— å…³ï¼Œå…·æœ‰å¾ˆé«˜çš„å¤ç”¨æ€§</li>
</ul>
<h2 id="4-æ¶æ„"><a href="#4-æ¶æ„" class="headerlink" title="4. æ¶æ„"></a>4. æ¶æ„</h2><h3 id="3-1-å›¾ç¤º"><a href="#3-1-å›¾ç¤º" class="headerlink" title="3.1 å›¾ç¤º"></a>3.1 å›¾ç¤º</h3><img src="/2020/10/01/Netty/image-20200921204851799.png" class="" title="image-20200921204851799">

<h3 id="3-2-è¯´æ˜"><a href="#3-2-è¯´æ˜" class="headerlink" title="3.2 è¯´æ˜"></a>3.2 è¯´æ˜</h3><ol>
<li><code>Netty</code>æŠ½è±¡å‡ºä¸¤ç»„çº¿ç¨‹æ± <code>BossGroup</code>ä¸“é—¨è´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œ<code>WorkerGroup</code>ä¸“é—¨è´Ÿè´£ç½‘ç»œçš„è¯»å†™</li>
<li><code>BossGroup</code>å’Œ<code>WorkerGroup</code>ç±»å‹çš„æœ¬è´¨éƒ½æ˜¯<code>NioEventLoopGroup</code></li>
<li><code>NioEventLoopGroup</code>ç›¸å½“äºä¸€ä¸ªäº‹ä»¶å¾ªç¯ç»„ï¼Œè¿™ä¸ªç»„ä¸­å«æœ‰å¤šä¸ªäº‹ä»¶å¾ªç¯ï¼Œæ¯ä¸€ä¸ªäº‹ä»¶å¾ªç¯æ˜¯<code>NioEventLoop</code></li>
<li><code>NioEventLoop</code>è¡¨ç¤ºä¸€ä¸ªä¸æ–­å¾ªç¯çš„æ‰§è¡Œå¤„ç†ä»»åŠ¡çš„çº¿ç¨‹ï¼Œæ¯ä¸ª<code>NioEventLoop</code>éƒ½æœ‰ä¸€ä¸ª<code>selector</code>ï¼Œç”¨äºç›‘å¬ç»‘å®šåœ¨å…¶ä¸Šçš„socketçš„ç½‘ç»œé€šè®¯</li>
<li><code>NioEventLoopGroup</code>å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œå³å¯ä»¥å«æœ‰å¤šä¸ª<code>NioEventLoop</code></li>
<li>æ¯ä¸ª<code>Boss NioEventLoop</code>å¾ªç¯æ‰§è¡Œçš„æ­¥éª¤æœ‰ä¸‰æ­¥:<ol>
<li>è½®è¯¢<code>accept</code>äº‹ä»¶</li>
<li>å¤„ç†<code>accept</code>äº‹ä»¶ï¼Œä¸<code>client</code>å»ºç«‹è¿æ¥ï¼Œç”Ÿæˆ<code>NioSocketChannel</code>ï¼Œå¹¶å°†å…¶æ³¨å†Œåˆ°æŸä¸ª<code>Worker NioEventLoop</code>ä¸Šçš„<code>selector</code></li>
<li>å¤„ç†ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œå³<code>runAllTasks</code></li>
</ol>
</li>
<li>æ¯ä¸ª<code>Worker NIOEventLoop</code>å¾ªç¯æ‰§è¡Œçš„æ­¥éª¤<ol>
<li>è½®è¯¢<code>read</code>ã€<code>write</code>äº‹ä»¶</li>
<li>å¤„ç†i/oäº‹ä»¶ï¼Œå³<code>read</code>ã€<code>write</code>äº‹ä»¶ï¼Œåœ¨å¯¹åº”<code>NioSocketChannel</code>å¤„ç†</li>
<li>å¤„ç†ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œå³<code>runAllTasks</code></li>
</ol>
</li>
</ol>
<h3 id="3-3-ä»£ç ç¤ºä¾‹"><a href="#3-3-ä»£ç ç¤ºä¾‹" class="headerlink" title="3.3 ä»£ç ç¤ºä¾‹"></a>3.3 ä»£ç ç¤ºä¾‹</h3><blockquote>
<p>NettyServer.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kag.netty.simple;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.bootstrap.ServerBootstrap;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.*;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2020/9/21 21:53</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NettyServer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * åˆ›å»ºBossGroup å’Œ WorkerGroup</span></span><br><span class="line"><span class="comment">         * è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment">         * 1ã€åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ç»„ï¼šbossGroup å’Œ workerGroup</span></span><br><span class="line"><span class="comment">         * 2ã€bossGroupå¤„ç†è¿æ¥è¯·æ±‚</span></span><br><span class="line"><span class="comment">         * 3ã€workerGroupå¤„ç†å’Œå®¢æˆ·ç«¯çš„ä¸šåŠ¡</span></span><br><span class="line"><span class="comment">         * 4ã€ä¸¤ä¸ªéƒ½æ˜¯æ— é™å¾ªç¯</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        EventLoopGroup bossGroup = <span class="keyword">new</span> NioEventLoopGroup();</span><br><span class="line">        NioEventLoopGroup workerGroup = <span class="keyword">new</span> NioEventLoopGroup();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åˆ›å»ºæœåŠ¡å™¨ç«¯çš„å¯åŠ¨å¯¹è±¡ï¼Œé…ç½®å‚æ•°</span></span><br><span class="line">            ServerBootstrap bootstrap = <span class="keyword">new</span> ServerBootstrap();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ä½¿ç”¨é“¾å¼ç¼–ç¨‹æ¥è¿›è¡Œè®¾ç½®</span></span><br><span class="line">            bootstrap.group(workerGroup, workerGroup)                         <span class="comment">// è®¾ç½®ä¸¤ä¸ªçº¿ç¨‹ç»„</span></span><br><span class="line">                    .channel(NioServerSocketChannel.class)                    <span class="comment">// ä½¿ç”¨NioSocketChannelä½œä¸ºæœåŠ¡å™¨çš„é€šé“å®ç°</span></span><br><span class="line">                    .option(ChannelOption.SO_BACKLOG, <span class="number">128</span>)              <span class="comment">// è®¾ç½®çº¿ç¨‹é˜Ÿåˆ—å¾—åˆ°è¿æ¥ä¸ªæ•°</span></span><br><span class="line">                    .childOption(ChannelOption.SO_KEEPALIVE, <span class="keyword">true</span>)      <span class="comment">// è®¾ç½®ä¿æŒæ´»åŠ¨è¿æ¥çŠ¶æ€</span></span><br><span class="line">                    .childHandler(<span class="keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;   <span class="comment">// åˆ›å»ºä¸€ä¸ªé€šé“æµ‹è¯•å¯¹è±¡</span></span><br><span class="line">                        <span class="comment">// ç»™Pipelineè®¾ç½®å¤„ç†å™¨</span></span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(SocketChannel socketChannel)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                            socketChannel.pipeline().addLast(<span class="keyword">new</span> NettyServerHandler());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);  <span class="comment">// ç»™workerGroupçš„EventLoopå¯¹åº”çš„ç®¡é“è®¾ç½®å¤„ç†å™¨</span></span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;æœåŠ¡å™¨å·²å°±ç»ªÂ·Â·Â·&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ç»‘å®šä¸€ä¸ªç«¯å£å¹¶ä¸”åŒæ­¥</span></span><br><span class="line">            <span class="comment">// ç»‘å®šç«¯å£å¹¶å¯åŠ¨æœåŠ¡å™¨</span></span><br><span class="line">            ChannelFuture channelFuture = bootstrap.bind(<span class="number">3333</span>).sync();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¯¹å…³é—­é€šé“è¿›è¡Œç›‘å¬</span></span><br><span class="line">            channelFuture.channel().closeFuture().sync();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            bossGroup.shutdownGracefully();</span><br><span class="line">            workerGroup.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>NettyHandler.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kag.netty.simple;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.buffer.ByteBuf;</span><br><span class="line"><span class="keyword">import</span> io.netty.buffer.Unpooled;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInboundHandlerAdapter;</span><br><span class="line"><span class="keyword">import</span> io.netty.util.CharsetUtil;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2020/9/21 22:20</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰ä¸€ä¸ªHandleréœ€è¦ç»§æ‰¿Nettyè§„å®šå¥½çš„æŸä¸ªHandlerAdapter</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NettyServerHandler</span> <span class="keyword">extends</span> <span class="title">ChannelInboundHandlerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯»å–æ•°æ®äº‹ä»¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ctx ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå«æœ‰ç®¡é“pipline[å¤„ç†æ•°æ®]ï¼Œé€šé“channel[ä¼ è¾“æ•°æ®]ï¼Œåœ°å€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> msg å®¢æˆ·ç«¯å‘é€çš„æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;server ctx = &quot;</span> + ctx);</span><br><span class="line">        <span class="comment">// å°†msgè½¬æˆByteBuffer</span></span><br><span class="line">        ByteBuf byteBuf = (ByteBuf) msg;</span><br><span class="line">        System.out.println(<span class="string">&quot;å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼š&quot;</span> + byteBuf.toString(CharsetUtil.UTF_8));</span><br><span class="line">        System.out.println(<span class="string">&quot;å®¢æˆ·ç«¯åœ°å€ï¼š&quot;</span> + ctx.channel().remoteAddress());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°æ®è¯»å–å®Œæ¯•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ctx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelReadComplete</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// å°†æ•°æ®å†™å…¥åˆ°ç¼“å­˜ï¼Œå¹¶åˆ·æ–°</span></span><br><span class="line">        ctx.writeAndFlush(Unpooled.copiedBuffer(<span class="string">&quot;Hello, å®¢æˆ·ç«¯~&quot;</span>, CharsetUtil.UTF_8));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ctx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cause</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(cause.getMessage());</span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>NettyClient.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kag.netty.simple;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.buffer.ByteBuf;</span><br><span class="line"><span class="keyword">import</span> io.netty.buffer.Unpooled;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInboundHandlerAdapter;</span><br><span class="line"><span class="keyword">import</span> io.netty.util.CharsetUtil;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2020/9/21 22:20</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰ä¸€ä¸ªHandleréœ€è¦ç»§æ‰¿Nettyè§„å®šå¥½çš„æŸä¸ªHandlerAdapter</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NettyServerHandler</span> <span class="keyword">extends</span> <span class="title">ChannelInboundHandlerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯»å–æ•°æ®äº‹ä»¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ctx ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå«æœ‰ç®¡é“pipline[å¤„ç†æ•°æ®]ï¼Œé€šé“channel[ä¼ è¾“æ•°æ®]ï¼Œåœ°å€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> msg å®¢æˆ·ç«¯å‘é€çš„æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;server ctx = &quot;</span> + ctx);</span><br><span class="line">        <span class="comment">// å°†msgè½¬æˆByteBuffer</span></span><br><span class="line">        ByteBuf byteBuf = (ByteBuf) msg;</span><br><span class="line">        System.out.println(<span class="string">&quot;å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼š&quot;</span> + byteBuf.toString(CharsetUtil.UTF_8));</span><br><span class="line">        System.out.println(<span class="string">&quot;å®¢æˆ·ç«¯åœ°å€ï¼š&quot;</span> + ctx.channel().remoteAddress());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°æ®è¯»å–å®Œæ¯•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ctx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelReadComplete</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// å°†æ•°æ®å†™å…¥åˆ°ç¼“å­˜ï¼Œå¹¶åˆ·æ–°</span></span><br><span class="line">        ctx.writeAndFlush(Unpooled.copiedBuffer(<span class="string">&quot;Hello, å®¢æˆ·ç«¯~&quot;</span>, CharsetUtil.UTF_8));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ctx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cause</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(cause.getMessage());</span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>NettyClientHandler.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kag.netty.simple;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.buffer.ByteBuf;</span><br><span class="line"><span class="keyword">import</span> io.netty.buffer.Unpooled;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInboundHandlerAdapter;</span><br><span class="line"><span class="keyword">import</span> io.netty.util.CharsetUtil;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2020/9/22 19:09</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NettyClientHandler</span> <span class="keyword">extends</span> <span class="title">ChannelInboundHandlerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šé“å°±ç»ª-&gt;è§¦å‘</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ctx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelActive</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;client &quot;</span> +  ctx);</span><br><span class="line">        ctx.writeAndFlush(Unpooled.copiedBuffer(<span class="string">&quot;Hello, server~å–µ&quot;</span>, CharsetUtil.UTF_8));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æœ‰è¯»å–äº‹ä»¶æ—¶-&gt;è§¦å‘</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ctx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> msg</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ByteBuf byteBuf = (ByteBuf) msg;</span><br><span class="line">        System.out.println(<span class="string">&quot;æœåŠ¡å™¨å›å¤æ¶ˆæ¯ï¼š&quot;</span> + byteBuf.toString(CharsetUtil.UTF_8));</span><br><span class="line">        System.out.println(<span class="string">&quot;æœåŠ¡å™¨çš„åœ°å€ï¼š&quot;</span> + ctx.channel().remoteAddress());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ctx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cause</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(cause.getMessage());</span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-4-ä»»åŠ¡é˜Ÿåˆ—"><a href="#3-4-ä»»åŠ¡é˜Ÿåˆ—" class="headerlink" title="3.4 ä»»åŠ¡é˜Ÿåˆ—"></a>3.4 ä»»åŠ¡é˜Ÿåˆ—</h3><p>ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„<code>Task</code>æœ‰ä¸‰ç§å…¸å‹ä½¿ç”¨åœºæ™¯</p>
<ul>
<li>ç”¨æˆ·ç¨‹åºè‡ªå®šä¹‰çš„æ™®é€šä»»åŠ¡</li>
<li>ç”¨æˆ·è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡</li>
<li>éå½“å‰<code>Reactor</code>çº¿ç¨‹è°ƒç”¨<code>Channel</code>çš„å„ç§æ–¹æ³•</li>
</ul>
<h3 id="3-5-å¼‚æ­¥æ¨¡å‹"><a href="#3-5-å¼‚æ­¥æ¨¡å‹" class="headerlink" title="3.5 å¼‚æ­¥æ¨¡å‹"></a>3.5 å¼‚æ­¥æ¨¡å‹</h3><h4 id="3-5-1-åŸºæœ¬ä»‹ç»"><a href="#3-5-1-åŸºæœ¬ä»‹ç»" class="headerlink" title="3.5.1 åŸºæœ¬ä»‹ç»"></a>3.5.1 åŸºæœ¬ä»‹ç»</h4><ol>
<li>å¼‚æ­¥çš„æ¦‚å¿µå’ŒåŒæ­¥ç›¸å¯¹ã€‚å½“ä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹è°ƒç”¨å‘å‡ºåï¼Œè°ƒç”¨è€…ä¸èƒ½ç«‹åˆ»å¾—åˆ°ç»“æœã€‚å®é™…å¤„ç†è¿™ä¸ªè°ƒç”¨çš„ç»„ä»¶åœ¨å®Œæˆåï¼Œé€šè¿‡çŠ¶æ€ã€é€šçŸ¥å’Œå›è°ƒæ¥é€šçŸ¥è°ƒç”¨è€…</li>
<li><code>Netty</code>ä¸­çš„I/Oæ“ä½œæ˜¯å¼‚æ­¥çš„ï¼ŒåŒ…æ‹¬<code>Bind</code>ã€<code>Write</code>ã€<code>Connect</code>ç­‰æ“ä½œä¼šç®€å•çš„è¿”å›ä¸€ä¸ª<code>ChannelFuture</code></li>
<li>è°ƒç”¨è€…å¹¶ä¸èƒ½ç†ç§‘è·å¾—ç»“æœï¼Œè€Œæ˜¯é€šè¿‡Future-Listeneræœºåˆ¶ï¼Œç”¨æˆ·å¯ä»¥æ–¹ä¾¿çš„ä¸»åŠ¨è·å–æˆ–è€…é€šè¿‡é€šçŸ¥æœºåˆ¶è·å¾—IOæ“ä½œç»“æœ</li>
<li><code>Netty</code>çš„å¼‚æ­¥æ¨¡å‹æ˜¯å»ºç«‹åœ¨<code>future</code>å’Œ<code>callback</code>ä¹‹ä¸Šçš„ã€‚<code>callback</code>å°±æ˜¯å›è°ƒã€‚é‡ç‚¹æ˜¯<code>future</code>ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šç»“ç¤¾ä¸€ä¸ªæ–¹æ³•<code>fun</code>ï¼Œè®¡ç®—è¿‡ç¨‹å¯èƒ½éå¸¸è€—æ—¶ï¼Œç­‰å¾…<code>fun</code>è¿”å›æ˜¾ç„¶ä¸åˆé€‚ã€‚é‚£ä¹ˆå¯ä»¥åœ¨è°ƒç”¨<code>fun</code>çš„æ—¶å€™ç«‹é©¬è¿”å›ä¸€ä¸ª<code>future</code>ï¼Œåç»­å¯ä»¥é€šè¿‡<code>future</code>å»ç›‘æ§æ–¹æ³•<code>fun</code>çš„å¤„ç†è¿‡ç¨‹</li>
</ol>
<h4 id="3-5-2-Futureè¯´æ˜"><a href="#3-5-2-Futureè¯´æ˜" class="headerlink" title="3.5.2 Futureè¯´æ˜"></a>3.5.2 Futureè¯´æ˜</h4><ol>
<li><p>è¡¨ç¤ºå¼‚æ­¥çš„æ‰§è¡Œç»“æœï¼Œå¯ä»¥é€šè¿‡å®ƒæä¾›çš„æ–¹æ³•æ¥æ£€æµ‹æ‰§è¡Œæ˜¯å¦å®Œæˆ</p>
</li>
<li><p><code>ChannelFuture</code>æ˜¯ä¸€ä¸ªæ¥å£: public interface ChannelFuture extends Future<Void></p>
<p>æˆ‘ä»¬å¯ä»¥æ·»åŠ ç›‘å¬å™¨ï¼Œå½“ç›‘å¬çš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå°±ä¼šé€šçŸ¥åˆ°ç›‘å¬å™¨</p>
</li>
</ol>
<h4 id="3-5-3-Future-Listeneræœºåˆ¶"><a href="#3-5-3-Future-Listeneræœºåˆ¶" class="headerlink" title="3.5.3 Future-Listeneræœºåˆ¶"></a>3.5.3 Future-Listeneræœºåˆ¶</h4><ol>
<li><p>å½“<code>future</code>å¯¹è±¡åˆšåˆšåˆ›å»ºæ—¶ï¼Œå¤„äºéå®ŒæˆçŠ¶æ€ï¼Œè°ƒç”¨è€…å¯ä»¥é€šè¿‡è¿”å›çš„<code>ChannelFuture</code>æ¥è·å–æ“ä½œæ‰§è¡Œçš„çŠ¶æ€ï¼Œæ³¨å†Œç›‘å¬å‡½æ•°æ¥æ‰§è¡Œå®Œæˆåçš„æ“ä½œ</p>
</li>
<li><p>å¸¸è§æ“ä½œï¼š</p>
<table>
<thead>
<tr>
<th align="center">æ–¹æ³•</th>
<th align="center">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="center">isDone()</td>
<td align="center">åˆ¤æ–­å½“å‰æ“ä½œæ˜¯å¦å®Œæˆ</td>
</tr>
<tr>
<td align="center">isSuccess()</td>
<td align="center">åˆ¤æ–­å·²å®Œæˆçš„å½“å‰æ“ä½œæ˜¯å¦æˆåŠŸ</td>
</tr>
<tr>
<td align="center">getCause()</td>
<td align="center">è·å–å·²å®Œæˆçš„å½“å‰æ“ä½œå¤±è´¥çš„åŸå› </td>
</tr>
<tr>
<td align="center">isCancelled()</td>
<td align="center">åˆ¤æ–­å·²å®Œæˆçš„å½“å‰æ“ä½œæ˜¯å¦è¢«å–æ¶ˆ</td>
</tr>
<tr>
<td align="center">addListener()</td>
<td align="center">æ³¨å†Œç›‘å¬å™¨ï¼Œå½“æ“ä½œå·²å®Œæˆ(isDoneè¿”å›å®Œæˆ)ï¼Œå°†ä¼šé€šçŸ¥æŒ‡å®šçš„ç›‘å¬å™¨ï¼›å¦‚æœFutureå¯¹è±¡å·²å®Œæˆï¼Œåˆ™é€šçŸ¥æŒ‡å®šçš„ç›‘å¬å™¨</td>
</tr>
</tbody></table>
</li>
</ol>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç»‘å®šä¸€ä¸ªç«¯å£å¹¶ä¸”åŒæ­¥</span></span><br><span class="line"><span class="comment">// ç»‘å®šç«¯å£å¹¶å¯åŠ¨æœåŠ¡å™¨</span></span><br><span class="line">ChannelFuture CF = bootstrap.bind(<span class="number">3333</span>).sync();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»™CFæ³¨å†Œç›‘å¬å™¨</span></span><br><span class="line">CF.addListener(<span class="keyword">new</span> ChannelFutureListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operationComplete</span><span class="params">(ChannelFuture channelFuture)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (CF.isSuccess()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æœåŠ¡å™¨ç›‘å¬ç«¯å£[3333]æˆåŠŸ&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æœåŠ¡å™¨ç›‘å¬ç«¯å£[3333]å¤±è´¥&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="3-6-HttpæœåŠ¡"><a href="#3-6-HttpæœåŠ¡" class="headerlink" title="3.6 HttpæœåŠ¡"></a>3.6 HttpæœåŠ¡</h3><blockquote>
<p>TestServer.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kag.netty.http;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.bootstrap.ServerBootstrap;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelFuture;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.EventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2020/9/26 10:34</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestServer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        EventLoopGroup bossGroup = <span class="keyword">new</span> NioEventLoopGroup(<span class="number">1</span>);</span><br><span class="line">        EventLoopGroup workerGroup = <span class="keyword">new</span> NioEventLoopGroup();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ServerBootstrap serverBootstrap = <span class="keyword">new</span> ServerBootstrap();</span><br><span class="line">            serverBootstrap.group(bossGroup, workerGroup)</span><br><span class="line">                    .channel(NioServerSocketChannel.class)</span><br><span class="line">                    .childHandler(<span class="keyword">new</span> TestServerInitializer());</span><br><span class="line"></span><br><span class="line">            ChannelFuture CF = serverBootstrap.bind(<span class="number">3333</span>).sync();</span><br><span class="line"></span><br><span class="line">            CF.channel().closeFuture().sync();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            System.out.println(e.getMessage());</span><br><span class="line">        &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">            bossGroup.shutdownGracefully();</span><br><span class="line">            workerGroup.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>TestServerInitializer.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kag.netty.http;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInitializer;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelPipeline;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.http.HttpServerCodec;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2020/9/26 10:39</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestServerInitializer</span> <span class="keyword">extends</span> <span class="title">ChannelInitializer</span>&lt;<span class="title">SocketChannel</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(SocketChannel socketChannel)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// å‘ç®¡é“åŠ å…¥å¤„ç†å™¨</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¾—åˆ°ç®¡é“</span></span><br><span class="line">        ChannelPipeline pipeline = socketChannel.pipeline();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŠ å…¥ä¸€ä¸ªNettyæä¾›çš„HttpServerCodeC codec =&gt; [coder - decoder]</span></span><br><span class="line">        <span class="comment">// 1ã€HttpServerCodeC: å¤„ç†httpçš„ç¼–&amp;è§£ç å™¨</span></span><br><span class="line">        pipeline.addLast(<span class="string">&quot;MyHttpServerCodec&quot;</span>, <span class="keyword">new</span> HttpServerCodec());</span><br><span class="line">        <span class="comment">// 2ã€å¢åŠ ä¸€ä¸ªè‡ªå®šä¹‰handler</span></span><br><span class="line">        pipeline.addLast(<span class="string">&quot;MyTestServerHandler&quot;</span>, <span class="keyword">new</span> TestHttpServerHandler());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>TestHttpServerHandler.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kag.netty.http;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInitializer;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelPipeline;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.http.HttpServerCodec;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2020/9/26 10:39</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestServerInitializer</span> <span class="keyword">extends</span> <span class="title">ChannelInitializer</span>&lt;<span class="title">SocketChannel</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(SocketChannel socketChannel)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// å‘ç®¡é“åŠ å…¥å¤„ç†å™¨</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¾—åˆ°ç®¡é“</span></span><br><span class="line">        ChannelPipeline pipeline = socketChannel.pipeline();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŠ å…¥ä¸€ä¸ªNettyæä¾›çš„HttpServerCodeC codec =&gt; [coder - decoder]</span></span><br><span class="line">        <span class="comment">// 1ã€HttpServerCodeC: å¤„ç†httpçš„ç¼–&amp;è§£ç å™¨</span></span><br><span class="line">        pipeline.addLast(<span class="string">&quot;MyHttpServerCodec&quot;</span>, <span class="keyword">new</span> HttpServerCodec());</span><br><span class="line">        <span class="comment">// 2ã€å¢åŠ ä¸€ä¸ªè‡ªå®šä¹‰handler</span></span><br><span class="line">        pipeline.addLast(<span class="string">&quot;MyTestServerHandler&quot;</span>, <span class="keyword">new</span> TestHttpServerHandler());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="5-æ ¸å¿ƒ"><a href="#5-æ ¸å¿ƒ" class="headerlink" title="5. æ ¸å¿ƒ"></a>5. æ ¸å¿ƒ</h2><h3 id="4-1-BootStrapã€ServerBootStrap"><a href="#4-1-BootStrapã€ServerBootStrap" class="headerlink" title="4.1 BootStrapã€ServerBootStrap"></a>4.1 BootStrapã€ServerBootStrap</h3><blockquote>
<p>è¯´æ˜</p>
</blockquote>
<p><code>BootStrap</code>æ„æ€æ˜¯å¼•å¯¼ç¨‹åºï¼Œä¸€ä¸ª<code>Netty</code>åº”ç”¨é€šå¸¸ç”±ä¸€ä¸ª<code>BootStrap</code>å¼€å§‹ï¼Œä¸»è¦ä½œç”¨æ˜¯é…ç½®æ•´ä¸ª<code>Netty</code>ç¨‹åºï¼Œä¸²è”å„ä¸ªç»„ä»¶ï¼Œ<code>Netty</code>ä¸­<code>BootStrap</code>ç±»æ˜¯å®¢æˆ·ç«¯ç¨‹åºçš„å¯åŠ¨å¼•å¯¼ç±»ï¼Œ<code>ServerBootStrap</code>æ˜¯æœåŠ¡å™¨ç«¯å¯åŠ¨å¼•å¯¼ç±»</p>
<blockquote>
<p>å¸¸ç”¨æ–¹æ³•</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">æ–¹æ³•åç§°</th>
<th align="center">æ–¹æ³•ä»‹ç»</th>
</tr>
</thead>
<tbody><tr>
<td align="center">public ServerBootStrap group(EventLoopGroup parentGroup, EventLoopGroup childGroup)</td>
<td align="center">è¯¥æ–¹æ³•ç”¨äºæœåŠ¡å™¨ç«¯ï¼Œç”¨æ¥è®¾ç½®ä¸¤ä¸ªEventLoop</td>
</tr>
<tr>
<td align="center">public B group(EventLoopGroup group)</td>
<td align="center">è¯¥æ–¹æ³•ç”¨äºå®¢æˆ·ç«¯ï¼Œç”¨æ¥è®¾ç½®ä¸€ä¸ªEventLoop</td>
</tr>
<tr>
<td align="center">public B channel(Class&lt;? extends C&gt; channelClass)</td>
<td align="center">è¯¥æ–¹æ³•ç”¨æ¥è®¾ç½®ä¸€ä¸ªæœåŠ¡å™¨ç«¯çš„é€šé“å®ç°</td>
</tr>
<tr>
<td align="center">public <T> B option(ChannelOption<T> option, T value)</td>
<td align="center">ç”¨æ¥ç»™ServerChannelæ·»åŠ é…ç½®</td>
</tr>
<tr>
<td align="center">public  ServerBootstrap childOption(ChannelOption childOption, T value)</td>
<td align="center">ç”¨æ¥ç»™æ¥æ”¶åˆ°çš„é€šé“æ·»åŠ é…ç½®</td>
</tr>
<tr>
<td align="center">public ServerBootstrap childHandler(ChannelHandler childHandler)</td>
<td align="center">è¯¥æ–¹æ³•ç”¨æ¥è®¾ç½®ä¸šåŠ¡å¤„ç†ç±»(è‡ªå®šä¹‰çš„handler)</td>
</tr>
<tr>
<td align="center">public ChannelFuture bind(int inetPort)</td>
<td align="center">è¯¥æ–¹æ³•ç”¨äºæœåŠ¡å™¨ç«¯ï¼Œç”¨æ¥è®¾ç½®å ç”¨çš„ç«¯å£å·</td>
</tr>
<tr>
<td align="center">public ChannelFuture connect(String inetHost, int inetPort)</td>
<td align="center">è¯¥æ–¹æ³•ç”¨äºå®¢æˆ·ç«¯ï¼Œç”¨æ¥è¿æ¥æœåŠ¡å™¨</td>
</tr>
</tbody></table>
<h3 id="4-2-Futureã€ChannelFuture"><a href="#4-2-Futureã€ChannelFuture" class="headerlink" title="4.2 Futureã€ChannelFuture"></a>4.2 Futureã€ChannelFuture</h3><blockquote>
<p>è¯´æ˜</p>
</blockquote>
<p><code>Netty</code>ä¸­æ‰€æœ‰çš„IOæ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„ï¼Œä¸èƒ½ç«‹åˆ»å¾—çŸ¥æ¶ˆæ¯æ˜¯å¦è¢«æ­£ç¡®å¤„ç†ã€‚ä½†æ˜¯å¯ä»¥è¿‡ä¸€ä¼šç­‰å®ƒæ‰§è¡Œå®Œæˆ–è€…ç›´æ¥æ³¨å†Œä¸€ä¸ªç›‘å¬ï¼Œå…·ä½“çš„å®ç°å°±æ˜¯é€šè¿‡<code>Future</code>å’Œ<code>ChannelFuture</code>ï¼Œå®ƒä»¬å¯ä»¥æ³¨å†Œä¸€ä¸ªç›‘å¬ï¼Œå½“æ“ä½œæ‰§è¡ŒæˆåŠŸæˆ–å¤±è´¥æ—¶ç›‘å¬ä¼šè‡ªåŠ¨è§¦å‘æ³¨å†Œçš„ç›‘å¬äº‹ä»¶</p>
<blockquote>
<p>å¸¸ç”¨æ–¹æ³•</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">æ–¹æ³•åç§°</th>
<th align="center">æ–¹æ³•ä»‹ç»</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Channel channel()</td>
<td align="center">è¿”å›å½“å‰æ­£åœ¨è¿›è¡ŒIOæ“ä½œçš„é€šé“</td>
</tr>
<tr>
<td align="center">ChannelFuture sync()</td>
<td align="center">ç­‰å¾…å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œæ¯•ï¼Œç›¸å½“äºå°†é˜»å¡åœ¨å½“å‰</td>
</tr>
</tbody></table>
<h3 id="4-3-Channel"><a href="#4-3-Channel" class="headerlink" title="4.3 Channel"></a>4.3 Channel</h3><blockquote>
<p>è¯´æ˜</p>
</blockquote>
<ul>
<li><code>Netty</code>ç½‘ç»œé€šä¿¡çš„ç»„ä»¶ï¼Œèƒ½å¤Ÿç”¨äºæ‰§è¡Œç½‘ç»œI/Oæ“ä½œ</li>
<li>é€šè¿‡<code>Channel</code>å¯è·å¾—å½“å‰ç½‘ç»œè¿æ¥çš„é€šé“çš„çŠ¶æ€</li>
<li>é€šè¿‡<code>Channel</code>å¯è·å¾—ç½‘ç»œè¿æ¥çš„é…ç½®å‚æ•°</li>
<li><code>Channel</code>é€šè¿‡å¼‚æ­¥çš„ç½‘ç»œI/Oæ“ä½œ(æ¯”å¦‚ï¼šå»ºç«‹è¿æ¥ã€è¯»å†™å’Œç»‘å®šç«¯å£)ï¼Œå¼‚æ­¥è°ƒç”¨æ„å‘³ç€ä»»ä½•I/Oè°ƒç”¨éƒ½å°†ç«‹å³è¿”å›ï¼Œå¹¶ä¸”ä¸ä¿è¯åœ¨è°ƒç”¨ç»“æŸæ—¶æ‰€è¯·æ±‚çš„I/Oæ“ä½œå·²å®Œæˆ</li>
<li>è°ƒç”¨ç«‹å³è¿”å›ä¸€ä¸ª<code>ChannelFuture</code>å®ä¾‹ï¼Œé€šè¿‡æ³¨å†Œå™¨åˆ°<code>ChannelFuture</code>ä¸Šï¼Œå¯ä»¥I/Oæ“ä½œæˆåŠŸã€å¤±è´¥æˆ–å–æ¶ˆæ—¶å›è°ƒé€šçŸ¥è°ƒç”¨æ–¹ </li>
<li>æ”¯æŒå…³è”I/Oæ“ä½œä¸å¯¹åº”çš„å¤„ç†ç¨‹åº</li>
<li>ä¸åŒåè®®ã€ä¸åŒçš„é˜»å¡ç±»å‹çš„è¿æ¥éƒ½æœ‰ä¸åŒçš„<code>Channel</code>ç±»å‹ä¸ä¹‹å¯¹åº”</li>
</ul>
<blockquote>
<p>å¸¸è§Channelç±»å‹</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">åç§°</th>
<th align="center">ä»‹ç»</th>
</tr>
</thead>
<tbody><tr>
<td align="center">NioSocketChannel</td>
<td align="center">å¼‚æ­¥çš„å®¢æˆ·ç«¯TCP Socketè¿æ¥</td>
</tr>
<tr>
<td align="center">NioServerSocketChannel</td>
<td align="center">å¼‚æ­¥çš„æœåŠ¡å™¨ç«¯TCP Socketè¿æ¥</td>
</tr>
<tr>
<td align="center">NioDatagramChannel</td>
<td align="center">å¼‚æ­¥çš„UDPè¿æ¥</td>
</tr>
<tr>
<td align="center">NioSctpChannel</td>
<td align="center">å¼‚æ­¥çš„å®¢æˆ·ç«¯Sctpè¿æ¥</td>
</tr>
<tr>
<td align="center">NioSctpServerChannel</td>
<td align="center">å¼‚æ­¥çš„SctpæœåŠ¡å™¨ç«¯è¿æ¥ï¼Œè¿™äº›é€šé“æ¶µç›–äº†UDPå’ŒTCPç½‘ç»œI/Oä»¥åŠæ–‡ä»¶I/O</td>
</tr>
</tbody></table>
<h3 id="4-4-Selector"><a href="#4-4-Selector" class="headerlink" title="4.4 Selector"></a>4.4 Selector</h3><blockquote>
<p>è¯´æ˜</p>
</blockquote>
<ul>
<li><code>Netty</code>åŸºäº<code>Selector</code>å¯¹è±¡å®ç°I/Oå¤šè·¯å¤ç”¨ï¼Œé€šè¿‡<code>Selector</code>ä¸€ä¸ªçº¿ç¨‹å¯ä»¥ç›‘å¬å¤šä¸ªè¿æ¥çš„<code>Channel</code>äº‹ä»¶</li>
<li>å½“å‘ä¸€ä¸ª<code>Selector</code>ä¸­æ³¨å†Œ<code>Channel</code>åï¼Œ<code>Selector</code>å†…éƒ¨çš„æœºåˆ¶å°±å¯ä»¥è‡ªåŠ¨ä¸æ–­åœ°æŸ¥è¯¢(<code>Select</code>)è¿™äº›æ³¨å†Œçš„<code>Channel</code>æ˜¯å¦æœ‰å·²å°±ç»ªçš„I/Oäº‹ä»¶(æ¯”å¦‚ï¼šå¯è¯»ã€å¯å†™ã€ç½‘ç»œè¿æ¥å®Œæˆç­‰)ï¼Œè¿™æ ·ç¨‹åºå°±å¯ä»¥å¾ˆç®€å•åœ°ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹é«˜æ•ˆåœ°ç®¡ç†å¤šä¸ª<code>Channel</code></li>
<li>åŒæ—¶ï¼Œ<code>Netty</code>ä¸­å¯¹<code>Selector</code>ä¸­çš„<code>selectedKey</code>é›†åˆè¿›è¡Œäº†æ›¿æ¢ï¼Œå®ƒæ›¿æ¢æˆäº†ä¸€ä¸ªå®ƒè‡ªå·±å®ç°çš„ä¸€ä¸ª<code>set</code>é›†åˆï¼Œè¿™æ ·æ•ˆç‡æ›´é«˜</li>
</ul>
<h3 id="4-5-ChannelHandleråŠå…¶å®ç°ç±»"><a href="#4-5-ChannelHandleråŠå…¶å®ç°ç±»" class="headerlink" title="4.5 ChannelHandleråŠå…¶å®ç°ç±»"></a>4.5 ChannelHandleråŠå…¶å®ç°ç±»</h3><blockquote>
<p>è¯´æ˜</p>
</blockquote>
<ul>
<li><p><code>ChannelHandler</code>æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¤„ç†I/Oäº‹ä»¶æˆ–æ‹¦æˆªI/Oæ“ä½œï¼Œå¹¶å°†å…¶è½¬å‘åˆ°<code>ChannelPipeline</code>(ä¸šåŠ¡å¤„ç†é“¾)ä¸­çš„ä¸‹ä¸€ä¸ªå¤„ç†ç¨‹åº</p>
</li>
<li><p><code>ChannelHandler</code>æœ¬èº«å¹¶æ²¡æœ‰æä¾›å¾ˆå¤šæ–¹æ³•ï¼Œå› ä¸ºè¿™ä¸ªæ¥å£æœ‰è®¸å¤šçš„æ–¹æ³•éœ€è¦å®ç°ï¼Œæ–¹ä¾¿ä½¿ç”¨æœŸé—´ï¼Œå¯ä»¥ç»§æ‰¿å®ƒçš„å­ç±»</p>
</li>
<li><p>æˆ‘ä»¬ç»å¸¸éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ª<code>Handler</code>ç±»å–ç»§æ‰¿<code>ChannelInboundHandlerAdapter</code>ï¼Œç„¶åé€šè¿‡é‡å†™ç›¸åº”æ–¹æ³•å®ç°ä¸šåŠ¡é€»è¾‘</p>
<p>ä¸€èˆ¬éœ€è¦é‡å†™çš„æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChannelInboundHandlerAdapter</span> <span class="keyword">extends</span> <span class="title">ChannelHandlerAdapter</span> <span class="keyword">implements</span> <span class="title">ChannelInboundHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é€šé“æ³¨å†Œäº‹ä»¶</span></span><br><span class="line">    <span class="meta">@Skip</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRegistered</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ctx.fireChannelRegistered();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é€šé“å–æ¶ˆæ³¨å†Œäº‹ä»¶</span></span><br><span class="line">    <span class="meta">@Skip</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelUnregistered</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ctx.fireChannelUnregistered();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é€šé“å°±ç»ªäº‹ä»¶</span></span><br><span class="line">    <span class="meta">@Skip</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelActive</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ctx.fireChannelActive();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é€šé“æ–­è”äº‹ä»¶</span></span><br><span class="line">    <span class="meta">@Skip</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelInactive</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ctx.fireChannelInactive();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é€šé“è¯»å–æ•°æ®äº‹ä»¶</span></span><br><span class="line">    <span class="meta">@Skip</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ctx.fireChannelRead(msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é€šé“æ•°æ®è¯»å–å®Œæ¯•äº‹ä»¶</span></span><br><span class="line">    <span class="meta">@Skip</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelReadComplete</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ctx.fireChannelReadComplete();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç”¨æ³•äº‹ä»¶è§¦å‘</span></span><br><span class="line">    <span class="meta">@Skip</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">userEventTriggered</span><span class="params">(ChannelHandlerContext ctx, Object evt)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ctx.fireUserEventTriggered(evt);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é€šé“å¯å†™æ€§æ›´æ”¹äº‹ä»¶</span></span><br><span class="line">    <span class="meta">@Skip</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelWritabilityChanged</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ctx.fireChannelWritabilityChanged();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é€šé“å‘ç”Ÿå¼‚å¸¸äº‹ä»¶</span></span><br><span class="line">    <span class="meta">@Skip</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;deprecation&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ctx.fireExceptionCaught(cause);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>ChannelInboundHandler</code>  ç”¨äºå¤„ç†å…¥ç«™I/Oäº‹ä»¶</li>
<li><code>ChannelOutboundHandler</code>  ç”¨äºå¤„ç†å‡ºæˆ˜I/Oäº‹ä»¶</li>
</ul>
<blockquote>
<p>é€‚é…å™¨</p>
</blockquote>
</li>
<li><p><code>ChannelInboundHandlerAdapter</code> ç”¨äºå¤„ç†å…¥ç«™ I/O äº‹ä»¶</p>
</li>
<li><p><code>ChannelOutboundHandlerAdapter</code> ç”¨äºå¤„ç†å‡ºç«™ I/O æ“ä½œ</p>
</li>
<li><p><code>ChannelDuplexHandler</code> ç”¨äºå¤„ç†å…¥ç«™å’Œå‡ºç«™äº‹ä»¶</p>
</li>
</ul>
<h3 id="4-6-Pipelineã€Channel"><a href="#4-6-Pipelineã€Channel" class="headerlink" title="4.6 Pipelineã€Channel"></a>4.6 Pipelineã€Channel</h3><blockquote>
<p>è¯´æ˜</p>
</blockquote>
<ul>
<li><p><code>ChannelPipeline</code>æ˜¯ä¸€ä¸ªHandlerçš„é›†åˆï¼Œå®ƒè´Ÿè´£å¤„ç†å’Œæ‹¦æˆª<code>inbound</code>å’Œ<code>outbound</code>çš„äº‹ä»¶å’Œæ“ä½œï¼Œç›¸å½“äºä¸€ä¸ªè´¯ç©¿<code>Netty</code>çš„é“¾ï¼ˆé€šä¿—çš„è®²ï¼š<code>ChannelPipeline</code>æ˜¯ä¿å­˜<code>ChannelHandler</code>çš„<code>list</code>ï¼Œç”¨äºå¤„ç†æˆ–æ‹¦æˆª<code>Channel</code>çš„å…¥ç«™äº‹ä»¶å’Œå‡ºæˆ˜æ“ä½œï¼‰</p>
</li>
<li><p><code>ChanenelPipline</code>å®ç°äº†ä¸€ç§é«˜çº§å½¢å¼çš„æ‹¦æˆªè¿‡æ»¤å™¨æ¨¡å¼ï¼Œä½¿ç”¨æˆ·å¯ä»¥å®Œå…¨æ§åˆ¶äº‹ä»¶çš„å¤„ç†æ–¹å¼ï¼Œä»¥åŠ<code>Channel</code>ä¸­å„ä¸ªçš„<code>ChannelHandler</code>å¦‚ä½•ç›¸äº’äº¤äº’</p>
</li>
<li><p>åœ¨<code>Netty</code>ä¸­æ¯ä¸ª<code>Channel</code>éƒ½æœ‰ä¸”ä»…æœ‰ä¸€ä¸ª<code>ChannelPipeline</code>ä¸ä¹‹å¯¹åº”ï¼Œä»–ä»¬çš„ç»„æˆå…³ç³»å¦‚ä¸‹</p>
<img src="/2020/10/01/Netty/image-20201002192427279.png" class="" title="image-20201002192427279">
</li>
<li><p>ä¸€ä¸ª<code>Channel</code>åŒ…å«ä¸€ä¸ª<code>ChannelPipeline</code>ï¼Œè€Œ<code>ChannelPipeline</code>ä¸­åˆç»´æŠ¤äº†ä¸€ä¸ªç”±<code>ChannelHandlerContext</code>ç»„æˆçš„åŒå‘é“¾è¡¨ï¼Œå¹¶ä¸”æ¯ä¸ª<code>ChannelHandlerContext</code>ä¸­åˆå…³è”ç€ä¸€ä¸ª<code>ChannelHandler</code></p>
</li>
<li><p>å…¥ç«™äº‹ä»¶å’Œå‡ºæˆ˜äº‹ä»¶åœ¨ä¸€ä¸ªåŒå‘é“¾è¡¨ä¸­ï¼Œå…¥ç«™äº‹ä»¶ä¼šä»é“¾è¡¨<code>head</code>å¾€åä¼ é€’åˆ°æœ€åä¸€ä¸ªå…¥ç«™çš„handlerï¼Œå‡ºç«™äº‹ä»¶ä¼šä»é“¾è¡¨<code>tail</code>å¾€å‰ä¼ é€’åˆ°æœ€å‰ä¸€ä¸ªå‡ºç«™çš„<code>handler</code>ï¼Œä¸¤ç§ç±»å‹çš„<code>handler</code>äº’ä¸å¹²æ‰°</p>
</li>
</ul>
<blockquote>
<p>å¸¸ç”¨æ–¹æ³•</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">æ–¹æ³•åç§°</th>
<th align="center">æ–¹æ³•ä»‹ç»</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ChannelPipeline addFirst(ChannelHandlerâ€¦ handlers)</td>
<td align="center">æŠŠä¸€ä¸ªä¸šåŠ¡å¤„ç†ç±»ï¼ˆhandlerï¼‰æ·»åŠ åˆ°é“¾ä¸­çš„ç¬¬ä¸€ä¸ªä½ç½®</td>
</tr>
<tr>
<td align="center">ChannelPipeline addLast(ChannelHandlerâ€¦ handlers)</td>
<td align="center">æŠŠä¸€ä¸ªä¸šåŠ¡å¤„ç†ç±»ï¼ˆhandlerï¼‰æ·»åŠ åˆ°é“¾ä¸­çš„æœ€åä¸€ä¸ªä½ç½®</td>
</tr>
</tbody></table>
<h3 id="4-7-ChannelHandlerContext"><a href="#4-7-ChannelHandlerContext" class="headerlink" title="4.7 ChannelHandlerContext"></a>4.7 ChannelHandlerContext</h3><blockquote>
<p>è¯´æ˜</p>
</blockquote>
<ul>
<li>ä¿å­˜<code>Channel</code>ç›¸å…³çš„æ‰€æœ‰ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ŒåŒæ—¶å…³è”ä¸€ä¸ªChannelHandlerå¯¹è±¡</li>
<li>å³<code>ChannelHandlerContext</code>ä¸­åŒ…å«ä¸€ä¸ªå…·ä½“çš„äº‹ä»¶å¤„ç†å™¨<code>ChannelHandler</code>ï¼ŒåŒæ—¶<code>ChannelHandlerContext</code>ä¸­ä¹Ÿç»‘å®šäº†å¯¹åº”çš„<code>Pipeline</code>å’Œ<code>Channel</code>çš„ä¿¡æ¯ï¼Œæ–¹ä¾¿å¯¹<code>ChannelHandler</code>è¿›è¡Œè°ƒç”¨</li>
</ul>
<blockquote>
<p>å¸¸è§æ–¹æ³•</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">æ–¹æ³•åç§°</th>
<th align="center">æ–¹æ³•ä»‹ç»</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ChannelFuture close()</td>
<td align="center">å…³é—­é€šé“</td>
</tr>
<tr>
<td align="center">ChannelOutboundInvoker flush()</td>
<td align="center">åˆ·æ–°</td>
</tr>
<tr>
<td align="center">ChannelFuture writeAndFlush(Object msg)</td>
<td align="center">å°†æ•°æ®å†™åˆ°ChannelPipelineä¸­å½“å‰ChannelHandlerçš„ä¸‹ä¸€ä¸ªChannelHandlerå¼€å§‹å¤„ç†</td>
</tr>
</tbody></table>
<h3 id="4-8-ChannelOption"><a href="#4-8-ChannelOption" class="headerlink" title="4.8 ChannelOption"></a>4.8 ChannelOption</h3><blockquote>
<p>è¯´æ˜</p>
</blockquote>
<p><code>Netty</code>åœ¨åˆ›å»º<code>Channel</code>å®ä¾‹åï¼Œä¸€èˆ¬éƒ½éœ€è¦è®¾ç½®<code>ChannelOption</code>å‚æ•°</p>
<blockquote>
<p>å‚æ•°å¦‚ä¸‹ï¼š</p>
</blockquote>
<ul>
<li>ChannelOption.SO_BACKLOG:<ul>
<li>å¯¹åº”TCP/IPåè®®listenå‡½æ•°ä¸­çš„backlogå‚æ•°ï¼Œç”¨æ¥åˆå§‹åŒ–æœåŠ¡å™¨å¯è¿æ¥é˜Ÿåˆ—å¤§å°</li>
<li>æœåŠ¡ç«¯å¤„ç†å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚æ˜¯é¡ºåºå¤„ç†çš„ï¼Œæ‰€ä»¥åŒä¸€æ—¶é—´åªèƒ½å¤„ç†ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥ã€‚å¤šä¸ªå®¢æˆ·ç«¯æ¥çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯å°†ä¸èƒ½å¤„ç†çš„å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚æ”¾åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…å¤„ç†ï¼Œbacklogå‚æ•°æŒ‡å®šäº†é˜Ÿåˆ—çš„å¤§å°</li>
</ul>
</li>
<li>ChannelOption.SO_KEEPALIVE:<ul>
<li>ä¸€ç›´ä¿æŒè¿æ¥æ´»åŠ¨çŠ¶æ€</li>
</ul>
</li>
</ul>
<h3 id="4-9-EventLoopGroupå’Œå…¶å®ç°ç±»NioEventLoopGroup"><a href="#4-9-EventLoopGroupå’Œå…¶å®ç°ç±»NioEventLoopGroup" class="headerlink" title="4.9 EventLoopGroupå’Œå…¶å®ç°ç±»NioEventLoopGroup"></a>4.9 EventLoopGroupå’Œå…¶å®ç°ç±»NioEventLoopGroup</h3><blockquote>
<p>è¯´æ˜</p>
</blockquote>
<ul>
<li><code>EventLoopGroup</code>æ˜¯ä¸€ç»„<code>EventLoop</code>çš„æŠ½è±¡ï¼Œ<code>Netty</code>ä¸ºäº†æ›´å¥½çš„åˆ©ç”¨å¤šæ ¸CPUèµ„æºï¼Œä¸€èˆ¬ä¼šæœ‰å¤šä¸ª<code>EventLoop</code>åŒæ—¶å·¥ä½œï¼Œæ¯ä¸ª<code>EventLoop</code>ç»´æŠ¤è€…ä¸€ä¸ªSelectorå®ä¾‹ã€‚</li>
<li><code>EventLoopGroup</code>æä¾›nextæ¥å£ï¼Œå¯ä»¥ä»ç»„é‡Œé¢æŒ‰ç…§ä¸€å®šè§„åˆ™è·å–å…¶ä¸­ä¸€ä¸ª<code>EventLoop</code>æ¥å¤„ç†ä»»åŠ¡ã€‚åœ¨NettyæœåŠ¡å™¨ç«¯ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½éœ€è¦æä¾›ä¸¤ä¸ª<code>EventLoopGroup</code>ï¼Œ<code>BossGroup</code>å’Œ<code>WorkerGroup</code></li>
<li>é€šå¸¸ä¸€ä¸ªæœåŠ¡ç«¯å£å³ä¸€ä¸ª<code>ServerSocketChannel</code>å¯¹åº”ä¸€ä¸ª<code>Selector</code>å’Œä¸€ä¸ª<code>EventLoop</code>çº¿ç¨‹ã€‚<code>BossEventLoop</code>è´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥å¹¶å°†<code>SocketChannel</code>äº¤ç»™<code>WorkerEventLoopGroup</code>æ¥è¿›è¡ŒIOå¤„ç†</li>
<li><code>BossEventLoopGroup</code>é€šå¸¸æ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„<code>EventLoop</code>ï¼Œ<code>EventLoop</code>ç»´æŠ¤ç€ä¸€ä¸ªæ³¨å†Œäº†<code>ServerSocketChannel</code>çš„<code>Selector</code>å®ä¾‹<code>BossEventLoop</code>ä¸æ–­è½®è¯¢<code>Selector</code>å°†è¿æ¥äº‹ä»¶åˆ†ç¦»å‡ºæ¥</li>
<li>é€šå¸¸æ˜¯OP_ACCEPTäº‹ä»¶ï¼Œç„¶åå°†æ¥æ”¶åˆ°çš„<code>SocketChannel</code>äº¤ç»™<code>WorkerEventLoopGroup</code></li>
<li><code>WorkerEventLoopGroup</code>ä¼šç”±<code>next</code>é€‰æ‹©å…¶ä¸­ä¸€ä¸ª<code>EventLoop</code>æ¥å°†è¿™ä¸ª<code>SocketChannel</code>æ³¨å†Œåˆ°å…¶ç»´æŠ¤çš„<code>Selector</code>å¹¶å¯¹å…¶åç»­çš„IOäº‹ä»¶è¿›è¡Œå¤„ç†</li>
</ul>
<blockquote>
<p>å¸¸ç”¨æ–¹æ³•</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">æ–¹æ³•åç§°</th>
<th align="center">æ–¹æ³•ä»‹ç»</th>
</tr>
</thead>
<tbody><tr>
<td align="center">public NioEventLoopGroup()</td>
<td align="center">æ„é€ æ–¹æ³•</td>
</tr>
<tr>
<td align="center">public Future&lt;?&gt; shutdownGracefully()</td>
<td align="center">æ–­å¼€è¿æ¥ï¼Œå…³é—­çº¿ç¨‹</td>
</tr>
</tbody></table>
<h3 id="4-10-Unpooled"><a href="#4-10-Unpooled" class="headerlink" title="4.10 Unpooled"></a>4.10 Unpooled</h3><blockquote>
<p>è¯´æ˜</p>
</blockquote>
<p><code>Netty</code>æä¾›ä¸€ä¸ªä¸“é—¨ç”¨æ¥æ“ä½œç¼“å†²åŒºï¼ˆå³<code>Netty</code>çš„æ•°æ®å®¹å™¨ï¼‰çš„å·¥å…·ç±»</p>
<blockquote>
<p>å¸¸ç”¨æ–¹æ³•</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">æ–¹æ³•åç§°</th>
<th align="center">æ–¹æ³•ä»‹ç»</th>
</tr>
</thead>
<tbody><tr>
<td align="center">public static ByteBuf copiedBuffer(CharSequence string, Charset charset)</td>
<td align="center">é€šè¿‡ç»™å®šçš„æ•°æ®å’Œå­—ç¬¦ç¼–ç è¿”å›ä¸€ä¸ª ByteBuf å¯¹è±¡ï¼ˆç±»ä¼¼äº NIO ä¸­çš„ ByteBuffer ä½†æœ‰åŒºåˆ«ï¼‰</td>
</tr>
</tbody></table>
<h3 id="4-11-ç¾¤èŠç³»ç»Ÿ"><a href="#4-11-ç¾¤èŠç³»ç»Ÿ" class="headerlink" title="4.11 ç¾¤èŠç³»ç»Ÿ"></a>4.11 ç¾¤èŠç³»ç»Ÿ</h3><blockquote>
<p>è¦æ±‚</p>
</blockquote>
<ul>
<li>ç¼–å†™ä¸€ä¸ª Netty ç¾¤èŠç³»ç»Ÿï¼Œå®ç°æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„æ•°æ®ç®€å•é€šè®¯ï¼ˆéé˜»å¡ï¼‰</li>
<li>å®ç°å¤šäººç¾¤èŠ</li>
<li>æœåŠ¡å™¨ï¼šå¯ä»¥ç›‘æµ‹ç”¨æˆ·ä¸Šçº¿ï¼Œç¦»çº¿ï¼Œå¹¶å®ç°æ¶ˆæ¯è½¬å‘åŠŸèƒ½</li>
<li>å®¢æˆ·ç«¯ï¼šé€šè¿‡channel å¯ä»¥æ— é˜»å¡å‘é€æ¶ˆæ¯ç»™å…¶å®ƒæ‰€æœ‰ç”¨æˆ·ï¼ŒåŒæ—¶å¯ä»¥æ¥å—å…¶å®ƒç”¨æˆ·å‘é€çš„æ¶ˆæ¯(ç”±æœåŠ¡å™¨è½¬å‘å¾—åˆ°)</li>
</ul>
<blockquote>
<p>GroupChatServer.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kag.netty.groupChat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.kag.nio.groupchat.GroupChatClient;</span><br><span class="line"><span class="keyword">import</span> io.netty.bootstrap.ServerBootstrap;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.*;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.nio.NioSocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.string.StringDecoder;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.string.StringEncoder;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2020/10/2 8:19</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GroupChatServer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> port;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GroupChatServer</span><span class="params">(<span class="keyword">int</span> port)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.port = port;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ç»„</span></span><br><span class="line">        EventLoopGroup bossGroup = <span class="keyword">new</span> NioEventLoopGroup(<span class="number">1</span>);</span><br><span class="line">        EventLoopGroup workerGroup = <span class="keyword">new</span> NioEventLoopGroup();</span><br><span class="line"></span><br><span class="line">        ServerBootstrap serverBootstrap = <span class="keyword">new</span> ServerBootstrap();</span><br><span class="line"></span><br><span class="line">        serverBootstrap.group(workerGroup, workerGroup)</span><br><span class="line">                .channel(NioServerSocketChannel.class)</span><br><span class="line">                .option(ChannelOption.SO_BACKLOG, <span class="number">128</span>)</span><br><span class="line">                .childOption(ChannelOption.SO_KEEPALIVE, <span class="keyword">true</span>)</span><br><span class="line">                .childHandler(<span class="keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(SocketChannel channel)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                        <span class="comment">// è·å–pipeline</span></span><br><span class="line">                        ChannelPipeline pipeline = channel.pipeline();;</span><br><span class="line">                        <span class="comment">// å‘pipelineåŠ å…¥è§£ç å™¨</span></span><br><span class="line">                        pipeline.addLast(<span class="string">&quot;decoder&quot;</span>, <span class="keyword">new</span> StringDecoder());</span><br><span class="line">                        <span class="comment">// å‘pipelineåŠ å…¥ç¼–ç å™¨</span></span><br><span class="line">                        pipeline.addLast(<span class="string">&quot;encoder&quot;</span>, <span class="keyword">new</span> StringEncoder());</span><br><span class="line">                        <span class="comment">// åŠ å…¥è‡ªå·±çš„ä¸šåŠ¡å¤„ç†handler</span></span><br><span class="line">                        pipeline.addLast(<span class="keyword">new</span> GroupChatServerHandler());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;â–¶-----NettyæœåŠ¡å™¨å¯åŠ¨-----â—€&quot;</span>);</span><br><span class="line">            ChannelFuture channelFuture = serverBootstrap.bind(port).sync();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ç›‘å¬å…³é—­</span></span><br><span class="line">            channelFuture.channel().closeFuture().sync();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            System.out.println(e.getMessage());</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            bossGroup.shutdownGracefully();</span><br><span class="line">            workerGroup.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> GroupChatServer(<span class="number">3333</span>).run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>GroupChatServerHandler.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kag.netty.groupChat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.channel.Channel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.SimpleChannelInboundHandler;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.group.ChannelGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.group.DefaultChannelGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.util.concurrent.EventExecutor;</span><br><span class="line"><span class="keyword">import</span> io.netty.util.concurrent.GlobalEventExecutor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2020/10/2 8:33</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GroupChatServerHandler</span> <span class="keyword">extends</span> <span class="title">SimpleChannelInboundHandler</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ªchannelç»„ï¼Œç®¡ç†æ‰€æœ‰çš„channel</span></span><br><span class="line">    <span class="comment">// GlobalEventExecutor.INSTANCE æ˜¯å…¨å±€çš„æ—¶é—´æ‰§è¡Œå™¨ï¼Œæ˜¯ä¸€ä¸ªå•ä¾‹</span></span><br><span class="line">    EventExecutor executor;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ChannelGroup channelGroup = <span class="keyword">new</span> DefaultChannelGroup(GlobalEventExecutor.INSTANCE);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">now</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SimpleDateFormat simpleDateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> simpleDateFormat.format(<span class="keyword">new</span> Date());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HandlerAdded</span></span><br><span class="line"><span class="comment">     * è¡¨ç¤ºè¿æ¥å»ºç«‹ï¼Œä¸€æ—¦è¿æ¥ï¼Œç¬¬ä¸€ä¸ªè¢«æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ctx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handlerAdded</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Channel channel = ctx.channel();</span><br><span class="line">        <span class="comment">// å°†è¯¥å®¢æˆ·åŠ å…¥èŠå¤©çš„ä¿¡æ¯æ¨é€ç»™å…¶ä»–åœ¨çº¿çš„å®¢æˆ·</span></span><br><span class="line">        <span class="comment">// è¯¥æ–¹æ³•ä¼šå°†channelGroupä¸­çš„æ‰€æœ‰channeléå†ï¼Œå¹¶å‘é€æ¶ˆæ¯</span></span><br><span class="line">        channelGroup.writeAndFlush(now() + <span class="string">&quot; [å®¢æˆ·ç«¯]&quot;</span> + channel.remoteAddress() + <span class="string">&quot;åŠ å…¥èŠå¤©\n&quot;</span>);</span><br><span class="line">        channelGroup.add(channel);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HandlerRemoved</span></span><br><span class="line"><span class="comment">     * è¡¨ç¤ºæ–­å¼€è¿æ¥ï¼Œå°†XXå®¢æˆ·ç¦»çº¿ä¿¡æ¯æ¨é€ç»™å½“å‰åœ¨çº¿å®¢æˆ·</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ctx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handlerRemoved</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Channel channel = ctx.channel();</span><br><span class="line">        channelGroup.writeAndFlush(now() + <span class="string">&quot; [å®¢æˆ·ç«¯]&quot;</span> + channel.remoteAddress() + <span class="string">&quot;ç¦»å¼€èŠå¤©\n&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Channel Group Size = &quot;</span> + channelGroup.size());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * channelActive</span></span><br><span class="line"><span class="comment">     * è¡¨ç¤ºchannelå¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œæç¤ºXXä¸Šçº¿</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ctx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelActive</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(now() + <span class="string">&quot; &quot;</span> + ctx.channel().remoteAddress() + <span class="string">&quot;ä¸Šçº¿&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * channelInactive</span></span><br><span class="line"><span class="comment">     * è¡¨ç¤ºchannelå¤„äºéæ´»åŠ¨çŠ¶æ€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ctx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelInactive</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(now() + <span class="string">&quot; &quot;</span> + ctx.channel().remoteAddress() + <span class="string">&quot;ç¦»çº¿&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ChannelRead0</span></span><br><span class="line"><span class="comment">     * è½¬å‘æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> channelHandlerContext</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> s</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">channelRead0</span><span class="params">(ChannelHandlerContext channelHandlerContext, String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Channel channel = channelHandlerContext.channel();</span><br><span class="line">        <span class="comment">// éå†ChannelGroup</span></span><br><span class="line">        channelGroup.forEach(ch -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (channel != ch) <span class="comment">// ä¸æ˜¯å½“å‰channelï¼Œç›´æ¥è½¬å‘</span></span><br><span class="line">                ch.writeAndFlush(now() + <span class="string">&quot; [å®¢æˆ·]&quot;</span> + channel.remoteAddress() + <span class="string">&quot;ï¼š&quot;</span> + s + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="comment">// å½“å‰channelæ˜¯è‡ªå·±</span></span><br><span class="line">                ch.writeAndFlush(now() + <span class="string">&quot; [è‡ªå·±]: &quot;</span> + s + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¼‚å¸¸å¤„ç†</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ctx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cause</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.exceptionCaught(ctx, cause);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>GroupChatClient.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kag.netty.groupChat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.bootstrap.Bootstrap;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.*;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.nio.NioSocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.string.StringDecoder;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.string.StringEncoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.SocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2020/10/2 9:22</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GroupChatClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String host;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> port;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GroupChatClient</span><span class="params">(String host, <span class="keyword">int</span> port)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.host = host;</span><br><span class="line">        <span class="keyword">this</span>.port = port;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        EventLoopGroup group = <span class="keyword">new</span> NioEventLoopGroup();</span><br><span class="line"></span><br><span class="line">        Bootstrap bootstrap = <span class="keyword">new</span> Bootstrap()</span><br><span class="line">                .group(group)</span><br><span class="line">                .channel(NioSocketChannel.class)</span><br><span class="line">                .handler(<span class="keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(SocketChannel channel)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                        <span class="comment">// å¾—åˆ°pipeline</span></span><br><span class="line">                        ChannelPipeline pipeline = channel.pipeline();</span><br><span class="line">                        <span class="comment">// åŠ å…¥ç›¸å…³handler</span></span><br><span class="line">                        pipeline.addLast(<span class="string">&quot;decoder&quot;</span>, <span class="keyword">new</span> StringDecoder());</span><br><span class="line">                        pipeline.addLast(<span class="string">&quot;encoder&quot;</span>, <span class="keyword">new</span> StringEncoder());</span><br><span class="line">                        <span class="comment">// åŠ å…¥è‡ªå®šä¹‰çš„handler</span></span><br><span class="line">                        pipeline.addLast(<span class="keyword">new</span> GroupChatClientHandler());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ChannelFuture channelFuture = bootstrap.connect(host, port).sync();</span><br><span class="line">            Channel channel = channelFuture.channel();</span><br><span class="line">            System.out.println(<span class="string">&quot;â–¶-----&quot;</span> + channel.localAddress().toString().substring(<span class="number">1</span>) + <span class="string">&quot;-----â—€&quot;</span>);</span><br><span class="line">            <span class="comment">// è¾“å…¥ä¿¡æ¯</span></span><br><span class="line">            Scanner scanner = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">            <span class="keyword">while</span> (scanner.hasNextLine()) &#123;</span><br><span class="line">                String msg = scanner.nextLine();</span><br><span class="line">                <span class="comment">// é€šè¿‡channelå‘é€åˆ°æœåŠ¡å™¨ç«¯</span></span><br><span class="line">                channel.writeAndFlush(msg + <span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            System.out.println(e.getMessage());</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            group.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="keyword">new</span> GroupChatClient(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">3333</span>).run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>GroupChatClientHandler.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kag.netty.groupChat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.SimpleChannelInboundHandler;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2020/10/2 10:06</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GroupChatClientHandler</span> <span class="keyword">extends</span> <span class="title">SimpleChannelInboundHandler</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">channelRead0</span><span class="params">(ChannelHandlerContext channelHandlerContext, String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(s.trim());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-12-å¿ƒè·³æ£€æµ‹"><a href="#4-12-å¿ƒè·³æ£€æµ‹" class="headerlink" title="4.12 å¿ƒè·³æ£€æµ‹"></a>4.12 å¿ƒè·³æ£€æµ‹</h3><blockquote>
<p>è¦æ±‚</p>
</blockquote>
<ul>
<li>å½“æœåŠ¡å™¨è¶…è¿‡3ç§’æ²¡æœ‰è¯»æ“ä½œæ—¶ï¼Œå°±æç¤ºè¯»ç©ºé—²</li>
<li>å½“æœåŠ¡å™¨è¶…è¿‡5ç§’æ²¡æœ‰å†™æ“ä½œæ—¶ï¼Œå°±æç¤ºå†™ç©ºé—²</li>
<li>å½“æœåŠ¡å™¨è¶…è¿‡7ç§’æ²¡æœ‰è¯»æˆ–å†™æ—¶ï¼Œå°±æç¤ºè¯»å†™ç©ºé—²</li>
</ul>
<blockquote>
<p>MyServer.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kag.netty.heartbeat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.bootstrap.ServerBootstrap;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelFuture;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInitializer;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelPipeline;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.logging.LogLevel;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.logging.LoggingHandler;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.timeout.IdleStateHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2020/10/2 10:25</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyServer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        NioEventLoopGroup bossGroup = <span class="keyword">new</span> NioEventLoopGroup(<span class="number">1</span>);</span><br><span class="line">        NioEventLoopGroup workerGroup = <span class="keyword">new</span> NioEventLoopGroup();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ServerBootstrap serverBootstrap = <span class="keyword">new</span> ServerBootstrap();</span><br><span class="line">            serverBootstrap.group(bossGroup, workerGroup)</span><br><span class="line">                    .channel(NioServerSocketChannel.class)</span><br><span class="line">                    .handler(<span class="keyword">new</span> LoggingHandler(LogLevel.INFO))  <span class="comment">//ä¸ºBossGroupä¸­çš„è¯·æ±‚æ·»åŠ æ—¥å¿—å¤„ç†Handler</span></span><br><span class="line">                    .childHandler(<span class="keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(SocketChannel ch)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                            ChannelPipeline pipeline = ch.pipeline();</span><br><span class="line">                            <span class="comment">/**</span></span><br><span class="line"><span class="comment">                             * åŠ å…¥ä¸€ä¸ª netty æä¾›çš„ IdleStateHandler</span></span><br><span class="line"><span class="comment">                             * è¯´æ˜</span></span><br><span class="line"><span class="comment">                             * 1ã€IdleStateHandler æ˜¯ netty æä¾›çš„æ£€æµ‹ç©ºé—²çŠ¶æ€çš„å¤„ç†å™¨</span></span><br><span class="line"><span class="comment">                             * 2ã€long readerIdleTimeï¼šè¡¨ç¤ºå¤šé•¿æ—¶é—´æ²¡æœ‰è¯»ï¼Œå°±ä¼šå‘é€ä¸€ä¸ªå¿ƒè·³æ£€æµ‹åŒ…æ£€æµ‹æ˜¯å¦è¿˜æ˜¯è¿æ¥çš„çŠ¶æ€</span></span><br><span class="line"><span class="comment">                             * 3ã€long writerIdleTimeï¼šè¡¨ç¤ºå¤šé•¿æ—¶é—´æ²¡æœ‰å†™ï¼Œå°±ä¼šå‘é€ä¸€ä¸ªå¿ƒè·³æ£€æµ‹åŒ…æ£€æµ‹æ˜¯å¦è¿˜æ˜¯è¿æ¥çš„çŠ¶æ€</span></span><br><span class="line"><span class="comment">                             * 4ã€long allIdleTimeï¼šè¡¨ç¤ºå¤šé•¿æ—¶é—´æ²¡æœ‰è¯»å†™ï¼Œå°±ä¼šå‘é€ä¸€ä¸ªå¿ƒè·³æ£€æµ‹åŒ…æ£€æµ‹æ˜¯å¦è¿˜æ˜¯è¿æ¥çš„çŠ¶æ€</span></span><br><span class="line"><span class="comment">                             * 5ã€å½“ IdleStateEvent è§¦å‘åï¼Œå°±ä¼šä¼ é€’ç»™ç®¡é“çš„ä¸‹ä¸€ä¸ª Handlerï¼Œé€šè¿‡è°ƒç”¨ï¼ˆè§¦å‘ï¼‰ä¸‹ä¸€ä¸ªHandlerçš„ userEventTriggeredï¼Œåœ¨è¯¥æ–¹æ³•åŒºå¤„ç†è¿™ä¸ªäº‹ä»¶ã€‚</span></span><br><span class="line"><span class="comment">                             */</span></span><br><span class="line">                            pipeline.addLast(<span class="keyword">new</span> IdleStateHandler(<span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, TimeUnit.SECONDS));</span><br><span class="line"></span><br><span class="line">                            <span class="comment">//åŠ å…¥ä¸€ä¸ªå¯¹ç©ºé—²æ£€æµ‹è¿›ä¸€æ­¥å¤„ç†çš„Handlerï¼ˆè‡ªå®šä¹‰ï¼‰</span></span><br><span class="line">                            pipeline.addLast(<span class="keyword">new</span> MyServerHandler());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">            <span class="comment">//å¯åŠ¨æœåŠ¡å™¨ï¼Œè®¾ç½®ä¸ºåŒæ­¥æ¨¡å¼</span></span><br><span class="line">            ChannelFuture channelFuture = serverBootstrap.bind(<span class="number">3333</span>).sync();</span><br><span class="line">            channelFuture.channel().closeFuture().sync();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            bossGroup.shutdownGracefully();</span><br><span class="line">            workerGroup.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>MyServerHandler.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kag.netty.heartbeat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInboundHandlerAdapter;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.timeout.IdleStateEvent;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2020/10/2 10:48</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyServerHandler</span> <span class="keyword">extends</span> <span class="title">ChannelInboundHandlerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ctx ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> evt äº‹ä»¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">userEventTriggered</span><span class="params">(ChannelHandlerContext ctx, Object evt)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (evt <span class="keyword">instanceof</span> IdleStateEvent) &#123;</span><br><span class="line">            <span class="comment">// å°†evtå‘ä¸‹è½¬å‹</span></span><br><span class="line">            IdleStateEvent event = (IdleStateEvent) evt;</span><br><span class="line">            String eventType = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">switch</span> (event.state()) &#123;</span><br><span class="line">                <span class="keyword">case</span> READER_IDLE:</span><br><span class="line">                    eventType = <span class="string">&quot;è¯»ç©ºé—²&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> WRITER_IDLE:</span><br><span class="line">                    eventType = <span class="string">&quot;å†™ç©ºé—²&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> ALL_IDLE:</span><br><span class="line">                    eventType = <span class="string">&quot;è¯»å†™ç©ºé—²&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(ctx.channel().remoteAddress() + <span class="string">&quot;â€”â€”&gt;è¶…æ—¶ï¼š&quot;</span> + eventType);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¦‚æœå‘ç”Ÿç©ºé—²ï¼Œç›´æ¥å…³é—­é€šé“</span></span><br><span class="line"><span class="comment">//            ctx.channel().close();</span></span><br><span class="line"><span class="comment">//            System.out.println(&quot;æœåŠ¡å™¨å…³é—­é€šé“Â·Â·Â·&quot;);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-13-ç®€å•æ€»ç»“"><a href="#4-13-ç®€å•æ€»ç»“" class="headerlink" title="4.13 ç®€å•æ€»ç»“"></a>4.13 ç®€å•æ€»ç»“</h3><blockquote>
<p>æœåŠ¡å™¨</p>
</blockquote>
<ol>
<li>åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ç»„ï¼Œ<code>bossGroup</code>å’Œ<code>workerGroup</code></li>
<li>åˆ›å»ºæœåŠ¡å™¨å¯åŠ¨å¯¹è±¡<code>ServerBootStrap</code></li>
<li>é“¾å¼ç¼–ç¨‹é…ç½®<code>ServerBootStrap</code>çš„å‚æ•°<ol>
<li><code>group</code>ï¼šè®¾ç½®çº¿ç¨‹ç»„<code>bossGroup</code>å’Œ<code>workerGroup</code></li>
<li><code>channel</code>ï¼šè®¾ç½®é€šé“å®ç°ï¼Œä¸€èˆ¬é€‰æ‹©<code>NioServerSocketChannel</code></li>
<li><code>option</code>ï¼šè®¾ç½®å¯è¿æ¥çº¿ç¨‹é˜Ÿåˆ—ä»¥åŠå¤§å°ï¼Œä¸€èˆ¬é€‰æ‹©<code>SO_BACKLOG</code></li>
<li><code>childOption</code>ï¼šè®¾ç½®ä¿æŒæ´»åŠ¨è¿æ¥çŠ¶æ€ï¼Œé€‰æ‹©<code>SO_KEEPALIVE</code></li>
<li><code>handler</code>ï¼šç»™<code>bossGroup</code>è®¾ç½®<code>Handler</code></li>
<li><code>childHandler</code>ï¼šç»™<code>workerGroup</code>è®¾ç½®<code>Hadnler</code></li>
</ol>
</li>
<li><code>ServerBootStrap</code>ç»‘å®šç«¯å£ï¼Œè®¾ç½®åŒæ­¥ï¼Œå¹¶ä¸”ç›‘å¬é€šé“å…³é—­äº‹ä»¶</li>
</ol>
<blockquote>
<p>å®¢æˆ·ç«¯</p>
</blockquote>
<ol>
<li>åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ç»„<code>group</code></li>
<li>åˆ›å»ºå®¢æˆ·ç«¯å¯åŠ¨å¯¹è±¡<code>BootStrap</code></li>
<li>é“¾å¼ç¼–ç¨‹é…ç½®<code>BootStrap</code>çš„å‚æ•°<ol>
<li><code>group</code>ï¼šè®¾ç½®çº¿ç¨‹ç»„<code>group</code></li>
<li><code>channel</code>ï¼šè®¾ç½®é€šé“å®ç°ï¼Œä¸€èˆ¬é€‰æ‹©<code>NioSocketChannel</code></li>
<li><code>handler</code>ï¼šè®¾ç½®<code>Handler</code></li>
</ol>
</li>
<li><code>BootStrap</code>ç»‘å®šç«¯å£ï¼Œè®¾ç½®åŒæ­¥ï¼Œå¹¶ä¸”ç›‘å¬é€šé“å…³é—­äº‹ä»¶</li>
</ol>
<blockquote>
<p>å¸¸è§Handler</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">Handler</th>
<th align="center">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="center">SimpleChannelInboundHandler</td>
<td align="center">å¤„ç†é€šä¿¡(æœåŠ¡å™¨æœ€å¸¸ç”¨)</td>
</tr>
<tr>
<td align="center">IdleStateHandler</td>
<td align="center">æ£€æµ‹ç©ºé—²çŠ¶æ€(å¿ƒè·³æ£€æµ‹)</td>
</tr>
<tr>
<td align="center">WebSocketServerProtocolHandler</td>
<td align="center">å°†httpåè®®å‡çº§wsåè®®ï¼Œä¿æŒé•¿è¿æ¥</td>
</tr>
</tbody></table>
<blockquote>
<p>Handlerå¸¸ç”¨æ–¹æ³•</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">Method</th>
<th align="center">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="center">handlerAdded(ChannelHandlerContext ctx)</td>
<td align="center">è¿æ¥å»ºç«‹ï¼Œä¸€æ—¦å»ºç«‹è¿æ¥ï¼Œç¬¬ä¸€ä¸ªè¢«æ‰§è¡Œçš„æ–¹æ³•</td>
</tr>
<tr>
<td align="center">handlerRemoved(ChannelHandlerContext ctx)</td>
<td align="center">è¿æ¥æ–­å¼€ï¼Œå°†XXå®¢æˆ·ç¦»çº¿ä¿¡æ¯æ¨é€ç»™å½“å‰åœ¨çº¿å®¢æˆ·</td>
</tr>
<tr>
<td align="center">channelActive(ChannelHandlerContext ctx)</td>
<td align="center">è¡¨ç¤ºchannelå¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œæç¤ºXXä¸Šçº¿</td>
</tr>
<tr>
<td align="center">channelInactive(ChannelHandlerContext ctx)</td>
<td align="center">è¡¨ç¤ºchannelå¤„äºéæ´»åŠ¨çŠ¶æ€ï¼Œæç¤ºXXç¦»çº¿</td>
</tr>
<tr>
<td align="center">channelRead0(ChannelHandlerContext channelHandlerContext, String s)</td>
<td align="center">è¯»å–æ•°æ®ï¼Œå¹¶è¿›è¡Œæ¶ˆæ¯è½¬å‘</td>
</tr>
<tr>
<td align="center">exceptionCaught(ChannelHandlerContext ctx, Throwable cause)</td>
<td align="center">å¼‚å¸¸å¤„ç†</td>
</tr>
<tr>
<td align="center">userEventTriggered(ChannelHandlerContext ctx, Object evt)</td>
<td align="center">äº‹ä»¶è§¦å‘å™¨ã€‚åœ¨<code>IdleStateHandler</code>åé¢åŠ ä¸Šä¸€ä¸ªè§¦å‘å™¨ï¼Œå¯ä»¥æ£€æµ‹å¿ƒè·³ã€‚</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>-Netty</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Netty</tag>
      </tags>
  </entry>
  <entry>
    <title>è®¾è®¡æ¨¡å¼</title>
    <url>/2020/11/11/DesignPattern/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h1><center>
    <font face="Kristen ITC" color="#555555" font-size=100px>ğŸ’Œ Khighness ğŸ’Œ</font><br>
</center>



<h2 id="1-è®¾è®¡åŸåˆ™"><a href="#1-è®¾è®¡åŸåˆ™" class="headerlink" title="1. è®¾è®¡åŸåˆ™"></a>1. è®¾è®¡åŸåˆ™</h2><h3 id="1-1-å¼€é—­åŸåˆ™"><a href="#1-1-å¼€é—­åŸåˆ™" class="headerlink" title="1.1 å¼€é—­åŸåˆ™"></a>1.1 å¼€é—­åŸåˆ™</h3><blockquote>
<p>å®šä¹‰</p>
</blockquote>
<p>è½¯ä»¶å®ä½“åº”å½“å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚</p>
<blockquote>
<p>å®ç°</p>
</blockquote>
<p>å¯ä»¥é€šè¿‡â€œæŠ½è±¡çº¦æŸã€å°è£…å˜åŒ–â€æ¥å®ç°å¼€é—­åŸåˆ™ï¼Œå³é€šè¿‡æ¥å£æˆ–è€…æŠ½è±¡ç±»ä¸ºè½¯ä»¶å®ä½“å®šä¹‰ä¸€ä¸ªç›¸å¯¹ç¨³å®šçš„æŠ½è±¡å±‚ï¼Œè€Œå°†ç›¸åŒçš„å¯å˜å› ç´ å°è£…åœ¨ç›¸åŒçš„å…·ä½“å®ç°ç±»ä¸­ã€‚</p>
<p>å› ä¸ºæŠ½è±¡çµæ´»æ€§å¥½ï¼Œé€‚åº”æ€§å¹¿ï¼Œåªè¦æŠ½è±¡çš„åˆç†ï¼Œå¯ä»¥åŸºæœ¬ä¿æŒè½¯ä»¶æ¶æ„çš„ç¨³å®šã€‚è€Œè½¯ä»¶ä¸­æ˜“å˜çš„ç»†èŠ‚å¯ä»¥ä»æŠ½è±¡æ´¾ç”Ÿæ¥çš„å®ç°ç±»æ¥è¿›è¡Œæ‰©å±•ï¼Œå½“è½¯ä»¶éœ€è¦å‘ç”Ÿå˜åŒ–æ—¶ï¼Œåªéœ€è¦æ ¹æ®éœ€æ±‚é‡æ–°æ´¾ç”Ÿä¸€ä¸ªå®ç°ç±»æ¥æ‰©å±•å°±å¯ä»¥äº†ã€‚</p>
<blockquote>
<p>ä½œç”¨</p>
</blockquote>
<p>å¼€é—­åŸåˆ™æ˜¯é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡çš„ç»ˆæç›®æ ‡ï¼Œå®ƒä½¿è½¯ä»¶å®ä½“æ‹¥æœ‰ä¸€å®šçš„é€‚åº”æ€§å’Œçµæ´»æ€§çš„åŒæ—¶å…·å¤‡ç¨³å®šæ€§å’Œå»¶ç»­æ€§ã€‚å…·ä½“æ¥è¯´ï¼Œå…¶ä½œç”¨å¦‚ä¸‹ã€‚</p>
<ol>
<li>å¯¹è½¯ä»¶æµ‹è¯•çš„å½±å“</li>
</ol>
<p>è½¯ä»¶éµå®ˆå¼€é—­åŸåˆ™çš„è¯ï¼Œè½¯ä»¶æµ‹è¯•æ—¶åªéœ€è¦å¯¹æ‰©å±•çš„ä»£ç è¿›è¡Œæµ‹è¯•å°±å¯ä»¥äº†ï¼Œå› ä¸ºåŸæœ‰çš„æµ‹è¯•ä»£ç ä»ç„¶èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚</p>
<ol start="2">
<li>å¯ä»¥æé«˜ä»£ç çš„å¯å¤ç”¨æ€§</li>
</ol>
<p>ç²’åº¦è¶Šå°ï¼Œè¢«å¤ç”¨çš„å¯èƒ½æ€§å°±è¶Šå¤§ï¼›åœ¨é¢å‘å¯¹è±¡çš„ç¨‹åºè®¾è®¡ä¸­ï¼Œæ ¹æ®åŸå­å’ŒæŠ½è±¡ç¼–ç¨‹å¯ä»¥æé«˜ä»£ç çš„å¯å¤ç”¨æ€§ã€‚</p>
<ol start="3">
<li>å¯ä»¥æé«˜è½¯ä»¶çš„å¯ç»´æŠ¤æ€§</li>
</ol>
<p>éµå®ˆå¼€é—­åŸåˆ™çš„è½¯ä»¶ï¼Œå…¶ç¨³å®šæ€§é«˜å’Œå»¶ç»­æ€§å¼ºï¼Œä»è€Œæ˜“äºæ‰©å±•å’Œç»´æŠ¤ã€‚</p>
<h3 id="1-2-é‡Œå¼æ›¿æ¢åŸåˆ™"><a href="#1-2-é‡Œå¼æ›¿æ¢åŸåˆ™" class="headerlink" title="1.2 é‡Œå¼æ›¿æ¢åŸåˆ™"></a>1.2 é‡Œå¼æ›¿æ¢åŸåˆ™</h3><blockquote>
<p>å®šä¹‰</p>
</blockquote>
<p>ç»§æ‰¿å¿…é¡»ç¡®ä¿è¶…ç±»æ‰€æ‹¥æœ‰çš„æ€§è´¨åœ¨å­ç±»ä¸­ä»ç„¶æˆç«‹</p>
<blockquote>
<p>å®ç°</p>
</blockquote>
<p>å­ç±»å¯ä»¥æ‰©å±•çˆ¶ç±»çš„åŠŸèƒ½ï¼Œä½†ä¸èƒ½æ”¹å˜çˆ¶ç±»åŸæœ‰çš„åŠŸèƒ½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šå­ç±»ç»§æ‰¿çˆ¶ç±»æ—¶ï¼Œé™¤æ·»åŠ æ–°çš„æ–¹æ³•å®Œæˆæ–°å¢åŠŸèƒ½å¤–ï¼Œå°½é‡ä¸è¦é‡å†™çˆ¶ç±»çš„æ–¹æ³•ã€‚</p>
<p>æ ¹æ®ä¸Šè¿°ç†è§£ï¼Œå¯¹é‡Œæ°æ›¿æ¢åŸåˆ™çš„å®šä¹‰å¯ä»¥æ€»ç»“å¦‚ä¸‹ï¼š</p>
<ul>
<li>å­ç±»å¯ä»¥å®ç°çˆ¶ç±»çš„æŠ½è±¡æ–¹æ³•ï¼Œä½†ä¸èƒ½è¦†ç›–çˆ¶ç±»çš„éæŠ½è±¡æ–¹æ³•</li>
<li>å­ç±»ä¸­å¯ä»¥å¢åŠ è‡ªå·±ç‰¹æœ‰çš„æ–¹æ³•</li>
<li>å½“å­ç±»çš„æ–¹æ³•é‡è½½çˆ¶ç±»çš„æ–¹æ³•æ—¶ï¼Œæ–¹æ³•çš„å‰ç½®æ¡ä»¶ï¼ˆå³æ–¹æ³•çš„è¾“å…¥å‚æ•°ï¼‰è¦æ¯”çˆ¶ç±»çš„æ–¹æ³•æ›´å®½æ¾</li>
<li>å½“å­ç±»çš„æ–¹æ³•å®ç°çˆ¶ç±»çš„æ–¹æ³•æ—¶ï¼ˆé‡å†™/é‡è½½æˆ–å®ç°æŠ½è±¡æ–¹æ³•ï¼‰ï¼Œæ–¹æ³•çš„åç½®æ¡ä»¶ï¼ˆå³æ–¹æ³•çš„çš„è¾“å‡º/è¿”å›å€¼ï¼‰è¦æ¯”çˆ¶ç±»çš„æ–¹æ³•æ›´ä¸¥æ ¼æˆ–ç›¸ç­‰</li>
</ul>
<blockquote>
<p>ä½œç”¨</p>
</blockquote>
<ul>
<li><p>é‡Œæ°æ›¿æ¢åŸåˆ™æ˜¯å®ç°å¼€é—­åŸåˆ™çš„é‡è¦æ–¹å¼ä¹‹ä¸€ã€‚</p>
</li>
<li><p>å®ƒå…‹æœäº†ç»§æ‰¿ä¸­é‡å†™çˆ¶ç±»é€ æˆçš„å¯å¤ç”¨æ€§å˜å·®çš„ç¼ºç‚¹ã€‚</p>
</li>
<li><p>å®ƒæ˜¯åŠ¨ä½œæ­£ç¡®æ€§çš„ä¿è¯ã€‚å³ç±»çš„æ‰©å±•ä¸ä¼šç»™å·²æœ‰çš„ç³»ç»Ÿå¼•å…¥æ–°çš„é”™è¯¯ï¼Œé™ä½äº†ä»£ç å‡ºé”™çš„å¯èƒ½æ€§ã€‚</p>
</li>
<li><p>åŠ å¼ºç¨‹åºçš„å¥å£®æ€§ï¼ŒåŒæ—¶å˜æ›´æ—¶å¯ä»¥åšåˆ°éå¸¸å¥½çš„å…¼å®¹æ€§ï¼Œæé«˜ç¨‹åºçš„ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§ï¼Œé™ä½éœ€æ±‚å˜æ›´æ—¶å¼•å…¥çš„é£é™©ã€‚</p>
</li>
</ul>
<h3 id="1-3-ä¾èµ–å€’ç½®åŸåˆ™"><a href="#1-3-ä¾èµ–å€’ç½®åŸåˆ™" class="headerlink" title="1.3 ä¾èµ–å€’ç½®åŸåˆ™"></a>1.3 ä¾èµ–å€’ç½®åŸåˆ™</h3><blockquote>
<p>å®šä¹‰</p>
</blockquote>
<p>é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–å…¶æŠ½è±¡ï¼›æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡ã€‚</p>
<blockquote>
<p>å®ç°</p>
</blockquote>
<ul>
<li><p>æ¯ä¸ªç±»å°½é‡æä¾›æ¥å£æˆ–æŠ½è±¡ç±»ï¼Œæˆ–è€…ä¸¤è€…éƒ½å…·å¤‡ã€‚</p>
</li>
<li><p>å˜é‡çš„å£°æ˜ç±»å‹å°½é‡æ˜¯æ¥å£æˆ–è€…æ˜¯æŠ½è±¡ç±»ã€‚</p>
</li>
<li><p>ä»»ä½•ç±»éƒ½ä¸åº”è¯¥ä»å…·ä½“ç±»æ´¾ç”Ÿã€‚</p>
</li>
<li><p>ä½¿ç”¨ç»§æ‰¿æ—¶å°½é‡éµå¾ªé‡Œæ°æ›¿æ¢åŸåˆ™ã€‚</p>
</li>
</ul>
<blockquote>
<p>ä½œç”¨</p>
</blockquote>
<ul>
<li>ä¾èµ–å€’ç½®åŸåˆ™å¯ä»¥é™ä½ç±»é—´çš„è€¦åˆæ€§ã€‚</li>
<li>ä¾èµ–å€’ç½®åŸåˆ™å¯ä»¥æé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚</li>
<li>ä¾èµ–å€’ç½®åŸåˆ™å¯ä»¥å‡å°‘å¹¶è¡Œå¼€å‘å¼•èµ·çš„é£é™©ã€‚</li>
<li>ä¾èµ–å€’ç½®åŸåˆ™å¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</li>
</ul>
<h3 id="1-4-å•ä¸€èŒè´£åŸåˆ™"><a href="#1-4-å•ä¸€èŒè´£åŸåˆ™" class="headerlink" title="1.4 å•ä¸€èŒè´£åŸåˆ™"></a>1.4 å•ä¸€èŒè´£åŸåˆ™</h3><blockquote>
<p>å®šä¹‰</p>
</blockquote>
<p>ä¸€ä¸ªç±»åº”è¯¥æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå¼•èµ·å®ƒå˜åŒ–çš„åŸå› ï¼Œå¦åˆ™ç±»åº”è¯¥è¢«æ‹†åˆ†</p>
<blockquote>
<p>å®ç°</p>
</blockquote>
<p>å•ä¸€èŒè´£åŸåˆ™æ˜¯æœ€ç®€å•ä½†åˆæœ€éš¾è¿ç”¨çš„åŸåˆ™ï¼Œéœ€è¦è®¾è®¡äººå‘˜å‘ç°ç±»çš„ä¸åŒèŒè´£å¹¶å°†å…¶åˆ†ç¦»ï¼Œå†å°è£…åˆ°ä¸åŒçš„ç±»æˆ–æ¨¡å—ä¸­ã€‚</p>
<blockquote>
<p>ä½œç”¨</p>
</blockquote>
<p>å•ä¸€èŒè´£åŸåˆ™çš„æ ¸å¿ƒå°±æ˜¯æ§åˆ¶ç±»çš„ç²’åº¦å¤§å°ã€å°†å¯¹è±¡è§£è€¦ã€æé«˜å…¶å†…èšæ€§ã€‚</p>
<ul>
<li>é™ä½ç±»çš„å¤æ‚åº¦ã€‚ä¸€ä¸ªç±»åªè´Ÿè´£ä¸€é¡¹èŒè´£ï¼Œå…¶é€»è¾‘è‚¯å®šè¦æ¯”è´Ÿè´£å¤šé¡¹èŒè´£ç®€å•å¾—å¤šã€‚</li>
<li>æé«˜ç±»çš„å¯è¯»æ€§ã€‚å¤æ‚æ€§é™ä½ï¼Œè‡ªç„¶å…¶å¯è¯»æ€§ä¼šæé«˜ã€‚</li>
<li>æé«˜ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€‚å¯è¯»æ€§æé«˜ï¼Œé‚£è‡ªç„¶æ›´å®¹æ˜“ç»´æŠ¤äº†ã€‚</li>
<li>å˜æ›´å¼•èµ·çš„é£é™©é™ä½ã€‚å˜æ›´æ˜¯å¿…ç„¶çš„ï¼Œå¦‚æœå•ä¸€èŒè´£åŸåˆ™éµå®ˆå¾—å¥½ï¼Œå½“ä¿®æ”¹ä¸€ä¸ªåŠŸèƒ½æ—¶ï¼Œå¯ä»¥æ˜¾è‘—é™ä½å¯¹å…¶ä»–åŠŸèƒ½çš„å½±å“ã€‚</li>
</ul>
<h3 id="1-5-æ¥å£éš”ç¦»åŸåˆ™"><a href="#1-5-æ¥å£éš”ç¦»åŸåˆ™" class="headerlink" title="1.5 æ¥å£éš”ç¦»åŸåˆ™"></a>1.5 æ¥å£éš”ç¦»åŸåˆ™</h3><blockquote>
<p>å®šä¹‰</p>
</blockquote>
<p>è¦ä¸ºå„ä¸ªç±»å»ºç«‹å®ƒä»¬éœ€è¦çš„ä¸“ç”¨æ¥å£ï¼Œè€Œä¸è¦è¯•å›¾å»å»ºç«‹ä¸€ä¸ªå¾ˆåºå¤§çš„æ¥å£ä¾›æ‰€æœ‰ä¾èµ–å®ƒçš„ç±»å»è°ƒç”¨ã€‚</p>
<blockquote>
<p>å®ç°</p>
</blockquote>
<p>åœ¨å…·ä½“åº”ç”¨æ¥å£éš”ç¦»åŸåˆ™æ—¶ï¼Œåº”è¯¥æ ¹æ®ä»¥ä¸‹å‡ ä¸ªè§„åˆ™æ¥è¡¡é‡ã€‚</p>
<ul>
<li>æ¥å£å°½é‡å°ï¼Œä½†æ˜¯è¦æœ‰é™åº¦ã€‚ä¸€ä¸ªæ¥å£åªæœåŠ¡äºä¸€ä¸ªå­æ¨¡å—æˆ–ä¸šåŠ¡é€»è¾‘ã€‚</li>
<li>ä¸ºä¾èµ–æ¥å£çš„ç±»å®šåˆ¶æœåŠ¡ã€‚åªæä¾›è°ƒç”¨è€…éœ€è¦çš„æ–¹æ³•ï¼Œå±è”½ä¸éœ€è¦çš„æ–¹æ³•ã€‚</li>
<li>äº†è§£ç¯å¢ƒï¼Œæ‹’ç»ç›²ä»ã€‚æ¯ä¸ªé¡¹ç›®æˆ–äº§å“éƒ½æœ‰é€‰å®šçš„ç¯å¢ƒå› ç´ ï¼Œç¯å¢ƒä¸åŒï¼Œæ¥å£æ‹†åˆ†çš„æ ‡å‡†å°±ä¸åŒæ·±å…¥äº†è§£ä¸šåŠ¡é€»è¾‘ã€‚</li>
<li>æé«˜å†…èšï¼Œå‡å°‘å¯¹å¤–äº¤äº’ã€‚ä½¿æ¥å£ç”¨æœ€å°‘çš„æ–¹æ³•å»å®Œæˆæœ€å¤šçš„äº‹æƒ…ã€‚</li>
</ul>
<blockquote>
<p>ä½œç”¨</p>
</blockquote>
<p>æ¥å£éš”ç¦»åŸåˆ™æ˜¯ä¸ºäº†çº¦æŸæ¥å£ã€é™ä½ç±»å¯¹æ¥å£çš„ä¾èµ–æ€§ï¼Œéµå¾ªæ¥å£éš”ç¦»åŸåˆ™æœ‰ä»¥ä¸‹ 5 ä¸ªä¼˜ç‚¹ã€‚</p>
<ul>
<li><p>å°†è‡ƒè‚¿åºå¤§çš„æ¥å£åˆ†è§£ä¸ºå¤šä¸ªç²’åº¦å°çš„æ¥å£ï¼Œå¯ä»¥é¢„é˜²å¤–æ¥å˜æ›´çš„æ‰©æ•£ï¼Œæé«˜ç³»ç»Ÿçš„çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
</li>
<li><p>æ¥å£éš”ç¦»æé«˜äº†ç³»ç»Ÿçš„å†…èšæ€§ï¼Œå‡å°‘äº†å¯¹å¤–äº¤äº’ï¼Œé™ä½äº†ç³»ç»Ÿçš„è€¦åˆæ€§ã€‚</p>
</li>
<li><p>å¦‚æœæ¥å£çš„ç²’åº¦å¤§å°å®šä¹‰åˆç†ï¼Œèƒ½å¤Ÿä¿è¯ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼›ä½†æ˜¯ï¼Œå¦‚æœå®šä¹‰è¿‡å°ï¼Œåˆ™ä¼šé€ æˆæ¥å£æ•°é‡è¿‡å¤šï¼Œä½¿è®¾è®¡å¤æ‚åŒ–ï¼›å¦‚æœå®šä¹‰å¤ªå¤§ï¼Œçµæ´»æ€§é™ä½ï¼Œæ— æ³•æä¾›å®šåˆ¶æœåŠ¡ï¼Œç»™æ•´ä½“é¡¹ç›®å¸¦æ¥æ— æ³•é¢„æ–™çš„é£é™©ã€‚</p>
</li>
<li><p>ä½¿ç”¨å¤šä¸ªä¸“é—¨çš„æ¥å£è¿˜èƒ½å¤Ÿä½“ç°å¯¹è±¡çš„å±‚æ¬¡ï¼Œå› ä¸ºå¯ä»¥é€šè¿‡æ¥å£çš„ç»§æ‰¿ï¼Œå®ç°å¯¹æ€»æ¥å£çš„å®šä¹‰ã€‚</p>
</li>
<li><p>èƒ½å‡å°‘é¡¹ç›®å·¥ç¨‹ä¸­çš„ä»£ç å†—ä½™ã€‚è¿‡å¤§çš„å¤§æ¥å£é‡Œé¢é€šå¸¸æ”¾ç½®è®¸å¤šä¸ç”¨çš„æ–¹æ³•ï¼Œå½“å®ç°è¿™ä¸ªæ¥å£çš„æ—¶å€™ï¼Œè¢«è¿«è®¾è®¡å†—ä½™çš„ä»£ç ã€‚</p>
</li>
</ul>
<h3 id="1-6-è¿ªç±³ç‰¹æ³•åˆ™"><a href="#1-6-è¿ªç±³ç‰¹æ³•åˆ™" class="headerlink" title="1.6 è¿ªç±³ç‰¹æ³•åˆ™"></a>1.6 è¿ªç±³ç‰¹æ³•åˆ™</h3><blockquote>
<p>å®šä¹‰</p>
</blockquote>
<p>å¦‚æœä¸¤ä¸ªè½¯ä»¶å®ä½“æ— é¡»ç›´æ¥é€šä¿¡ï¼Œé‚£ä¹ˆå°±ä¸åº”å½“å‘ç”Ÿç›´æ¥çš„ç›¸äº’è°ƒç”¨ï¼Œå¯ä»¥é€šè¿‡ç¬¬ä¸‰æ–¹è½¬å‘è¯¥è°ƒç”¨ã€‚</p>
<blockquote>
<p>å®ç°</p>
</blockquote>
<ul>
<li><p>ä»ä¾èµ–è€…çš„è§’åº¦æ¥è¯´ï¼Œåªä¾èµ–åº”è¯¥ä¾èµ–çš„å¯¹è±¡ã€‚</p>
</li>
<li><p>ä»è¢«ä¾èµ–è€…çš„è§’åº¦è¯´ï¼Œåªæš´éœ²åº”è¯¥æš´éœ²çš„æ–¹æ³•ã€‚</p>
</li>
</ul>
<blockquote>
<p>ä½œç”¨</p>
</blockquote>
<p>è¿ªç±³ç‰¹æ³•åˆ™è¦æ±‚é™åˆ¶è½¯ä»¶å®ä½“ä¹‹é—´é€šä¿¡çš„å®½åº¦å’Œæ·±åº¦ï¼Œæ­£ç¡®ä½¿ç”¨è¿ªç±³ç‰¹æ³•åˆ™å°†æœ‰ä»¥ä¸‹ä¸¤ä¸ªä¼˜ç‚¹ã€‚</p>
<ul>
<li><p>é™ä½äº†ç±»ä¹‹é—´çš„è€¦åˆåº¦ï¼Œæé«˜äº†æ¨¡å—çš„ç›¸å¯¹ç‹¬ç«‹æ€§ã€‚</p>
</li>
<li><p>ç”±äºäº²åˆåº¦é™ä½ï¼Œä»è€Œæé«˜äº†ç±»çš„å¯å¤ç”¨ç‡å’Œç³»ç»Ÿçš„æ‰©å±•æ€§ã€‚</p>
</li>
</ul>
<h2 id="2-è®¾è®¡æ¨¡å¼"><a href="#2-è®¾è®¡æ¨¡å¼" class="headerlink" title="2. è®¾è®¡æ¨¡å¼"></a>2. è®¾è®¡æ¨¡å¼</h2><img src="/2020/11/11/DesignPattern/image-20201009122147509.png" class="" title="image-20201009122147509">



<h3 id="2-1-å•ä¾‹æ¨¡å¼-Singleton"><a href="#2-1-å•ä¾‹æ¨¡å¼-Singleton" class="headerlink" title="2.1 å•ä¾‹æ¨¡å¼-Singleton"></a>2.1 å•ä¾‹æ¨¡å¼-Singleton</h3><blockquote>
<p>å®šä¹‰</p>
</blockquote>
<p>ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œä¸”è¯¥ç±»èƒ½è‡ªè¡Œåˆ›å»ºè¿™ä¸ªå®ä¾‹</p>
<blockquote>
<p>ç‰¹ç‚¹</p>
</blockquote>
<ol>
<li>å•ä¾‹ç±»åªæœ‰ä¸€ä¸ªå®ä¾‹å¯¹è±¡ã€‚</li>
<li>è¯¥å•ä¾‹å¯¹è±¡å¿…é¡»ç”±å•ä¾‹ç±»è‡ªè¡Œåˆ›å»ºã€‚</li>
<li>å•ä¾‹ç±»å¯¹å¤–æä¾›ä¸€ä¸ªè®¿é—®è¯¥å•ä¾‹çš„å…¨å±€è®¿é—®ç‚¹ã€‚</li>
</ol>
<blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<ul>
<li>å•ä¾‹æ¨¡å¼å¯ä»¥ä¿è¯å†…å­˜ä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå‡å°‘äº†å†…å­˜çš„å¼€é”€ã€‚</li>
<li>å¯ä»¥é¿å…å¯¹èµ„æºçš„å¤šé‡å ç”¨ã€‚</li>
<li>å•ä¾‹æ¨¡å¼è®¾ç½®å…¨å±€è®¿é—®ç‚¹ï¼Œå¯ä»¥ä¼˜åŒ–å’Œå…±äº«èµ„æºçš„è®¿é—®ã€‚</li>
</ul>
<blockquote>
<p>ç¼ºç‚¹</p>
</blockquote>
<ul>
<li>å•ä¾‹æ¨¡å¼ä¸€èˆ¬æ²¡æœ‰æ¥å£ï¼Œæ‰©å±•å›°éš¾ï¼Œå¦‚æœè¦æ‰©å±•ï¼Œåˆ™é™¤äº†ä¿®æ”¹åŸæ¥çš„ä»£ç ï¼Œæ²¡æœ‰ç¬¬äºŒç§é€”å¾„ï¼Œè¿èƒŒå¼€é—­åŸåˆ™ã€‚</li>
<li>åœ¨å¹¶å‘æµ‹è¯•ä¸­ï¼Œå•ä¾‹æ¨¡å¼ä¸åˆ©äºä»£ç è°ƒè¯•ã€‚åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå•ä¾‹ä¸­çš„ä»£ç æ²¡æœ‰æ‰§è¡Œå®Œï¼Œä¹Ÿä¸èƒ½æ¨¡æ‹Ÿç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚</li>
<li>å•ä¾‹æ¨¡å¼çš„åŠŸèƒ½ä»£ç é€šå¸¸å†™åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œå¦‚æœåŠŸèƒ½è®¾è®¡ä¸åˆç†ï¼Œåˆ™å¾ˆå®¹æ˜“è¿èƒŒå•ä¸€èŒè´£åŸåˆ™ã€‚</li>
</ul>
<blockquote>
<p>ç»“æ„</p>
</blockquote>
<ul>
<li>å•ä¾‹ç±»</li>
<li>è®¿é—®ç±»</li>
</ul>
<blockquote>
<p>å®ç°</p>
</blockquote>
<blockquote>
<p>æ‡’æ±‰å¼å•ä¾‹</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.singleton.pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: DesignPattern &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.singeleton.pattern &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: LazySingleton &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: æ‡’æ±‰å¼å•ä¾‹ &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/10/16</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; ç‰¹ç‚¹ï¼š</span></span><br><span class="line"><span class="comment"> * ç±»åŠ è½½æ—¶æ²¡æœ‰ç”Ÿæˆå•ä¾‹ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡è°ƒç”¨getInstanceæ–¹æ³•æ—¶æ‰ä¼šåˆ›å»ºè¿™ä¸ªå•ä¾‹</span></span><br><span class="line"><span class="comment"> * &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LazySingleton</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* volatile: å…·æœ‰å¯è§æ€§ã€æœ‰åºæ€§ï¼Œä¸å…·å¤‡åŸå­æ€§</span></span><br><span class="line"><span class="comment">    volatileå£°æ˜å˜é‡çš„å€¼å¯èƒ½éšæ—¶ä¼šè¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹ï¼Œ</span></span><br><span class="line"><span class="comment">    ä½¿ç”¨volatileä¿®é¥°çš„å˜é‡ä¼šå¼ºåˆ¶å°†ä¿®æ”¹çš„å€¼ç«‹å³å†™å…¥ä¸»å­˜ï¼Œ</span></span><br><span class="line"><span class="comment">    ä¸»å­˜ä¸­å€¼çš„æ›´æ–°ä¼šä½¿ç¼“å­˜ä¸­çš„å€¼å¤±æ•ˆã€‚</span></span><br><span class="line"><span class="comment">    volatileä¸ä¼šè®©çº¿ç¨‹é˜»å¡ï¼Œå“åº”é€Ÿåº¦æ¯”synchronizedå¿« */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// volatileä¿è¯instanceåœ¨æ‰€æœ‰çº¿ç¨‹ä¸­åŒæ­¥å¯è§</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> LazySingleton instance = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// privateé¿å…ç±»åœ¨å¤–éƒ¨è¢«å®ä¾‹åŒ–</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">LazySingleton</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŠ é”åŒæ­¥ï¼Œä¿è¯getInstance()åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> LazySingleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> LazySingleton();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>é¥¿æ±‰å¼å•ä¾‹</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.singleton.pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: DesignPattern &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.singeleton.pattern &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: HungrySingleton &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: é¥¿æ±‰å¼å•ä¾‹ &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/10/16</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; ç‰¹ç‚¹ï¼š</span></span><br><span class="line"><span class="comment"> * ç±»ä¸€æ—¦åŠ è½½å°±åˆ›å»ºä¸€ä¸ªå•ä¾‹ï¼Œä¿è¯åœ¨è°ƒç”¨getInstance()ä¹‹å‰å•ä¾‹å°±å·²ç»å­˜åœ¨</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HungrySingleton</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* åœ¨ç±»åŠ è½½æ—¶å°±åˆ›å»ºä¸€ä¸ªé™æ€å¯¹è±¡ä¾›ç³»ç»Ÿä½¿ç”¨ï¼Œä»¥åä¸å†æ”¹å˜ï¼Œ</span></span><br><span class="line"><span class="comment">    æ‰€ä»¥æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥ç›´æ¥ç”¨äºå¤šçº¿ç¨‹è€Œä¸ä¼šå‡ºç°é—®é¢˜ */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> HungrySingleton instance = <span class="keyword">new</span> HungrySingleton();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">HungrySingleton</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HungrySingleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-2-åŸå‹æ¨¡å¼-Prototype"><a href="#2-2-åŸå‹æ¨¡å¼-Prototype" class="headerlink" title="2.2 åŸå‹æ¨¡å¼-Prototype"></a>2.2 åŸå‹æ¨¡å¼-Prototype</h3><blockquote>
<p>å®šä¹‰</p>
</blockquote>
<p>ç”¨ä¸€ä¸ªå·²ç»åˆ›å»ºçš„å®ä¾‹ï¼Œé€šè¿‡å¤åˆ¶è¯¥åŸå‹å¯¹è±¡æ¥åˆ›å»ºä¸€ä¸ªå’ŒåŸå‹ç›¸åŒæˆ–è€…ç›¸ä¼¼çš„æ–°å¯¹è±¡</p>
<blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<ul>
<li>Javaè‡ªå¸¦çš„åŸå‹æ¨¡å¼åŸºäºå†…å­˜äºŒè¿›åˆ¶æµçš„å¤åˆ¶ï¼Œåœ¨æ€§èƒ½ä¸Šæ¯”ç›´æ¥newä¸€ä¸ªå¯¹è±¡æ›´åŠ ä¼˜è‰¯ã€‚</li>
<li>å¯ä»¥ä½¿ç”¨æ·±å…‹éš†æ–¹å¼ä¿å­˜å¯¹è±¡çš„çŠ¶æ€ï¼Œä½¿ç”¨åŸå‹æ¨¡å¼å°†å¯¹è±¡å¤åˆ¶ä¸€ä»½ï¼Œå¹¶å°†å…¶çŠ¶æ€ä¿å­˜èµ·æ¥ï¼Œç®€åŒ–äº†åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ï¼Œä»¥ä¾¿åœ¨éœ€è¦çš„æ—¶å€™ä½¿ç”¨ï¼ˆä¾‹å¦‚æ¢å¤åˆ°å†å²æŸä¸€çŠ¶æ€ï¼‰ï¼Œå¯å¤åˆ¶å®ç°æ’¤é”€æ“ä½œã€‚</li>
</ul>
<blockquote>
<p>ç¼ºç‚¹</p>
</blockquote>
<ul>
<li>éœ€è¦ä¸ºæ¯ä¸€ä¸ªç±»éƒ½é…ç½®ä¸€ä¸ªcloneæ–¹æ³•ã€‚</li>
<li>cloneæ–¹æ³•ä½äºç±»çš„å†…éƒ¨ï¼Œå½“å¯¹äºå·²æœ‰ç±»è¿›è¡Œæ”¹é€ çš„æ—¶å€™ï¼Œéœ€è¦ä¿®æ”¹ä»£ç ï¼Œè¿èƒŒäº†å¼€é—­åŸåˆ™ã€‚</li>
<li>å½“å®ç°æ·±å…‹éš†æ—¶ï¼Œéœ€è¦ç¼–å†™è¾ƒä¸ºå¤æ‚çš„ä»£ç ï¼Œè€Œä¸”å½“å¯¹è±¡ä¹‹é—´å­˜åœ¨å¤šé‡åµŒå¥—å¼•ç”¨æ—¶ï¼Œä¸ºäº†å®ç°æ·±å…‹éš†ï¼Œæ¯ä¸€å±‚å¯¹è±¡å¯¹åº”çš„ç±»éƒ½å¿…é¡»æ”¯æŒæ·±å…‹éš†ï¼Œå®ç°èµ·æ¥ä¼šæ¯”è¾ƒéº»çƒ¦ã€‚å› æ­¤ï¼Œæµ…å…‹éš†å’Œæ·±å…‹éš†éœ€è¦éœ€è¦è¿ç”¨å¾—å½“ã€‚</li>
</ul>
<blockquote>
<p>ç»“æ„</p>
</blockquote>
<ul>
<li>æŠ½è±¡åŸå‹ç±»ï¼šè§„å®šäº†å…·ä½“åŸå‹å¯¹è±¡å¿…é¡»å®ç°çš„æ¥å£ã€‚</li>
<li>å…·ä½“åŸå‹ç±»ï¼šå®ç°æŠ½è±¡åŸå‹ç±»çš„clone()æ–¹æ³•ï¼Œå®ƒæ˜¯å¯è¢«å¤åˆ¶çš„å¯¹è±¡ã€‚</li>
<li>è®¿é—®ç±»ï¼šä½¿ç”¨å…·ä½“åŸå‹ç±»ä¸­çš„clone()æ–¹æ³•ç±»å¤åˆ¶æ–°çš„å¯¹è±¡ã€‚</li>
</ul>
<blockquote>
<p>å®ç°</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.prototype.pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: DesignPattern &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.prototype.pattern &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: Prototype &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: åŸå‹æ¨¡å¼æµ…å…‹éš† &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/10/16</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; ç‰¹ç‚¹ï¼š</span></span><br><span class="line"><span class="comment"> * æµ…å…‹éš†ï¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œæ–°å¯¹è±¡çš„å±æ€§å’ŒåŸæ¥å¯¹è±¡å®Œå…¨ç›¸åŒï¼Œå¯¹äºéåŸºæœ¬ç±»å‹å±æ€§ï¼Œæ‰”æŒ‡å‘åŸæœ‰å±æ€§æ‰€æŒ‡å‘çš„å¯¹è±¡çš„å†…å­˜åœ°å€</span></span><br><span class="line"><span class="comment"> * æ·±å…‹éš†ï¼šåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå±æ€§ä¸­å¼•ç”¨çš„å¯¹è±¡ä¹Ÿä¼šè¢«å…‹éš†ï¼Œä¸å†æŒ‡å‘åŸæœ‰å¯¹è±¡åœ°å€</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Prototype</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Logger log = Logger.getLogger(Prototype.class);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">        RealizeType realizeType1 = <span class="keyword">new</span> RealizeType();</span><br><span class="line">        RealizeType realizeType2 = (RealizeType) realizeType1.clone();</span><br><span class="line">        log.info(<span class="string">&quot;realizeType1 == realizeType2 ? &quot;</span> + (realizeType1 == realizeType2));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RealizeType</span> <span class="keyword">implements</span> <span class="title">Cloneable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(RealizeType.class);</span><br><span class="line"></span><br><span class="line">    RealizeType() &#123;</span><br><span class="line">        log.info(<span class="string">&quot;åŸå‹åˆ›å»º&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Object <span class="title">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;åŸå‹å¤åˆ¶&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.clone();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-3-ç®€å•å·¥å‚æ¨¡å¼-Simple-Factory"><a href="#2-3-ç®€å•å·¥å‚æ¨¡å¼-Simple-Factory" class="headerlink" title="2.3 ç®€å•å·¥å‚æ¨¡å¼-Simple Factory"></a>2.3 <del>ç®€å•å·¥å‚æ¨¡å¼-Simple Factory</del></h3><blockquote>
<p>å®šä¹‰</p>
</blockquote>
<p>å®šä¹‰ä¸€ä¸ªåˆ›å»ºäº§å“å¯¹è±¡çš„å·¥å‚æ¥å£ï¼Œå°†äº§å“å¯¹è±¡çš„å®é™…åˆ›å»ºå·¥ä½œæ¨è¿Ÿåˆ°å…·ä½“å­å·¥å‚ç±»å½“ä¸­ã€‚</p>
<blockquote>
<p>æŒ‰ç…§ä¸šåŠ¡åœºæ™¯åˆ’åˆ†ï¼Œå·¥å‚æ¨¡å¼æœ‰3ç§å®ç°æ–¹å¼</p>
</blockquote>
<img src="/2020/11/11/DesignPattern/image-20201111164349538.png" class="" title="image-20201111164349538">

<center>
    <font face="Kristen ITC" color="#555555" font-size=100px>ä¸‰ç§å®ç°æ–¹å¼</font><br>
</center>



<blockquote>
<p>è¯´æ˜</p>
</blockquote>
<p>ç®€å•å·¥å‚æ¨¡å¼æœ‰ä¸€ä¸ªå…·ä½“çš„å·¥å‚ç±»ï¼Œå¯ä»¥ç”Ÿäº§å¤šä¸ªä¸åŒçš„äº§å“ï¼Œå±äºåˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œä½†æ˜¯ç®€å•å·¥å‚æ¨¡å¼ä¸åœ¨GOF23ä¸­è®¾è®¡æ¨¡å¼ä¹‹åˆ—ã€‚</p>
<p>åœ¨ç®€å•å·¥å‚æ¨¡å¼ä¸­åˆ›å»ºå®ä¾‹çš„æ–¹æ³•é€šå¸¸ä¸ºé™æ€(static)æ–¹æ³•ï¼Œå› æ­¤ç®€å•å·¥å‚æ¨¡å¼(Simple Factory Pattern)åˆå«åšé™æ€å·¥å‚æ–¹æ³•æ¨¡å¼(Static Factory Method Pattern)ã€‚</p>
<blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<ul>
<li>å·¥å‚ç±»åŒ…å«å¿…è¦çš„é€»è¾‘åˆ¤æ–­ï¼Œå¯ä»¥å†³å®šåœ¨ä»€ä¹ˆæ—¶å€™åˆ›å»ºå“ªä¸€ä¸ªäº§å“çš„å®ä¾‹ã€‚å®¢æˆ·ç«¯å¯ä»¥å…é™¤ç›´æ¥åˆ›å»ºäº§å“å¯¹è±¡çš„èŒè´£ï¼Œå¾ˆæ–¹ä¾¿çš„åˆ›å»ºå“åº”çš„äº§å“ã€‚å·¥å‚å’Œäº§å“çš„èŒè´£åŒºåˆ†æ˜ç¡®ã€‚</li>
<li>å®¢æˆ·ç«¯æ— éœ€çŸ¥é“æ‰€åˆ›å»ºå…·ä½“äº§å“çš„ç±»åï¼Œåªéœ€çŸ¥é“å‚æ•°å³å¯ã€‚</li>
<li>ä¹Ÿå¯ä»¥å¼•å…¥é…ç½®æ–‡ä»¶ï¼Œåœ¨ä¸ä¿®æ”¹å®¢æˆ·ç«¯çš„ä»£ç çš„æƒ…å†µä¸‹æ›´æ¢å’Œæ·»åŠ æ–°çš„å…·ä½“äº§å“ç±»ã€‚</li>
</ul>
<blockquote>
<p>ç¼ºç‚¹</p>
</blockquote>
<ul>
<li>ç®€å•å·¥å‚æ¨¡å¼çš„å·¥å‚ç±»å•ä¸€ï¼Œè´Ÿè´£æ‰€æœ‰äº§å“çš„åˆ›å»ºï¼ŒèŒè´£è¿‡é‡ï¼Œä¸€æ—¦å¼‚å¸¸ï¼Œæ•´ä¸ªç³»ç»Ÿå°†å—åˆ°å½±å“ã€‚ä¸”å·¥å‚ç±»ä»£ç ä¼šéå¸¸è‡ƒè‚¿ï¼Œè¿èƒŒé«˜èšåˆåŸåˆ™ã€‚</li>
<li>ä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼ä¼šå¢åŠ ç³»ç»Ÿä¸­ç±»çš„ä¸ªæ•°(å¼•å…¥æ–°çš„å·¥å‚ç±»)ï¼Œå¢åŠ ç³»ç»Ÿçš„å¤æ‚åº¦å’Œç†è§£éš¾åº¦ã€‚</li>
<li>ç³»ç»Ÿæ‹“å±•å›°éš¾ï¼Œä¸€æ—¦å¢åŠ æ–°äº§å“ä¸å¾—ä¸ä¿®æ”¹å·¥å‚é€»è¾‘ï¼Œåœ¨äº§å“ç±»å‹è¾ƒå¤šæ—¶ï¼Œå¯èƒ½é€ æˆé€»è¾‘è¿‡äºå¤æ‚ã€‚</li>
</ul>
<blockquote>
<p>åº”ç”¨åœºæ™¯</p>
</blockquote>
<p>å¯¹äºäº§å“ç§ç±»ç›¸å¯¹è¾ƒå°‘çš„æƒ…å†µï¼Œè€ƒè™‘ä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼ã€‚ä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼çš„å®¢æˆ·ç«¯åªéœ€è¦ä¼ å…¥å·¥å‚ç±»çš„å‚æ•°ï¼Œä¸éœ€è¦å…³å¿ƒå¦‚ä½•åˆ›å»ºå¯¹è±¡çš„é€»è¾‘ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°åˆ›å»ºæ‰€éœ€äº§å“ã€‚</p>
<blockquote>
<p>ç»“æ„</p>
</blockquote>
<ul>
<li>ç®€å•å·¥å‚(Simple Factory)ï¼šæ˜¯ç®€å•å·¥å‚æ¨¡å¼çš„æ ¸å¿ƒï¼Œè´Ÿè´£å®ç°åˆ›å»ºæ‰€æœ‰å®ä¾‹çš„å†…éƒ¨é€»è¾‘ã€‚å·¥å‚ç±»åˆ›å»ºäº§å“ç±»çš„æ–¹æ³•å¯ä»¥è¢«å¤–ç•Œç›´æ¥è°ƒç”¨ï¼Œåˆ›å»ºæ‰€éœ€çš„äº§å“å¯¹è±¡ã€‚</li>
<li>æŠ½è±¡äº§å“(Abstract Product)ï¼šæ˜¯ç®€å•å·¥å‚åˆ›å»ºçš„æ‰€æœ‰å¯¹è±¡çš„çˆ¶äº²ï¼Œè´Ÿè´£æè¿°æ‰€æœ‰å®ä¾‹å…±æœ‰çš„å…¬å…±æ¥å£ã€‚</li>
<li>å…·ä½“äº§å“(Concrete Product)ï¼šæ˜¯ç®€å•å·¥å‚æ¨¡å¼çš„åˆ›å»ºç›®æ ‡ã€‚</li>
</ul>
<blockquote>
<p>å®ç°</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.simpleFactory.pattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: DesignPattern &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.simpleactory.pattern &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: Client &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: ç®€å•å·¥å‚æ¨¡å¼ &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/10/17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;æµ‹è¯•ç±»&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleFactoryDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger log = Logger.getLogger(SimpleFactoryDemo.class);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Scanner scanner = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            System.out.print(<span class="string">&quot;è¾“å…¥äº§å“å‹å·ï¼š&quot;</span>);</span><br><span class="line">            <span class="keyword">int</span> choice = scanner.nextInt();</span><br><span class="line">            <span class="keyword">switch</span> (choice) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">0</span>: log.info(<span class="string">&quot;æˆåŠŸé€€å‡º&quot;</span>); <span class="keyword">return</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>: SimpleFactory.makeProduct(Constant.PRODUCT_1).show(); <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>: SimpleFactory.makeProduct(Constant.PRODUCT_2).show(); <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">3</span>: SimpleFactory.makeProduct(Constant.PRODUCT_3).show(); <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>: log.info(<span class="string">&quot;è¯¥äº§å“ä¸å­˜åœ¨ï¼Œè¯·é‡æ–°è¾“å…¥ï¼&quot;</span>); <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     æŠ½è±¡äº§å“</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">product</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     æšä¸¾æ‰€æœ‰äº§å“</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Constant</span> </span>&#123;</span><br><span class="line">    PRODUCT_1,</span><br><span class="line">    PRODUCT_2,</span><br><span class="line">    PRODUCT_3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“äº§å“1</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteProduct1</span> <span class="keyword">implements</span> <span class="title">product</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(ConcreteProduct1.class);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…·ä½“äº§å“1æ˜¾ç¤º...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“äº§å“2</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteProduct2</span> <span class="keyword">implements</span> <span class="title">product</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(ConcreteProduct2.class);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…·ä½“äº§å“2æ˜¾ç¤º...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“äº§å“3</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteProduct3</span> <span class="keyword">implements</span> <span class="title">product</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(ConcreteProduct3.class);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…·ä½“äº§å“3æ˜¾ç¤º...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     ç®€å•å·¥å‚</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleFactory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> product <span class="title">makeProduct</span><span class="params">(Constant c)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (c) &#123;</span><br><span class="line">            <span class="keyword">case</span> PRODUCT_1:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> ConcreteProduct1();</span><br><span class="line">            <span class="keyword">case</span> PRODUCT_2:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> ConcreteProduct2();</span><br><span class="line">            <span class="keyword">case</span> PRODUCT_3:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> ConcreteProduct3();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-4-å·¥å‚æ–¹æ³•æ¨¡å¼-Factory-Method"><a href="#2-4-å·¥å‚æ–¹æ³•æ¨¡å¼-Factory-Method" class="headerlink" title="2.4 å·¥å‚æ–¹æ³•æ¨¡å¼-Factory Method"></a>2.4 å·¥å‚æ–¹æ³•æ¨¡å¼-Factory Method</h3><blockquote>
<p>è¯´æ˜</p>
</blockquote>
<p>å·¥å‚æ–¹æ³•æ¨¡å¼æ˜¯å¯¹ç®€å•å·¥å‚æ¨¡å¼çš„è¿›ä¸€æ­¥æŠ½è±¡åŒ–ï¼Œå…¶å¥½å¤„æ˜¯å¯ä»¥ä½¿ç³»ç»Ÿåœ¨ä¸ä¿®æ”¹åŸæ¥ä»£ç çš„æƒ…å†µä¸‹å¼•è¿›æ–°çš„äº§å“ï¼Œå³æ»¡è¶³å¼€é—­åŸåˆ™ã€‚</p>
<p>å·¥å‚æ–¹æ³•æ¨¡å¼è€ƒè™‘çš„æ˜¯ä¸€ç§å·¥å‚è´Ÿè´£ä¸€ç±»äº§å“çš„ç”Ÿäº§ï¼Œç•œç‰§åœºåªå…»åŠ¨ç‰©ã€ç”µè§†æœºå‚åªç”Ÿäº§ç”µè§†æœºã€è®¡ç®—æœºè½¯ä»¶å­¦é™¢åªåŸ¹å…»è®¡ç®—æœºè½¯ä»¶ä¸“ä¸šçš„å­¦ç”Ÿç­‰ã€‚</p>
<blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<ul>
<li>ç”¨æˆ·åªéœ€è¦å…·ä½“å·¥å‚çš„åç§°å°±å¯å¾—åˆ°æ‰€è¦çš„äº§å“ï¼Œæ— éœ€çŸ¥é“äº§å“çš„å…·ä½“åˆ›å»ºè¿‡ç¨‹ã€‚</li>
<li>çµæ´»æ€§å¢å¼ºï¼Œå¯¹äºæ–°äº§å“çš„åˆ›å»ºï¼Œåªéœ€å¤šå†™ä¸€ä¸ªç›¸åº”çš„å·¥å‚ç±»ã€‚</li>
<li>å…¸å‹çš„è§£è€¦æ¡†æ¶ã€‚é«˜å±‚æ¨¡å—åªéœ€è¦çŸ¥é“äº§å“çš„æŠ½è±¡ç±»ï¼Œæ— éœ€å…³ç³»å…¶ä»–å®ç°ç±»ï¼Œæ»¡è¶³è¿ªç±³ç‰¹æ³•åˆ™ã€ä¾èµ–å€’ç½®åŸåˆ™å’Œé‡Œå¼æ›¿æ¢åŸåˆ™ã€‚</li>
</ul>
<blockquote>
<p>ç¼ºç‚¹</p>
</blockquote>
<ul>
<li>ç±»çš„ä¸ªæ•°å®¹æ˜“è¿‡å¤šï¼Œå¢åŠ å¤æ‚åº¦ã€‚</li>
<li>å¢åŠ äº†ç³»ç»Ÿçš„æŠ½è±¡æ€§å’Œç†è§£éš¾åº¦ã€‚</li>
<li>ä¸€ä¸ªå·¥å‚åªèƒ½ç”Ÿäº§ä¸€ç§äº§å“ï¼Œæ­¤å¼Šç«¯å¯ä½¿ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼è§£å†³ã€‚</li>
</ul>
<blockquote>
<p>ç»“æ„</p>
</blockquote>
<ul>
<li>æŠ½è±¡å·¥å‚(Abstract Factory)ï¼šæä¾›äº†åˆ›å»ºäº§å“çš„æ¥å£ï¼Œè°ƒç”¨è€…é€šè¿‡å®ƒè®¿é—®å…·ä½“å·¥å‚çš„å·¥å‚æ–¹æ³•ç±»åˆ›å»ºäº§å“ã€‚</li>
<li>å…·ä½“å·¥å‚(Concrete Factory)ï¼šä¸»è¦æ˜¯å®ç°æŠ½è±¡å·¥å‚ä¸­çš„æŠ½è±¡æ–¹æ³•ï¼Œå®Œæˆå…·ä½“äº§å“çš„åˆ›å»ºã€‚</li>
<li>æŠ½è±¡äº§å“(Abstract Product)ï¼šå®šä¹‰äº†äº§å“çš„è§„èŒƒï¼Œæè¿°äº†äº§å“çš„ä¸»è¦ç‰¹æ€§å’ŒåŠŸèƒ½ã€‚</li>
<li>å…·ä½“äº§å“(Concrete Product)ï¼šå®ç°äº†æŠ½è±¡äº§å“è§’è‰²å®šä¹‰çš„æ¥å£ï¼Œç”±å…·ä½“å·¥å‚æ¥åˆ›å»ºï¼Œå®ƒåŒå…·ä½“å·¥å‚ä¹‹é—´ä¸€ä¸€å¯¹åº”ã€‚</li>
</ul>
<blockquote>
<p>å®ç°</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.factoryMethod.pattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.Document;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.NodeList;</span><br><span class="line"><span class="keyword">import</span> org.xml.sax.SAXException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.DocumentBuilder;</span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.DocumentBuilderFactory;</span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.ParserConfigurationException;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: DesignPattern &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.factoryMethod.pattern &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: FactoryMethod &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: å·¥å‚æ–¹æ³•æ¨¡å¼ &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/10/17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;æµ‹è¯•ç±»&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FactoryMethodDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger log = Logger.getLogger(FactoryMethodDemo.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * è¯»å–XMLé…ç½®æ–‡ä»¶ï¼Œæå–å…·ä½“ç±»åï¼Œè¿”å›å®ä¾‹å¯¹è±¡é›†åˆ</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> List&lt;Object&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> SAXException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ParserConfigurationException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ClassNotFoundException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalAccessException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> InstantiationException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Object&gt; <span class="title">getObjects</span><span class="params">(String filePath)</span> <span class="keyword">throws</span> IOException, SAXException, ParserConfigurationException,  ClassNotFoundException, IllegalAccessException, InstantiationException </span>&#123;</span><br><span class="line">        DocumentBuilderFactory documentBuilderFactory = DocumentBuilderFactory.newInstance();</span><br><span class="line">        DocumentBuilder documentBuilder = documentBuilderFactory.newDocumentBuilder();</span><br><span class="line">        Document document = documentBuilder.parse(<span class="keyword">new</span> File(filePath));</span><br><span class="line">        NodeList nodeList = document.getElementsByTagName(<span class="string">&quot;className&quot;</span>);</span><br><span class="line">        List&lt;Object&gt; objects = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nodeList.getLength(); i++) &#123;</span><br><span class="line">            String packageName = FactoryMethodDemo.class.getPackage().getName();</span><br><span class="line">            String className = nodeList.item(i).getTextContent();</span><br><span class="line">            Class&lt;?&gt; c = Class.forName(packageName + <span class="string">&quot;.&quot;</span> + className);</span><br><span class="line">            objects.add(c.newInstance());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> objects;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;Object&gt; objects = getObjects(<span class="string">&quot;src/main/java/top/parak/factoryMethod/pattern/config.xml&quot;</span>);</span><br><span class="line">            objects.stream().forEach( o -&gt; &#123;</span><br><span class="line">                AbstractFactory factory = (AbstractFactory) o;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    factory.produce().show();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    log.error(e.getMessage());</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;P&gt;</span></span><br><span class="line"><span class="comment"> *     æŠ½è±¡äº§å“</span></span><br><span class="line"><span class="comment"> * &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">product</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“äº§å“1</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteProduct1</span> <span class="keyword">implements</span> <span class="title">product</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(ConcreteProduct1.class);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…·ä½“äº§å“1å±•ç¤º...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“äº§å“2</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteProduct2</span> <span class="keyword">implements</span> <span class="title">product</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(ConcreteProduct2.class);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…·ä½“äº§å“2å±•ç¤º...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“äº§å“3</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteProduct3</span> <span class="keyword">implements</span> <span class="title">product</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(ConcreteProduct3.class);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…·ä½“äº§å“3å±•ç¤º...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     æŠ½è±¡å·¥å‚</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">AbstractFactory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> product <span class="title">produce</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“å·¥å‚1</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteFactory1</span> <span class="keyword">implements</span> <span class="title">AbstractFactory</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(ConcreteFactory1.class);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> product <span class="title">produce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…·ä½“å·¥å‚1ç”Ÿäº§ä¸­...&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(<span class="string">&quot;===&gt;äº§å“1ç”Ÿäº§å®Œæˆ&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ConcreteProduct1();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“å·¥å‚2</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteFactory2</span> <span class="keyword">implements</span> <span class="title">AbstractFactory</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(ConcreteFactory2.class);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> product <span class="title">produce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…·ä½“å·¥å‚2ç”Ÿäº§ä¸­...&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(<span class="string">&quot;===&gt;äº§å“2ç”Ÿäº§å®Œæˆ&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ConcreteProduct2();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“å·¥å‚3</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteFactory3</span> <span class="keyword">implements</span> <span class="title">AbstractFactory</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(ConcreteFactory3.class);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> product <span class="title">produce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…·ä½“å·¥å‚3ç”Ÿäº§ä¸­...&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(<span class="string">&quot;===&gt;äº§å“3ç”Ÿäº§å®Œæˆ&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ConcreteProduct3();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>config.xml</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">config</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">className</span>&gt;</span>ConcreteFactory1<span class="tag">&lt;/<span class="name">className</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">className</span>&gt;</span>ConcreteFactory2<span class="tag">&lt;/<span class="name">className</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">className</span>&gt;</span>ConcreteFactory3<span class="tag">&lt;/<span class="name">className</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿è¡Œç»“æœ</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">2020-10-17 11:25:34 PARAK INFO  [top.parak.factoryMethod.pattern.ConcreteFactory1] [thread: main] [FactoryMethod.java: 143] - å…·ä½“å·¥å‚1ç”Ÿäº§ä¸­...</span><br><span class="line">2020-10-17 11:25:35 PARAK INFO  [top.parak.factoryMethod.pattern.ConcreteFactory1] [thread: main] [FactoryMethod.java: 149] - ===&gt;äº§å“1ç”Ÿäº§å®Œæˆ</span><br><span class="line">2020-10-17 11:25:35 PARAK INFO  [top.parak.factoryMethod.pattern.ConcreteProduct1] [thread: main] [FactoryMethod.java: 98] - å…·ä½“äº§å“1å±•ç¤º...</span><br><span class="line">2020-10-17 11:25:35 PARAK INFO  [top.parak.factoryMethod.pattern.ConcreteFactory2] [thread: main] [FactoryMethod.java: 162] - å…·ä½“å·¥å‚2ç”Ÿäº§ä¸­...</span><br><span class="line">2020-10-17 11:25:36 PARAK INFO  [top.parak.factoryMethod.pattern.ConcreteFactory2] [thread: main] [FactoryMethod.java: 168] - ===&gt;äº§å“2ç”Ÿäº§å®Œæˆ</span><br><span class="line">2020-10-17 11:25:36 PARAK INFO  [top.parak.factoryMethod.pattern.ConcreteProduct2] [thread: main] [FactoryMethod.java: 110] - å…·ä½“äº§å“2å±•ç¤º...</span><br><span class="line">2020-10-17 11:25:36 PARAK INFO  [top.parak.factoryMethod.pattern.ConcreteFactory3] [thread: main] [FactoryMethod.java: 181] - å…·ä½“å·¥å‚3ç”Ÿäº§ä¸­...</span><br><span class="line">2020-10-17 11:25:37 PARAK INFO  [top.parak.factoryMethod.pattern.ConcreteFactory3] [thread: main] [FactoryMethod.java: 187] - ===&gt;äº§å“3ç”Ÿäº§å®Œæˆ</span><br><span class="line">2020-10-17 11:25:37 PARAK INFO  [top.parak.factoryMethod.pattern.ConcreteProduct3] [thread: main] [FactoryMethod.java: 122] - å…·ä½“äº§å“3å±•ç¤º...</span><br></pre></td></tr></table></figure>



<h3 id="2-5-æŠ½è±¡å·¥å‚æ¨¡å¼-Abstract-Factory"><a href="#2-5-æŠ½è±¡å·¥å‚æ¨¡å¼-Abstract-Factory" class="headerlink" title="2.5 æŠ½è±¡å·¥å‚æ¨¡å¼-Abstract Factory"></a>2.5 æŠ½è±¡å·¥å‚æ¨¡å¼-Abstract Factory</h3><blockquote>
<p>è¯´æ˜</p>
</blockquote>
<p>å·¥å‚æ–¹æ³•æ¨¡å¼ï¼šä¸€ä¸ªå·¥å‚åªè´Ÿè´£ä¸€ç±»äº§å“çš„ç”Ÿäº§ï¼Œåƒå°ä½œåŠï¼Œç”µå™¨å‚åªç”Ÿäº§ç”µé£æ‰‡ã€‚<br>æŠ½è±¡å·¥å‚æ¨¡å¼ï¼šä¸€ä¸ªå·¥å‚è´Ÿè´£å¤šç§ç›¸å…³äº§å“çš„ç”Ÿäº§ï¼Œåƒç»¼åˆå‹å·¥å‚ï¼Œç”µå™¨å‚ç”Ÿäº§ç”µè§†æœºã€ç©ºè°ƒå’Œå†°ç®±ç­‰ã€‚</p>
<p>æŠ½è±¡å·¥å‚æ¨¡å¼æ˜¯å·¥å‚æ–¹æ³•æ¨¡å¼çš„å‡çº§ç‰ˆæœ¬ï¼Œå·¥å‚æ–¹æ³•æ¨¡å¼åªç”Ÿäº§ä¸€ä¸ªç­‰çº§çš„äº§å“ï¼ŒæŠ½è±¡å·¥å‚æ¨¡å¼å¯ç”Ÿäº§å¤šä¸ªç­‰çº§çš„äº§å“ã€‚</p>
<blockquote>
<p>å®šä¹‰</p>
</blockquote>
<p>ä¸€ç§ä¸ºè®¿é—®ç±»æä¾›ä¸€ä¸ªåˆ›å»ºä¸€ç»„ç›¸å…³æˆ–ç›¸äº’ä¾èµ–å¯¹è±¡çš„æ¥å£ï¼Œä¸”è®¿é—®ç±»æ— é¡»æŒ‡å®šæ‰€è¦äº§å“çš„å…·ä½“ç±»å°±èƒ½å¾—åˆ°åŒæ—çš„ä¸åŒç­‰çº§çš„äº§å“çš„æ¨¡å¼ç»“æ„ã€‚</p>
<blockquote>
<p>ä½¿ç”¨æ¡ä»¶</p>
</blockquote>
<ul>
<li>ç³»ç»Ÿä¸­æœ‰å¤šä¸ªäº§å“æ—ï¼Œæ¯ä¸ªå…·ä½“å·¥å‚åˆ›å»ºåŒä¸€æ—ä½†å±äºä¸åŒç­‰çº§ç»“æ„çš„äº§å“ã€‚</li>
<li>ç³»ç»Ÿä¸€æ¬¡åªå¯èƒ½æ¶ˆè´¹å…¶ä¸­æŸä¸€æ—äº§å“ï¼Œå³åŒæ—çš„äº§å“ä¸€èµ·ä½¿ç”¨ã€‚</li>
</ul>
<blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<p>é™¤äº†åŒ…å«å·¥å‚æ–¹æ³•æ¨¡å¼çš„ä¼˜ç‚¹ï¼Œè¿˜æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š</p>
<ul>
<li>å¯ä»¥åœ¨ç±»çš„å†…éƒ¨å¯¹äº§å“æ—ä¸­ç›¸å…³è”çš„å¤šç­‰çº§äº§å“å…±åŒç®¡ç†ï¼Œè€Œä¸å¿…ä¸“é—¨å¼•å…¥å¤šä¸ªæ–°çš„ç±»æ¥è¿›è¡Œç®¡ç†ã€‚</li>
<li>å½“éœ€è¦äº§å“æ—æ—¶ï¼ŒæŠ½è±¡å·¥å‚å¯ä»¥ä¿è¯å®¢æˆ·ç«¯å§‹ç»ˆåªä½¿ç”¨åŒä¸€ä¸ªäº§å“çš„äº§å“æ—ã€‚</li>
<li>æŠ½è±¡å·¥å‚å¢å¼ºäº†ç¨‹åºçš„å¯æ‰©å±•æ€§ï¼Œå½“å¢åŠ ä¸€ä¸ªæ–°çš„äº§å“æ—æ—¶ï¼Œä¸éœ€è¦ä¿®æ”¹åŸä»£ç ï¼Œæ»¡è¶³å¼€é—­åŸåˆ™ã€‚</li>
</ul>
<blockquote>
<p>ç¼ºç‚¹</p>
</blockquote>
<p>å½“äº§å“æ—ä¸­éœ€è¦å¢åŠ ä¸€ä¸ªæ–°çš„äº§å“æ—¶ï¼Œæ‰€æœ‰çš„å·¥å‚ç±»éƒ½éœ€è¦è¿›è¡Œä¿®æ”¹ã€‚å¢åŠ äº†ç³»ç»Ÿçš„æŠ½è±¡æ€§å’Œç†è§£éš¾åº¦ã€‚</p>
<blockquote>
<p>ç»“æ„</p>
</blockquote>
<ul>
<li>æŠ½è±¡å·¥å‚(Abstract Factory)ï¼šæä¾›äº†åˆ›å»ºäº§å“çš„æ¥å£ï¼Œå®ƒåŒ…å«å¤šä¸ªåˆ›å»ºäº§å“çš„æ–¹æ³•ï¼Œå¯ä»¥åˆ›å»ºå¤šä¸ªä¸åŒç­‰çº§çš„äº§å“ã€‚</li>
<li>å…·ä½“å·¥å‚(Concrete Factory)ï¼šä¸»è¦æ˜¯å®ç°æŠ½è±¡å·¥å‚ä¸­çš„å¤šä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå®Œæˆå…·ä½“äº§å“çš„åˆ›å»ºã€‚</li>
<li>æŠ½è±¡äº§å“(Abstract Product)ï¼šå®šä¹‰äº†äº§å“çš„è§„èŒƒï¼Œæè¿°äº†äº§å“çš„ä¸»è¦ç‰¹æ€§å’ŒåŠŸèƒ½ï¼ŒæŠ½è±¡å·¥å‚æ¨¡å¼æœ‰å¤šä¸ªæŠ½è±¡äº§å“ã€‚</li>
<li>å…·ä½“äº§å“(Concrete Product)ï¼šå®ç°äº†æŠ½è±¡äº§å“è§’è‰²æ‰€å®šä¹‰çš„æ¥å£ï¼Œç”±å…·ä½“å·¥å‚æ¥åˆ›å»ºï¼Œå®ƒåŒå…·ä½“å·¥å‚ä¹‹é—´æ˜¯å¤šå¯¹ä¸€çš„å…³ç³»ã€‚</li>
</ul>
<blockquote>
<p>å®ä¾‹</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.abstractFactory.example;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: DesignPattern &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.abstractFactory.example &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: Farm &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: æŠ½è±¡å·¥å‚æ¨¡å¼æ¨¡æ‹Ÿå†œåœº &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/10/17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> javax.swing.border.TitledBorder;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å†œåœºæµ‹è¯•ç±»</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FarmDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> JFrame frame = <span class="keyword">new</span> JFrame(<span class="string">&quot;FarmDemo&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> JDesktopPane desktopPane = <span class="keyword">new</span> JDesktopPane();</span><br><span class="line">    <span class="keyword">private</span> JPanel contentPane = (JPanel) frame.getContentPane();</span><br><span class="line">    <span class="keyword">private</span> JPanel leftPanel = <span class="keyword">new</span> JPanel();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ImageIcon backIcon = <span class="keyword">new</span> ImageIcon(<span class="string">&quot;img/Farm.jpg&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JLabel rightLabel = <span class="keyword">new</span> JLabel(backIcon);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JLabel tipLabel = <span class="keyword">new</span> JLabel(<span class="string">&quot;é€‰æ‹©äº§å“&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JButton produceButton = <span class="keyword">new</span> JButton(<span class="string">&quot;å¼€å§‹ç”Ÿäº§&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Font font = <span class="keyword">new</span> Font(<span class="string">&quot;å¾®è½¯é›…é»‘&quot;</span>, Font.PLAIN, <span class="number">20</span>);</span><br><span class="line">    <span class="keyword">private</span> JComboBox&lt;String&gt; productComboBox = <span class="keyword">new</span> JComboBox&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> JTextArea textArea = <span class="keyword">new</span> JTextArea();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> AbstractFarm baoXingFarm = <span class="keyword">new</span> BaoXingFarm();</span><br><span class="line">    <span class="keyword">private</span> AbstractFarm zhouQiaoFarm = <span class="keyword">new</span> ZhouQiaoFarm();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FarmDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        contentPane.setOpaque(<span class="keyword">false</span>);</span><br><span class="line">        contentPane.setLayout(<span class="keyword">null</span>);</span><br><span class="line">        rightLabel.setBounds(<span class="number">300</span>, <span class="number">0</span>, backIcon.getIconWidth(), backIcon.getIconHeight());</span><br><span class="line">        desktopPane.setLayout(<span class="keyword">null</span>);</span><br><span class="line">        desktopPane.add(rightLabel, <span class="keyword">new</span> Integer(Integer.MIN_VALUE));</span><br><span class="line">        leftPanel.setBackground(Color.CYAN);</span><br><span class="line">        leftPanel.setBounds(<span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">420</span>);</span><br><span class="line">        desktopPane.add(leftPanel);</span><br><span class="line"></span><br><span class="line">        leftPanel.setLayout(<span class="keyword">null</span>);</span><br><span class="line">        tipLabel.setFont(font);</span><br><span class="line">        tipLabel.setBounds(<span class="number">5</span>, <span class="number">10</span>, <span class="number">90</span>, <span class="number">30</span>);</span><br><span class="line">        leftPanel.add(tipLabel);</span><br><span class="line">        String[] products = <span class="keyword">new</span> String[]&#123;<span class="string">&quot;é©¬&quot;</span>, <span class="string">&quot;ç‰›&quot;</span>, <span class="string">&quot;é’èœ&quot;</span>, <span class="string">&quot;ç™½èœ&quot;</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span> (String product : products) &#123;</span><br><span class="line">            productComboBox.addItem(product);</span><br><span class="line">        &#125;</span><br><span class="line">        productComboBox.setFont(font);</span><br><span class="line">        produceButton.setFont(font);</span><br><span class="line">        productComboBox.setBounds(<span class="number">90</span>, <span class="number">10</span>, <span class="number">80</span>, <span class="number">30</span>);</span><br><span class="line">        leftPanel.add(productComboBox);</span><br><span class="line">        produceButton.setBounds(<span class="number">180</span>, <span class="number">10</span>, <span class="number">115</span>, <span class="number">30</span>);</span><br><span class="line">        leftPanel.add(produceButton);</span><br><span class="line">        produceButton.addActionListener(<span class="keyword">new</span> ProductAction());</span><br><span class="line"></span><br><span class="line">        textArea.setFont(<span class="keyword">new</span> Font(<span class="string">&quot;å¾®è½¯é›…é»‘&quot;</span>, Font.PLAIN, <span class="number">14</span>));</span><br><span class="line">        JScrollPane scrollPane = <span class="keyword">new</span> JScrollPane(textArea);</span><br><span class="line">        scrollPane.setBounds(<span class="number">10</span>, <span class="number">50</span>, <span class="number">280</span>, <span class="number">360</span>);</span><br><span class="line">        scrollPane.setBorder(<span class="keyword">new</span> TitledBorder(<span class="string">&quot;ç”Ÿäº§æ—¥å¿—&quot;</span>));</span><br><span class="line">        scrollPane.getViewport().setOpaque(<span class="keyword">false</span>);</span><br><span class="line">        leftPanel.add(scrollPane);</span><br><span class="line"></span><br><span class="line">        frame.setContentPane(desktopPane);</span><br><span class="line">        frame.setBounds(<span class="number">300</span>,<span class="number">300</span>,<span class="number">1500</span>,<span class="number">500</span>);</span><br><span class="line">        frame.setVisible(<span class="keyword">true</span>);</span><br><span class="line">        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ProductAction</span> <span class="keyword">implements</span> <span class="title">ActionListener</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">            JInternalFrame internalFrame = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">switch</span> (productComboBox.getSelectedItem().toString()) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;é©¬&quot;</span>:</span><br><span class="line">                    internalFrame = zhouQiaoFarm.produceAnimalProduct().showImage();</span><br><span class="line">                    textArea.append(getTime() + <span class="string">&quot; å‘¨æ¡¥å†œåœºï¼šæ–°é©¬å‡ºç”Ÿ\n&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;ç‰›&quot;</span>:</span><br><span class="line">                    internalFrame = baoXingFarm.produceAnimalProduct().showImage();</span><br><span class="line">                    textArea.append(getTime() + <span class="string">&quot; å®å…´å†œåœºï¼šæ–°ç‰›å‡ºç”Ÿ\n&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;é’èœ&quot;</span>:</span><br><span class="line">                    internalFrame = baoXingFarm.producePlantProduct().showImage();</span><br><span class="line">                    textArea.append(getTime() + <span class="string">&quot; å®å…´å†œåœºï¼šé’èœå‡ºç”Ÿ\n&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;ç™½èœ&quot;</span>:</span><br><span class="line">                    internalFrame = zhouQiaoFarm.producePlantProduct().showImage();</span><br><span class="line">                    textArea.append(getTime() + <span class="string">&quot; å‘¨æ¡¥å†œåœºï¼šç™½èœå‡ºç”Ÿ\n&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Error&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            internalFrame.setBounds(index + <span class="number">300</span>, <span class="number">100</span>, <span class="number">300</span>, <span class="number">350</span>);</span><br><span class="line">            desktopPane.add(internalFrame);</span><br><span class="line">            index = (index + <span class="number">300</span>) % <span class="number">1200</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> String <span class="title">getTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>).format(<span class="keyword">new</span> Date());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> FarmDemo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     æŠ½è±¡äº§å“ï¼šåŠ¨ç‰©ç±»</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">AnimalProduct</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> JInternalFrame <span class="title">showImage</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     æŠ½è±¡äº§å“ï¼šæ¤ç‰©ç±»</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">PlantProduct</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> JInternalFrame <span class="title">showImage</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     åŠ¨ç‰©äº§å“å±•ç¤ºçª—å£</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AnimalFrame</span> <span class="keyword">extends</span> <span class="title">JInternalFrame</span> <span class="keyword">implements</span> <span class="title">AnimalProduct</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AnimalFrame</span><span class="params">(String animalName, String imagePath)</span> </span>&#123;</span><br><span class="line">        Container contentPane = getContentPane();</span><br><span class="line">        JPanel panel = <span class="keyword">new</span> JPanel();</span><br><span class="line">        panel.setLayout(<span class="keyword">new</span> GridLayout(<span class="number">1</span>, <span class="number">1</span>));</span><br><span class="line">        panel.setBorder(BorderFactory.createTitledBorder(<span class="string">&quot;åŠ¨ç‰©ï¼š&quot;</span> + animalName));</span><br><span class="line">        JScrollPane scrollPane = <span class="keyword">new</span> JScrollPane(panel);</span><br><span class="line">        contentPane.add(scrollPane, BorderLayout.CENTER);</span><br><span class="line">        JLabel label = <span class="keyword">new</span> JLabel(<span class="keyword">new</span> ImageIcon(imagePath));</span><br><span class="line">        panel.add(label);</span><br><span class="line">        pack();</span><br><span class="line">        setTitle(animalName);</span><br><span class="line">        setVisible(<span class="keyword">false</span>);</span><br><span class="line">        setClosable(<span class="keyword">true</span>);</span><br><span class="line">        setIconifiable(<span class="keyword">true</span>);</span><br><span class="line">        setResizable(<span class="keyword">false</span>);</span><br><span class="line">        setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JInternalFrame <span class="title">showImage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setVisible(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     æ¤ç‰©äº§å“å±•ç¤ºçª—å£</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PlantFrame</span> <span class="keyword">extends</span> <span class="title">JInternalFrame</span> <span class="keyword">implements</span> <span class="title">PlantProduct</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PlantFrame</span><span class="params">(String plantName, String imagePath)</span> </span>&#123;</span><br><span class="line">        Container contentPane = getContentPane();</span><br><span class="line">        JPanel panel = <span class="keyword">new</span> JPanel();</span><br><span class="line">        panel.setLayout(<span class="keyword">new</span> GridLayout(<span class="number">1</span>, <span class="number">1</span>));</span><br><span class="line">        panel.setBorder(BorderFactory.createTitledBorder(<span class="string">&quot;æ¤ç‰©ï¼š&quot;</span> + plantName));</span><br><span class="line">        JScrollPane scrollPane = <span class="keyword">new</span> JScrollPane(panel);</span><br><span class="line">        contentPane.add(scrollPane, BorderLayout.CENTER);</span><br><span class="line">        JLabel label = <span class="keyword">new</span> JLabel(<span class="keyword">new</span> ImageIcon(imagePath));</span><br><span class="line">        panel.add(label);</span><br><span class="line">        pack();</span><br><span class="line">        setTitle(plantName);</span><br><span class="line">        setVisible(<span class="keyword">false</span>);</span><br><span class="line">        setClosable(<span class="keyword">true</span>);</span><br><span class="line">        setIconifiable(<span class="keyword">true</span>);</span><br><span class="line">        setResizable(<span class="keyword">false</span>);</span><br><span class="line">        setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JInternalFrame <span class="title">showImage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setVisible(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“åŠ¨ç‰©äº§å“ï¼šé©¬ç±»</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Horse</span> <span class="keyword">extends</span> <span class="title">AnimalFrame</span>  </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Horse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="string">&quot;é©¬-ğŸ´&quot;</span>, <span class="string">&quot;img/Horse.jpg&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“åŠ¨ç‰©äº§å“ï¼šç‰›ç±»</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cattle</span> <span class="keyword">extends</span> <span class="title">AnimalFrame</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Cattle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="string">&quot;ç‰›-ğŸ®&quot;</span>, <span class="string">&quot;img/Cattle.jpg&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“æ¤ç‰©äº§å“ï¼šé’èœ</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vegetable</span> <span class="keyword">extends</span> <span class="title">PlantFrame</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Vegetable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="string">&quot;é’èœ&quot;</span>, <span class="string">&quot;img/Vegetable.jpg&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“æ¤ç‰©äº§å“ï¼šç™½èœ</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cabbage</span> <span class="keyword">extends</span> <span class="title">PlantFrame</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Cabbage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="string">&quot;ç™½èœ&quot;</span>, <span class="string">&quot;img/Cabbage.jpg&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     æŠ½è±¡å·¥å‚ï¼šå†œåœºç±»</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">AbstractFarm</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> AnimalProduct <span class="title">produceAnimalProduct</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> PlantProduct <span class="title">producePlantProduct</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“å·¥å‚ï¼šå®å…´å†œåœº</span></span><br><span class="line"><span class="comment"> *     ç”Ÿäº§äº§å“ï¼šç‰›ã€é’èœ</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaoXingFarm</span> <span class="keyword">implements</span> <span class="title">AbstractFarm</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(BaoXingFarm.class);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AnimalProduct <span class="title">produceAnimalProduct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å®å…´å†œåœº===&gt;æ–°ç‰›å‡ºç”Ÿ&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Cattle();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PlantProduct <span class="title">producePlantProduct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å®å…´å†œåœº===&gt;é’èœé•¿æˆ&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Vegetable();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“å†œåœºï¼šå‘¨æ¡¥å†œåœº</span></span><br><span class="line"><span class="comment"> *     ç”Ÿäº§äº§å“ï¼šé©¬ã€ç™½èœ</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ZhouQiaoFarm</span> <span class="keyword">implements</span> <span class="title">AbstractFarm</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(ZhouQiaoFarm.class);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AnimalProduct <span class="title">produceAnimalProduct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å‘¨æ¡¥å†œåœº===&gt;æ–°é©¬å‡ºç”Ÿ&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Horse();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PlantProduct <span class="title">producePlantProduct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å‘¨æ¡¥å†œåœº===&gt;ç™½èœé•¿æˆ&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Cabbage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿è¡Œç»“æœ</p>
</blockquote>
<img src="/2020/11/11/DesignPattern/image-20201017185342528.png" class="" title="image-20201017185342528">



<h3 id="2-6-å»ºé€ è€…æ¨¡å¼-Builder"><a href="#2-6-å»ºé€ è€…æ¨¡å¼-Builder" class="headerlink" title="2.6 å»ºé€ è€…æ¨¡å¼-Builder"></a>2.6 å»ºé€ è€…æ¨¡å¼-Builder</h3><blockquote>
<p>å®šä¹‰</p>
</blockquote>
<p>å°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„é€ ä¸å®ƒçš„è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿åŒæ ·çš„æ„é€ è¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚</p>
<blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<ul>
<li>å°è£…æ€§å¥½ï¼Œæ„å»ºå’Œè¡¨ç¤ºåˆ†ç¦»ã€‚</li>
<li>æ‰©å±•æ€§å¥½ï¼Œå„ä¸ªå…·ä½“çš„å»ºé€ è€…ç›¸äº’ç‹¬ç«‹ï¼Œæœ‰åˆ©äºç³»ç»Ÿçš„è§£è€¦ã€‚</li>
<li>å®¢æˆ·ç«¯ä¸å¿…çŸ¥é“äº§å“å†…éƒ¨ç»„æˆçš„ç»†èŠ‚ï¼Œå»ºé€ è€…å¯ä»¥å¯¹åˆ›å»ºè¿‡ç¨‹é€æ­¥ç»†åŒ–ï¼Œè€Œä¸å¯¹å…¶ä»–æ¨¡å—äº§ç”Ÿä»»ä½•å½±å“ï¼Œä¾¿äºæ§åˆ¶ç»†èŠ‚é£é™©ã€‚</li>
</ul>
<blockquote>
<p>ç¼ºç‚¹</p>
</blockquote>
<ul>
<li>äº§å“çš„ç»„æˆéƒ¨åˆ†å¿…é¡»ç›¸åŒï¼Œè¿™é™åˆ¶äº†å…¶ä½¿ç”¨èŒƒå›´ã€‚</li>
<li>å¦‚æœäº§å“çš„å†…éƒ¨å˜åŒ–å¤æ‚ï¼Œå¦‚æœäº§å“å†…éƒ¨å‘ç”Ÿå˜åŒ–ï¼Œåˆ™å»ºé€ è€…ä¹Ÿè¦åŒæ­¥ä¿®æ”¹ï¼ŒåæœŸç»´æŠ¤æˆæœ¬è¾ƒå¤§ã€‚</li>
</ul>
<blockquote>
<p>ç»“æ„</p>
</blockquote>
<ul>
<li><p>äº§å“è§’è‰²(Product)ï¼šåŒ…å«å¤šä¸ªç»„ä»¶çš„å¤æ‚å¯¹è±¡ï¼Œç”±å…·ä½“å»ºé€ è€…æ¥åˆ›å»ºå…¶å„ä¸ªé›¶éƒ¨ä»¶ã€‚</p>
</li>
<li><p>æŠ½è±¡å»ºé€ è€…(Abstract Builder)ï¼šåŒ…å«åˆ›å»ºäº§å“å„ä¸ªå­éƒ¨ä»¶çš„æŠ½è±¡æ–¹æ³•çš„æ¥å£ï¼Œé€šå¸¸è¿˜åŒ…å«ä¸€ä¸ªè¿”å›å¤æ‚äº§å“çš„æ–¹æ³•getResult()ã€‚</p>
</li>
<li><p>å…·ä½“å»ºé€ è€…(Concrete Builder)ï¼šå®ç°æŠ½è±¡å»ºé€ è€…çš„æ¥å£ï¼Œå®Œæˆå¤æ‚äº§å“çš„å„ä¸ªéƒ¨ä»¶çš„å…·ä½“åˆ›å»ºæ–¹æ³•ã€‚</p>
</li>
<li><p>æŒ‡æŒ¥è€…(Director)ï¼šå®ƒè°ƒç”¨å»ºé€ è€…å¯¹è±¡ä¸­çš„éƒ¨ä»¶æ„é€ ä¸è£…é…æ–¹æ³•å®Œæˆå¤æ‚å¯¹è±¡çš„åˆ›å»ºï¼Œåœ¨æŒ‡æŒ¥è€…ä¸­ä¸æ¶‰åŠå…·ä½“äº§å“çš„ä¿¡æ¯ã€‚</p>
</li>
</ul>
<blockquote>
<p>å®ç°</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.builder.pattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: DesignPattern &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.builder.pattern &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: Builder &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: å»ºé€ è€…æ¨¡å¼ &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/10/17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;æµ‹è¯•ç±»&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BuilderDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger log = Logger.getLogger(BuilderDemo.class);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Builder builder = <span class="keyword">new</span> ConcreteBuilder();</span><br><span class="line">        Director director = <span class="keyword">new</span> Director(builder);</span><br><span class="line">        Product product = director.construct();</span><br><span class="line">        log.info(product.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     æŠ½è±¡äº§å“ç±»</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String componentA;</span><br><span class="line">    <span class="keyword">private</span> String componentB;</span><br><span class="line">    <span class="keyword">private</span> String componentC;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     æŠ½è±¡å»ºé€ è€…</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> Product product = <span class="keyword">new</span> Product();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">buildComponentA</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">buildComponentB</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">buildComponentC</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Product <span class="title">getProduct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> product;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“å»ºé€ è€…</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteBuilder</span> <span class="keyword">extends</span> <span class="title">Builder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildComponentA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        product.setComponentA(<span class="string">&quot;å»ºé€ é›¶ä»¶A&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildComponentB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        product.setComponentB(<span class="string">&quot;å»ºé€ é›¶ä»¶B&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildComponentC</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        product.setComponentC(<span class="string">&quot;å»ºé€ é›¶ä»¶C&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;P&gt;</span></span><br><span class="line"><span class="comment"> *     æŒ‡æŒ¥è€…</span></span><br><span class="line"><span class="comment"> * &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Director</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Builder builder;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Director</span><span class="params">(Builder builder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.builder = builder;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Product <span class="title">construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        builder.buildComponentA();</span><br><span class="line">        builder.buildComponentB();</span><br><span class="line">        builder.buildComponentC();</span><br><span class="line">        <span class="keyword">return</span> builder.getProduct();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="2-7-ä»£ç†æ¨¡å¼-Proxy"><a href="#2-7-ä»£ç†æ¨¡å¼-Proxy" class="headerlink" title="2.7 ä»£ç†æ¨¡å¼-Proxy"></a>2.7 ä»£ç†æ¨¡å¼-Proxy</h3><blockquote>
<p>å®šä¹‰</p>
</blockquote>
<p>ç”±äºæŸäº›åŸå› éœ€è¦ç»™æŸå¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†ä»¥æ§åˆ¶å¯¹è¯¥å¯¹è±¡çš„è®¿é—®ã€‚</p>
<blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<ul>
<li>ä»£ç†æ¨¡å¼åœ¨å®¢æˆ·ç«¯å’Œç›®æ ‡å¯¹è±¡ä¹‹é—´èµ·åˆ°ä¸€ä¸ªä¸­ä»‹ä½œç”¨å’Œä¿æŠ¤ç›®æ ‡å¯¹è±¡çš„ä½œç”¨ã€‚</li>
<li>ä»£ç†å¯¹è±¡å¯ä»¥æ‰©å±•å¯¹è±¡çš„åŠŸèƒ½ã€‚</li>
<li>ä»£ç†æ¨¡å¼èƒ½å°†å®¢æˆ·ç«¯ä¸ç›®æ ‡å¯¹è±¡åˆ†ç¦»ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½ç³»ç»Ÿçš„è€¦åˆåº¦ï¼Œå¢åŠ äº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€‚</li>
</ul>
<blockquote>
<p>ç¼ºç‚¹</p>
</blockquote>
<ul>
<li>ä»£ç†æ¨¡å¼ä¼šé€ æˆç³»ç»Ÿè®¾è®¡ä¸­ç±»çš„æ•°é‡å¢åŠ ã€‚</li>
<li>ä»£ç†æ¨¡å¼èƒ½å°†å®¢æˆ·ç«¯ä¸ç›®æ ‡å¯¹è±¡ä¹‹é—´å¢åŠ ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œä¼šé€ æˆè¯·æ±‚å¤„ç†é€Ÿåº¦å˜æ…¢ã€‚</li>
<li>å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ã€‚</li>
</ul>
<blockquote>
<p>ç»“æ„</p>
</blockquote>
<ul>
<li>æŠ½è±¡ä¸»é¢˜(Subject)ï¼šé€šè¿‡æ¥å£æˆ–æŠ½è±¡ç±»å£°æ˜çœŸå®ä¸»é¢˜å’Œä»£ç†å¯¹è±¡å®ç°çš„ä¸šåŠ¡æ–¹æ³•ã€‚</li>
<li>çœŸå®ä¸»é¢˜(Real Subject)ï¼šå®ç°äº†æŠ½è±¡ä¸»é¢˜ä¸­çš„å…·ä½“ä¸šåŠ¡ï¼Œæ˜¯ä»£ç†å¯¹è±¡é”ä»£è¡¨çš„çœŸå®å¯¹è±¡ï¼Œæ˜¯æœ€ç»ˆè¦å¼•ç”¨çš„å¯¹è±¡ã€‚</li>
<li>ä»£ç†(Proxy)ï¼šæä¾›äº†ä¸çœŸå®ä¸»é¢˜ç›¸åŒçš„æ¥å£ï¼Œå…¶å†…éƒ¨å«æœ‰å¯¹çœŸå®ä¸»é¢˜çš„å¼•ç”¨ï¼Œå®ƒå¯ä»¥è®¿é—®ã€æ§åˆ¶æˆ–æ‰©å±•çœŸå®ä¸»é¢˜çš„åŠŸèƒ½ã€‚</li>
</ul>
<p>==å®ç°==</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.proxy.pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: DesignPattern &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.proxy.pattern &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: Proxy &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: ä»£ç†æ¨¡å¼ &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/10/18</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;æµ‹è¯•ç±»&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Proxy proxy = <span class="keyword">new</span> Proxy();</span><br><span class="line">        proxy.request();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     æŠ½è±¡ä¸»é¢˜</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">request</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     çœŸå®ä¸»é¢˜</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RealSubject</span> <span class="keyword">implements</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(RealSubject.class);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">request</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;è®¿é—®çœŸå®ä¸»é¢˜...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     ä»£ç†</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Proxy</span> <span class="keyword">implements</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(Proxy.class);</span><br><span class="line">    <span class="keyword">private</span> RealSubject realSubject;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">request</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (realSubject == <span class="keyword">null</span>) &#123;</span><br><span class="line">            realSubject = <span class="keyword">new</span> RealSubject();</span><br><span class="line">            preHandler();</span><br><span class="line">            realSubject.request();</span><br><span class="line">            postHandler();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preHandler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;è®¿é—®çœŸå®ä¸»é¢˜ä¹‹å‰çš„é¢„å¤„ç†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;è®¿é—®çœŸå®ä¸»é¢˜ä¹‹åçš„åç»­å¤„ç†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-8-é€‚é…å™¨æ¨¡å¼-Adapter"><a href="#2-8-é€‚é…å™¨æ¨¡å¼-Adapter" class="headerlink" title="2.8 é€‚é…å™¨æ¨¡å¼-Adapter"></a>2.8 é€‚é…å™¨æ¨¡å¼-Adapter</h3><blockquote>
<p>å®šä¹‰</p>
</blockquote>
<p>å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦å¤–ä¸€ä¸ªæ¥å£ï¼Œä½¿å¾—åŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„é‚£äº›ç±»èƒ½ä¸€èµ·å·¥ä½œ</p>
<blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<ul>
<li>å®¢æˆ·ç«¯é€šè¿‡é€‚é…å™¨å¯ä»¥é€æ˜åœ°è°ƒç”¨ç›®æ ‡æ¥å£ã€‚</li>
<li>å¤ç”¨äº†ç°å­˜çš„ç±»ï¼Œç¨‹åºå‘˜ä¸éœ€è¦ä¿®æ”¹åŸæœ‰ä»£ç è€Œå¤ç”¨ç°æœ‰çš„é€‚é…è€…ç±»ã€‚</li>
<li>å°†ç›®æ ‡ç±»ä¸é€‚é…è€…ç±»è§£è€¦ï¼Œè§£å†³äº†ç›®æ ‡ç±»å’Œé€‚é…è€…ç±»æ¥å£ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</li>
<li>åœ¨å¾ˆå¤šä¸šåŠ¡åœºæ™¯ä¸­ç¬¦åˆå¼€é—­åŸåˆ™ã€‚</li>
</ul>
<blockquote>
<p>ç¼ºç‚¹</p>
</blockquote>
<ul>
<li>é€‚é…å™¨ç¼–å†™è¿‡ç¨‹éœ€è¦ç»“åˆä¸šåŠ¡åœºæ™¯å…¨é¢è€ƒè™‘ï¼Œå¯èƒ½ä¼šå¢åŠ ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚</li>
<li>å¢åŠ ä»£ç é˜…è¯»éš¾åº¦ï¼Œè¿‡å¤šä½¿ç”¨é€‚é…å™¨ä¼šä½¿ç³»ç»Ÿä»£ç å˜å¾—å‡Œä¹±ã€‚</li>
</ul>
<blockquote>
<p>ç»“æ„</p>
</blockquote>
<ul>
<li>ç›®æ ‡æ¥å£(Target)ï¼šå½“å‰ç³»ç»Ÿä¸šåŠ¡æ‰€æœŸå¾…çš„æ¥å£ï¼Œå¯ä»¥æ˜¯æŠ½è±¡ç±»æˆ–è€…æ¥å£ã€‚</li>
<li>é€‚é…è€…ç±»(Adaptee)ï¼šè¢«è®¿é—®å’Œé€‚é…çš„ç°å­˜ç»„ä»¶åº“ä¸­çš„ç»„ä»¶æ¥å£ã€‚</li>
<li>é€‚é…å™¨ç±»(Adapter)ï¼šè½¬æ¢å™¨ï¼Œé€šè¿‡ç»§æ‰¿æˆ–å¼•ç”¨é€‚é…è€…çš„å¯¹è±¡ï¼ŒæŠŠé€‚é…è€…æ¥å£è½¬æ¢ç›®æ ‡æ¥å£ï¼Œè®©å®¢æˆ·ç«¯ç›®æ ‡æ¥å£çš„æ ¼å¼è®¿é—®é€‚é…è€…ã€‚</li>
</ul>
<blockquote>
<p>å®ç°</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.adapter.pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: DesignPattern &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.adapter.pattern &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: Adapter &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: é€‚é…å™¨æ¨¡å¼ &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/10/18</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;P&gt;æµ‹è¯•ç±»&lt;/P&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdapterDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Target target = <span class="keyword">new</span> Adapter();</span><br><span class="line">        target.request();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     ç›®æ ‡æ¥å£</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Target</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">request</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     é€‚é…è€…æ¥å£</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Adaptee</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(Adaptee.class);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">specificRequest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;é€‚é…è€…ä¸­çš„ä¸šåŠ¡ä»£ç è¢«è°ƒç”¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     é€‚é…å™¨ç±»</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">Adaptee</span> <span class="keyword">implements</span> <span class="title">Target</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">request</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        specificRequest();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-9-æ¡¥æ¥æ¨¡å¼-Bridge"><a href="#2-9-æ¡¥æ¥æ¨¡å¼-Bridge" class="headerlink" title="2.9 æ¡¥æ¥æ¨¡å¼-Bridge"></a>2.9 æ¡¥æ¥æ¨¡å¼-Bridge</h3><blockquote>
<p>å®šä¹‰</p>
</blockquote>
<p>å°†æŠ½è±¡ä¸å®ç°åˆ†ç¦»ï¼Œä½¿å®ƒä»¬å¯ä»¥ç‹¬ç«‹å˜åŒ–ã€‚</p>
<blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<ul>
<li>æŠ½è±¡ä¸å®ç°åˆ†ç¦»ï¼Œæ‰©å±•èƒ½åŠ›å¼ºã€‚</li>
<li>ç¬¦åˆå¼€é—­åŸåˆ™ã€‚</li>
<li>ç¬¦åˆåˆæˆå¤ç”¨åŸåˆ™ã€‚</li>
<li>å…¶å®ç°ç»†èŠ‚å¯¹å®¢æˆ·é€æ˜ã€‚</li>
</ul>
<blockquote>
<p>ç¼ºç‚¹</p>
</blockquote>
<ul>
<li>ç”±äºèšåˆå…³ç³»å»ºç«‹åœ¨æŠ½è±¡å±‚ï¼Œè¦æ±‚å¼€å‘è€…å¯¹æŠ½è±¡åŒ–è¿›è¡Œè®¾è®¡ä¸ç¼–ç¨‹ï¼Œèƒ½æ­£ç¡®çš„è¯†åˆ«å‡ºç³»ç»Ÿä¸­ä¸¤ä¸ªç‹¬ç«‹å˜åŒ–çš„ç»´åº¦ï¼Œè¿™å¢åŠ äº†ç³»ç»Ÿçš„ç†è§£ä¸è®¾è®¡éš¾åº¦ã€‚</li>
</ul>
<blockquote>
<p>ç»“æ„</p>
</blockquote>
<ul>
<li>æŠ½è±¡åŒ–è§’è‰²(Abstraction)ï¼šå®šä¹‰æŠ½è±¡ç±»ï¼Œå¹¶åŒ…å«ä¸€ä¸ªå¯¹å®ç°åŒ–å¯¹è±¡çš„å¼•ç”¨ã€‚</li>
<li>æ‰©å±•æŠ½è±¡åŒ–è§’è‰²(Refined Abstraction)ï¼šæ˜¯æŠ½è±¡åŒ–è§’è‰²çš„å­ç±»ï¼Œå®ç°çˆ¶ç±»ä¸­çš„ä¸šåŠ¡æ–¹æ³•ï¼Œå¹¶é€šè¿‡ç»„åˆå…³ç³»è°ƒç”¨å®ç°åŒ–è§’è‰²ä¸­çš„ä¸šåŠ¡æ–¹æ³•ã€‚</li>
<li>å®ç°åŒ–è§’è‰²(Implementor)ï¼šå®šä¹‰å®ç°åŒ–è§’è‰²çš„æ¥å£ï¼Œä¾›æ‰©å±•æŠ½è±¡åŒ–è§’è‰²è°ƒç”¨ã€‚</li>
<li>å…·ä½“å®ç°åŒ–è§’è‰²(Concrete Implementor)ï¼šç»™å‡ºå®ç°åŒ–è§’è‰²æ¥å£çš„å…·ä½“å®ç°ã€‚</li>
</ul>
<blockquote>
<p>å®ç°</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.bridge.pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: DesignPattern &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.bridge.pattern &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: Bridge &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: æ¡¥æ¥æ¨¡å¼ &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/10/18</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;æµ‹è¯•ç±»&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BridgeDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Implementor implementor = <span class="keyword">new</span> ConcreteImplementorA();</span><br><span class="line">        Abstraction abstraction = <span class="keyword">new</span> RefinedAbstraction(implementor);</span><br><span class="line">        abstraction.operation();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å®ç°åŒ–è§’è‰²</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Implementor</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operationImpl</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“å®ç°åŒ–è§’è‰²</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteImplementorA</span> <span class="keyword">implements</span> <span class="title">Implementor</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(ConcreteImplementorA.class);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operationImpl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…·ä½“å®ç°åŒ–è§’è‰²(Concrete Implementor)è¢«è®¿é—®&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     æŠ½è±¡åŒ–è§’è‰²</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Abstraction</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> Implementor implementor;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">Abstraction</span><span class="params">(Implementor implementor)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.implementor = implementor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     æ‰©å±•æŠ½è±¡åŒ–è§’è‰²</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RefinedAbstraction</span> <span class="keyword">extends</span> <span class="title">Abstraction</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(RefinedAbstraction.class);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">RefinedAbstraction</span><span class="params">(Implementor implementor)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(implementor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;æ‰©å±•æŠ½è±¡åŒ–è§’è‰²(Refined Abstraction)è¢«è®¿é—®&quot;</span>);</span><br><span class="line">        implementor.operationImpl();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-10-è£…é¥°æ¨¡å¼-Decorator"><a href="#2-10-è£…é¥°æ¨¡å¼-Decorator" class="headerlink" title="2.10 è£…é¥°æ¨¡å¼-Decorator"></a>2.10 è£…é¥°æ¨¡å¼-Decorator</h3><blockquote>
<p>å®šä¹‰</p>
</blockquote>
<p>åœ¨ä¸æ”¹å˜ç°æœ‰å¯¹è±¡ç»“æ„çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€åœ°ç»™è¯¥å¯¹è±¡å¢åŠ ä¸€äº›èŒè´£çš„æ¨¡å¼ã€‚</p>
<blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<ul>
<li>è£…é¥°å™¨æ˜¯ç»§æ‰¿çš„æœ‰åŠ›è¡¥å……ï¼Œæ¯”ç»§æ‰¿çµæ´»ï¼Œåœ¨ä¸æ”¹å˜åŸæœ‰å¯¹è±¡çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€çš„ç»™ä¸€ä¸ªå¯¹è±¡æ‰©å±•åŠŸèƒ½ï¼Œå³æ’å³ç”¨ã€‚</li>
<li>é€šè¿‡ä½¿ç”¨ä¸ç”¨è£…é¥°ç±»åŠè¿™äº›è£…é¥°ç±»çš„æ’åˆ—ç»„åˆï¼Œå¯ä»¥å®ç°ä¸åŒæ•ˆæœã€‚</li>
<li>è£…é¥°æ¨¡å¼å®Œå…¨éµå®ˆå¼€é—­åŸåˆ™ã€‚</li>
</ul>
<blockquote>
<p>ç¼ºç‚¹</p>
</blockquote>
<ul>
<li>è£…é¥°æ¨¡å¼ä¼šå¢åŠ è®¸å¤šå­ç±»ï¼Œè¿‡åº¦ä½¿ç”¨ä¼šå¢åŠ ç¨‹åºçš„å¤æ‚æ€§ã€‚</li>
</ul>
<blockquote>
<p>ç»“æ„</p>
</blockquote>
<ul>
<li>æŠ½è±¡æ„å»ºè§’è‰²(Component)ï¼šå®šä¹‰ä¸€ä¸ªæŠ½è±¡æ¥å£ä»¥è§„èŒƒå‡†å¤‡æ¥é™„åŠ è´£ä»»çš„å¯¹è±¡ã€‚</li>
<li>å…·ä½“æ„å»ºè§’è‰²(Concrete Component)ï¼šå®ç°æŠ½è±¡æ„ä»¶ï¼Œé€šè¿‡è£…é¥°è§’è‰²ä¸ºå…¶æ·»åŠ ä¸€äº›èŒè´£ã€‚</li>
<li>æŠ½è±¡è£…é¥°è§’è‰²(Decorator)ï¼šç»§æ‰¿æŠ½è±¡æ„ä»¶ï¼Œå¹¶åŒ…å«å…·ä½“æ„ä»¶çš„å®ä¾‹ï¼Œå¯ä»¥é€šè¿‡å…¶å­ç±»æ‰©å±•å…·ä½“æ„ä»¶çš„åŠŸèƒ½ã€‚</li>
<li>å…·ä½“è£…é¥°è§’è‰²(Concrete Decorator)ï¼šå®ç°æŠ½è±¡è£…é¥°çš„ç›¸å…³æ–¹æ³•ï¼Œå¹¶ç»™å…·ä½“æ„ä»¶å¯¹è±¡æ·»åŠ é™„åŠ çš„è´£ä»»ã€‚</li>
</ul>
<blockquote>
<p>å®ç°</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.decorator.pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: DesignPattern &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.decorator.pattern &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: Decorator &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: è£…é¥°æ¨¡å¼ &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/10/18</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;æµ‹è¯•ç±»&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DecoratorDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Component component1 = <span class="keyword">new</span> ConcreteComponent();</span><br><span class="line">        component1.operation();</span><br><span class="line">        Component component2 = <span class="keyword">new</span> ConcreteDecorator(component1);</span><br><span class="line">        component2.operation();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     æŠ½è±¡æ„ä»¶è§’è‰²</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“æ„ä»¶è§’è‰²</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteComponent</span> <span class="keyword">implements</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(ConcreteComponent.class);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConcreteComponent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;åˆ›å»ºå…·ä½“æ„ä»¶è§’è‰²&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;è°ƒç”¨å…·ä½“æ„ä»¶è§’è‰²çš„æ–¹æ³•operation()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     æŠ½è±¡è£…é¥°è§’è‰²</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Decorator</span> <span class="keyword">implements</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Component component;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Decorator</span><span class="params">(Component component)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.component = component;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“è£…é¥°è§’è‰²</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteDecorator</span> <span class="keyword">extends</span> <span class="title">Decorator</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(ConcreteComponent.class);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConcreteDecorator</span><span class="params">(Component component)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(component);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.operation();</span><br><span class="line">        addFunction();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFunction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;ä¸ºå…·ä½“æ„ä»¶è§’è‰²å¢åŠ é¢å¤–çš„åŠŸèƒ½function()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-11-å¤–è§‚æ¨¡å¼-Facade"><a href="#2-11-å¤–è§‚æ¨¡å¼-Facade" class="headerlink" title="2.11 å¤–è§‚æ¨¡å¼-Facade"></a>2.11 å¤–è§‚æ¨¡å¼-Facade</h3><blockquote>
<p>å®šä¹‰</p>
</blockquote>
<p>é€šè¿‡ä¸ºå¤šä¸ªå¤æ‚çš„å­ç³»ç»Ÿæä¾›ä¸€ä¸ªä¸€è‡´çš„æ¥å£ï¼Œè€Œä½¿è¿™äº›å­ç³»ç»Ÿæ›´åŠ å®¹æ˜“è¢«è®¿é—®ã€‚å¤–è§‚æ¨¡å¼å¯¹å¤–æœ‰ä¸€ä¸ªç»Ÿä¸€æ¥å£ï¼Œå¤–éƒ¨åº”ç”¨ç¨‹åºä¸ç”¨å…³å¿ƒå†…éƒ¨å­ç³»ç»Ÿçš„å…·ä½“ç»†èŠ‚ï¼Œè¿™æ ·ä¼šå¤§å¤§é™ä½åº”ç”¨ç¨‹åºçš„å¤æ‚åº¦ï¼Œæé«˜äº†ç¨‹åºçš„å¯ç»´æŠ¤æ€§ã€‚</p>
<blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<ul>
<li>é™ä½äº†å­ç³»ç»Ÿä¸å®¢æˆ·ç«¯ä¹‹é—´çš„è€¦åˆåº¦ï¼Œä½¿å¾—å­ç³»ç»Ÿé«˜çš„å˜åŒ–ä¸ä¼šå½±å“è°ƒç”¨å®ƒçš„å®¢æˆ·ç±»ã€‚</li>
<li>å¯¹å®¢æˆ·å±è”½äº†å­ç³»ç»Ÿç»„ä»¶ï¼Œå‡å°‘äº†å®¢æˆ·å¤„ç†çš„å¯¹è±¡æ•°ç›®ï¼Œå¹¶ä½¿å¾—å­ç³»ç»Ÿä½¿ç”¨èµ·æ¥æ›´åŠ å®¹æ˜“ã€‚</li>
<li>é™ä½äº†å¤§å‹è½¯ä»¶ç³»ç»Ÿä¸­çš„ç¼–è¯‘ä¾èµ–æ€§ï¼Œç®€åŒ–äº†ç³»ç»Ÿåœ¨ä¸åŒå¹³å°ä¹‹é—´çš„ç§»æ¤è¿‡ç¨‹ï¼Œå› ä¸ºç¼–è¯‘ä¸€ä¸ªå­ç³»ç»Ÿä¸ä¼šå½±å“å…¶ä»–çš„å­ç³»ç»Ÿï¼Œä¹Ÿä¸ä¼šå½±å“å¤–è§‚å¯¹è±¡ã€‚</li>
</ul>
<blockquote>
<p>ç¼ºç‚¹</p>
</blockquote>
<ul>
<li>ä¸èƒ½å¾ˆå¥½åœ°é™åˆ¶å®¢æˆ·ä½¿ç”¨å­ç³»ç»Ÿç±»ï¼Œå¾ˆå®¹æ˜“å¸¦æ¥æœªçŸ¥é£é™©ã€‚</li>
<li>å¢åŠ æ–°çš„å­ç³»ç»Ÿå¯èƒ½éœ€è¦ä¿®æ”¹å¤–è§‚ç±»æˆ–å®¢æˆ·ç«¯çš„æºä»£ç ï¼Œè¿èƒŒäº†å¼€é—­åŸåˆ™ã€‚</li>
</ul>
<blockquote>
<p>ç»“æ„</p>
</blockquote>
<ul>
<li>å¤–è§‚è§’è‰²(Facade)ï¼šä¸ºå¤šä¸ªå­ç³»ç»Ÿå¯¹å¤–æä¾›ä¸€ä¸ªå…±åŒçš„æ¥å£ã€‚</li>
<li>å­ç³»ç»Ÿè§’è‰²(Sub System)ï¼šå®ç°ç³»ç»Ÿçš„éƒ¨åˆ†åŠŸèƒ½ï¼Œå®¢æˆ·å¯ä»¥é€šè¿‡å¤–è§‚è§’è‰²è®¿é—®å®ƒã€‚</li>
<li>å®¢æˆ·è§’è‰²(Client)ï¼šé€šè¿‡ä¸€ä¸ªå¤–è§‚è§’è‰²è®¿é—®å„ä¸ªå­ç³»ç»Ÿçš„åŠŸèƒ½ã€‚</li>
</ul>
<blockquote>
<p>å®ç°</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.facade.pattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: DesignPattern &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.facade.pattern &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: Facade &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: å¤–è§‚æ¨¡å¼ &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/10/19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;æµ‹è¯•ç±»&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FacadeDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Facade</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> SubSys1 subSys1 = <span class="keyword">new</span> SubSys1();</span><br><span class="line">    <span class="keyword">private</span> SubSys2 subSys2 = <span class="keyword">new</span> SubSys2();</span><br><span class="line">    <span class="keyword">private</span> SubSys3 subSys3 = <span class="keyword">new</span> SubSys3();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        subSys1.method1();</span><br><span class="line">        subSys2.method2();</span><br><span class="line">        subSys3.method3();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubSys1</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(SubSys1.class);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å­ç³»ç»Ÿ1çš„method1è¢«è°ƒç”¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubSys2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(SubSys2.class);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å­ç³»ç»Ÿ2çš„method2è¢«è°ƒç”¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubSys3</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(SubSys3.class);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å­ç³»ç»Ÿ3çš„method3è¢«è°ƒç”¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-12-äº«å…ƒæ¨¡å¼-Flyweight"><a href="#2-12-äº«å…ƒæ¨¡å¼-Flyweight" class="headerlink" title="2.12 äº«å…ƒæ¨¡å¼-Flyweight"></a>2.12 äº«å…ƒæ¨¡å¼-Flyweight</h3><blockquote>
<p>å®šä¹‰</p>
</blockquote>
<p>è¿ç”¨å…±äº«æŠ€æœ¯æ¥æœ‰æ•ˆåœ°æ”¯æŒå¤§é‡ç»†ç²’åº¦å¯¹è±¡çš„å¤ç”¨ã€‚</p>
<blockquote>
<p>ä¼˜åŠ¿</p>
</blockquote>
<p>ç›¸åŒå¯¹è±¡åªä¿å­˜ä¸€ä»½ï¼Œè¿™é™ä½äº†ç³»ç»Ÿä¸­å¯¹è±¡çš„æ•°é‡ï¼Œä»è€Œé™ä½äº†ç³»ç»Ÿä¸­ç»†ç²’åº¦å¯¹è±¡ç»™å†…å­˜å¸¦æ¥çš„å‹åŠ›ã€‚</p>
<blockquote>
<p>ç¼ºç‚¹</p>
</blockquote>
<ul>
<li>ä¸ºäº†ä½¿å¯¹è±¡å¯ä»¥å…±äº«ï¼Œéœ€è¦å°†ä¸€äº›ä¸èƒ½å…±äº«çš„çŠ¶æ€å¤–éƒ¨åŒ–ï¼Œè¿™å°†å¢åŠ ç¨‹åºçš„å¤æ‚æ€§ã€‚</li>
<li>è¯»å–äº«å…ƒæ¨¡å¼çš„å¤–éƒ¨çŠ¶æ€ä¼šä½¿å¾—è¿è¡Œæ—¶é—´ç¨å¾®å˜é•¿ã€‚</li>
</ul>
<blockquote>
<p>ç»“æ„</p>
</blockquote>
<p>==çŠ¶æ€==</p>
<ul>
<li>å†…éƒ¨çŠ¶æ€ï¼šä¸ä¼šéšç€ç¯å¢ƒçš„æ”¹å˜è€Œæ”¹å˜çš„å¯å…±äº«éƒ¨åˆ†ã€‚</li>
<li>å¤–éƒ¨çŠ¶æ€ï¼šéšç€ç¯å¢ƒæ”¹å˜è€Œæ”¹å˜çš„ä¸å¯ä»¥å…±äº«çš„éƒ¨åˆ†ã€‚</li>
</ul>
<p>==ç»“æ„==</p>
<ul>
<li>æŠ½è±¡äº«å…ƒè§’è‰²(Flyweight)ï¼šæ‰€æœ‰çš„å…·ä½“äº«å…ƒç±»çš„åŸºç±»ï¼Œä¸ºå…·ä½“äº«å…ƒè§„èŒƒéœ€è¦å®ç°çš„å…¬å…±æ¥å£ï¼Œéäº«å…ƒçš„å¤–éƒ¨çŠ¶æ€ä»¥å‚æ•°çš„å½¢å¼é€šè¿‡æ–¹æ³•ä¼ å…¥ã€‚</li>
<li>å…·ä½“äº«å…ƒè§’è‰²(Concrete Flyweight)ï¼šå®ç°æŠ½è±¡äº«å…ƒè§’è‰²ä¸­æ‰€è§„å®šçš„æ¥å£ã€‚</li>
<li>éäº«å…ƒè§’è‰²(Unsharable Flyweight)ï¼šæ˜¯ä¸å¯ä»¥å…±äº«çš„å¤–éƒ¨çŠ¶æ€ï¼Œå®ƒä»¥å‚æ•°çš„å½¢å¼æ³¨å…¥å…·ä½“äº«å…ƒçš„ç›¸å…³æ–¹æ³•ä¸­ã€‚</li>
<li>äº«å…ƒå·¥å‚è§’è‰²(Flyweight Factory)ï¼šè´Ÿè´£åˆ›å»ºå’Œç®¡ç†äº«å…ƒè§’è‰²ã€‚å½“å®¢æˆ·å¯¹è±¡è¯·æ±‚çš„æ—¶å€™ï¼Œäº«å…ƒå·¥å‚æ£€æŸ¥ç³»ç»Ÿä¸­æ˜¯å¦å­˜åœ¨ç¬¦åˆè¦æ±‚çš„äº«å…ƒå¯¹è±¡ï¼Œå¦‚æœå­˜åœ¨åˆ™æä¾›ç»™å®¢æˆ·ï¼›å¦‚æœä¸å­˜åœ¨çš„è¯ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„äº«å…ƒå¯¹è±¡ã€‚</li>
</ul>
<blockquote>
<p>å®ç°</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.flyweight.pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: DesignPattern &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.flyweight.pattern &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: Flyweight &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: äº«å…ƒæ¨¡å¼ &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/10/19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;P&gt;æµ‹è¯•ç±»&lt;/P&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlyweightDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        FlyweightFactory factory = <span class="keyword">new</span> FlyweightFactory();</span><br><span class="line">        Flyweight f1 = factory.getFlyweight(<span class="string">&quot;K&quot;</span>);</span><br><span class="line">        Flyweight f2 = factory.getFlyweight(<span class="string">&quot;H&quot;</span>);</span><br><span class="line">        Flyweight f3 = factory.getFlyweight(<span class="string">&quot;I&quot;</span>);</span><br><span class="line">        Flyweight f4 = factory.getFlyweight(<span class="string">&quot;G&quot;</span>);</span><br><span class="line">        Flyweight f5 = factory.getFlyweight(<span class="string">&quot;H&quot;</span>);</span><br><span class="line">        f1.operation(<span class="keyword">new</span> UnsharedConcreteFlyweight(<span class="string">&quot;ç¬¬ä¸€æ¬¡è°ƒç”¨K&quot;</span>));</span><br><span class="line">        f2.operation(<span class="keyword">new</span> UnsharedConcreteFlyweight(<span class="string">&quot;ç¬¬ä¸€æ¬¡è°ƒç”¨H&quot;</span>));</span><br><span class="line">        f3.operation(<span class="keyword">new</span> UnsharedConcreteFlyweight(<span class="string">&quot;ç¬¬ä¸€æ¬¡è°ƒç”¨I&quot;</span>));</span><br><span class="line">        f4.operation(<span class="keyword">new</span> UnsharedConcreteFlyweight(<span class="string">&quot;ç¬¬ä¸€æ¬¡è°ƒç”¨G&quot;</span>));</span><br><span class="line">        f5.operation(<span class="keyword">new</span> UnsharedConcreteFlyweight(<span class="string">&quot;ç¬¬äºŒæ¬¡è°ƒç”¨H&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     éäº«å…ƒè§’è‰²</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UnsharedConcreteFlyweight</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String info;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     æŠ½è±¡äº«å…ƒè§’è‰²</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Flyweight</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">(UnsharedConcreteFlyweight concreteFlyweight)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“äº«å…ƒè§’è‰²</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteFlyweight</span> <span class="keyword">implements</span> <span class="title">Flyweight</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(ConcreteFlyweight.class);</span><br><span class="line">    <span class="keyword">private</span> String key;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConcreteFlyweight</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.key = key;</span><br><span class="line">        log.info(<span class="string">&quot;å…·ä½“äº«å…ƒ&quot;</span> + key + <span class="string">&quot;è¢«åˆ›å»º&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">(UnsharedConcreteFlyweight concreteFlyweight)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…·ä½“äº«å…ƒ&quot;</span> + key + <span class="string">&quot;è¢«è°ƒç”¨&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;éäº«å…ƒä¿¡æ¯æ˜¯ï¼š&quot;</span> + concreteFlyweight.getInfo());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     äº«å…ƒå·¥å‚è§’è‰²</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FlyweightFactory</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(FlyweightFactory.class);</span><br><span class="line">    <span class="keyword">private</span> HashMap&lt;String, Flyweight&gt; flyweightMap = <span class="keyword">new</span> HashMap&lt;String, Flyweight&gt;();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Flyweight <span class="title">getFlyweight</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        Flyweight flyweight = (Flyweight) flyweightMap.get(key);</span><br><span class="line">        <span class="keyword">if</span> (flyweight != <span class="keyword">null</span>) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;å…·ä½“äº«å…ƒ&quot;</span> + key + <span class="string">&quot;å·²ç»å­˜åœ¨ï¼Œè¢«æˆåŠŸè·å–ï¼&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            flyweight = <span class="keyword">new</span> ConcreteFlyweight(key);</span><br><span class="line">            flyweightMap.put(key, flyweight);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flyweight;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-13-ç»„åˆæ¨¡å¼-Composite"><a href="#2-13-ç»„åˆæ¨¡å¼-Composite" class="headerlink" title="2.13 ç»„åˆæ¨¡å¼-Composite"></a>2.13 ç»„åˆæ¨¡å¼-Composite</h3><blockquote>
<p>å®šä¹‰</p>
</blockquote>
<p>æœ‰æ—¶åˆå«åšéƒ¨åˆ†-æ•´ä½“æ¨¡å¼ï¼Œå®ƒæ˜¯ä¸€ç§å°†å¯¹è±¡ç»„åˆæˆæ ‘çŠ¶çš„å±‚æ¬¡ç»“æ„çš„æ¨¡å¼ï¼Œç”¨æ¥è¡¨ç¤ºâ€éƒ¨åˆ†-æ•´ä½“â€çš„å…³ç³»ï¼Œä½¿ç”¨æˆ·å¯¹å•ä¸ªç»„åˆå¯¹è±¡å…·æœ‰ä¸€è‡´çš„è®¿é—®æ€§ã€‚</p>
<blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<ul>
<li>ç»„åˆæ¨¡å¼ä½¿å¾—å®¢æˆ·ç«¯ä»£ç å¯ä»¥ä¸€è‡´åœ°å¤„ç†å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡ï¼Œæ— é¡»å…³å¿ƒè‡ªå·±å¤„ç†çš„æ˜¯å•ä¸ªå¯¹è±¡ï¼Œè¿˜æ˜¯ç»„åˆå¯¹è±¡ï¼Œè¿™ç®€åŒ–äº†å®¢æˆ·ç«¯ä»£ç ã€‚</li>
<li>æ›´å®¹æ˜“åœ¨ç»„åˆä½“å†…åŠ å…¥äº†æ–°çš„å¯¹è±¡ï¼Œå®¢æˆ·ç«¯ä¸ä¼šå› ä¸ºåŠ å…¥äº†æ–°çš„å¯¹è±¡è€Œæ›´æ”¹æºä»£ç ï¼Œæ»¡è¶³å¼€é—­åŸåˆ™ã€‚</li>
</ul>
<blockquote>
<p>ç¼ºç‚¹</p>
</blockquote>
<ul>
<li>è®¾è®¡è¾ƒå¤æ‚ï¼Œå®¢æˆ·ç«¯éœ€è¦èŠ±æ›´å¤šæ—¶é—´ç†æ¸…ç±»ä¹‹é—´çš„å±‚æ¬¡å…³ç³»ã€‚</li>
<li>ä¸å®¹æ˜“é™åˆ¶å®¹å™¨ä¸­çš„æ„ä»¶ã€‚</li>
<li>ä¸å®¹æ˜“ç”¨ç»§æ‰¿çš„æ–¹æ³•æ¥å¢åŠ æ„ä»¶çš„æ–°åŠŸèƒ½ã€‚</li>
</ul>
<blockquote>
<p>ç»“æ„</p>
</blockquote>
<ul>
<li>æŠ½è±¡æ„ä»¶è§’è‰²(Component)ï¼šå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ä¸ºæ ‘å¶æ„ä»¶å’Œæ ‘ææ„ä»¶å£°æ˜å…¬å…±æ¥å£ï¼Œå¹¶å®ç°å®ƒä»¬çš„é»˜è®¤è¡Œä¸ºï¼Œåœ¨é€æ˜å¼çš„ç»„åˆæ¨¡å¼ä¸­æŠ½è±¡æ’ä»¶è¿˜å£°æ˜è®¿é—®å’Œç®¡ç†å­ç±»çš„æ¥å£ï¼›åœ¨å®‰å…¨å¼çš„ç»„åˆæ¨¡å¼ä¸­ä¸å£°æ˜è®¿é—®å’Œç®¡ç†å­ç±»çš„æ¥å£ï¼Œç®¡ç†å·¥ä½œç”±æ ‘ææ„ä»¶å®Œæˆã€‚</li>
<li>æ ‘å¶æ„ä»¶è§’è‰²(Leaf)ï¼šæ˜¯ç»„åˆæ¨¡å¼ä¸­çš„å¶å­ç»“ç‚¹ï¼Œæ²¡æœ‰å­ç»“ç‚¹ï¼Œç”¨äºå®ç°æŠ½è±¡æ„ä»¶è§’è‰²ä¸­å£°æ˜çš„å…¬å…±æ¥å£ã€‚</li>
<li>æ ‘ææ„ä»¶è§’è‰²(Composite)ï¼šæ˜¯ç»„åˆæ¨¡å¼ä¸­çš„åˆ†æ”¯ç»“ç‚¹å¯¹è±¡ï¼Œæœ‰å­ç»“ç‚¹ï¼Œå®ƒå®ç°äº†æŠ½è±¡æ„ä»¶è§’è‰²ä¸­å£°æ˜çš„æ¥å£ï¼Œä¸»è¦ä½œç”¨æ˜¯å­˜å‚¨å’Œç®¡ç†å­éƒ¨ä»¶ï¼Œé€šå¸¸åŒ…å«add()ã€remove()ã€getChild()ç­‰æ–¹æ³•ã€‚</li>
</ul>
<blockquote>
<p>å®ç°</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.composite.pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: DesignPattern &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.composite.pattern &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: Composite &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: ç»„åˆæ¨¡å¼ &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/10/19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;æµ‹è¯•ç±»&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CompositeDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Component component0 = <span class="keyword">new</span> Composite();</span><br><span class="line">        Component component1 = <span class="keyword">new</span> Composite();</span><br><span class="line">        Component component2 = <span class="keyword">new</span> Leaf(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        Component component3 = <span class="keyword">new</span> Leaf(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">        Component component4 = <span class="keyword">new</span> Leaf(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">        component0.add(component2);</span><br><span class="line">        component0.add(component1);</span><br><span class="line">        component1.add(component3);</span><br><span class="line">        component1.add(component4);</span><br><span class="line">        component0.operation();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     æŠ½è±¡æ„ä»¶</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Component c)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(Component c)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Component <span class="title">getChild</span><span class="params">(<span class="keyword">int</span> i)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     æ ‘å¶æ„ä»¶</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Leaf</span> <span class="keyword">implements</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(Leaf.class);</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Leaf</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Component c)</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(Component c)</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Component <span class="title">getChild</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;æ ‘å¶&quot;</span> + name + <span class="string">&quot;è¢«è®¿é—®&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">	 **</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> *     æ ‘ææ„ä»¶</span><br><span class="line"> * &lt;/p&gt;</span><br><span class="line"> */</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Composite</span> <span class="keyword">implements</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Component&gt; children = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Component c)</span> </span>&#123;</span><br><span class="line">        children.add(c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(Component c)</span> </span>&#123;</span><br><span class="line">        children.remove(c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Component <span class="title">getChild</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> children.get(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Object obj : children) &#123;</span><br><span class="line">            ((Component) obj).operation();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-14-æ¨¡æ¿æ–¹æ³•æ¨¡å¼"><a href="#2-14-æ¨¡æ¿æ–¹æ³•æ¨¡å¼" class="headerlink" title="2.14 æ¨¡æ¿æ–¹æ³•æ¨¡å¼"></a>2.14 æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h3><blockquote>
<p>å®šä¹‰</p>
</blockquote>
<p>å®šä¹‰ä¸€ä¸ªæ“ä½œä¸­çš„ç®—æ³•éª¨æ¶ï¼Œè€Œå°†ç®—æ³•ä¸­çš„ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ï¼Œä½¿å¾—å­ç±»å¯ä»¥ä¸æ”¹å˜ç®—æ³•ç»“æ„çš„æƒ…å†µä¸‹é‡å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›ç‰¹å®šæ­¥éª¤ã€‚</p>
<blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<ul>
<li>å°è£…äº†ä¸å˜éƒ¨åˆ†ï¼Œæ‰©å±•å¯å˜éƒ¨åˆ†ã€‚å®ƒæŠŠè®¤ä¸ºæ˜¯ä¸å˜éƒ¨åˆ†çš„ç®—æ³•å°è£…åˆ°çˆ¶ç±»å®ç°ä¸­ï¼Œè€ŒæŠŠå¯å˜éƒ¨åˆ†ç®—æ³•ç”±å­ç±»ç»§æ‰¿å®ç°ï¼Œä¾¿äºå­ç±»ç»§ç»­æ‰©å±•ã€‚</li>
<li>å®ƒåœ¨çˆ¶ç±»ä¸­æå–äº†å…¬å…±çš„éƒ¨åˆ†ä»£ç ï¼Œä¾¿äºä»£ç å¤ç”¨ã€‚</li>
<li>éƒ¨åˆ†æ–¹æ³•æ˜¯å­ç±»å®ç°çš„ï¼Œå› æ­¤å­ç±»å¯ä»¥é€šè¿‡æ‰©å±•æ–¹å¼å¢åŠ ç›¸åº”çš„åŠŸèƒ½ï¼Œç¬¦åˆå¼€é—­åŸåˆ™ã€‚</li>
</ul>
<blockquote>
<p>ç¼ºç‚¹</p>
</blockquote>
<ul>
<li>å¯¹æ¯ä¸ªä¸åŒçš„å®ç°éƒ½éœ€è¦å®šä¹‰ä¸€ä¸ªå­ç±»ï¼Œè¿™ä¼šå¯¼è‡´ç±»çš„ä¸ªæ•°å¢åŠ ï¼Œç³»ç»Ÿæ›´åŠ åºå¤§ï¼Œè®¾è®¡ä¹Ÿæ›´åŠ æŠ½è±¡ã€‚</li>
<li>çˆ¶ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•ç”±å­ç±»å®ç°ï¼Œå­ç±»æ‰§è¡Œçš„ç»“æœä¼šå½±å“çˆ¶ç±»çš„ç»“æœï¼Œè¿™å¯¼è‡´ä¸€ç§åå‘çš„æ§åˆ¶ç»“æ„ï¼Œå®ƒæé«˜äº†ä»£ç é˜…è¯»çš„éš¾åº¦ã€‚</li>
</ul>
<blockquote>
<p>ç»“æ„</p>
</blockquote>
<ul>
<li>æŠ½è±¡ç±»(Abstract class)ï¼šè´Ÿè´£ç»™å‡ºä¸€ä¸ªç®—æ³•çš„è½®å»“å’Œéª¨æ¶ã€‚å®ƒç”±ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•å’Œè‹¥å¹²ä¸ªåŸºæœ¬æ–¹æ³•æ„æˆ<ul>
<li>æ¨¡æ¿æ–¹æ³•ï¼šå®šä¹‰äº†ç®—æ³•çš„éª¨æ¶ï¼ŒæŒ‰æŸç§é¡ºåºè°ƒç”¨å…¶åŒ…å«çš„åŸºæœ¬æ–¹æ³•</li>
<li>åŸºæœ¬æ–¹æ³•ï¼š<ul>
<li>æŠ½è±¡æ–¹æ³•ï¼šåœ¨æŠ½è±¡ç±»ä¸­ç”³æ˜ï¼Œç”±å…·ä½“å­ç±»ä¸­å¯ä»¥ç»§æ‰¿æˆ–é‡å†™å®ƒã€‚</li>
<li>å…·ä½“æ–¹æ³•ï¼šåœ¨æŠ½è±¡ç±»ä¸­å·²ç»å®ç°ï¼Œåœ¨å…·ä½“å­ç±»ä¸­å¯ä»¥ç»§æ‰¿æˆ–é‡å†™å®ƒã€‚</li>
<li>é’©å­æ–¹æ³•ï¼šåœ¨æŠ½è±¡ç±»ä¸­å·²ç»å®ç°ï¼ŒåŒ…æ‹¬ç”¨äºåˆ¤æ–­çš„é€»è¾‘æ–¹æ³•å’Œéœ€è¦å­ç±»é‡å†™çš„å­”æ–¹æ³•ä¸¤ç§ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>å…·ä½“å­ç±»(Concrete Class)ï¼šå®ç°æŠ½è±¡ç±»ä¸­æ‰€å®šä¹‰çš„æŠ½è±¡æ–¹æ³•å’Œé’©å­æ–¹æ³•ï¼Œå®ƒä»¬æ˜¯ä¸€ä¸ªé¡¶çº§é€»è¾‘çš„ä¸€ä¸ªç»„æˆæ­¥éª¤ã€‚</li>
</ul>
<blockquote>
<p>å®ç°</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.templateMethod.pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: DesignPattern &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.templateMethod.pattern &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: TemplateMethodDemo &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/11/7</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;æµ‹è¯•ç±»&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TemplateMethodDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        AbstractClass abstractClass = <span class="keyword">new</span> ConcreteClass();</span><br><span class="line">        abstractClass.templateMethod();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;P&gt;</span></span><br><span class="line"><span class="comment"> *     æŠ½è±¡ç±»</span></span><br><span class="line"><span class="comment"> * &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(AbstractClass.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* æ¨¡æ¿æ–¹æ³• */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">templateMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        specificMethod();</span><br><span class="line">        abstractMethod1();</span><br><span class="line">        abstractMethod2();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* å…·ä½“æ–¹æ³• */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">specificMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…·ä½“æ–¹æ³•è¢«è°ƒç”¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* æŠ½è±¡æ–¹æ³•1 */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">abstractMethod1</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">/* æŠ½è±¡æ–¹æ³•2 */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">abstractMethod2</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteClass</span> <span class="keyword">extends</span> <span class="title">AbstractClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(ConcreteClass.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">abstractMethod1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;æŠ½è±¡æ–¹æ³•1çš„å®ç°è¢«è°ƒç”¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">abstractMethod2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;æŠ½è±¡æ–¹æ³•2çš„å®ç°è¢«è°ƒç”¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-15-ç­–ç•¥æ¨¡å¼-Strategy"><a href="#2-15-ç­–ç•¥æ¨¡å¼-Strategy" class="headerlink" title="2.15 ç­–ç•¥æ¨¡å¼-Strategy"></a>2.15 ç­–ç•¥æ¨¡å¼-Strategy</h3><blockquote>
<p>å®šä¹‰</p>
</blockquote>
<p>è¯¥æ¨¡å¼å®šä¹‰äº†ä¸€ç³»åˆ—ç®—æ³•ï¼Œå¹¶å°†æ¯ä¸ªç®—æ³•å°è£…èµ·æ¥ï¼Œä½¿å®ƒä»¬å¯ä»¥ç›¸äº’ä¾èµ–ï¼Œä¸”ç®—æ³•çš„å˜åŒ–ä¸ä¼šå½±å“åˆ°ä½¿ç”¨ç®—æ³•çš„ç”¨æˆ·ã€‚</p>
<blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<ul>
<li>å¤šé‡æ¡ä»¶è¯­å¥ä¸æ˜“ç»´æŠ¤ï¼Œè€Œä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥é¿å…ä½¿ç”¨å¤šé‡æ¡ä»¶è¯­å¥ã€‚</li>
<li>ç­–ç•¥æ¨¡å¼æä¾›äº†ä¸€ç³»åˆ—çš„å¯ä¾›é‡ç”¨çš„ç®—æ³•æ—ï¼Œæ°å½“ä½¿ç”¨ç»§æ‰¿å¯ä»¥æŠŠç®—æ³•æ—çš„å…¬å…±ä»£ç è½¬ç§»åˆ°çˆ¶ç±»é‡Œé¢ï¼Œä»è€Œé¿å…é‡å¤çš„ä»£ç ã€‚</li>
<li>ç­–ç•¥æ¨¡å¼å¯ä»¥æä¾›ç›¸åŒè¡Œä¸ºçš„ä¸åŒå®ç°ï¼Œå®¢æˆ·å¯ä»¥æ ¹æ®ä¸åŒæ—¶é—´æˆ–ç©ºé—´è¦æ±‚é€‰æ‹©ä¸åŒçš„ã€‚</li>
<li>ç­–ç•¥æ¨¡å¼æä¾›äº†å¯¹å¼€é—­åŸåˆ™çš„å®Œç¾æ”¯æŒï¼Œå¯ä»¥åœ¨ä¸ä¿®æ”¹åŸä»£ç çš„æƒ…å†µä¸‹ï¼Œçµæ´»å¢åŠ æ–°ç®—æ³•ã€‚</li>
<li>ç­–ç•¥æ¨¡å¼æŠŠç®—æ³•çš„ä½¿ç”¨æ”¾åˆ°ç¯å¢ƒç±»ä¸­ï¼Œè€Œç®—æ³•çš„å®ç°ç§»åˆ°å…·ä½“ç­–ç•¥ç±»ä¸­ï¼Œå®ç°äº†äºŒè€…çš„åˆ†ç¦»ã€‚</li>
</ul>
<blockquote>
<p>ç¼ºç‚¹</p>
</blockquote>
<ul>
<li>å®¢æˆ·ç«¯å¿…é¡»ç†è§£æ‰€æœ‰ç­–ç•¥ç®—æ³•çš„åŒºåˆ«ï¼Œä»¥ä¾¿é€‚æ—¶é€‰æ‹©æ°å½“çš„ç®—æ³•ç±»ã€‚</li>
<li>ç­–ç•¥æ¨¡å¼é€ æˆå¾ˆå¤šçš„ç­–ç•¥ç±»ã€‚</li>
</ul>
<blockquote>
<p>å®ç°</p>
</blockquote>
<p>==ç»“æ„==</p>
<ul>
<li>æŠ½è±¡ç­–ç•¥ç±»(Strategy)ï¼šå®šä¹‰äº†ä¸€ä¸ªå…¬å…±æ¥å£ï¼Œå„ç§ä¸åŒçš„ç®—æ³•ä»¥ä¸åŒçš„æ–¹å¼å®ç°è¿™ä¸ªæ¥å£ï¼Œç¯å¢ƒè§’è‰²ä½¿ç”¨è¿™ä¸ªæ¥å£è°ƒç”¨ä¸åŒçš„ç®—æ³•ï¼Œä¸€èˆ¬ä½¿ç”¨æ¥å£æˆ–æŠ½è±¡ç±»å®ç°ã€‚</li>
<li>å…·ä½“ç­–ç•¥ç±»(Concrete Strategy)ï¼šå®ç°äº†æŠ½è±¡äº†ç­–ç•¥å®šä¹‰çš„æ¥å£ï¼Œç¯å¢ƒè§’è‰²ä½¿ç”¨è¿™ä¸ªæ¥å£è°ƒç”¨ä¸åŒçš„ç®—æ³•ï¼Œä¸€èˆ¬ä½¿ç”¨æ¥å£æˆ–æŠ½è±¡ç±»å®ç°ã€‚</li>
<li>ç¯å¢ƒç±»(Context)ï¼šæŒæœ‰ä¸€ä¸ªç­–ç•¥ç±»çš„å¼•ç”¨ï¼Œæœ€ç»ˆç»™å®¢æˆ·ç«¯è°ƒç”¨ã€‚</li>
</ul>
<p>==å®ç°==</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.strategy.pattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: DesignPattern &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.strategy.pattern &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: StrategyDemo &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: ç­–ç•¥æ¨¡å¼ &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/11/7</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;æµ‹è¯•ç±»&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StrategyDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Context context = <span class="keyword">new</span> Context();</span><br><span class="line">        Strategy strategy1 = <span class="keyword">new</span> ConcreteStrategyA();</span><br><span class="line">        Strategy strategy2 = <span class="keyword">new</span> ConcreteStrategyB();</span><br><span class="line">        context.setStrategy(strategy1);</span><br><span class="line">        context.strategyMethod();</span><br><span class="line">        context.setStrategy(strategy2);</span><br><span class="line">        context.strategyMethod();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     æŠ½è±¡ç­–ç•¥ç±»</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Strategy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">strategyMethod</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“ç­–ç•¥ç±»A</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStrategyA</span> <span class="keyword">implements</span> <span class="title">Strategy</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(ConcreteStrategyA.class);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">strategyMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…·ä½“ç­–ç•¥Açš„ç­–ç•¥æ–¹æ³•è¢«è®¿é—®&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“ç­–ç•¥ç±»B</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStrategyB</span> <span class="keyword">implements</span> <span class="title">Strategy</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(ConcreteStrategyB.class);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">strategyMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…·ä½“ç­–ç•¥Bçš„ç­–ç•¥æ–¹æ³•è¢«è®¿é—®&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     ç¯å¢ƒç±»</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Context</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Strategy strategy;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Strategy <span class="title">getStrategy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> strategy;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStrategy</span><span class="params">(Strategy strategy)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.strategy = strategy;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">strategyMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        strategy.strategyMethod();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-16-å‘½ä»¤æ¨¡å¼-Command"><a href="#2-16-å‘½ä»¤æ¨¡å¼-Command" class="headerlink" title="2.16 å‘½ä»¤æ¨¡å¼-Command"></a>2.16 å‘½ä»¤æ¨¡å¼-Command</h3><blockquote>
<p>å®šä¹‰</p>
</blockquote>
<p>å°†è¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä½¿å‘å‡ºè¯·æ±‚çš„è´£ä»»å’Œæ‰§è¡Œè¯·æ±‚çš„è´£ä»»åˆ†å‰²å¼€ã€‚è¿™æ ·ä¸¤è€…ä¹‹é—´é€šè¿‡å‘½ä»¤å¯¹è±¡è¿›è¡Œæ²Ÿé€šï¼Œè¿™æ ·æ–¹ä¾¿å°†å‘½ä»¤å¯¹è±¡è¿›è¡Œå‚¨å­˜ã€ä¼ é€’ã€è°ƒç”¨ã€å¢åŠ ä¸ç®¡ç†ã€‚</p>
<blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<ul>
<li>é™ä½ç³»ç»Ÿçš„è€¦åˆåº¦ã€‚å‘½ä»¤æ¨¡å¼èƒ½å°†è°ƒç”¨æ“ä½œçš„å¯¹è±¡ä¸å®ç°è¯¥æ“ä½œçš„å¯¹è±¡è§£è€¦ã€‚</li>
<li>å¢åŠ æˆ–åˆ é™¤å‘½ä»¤éå¸¸æ–¹ä¾¿ã€‚é‡‡ç”¨å‘½ä»¤æ¨¡å¼å¢åŠ ä¸åˆ é™¤å‘½ä»¤ä¸ä¼šå½±å“å…¶ä»–ç±»ï¼Œå®ƒæ»¡è¶³å¼€é—­åŸåˆ™ï¼Œå¯¹æ‹“å±•æ¯”è¾ƒçµæ´»ã€‚</li>
<li>å¯ä»¥å®ç°å®å‘½ä»¤ã€‚å‘½ä»¤æ¨¡å¼å¯ä»¥ä¸ç»„åˆæ¨¡å¼ç»“åˆï¼Œå°†å¤šä¸ªå‘½ä»¤è£…é…æˆä¸€ä¸ªç»„åˆå‘½ä»¤ï¼Œå³å®å‘½ä»¤ã€‚</li>
<li>æ–¹ä¾¿å®ç°Undoå’ŒRedoæ“ä½œã€‚å‘½ä»¤æ¨¡å¼å¯ä»¥ä¸å¤‡å¿˜å½•æ¨¡å¼ç»“åˆï¼Œå®ç°å‘½ä»¤çš„æ’¤é”€ä¸æ¢å¤ã€‚</li>
</ul>
<blockquote>
<p>ç¼ºç‚¹</p>
</blockquote>
<p>å¯èƒ½äº§ç”Ÿå¤§é‡å…·ä½“å‘½ä»¤ç±»ã€‚å› ä¸ºå¯¹æ¯ä¸€ä¸ªå…·ä½“æ“ä½œéƒ½éœ€è¦è®¾è®¡ä¸€ä¸ªå…·ä½“å‘½ä»¤ç±»ï¼Œè¿™å°†å¢åŠ ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚</p>
<blockquote>
<p>å®ç°</p>
</blockquote>
<p>==ç»“æ„==</p>
<ul>
<li>æŠ½è±¡å‘½ä»¤ç±»(Command)ï¼šå£°æ˜æ‰§è¡Œå‘½ä»¤çš„æ¥å£ï¼Œæ‹¥æœ‰æ‰§è¡Œå‘½ä»¤çš„æŠ½è±¡æ–¹æ³•execute()ã€‚</li>
<li>å…·ä½“å‘½ä»¤è§’è‰²(Concrete Command)ï¼šæ˜¯æŠ½è±¡å‘½ä»¤ç±»çš„å…·ä½“å®ç°ç±»ï¼Œå®ƒæ‹¥æœ‰æ¥æ”¶è€…å¯¹è±¡ï¼Œå¹¶é€šè¿‡è°ƒç”¨æ¥æ”¶è€…çš„åŠŸèƒ½æ¥å®Œæˆå‘½ä»¤è¦æ‰§è¡Œçš„æ“ä½œã€‚</li>
<li>æ¥æ”¶è€…(Receiver)ï¼šæ‰§è¡Œå‘½ä»¤åŠŸèƒ½çš„ç›¸å…³æ“ä½œï¼Œæ˜¯å…·ä½“å‘½ä»¤å¯¹è±¡ä¸šåŠ¡çš„çœŸæ­£å®ç°è€…ã€‚</li>
<li>è¯·æ±‚è€…(Invoker)ï¼šè¯·æ±‚çš„å‘é€è€…ï¼Œå®ƒé€šå¸¸æ‹¥æœ‰å¾ˆå¤šçš„å‘½ä»¤å¯¹è±¡ï¼Œå¹¶é€šè¿‡è®¿é—®å‘½ä»¤å¯¹è±¡ç±»æ‰§è¡Œç›¸å…³è¯·æ±‚ï¼Œå®ƒä¸å¼ å­æ°è®¿é—®æ¥æ”¶è€…ã€‚</li>
</ul>
<p>==å®ç°==</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.command.pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: DesignPattern &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.command.pattern &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: CommandDemo &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: å‘½ä»¤æ¨¡å¼ &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/11/7</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;æµ‹è¯•ç±»&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommandDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Logger log = Logger.getLogger(CommandDemo.class);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Command command = <span class="keyword">new</span> ConcreteCommand();</span><br><span class="line">        Invoker invoker = <span class="keyword">new</span> Invoker(command);</span><br><span class="line">        log.info(<span class="string">&quot;å®¢æˆ·è®¿é—®è°ƒç”¨è€…çš„callæ–¹æ³•&quot;</span>);</span><br><span class="line">        invoker.call();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     è°ƒç”¨è€…</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Invoker</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(Invoker.class);</span><br><span class="line">    <span class="keyword">private</span> Command command;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Invoker</span><span class="params">(Command command)</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.command = command;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCommand</span><span class="params">(Command command)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.command = command;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;è°ƒç”¨è€…æ‰§è¡Œå‘½ä»¤command&quot;</span>);</span><br><span class="line">        command.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     æŠ½è±¡å‘½ä»¤</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;å…·ä½“å‘½ä»¤&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteCommand</span> <span class="keyword">implements</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Receiver receiver;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConcreteCommand</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.receiver = <span class="keyword">new</span> Receiver();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        receiver.action();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;æ¥æ”¶è€…&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Receiver</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(Receiver.class);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">action</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;æ¥æ”¶è€…çš„actionæ–¹æ³•è¢«è°ƒç”¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-17-è´£ä»»é“¾æ¨¡å¼-Chain-of-Responsibility"><a href="#2-17-è´£ä»»é“¾æ¨¡å¼-Chain-of-Responsibility" class="headerlink" title="2.17 è´£ä»»é“¾æ¨¡å¼-Chain of Responsibility"></a>2.17 è´£ä»»é“¾æ¨¡å¼-Chain of Responsibility</h3><blockquote>
<p>å®šä¹‰</p>
</blockquote>
<p>ä¸ºäº†é¿å…è¯·æ±‚å‘é€è€…ä¸å¤šä¸ªè¯·æ±‚å¤„ç†è€…è€¦åˆåœ¨ä¸€èµ·ï¼Œå°†æ‰€æœ‰è¯·æ±‚çš„å¤„ç†è€…é€šè¿‡å‰ä¸€å¯¹è±¡è®°ä½å…¶ä¸‹ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨è€Œè¿æˆä¸€æ¡é“¾ï¼›å½“æœ‰è¯·æ±‚å‘ç”Ÿæ—¶ï¼Œå¯ä»¥å°†è¯·æ±‚æ²¿ç€è¿™æ¡é“¾ä¼ é€’ï¼Œç›´åˆ°æœ‰å¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢ã€‚</p>
<blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<ul>
<li>é™ä½äº†å¯¹è±¡ä¹‹é—´çš„è€¦åˆåº¦ã€‚è¯¥æ¨¡å¼ä½¿å¾—ä¸€ä¸ªå¯¹è±¡æ— é¡»çŸ¥é“åˆ°åº•æ˜¯å“ªä¸€ä¸ªå¯¹è±¡å¤„ç†å…¶è¯·æ±‚ä»¥åŠé“¾çš„ç»“æ„ï¼Œå‘é€è€…å’Œæ¥æ”¶è€…ä¹Ÿæ— é¡»æ‹¥æœ‰å¯¹æ–¹çš„æ˜ç¡®ä¿¡æ¯ã€‚</li>
<li>å¢å¼ºäº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€‚å¯ä»¥æ ¹æ®éœ€è¦å¢åŠ æ–°çš„è¯·æ±‚å¤„ç†ç±»ï¼Œæ»¡è¶³å¼€é—­åŸåˆ™ã€‚</li>
<li>å¢å¼ºäº†ç»™å¯¹è±¡æŒ‡æ´¾èŒè´£çš„çµæ´»æ€§ã€‚å½“å·¥ä½œæµç¨‹å‘ç”Ÿå˜åŒ–ï¼Œå¯ä»¥åŠ¨æ€åœ°æ”¹å˜é“¾å†…çš„æˆå‘˜æˆ–è€…è°ƒåŠ¨å®ƒä»¬çš„æ¬¡åºï¼Œä¹Ÿå¯åŠ¨æ€åœ°æ–°å¢æˆ–è€…åˆ é™¤è´£ä»»ã€‚</li>
<li>è´£ä»»é“¾ç®€åŒ–äº†å¯¹è±¡ä¹‹é—´çš„è¿æ¥ã€‚æ¯ä¸ªå¯¹è±¡åªéœ€ä¿æŒä¸€ä¸ªæŒ‡å‘å…¶åç»§è€…çš„å¼•ç”¨ï¼Œä¸éœ€ä¿æŒå…¶ä»–æ‰€æœ‰å¤„ç†è€…çš„å¼•ç”¨ï¼Œè¿™é¿å…äº†ä½¿ç”¨ä¼—å¤šçš„if-elseè¯­å¥ã€‚</li>
<li>è´£ä»»åˆ†æ‹…ã€‚æ¯ä¸ªç±»åªéœ€è¦å¤„ç†è‡ªå·±è¯¥å¤„ç†çš„å·¥ä½œï¼Œä¸è¯¥å¤„ç†çš„ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¯¹è±¡å®Œæˆï¼Œæ˜ç¡®å„ç±»çš„è´£ä»»èŒƒå›´ï¼Œç¬¦åˆç±»çš„å•ä¸€èŒè´£åŸåˆ™ã€‚</li>
</ul>
<blockquote>
<p>ç¼ºç‚¹</p>
</blockquote>
<ul>
<li>ä¸èƒ½ä¿è¯æ¯ä¸ªè¯·æ±‚ä¸€å®šè¢«å¤„ç†ã€‚ç”±äºä¸€ä¸ªè¯·æ±‚æ²¡æœ‰æ˜ç¡®çš„æ¥æ”¶è€…ï¼Œæ‰€ä»¥ä¸èƒ½ä¿è¯å®ƒä¸€å®šä¼šè¢«å¤„ç†ï¼Œè¯¥è¯·æ±‚å¯èƒ½ä¸€ç›´ä¼ åˆ°é“¾çš„æœ«ç«¯éƒ½å¾—ä¸åˆ°å¤„ç†ã€‚</li>
<li>å¯¹æ¯”è¾ƒé•¿çš„è´£ä»»é“¾ï¼Œè¯·æ±‚çš„å¤„ç†å¯èƒ½æ¶‰åŠå¤šä¸ªå¤„ç†å¯¹è±¡ï¼Œç³»ç»Ÿæ€§èƒ½å°†å—åˆ°ä¸€ä¸ªå½±å“ã€‚</li>
<li>èŒè´£é“¾çš„å»ºç«‹çš„åˆç†æ€§è¦é å®¢æˆ·ç«¯æ¥ä¿è¯ï¼Œå¢åŠ äº†å®¢æˆ·ç«¯çš„å¤æ‚æ€§ï¼Œå¯èƒ½ä¼šç”±äºè´£ä»»é“¾çš„é”™è¯¯è®¾ç½®è€Œå¯¼è‡´ç³»ç»Ÿå‡ºé”™ï¼Œå¦‚å¯èƒ½è¿˜ä¼šé€ æˆå¾ªç¯è°ƒç”¨ã€‚</li>
</ul>
<blockquote>
<p>ç»“æ„</p>
</blockquote>
<ul>
<li><p>æŠ½è±¡å¤„ç†è€…(Handler)ï¼šå®šä¹‰ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„æ¥å£ï¼ŒåŒ…å«æŠ½è±¡å¤„ç†æ–¹æ³•å’Œä¸€ä¸ªåç»§è¿æ¥ã€‚</p>
</li>
<li><p>å…·ä½“å¤„ç†è€…(Concrete Handler)ï¼šå®ç°æŠ½è±¡å¤„ç†è€…çš„å¤„ç†æ–¹æ³•ï¼Œåˆ¤æ–­èƒ½å¦æœ¬æ¬¡è¯·æ±‚ï¼Œå¦‚æœå¯ä»¥å¤„ç†è¯·æ±‚åˆ™å¤„ç†ï¼Œå¦åˆ™å°†ç»™è¯·æ±‚è½¬ç»™å®ƒçš„åç»§è€…ã€‚</p>
</li>
<li><p>å®¢æˆ·ç±»(Client)ï¼šåˆ›å»ºå¤„ç†é“¾ï¼Œå¹¶å‘é“¾å¤´çš„å…·ä½“å¤„ç†è€…å¯¹è±¡æäº¤è¯·æ±‚ï¼Œå®ƒä¸å…³å¿ƒå¤„ç†ç»†èŠ‚å’Œè¯·æ±‚çš„ä¼ é€’è¿‡ç¨‹ã€‚</p>
</li>
</ul>
<blockquote>
<p>å®ç°</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.chainofResposibility.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: DesignPattern &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.chainofResposibility.example &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: Main &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: è´£ä»»é“¾Demo &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/10/23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     æµ‹è¯•ç±»</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Support RubbishK = <span class="keyword">new</span> NoSupport(<span class="string">&quot;RubbishK&quot;</span>);</span><br><span class="line">        Support FlowerK = <span class="keyword">new</span> LimitSupport(<span class="string">&quot;FlowerK&quot;</span>, <span class="number">100</span>);</span><br><span class="line">        Support EyedropK = <span class="keyword">new</span> LimitSupport(<span class="string">&quot;EyedropK&quot;</span>, <span class="number">200</span>);</span><br><span class="line">        Support UnknownK = <span class="keyword">new</span> SpecialSupport(<span class="string">&quot;UnknownK&quot;</span>, <span class="number">300</span>);</span><br><span class="line">        Support KHighness = <span class="keyword">new</span> SpecialSupport(<span class="string">&quot;KHighness&quot;</span>, <span class="number">330</span>);</span><br><span class="line">        Support BrotherK = <span class="keyword">new</span> OddSupport(<span class="string">&quot;BrotherK&quot;</span>);</span><br><span class="line">        <span class="comment">// åˆ¶é€ è´£ä»»é“¾</span></span><br><span class="line">        RubbishK.setNext(FlowerK).setNext(EyedropK).setNext(UnknownK).setNext(KHighness).setNext(BrotherK);</span><br><span class="line">        <span class="comment">// åˆ¶é€ é—®é¢˜</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">500</span>; i += <span class="number">30</span>) &#123;</span><br><span class="line">            RubbishK.support(<span class="keyword">new</span> Trouble(i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å‘ç”Ÿçš„é—®é¢˜çš„ç±»</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Trouble</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> number;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Trouble</span><span class="params">(<span class="keyword">int</span> number)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.number = number;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> number;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;[Trouble &quot;</span> +</span><br><span class="line">                <span class="string">&quot;number=&quot;</span> + number +</span><br><span class="line">                <span class="string">&#x27;]&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     ç”¨æ¥è§£å†³é—®çš„æŠ½è±¡ç±»</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Support</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(Support.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Support next;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Support</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Support <span class="title">setNext</span><span class="params">(Support next)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.next = next;</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;[&quot;</span> + name + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">support</span><span class="params">(Trouble trouble)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (resolve(trouble)) &#123;</span><br><span class="line">            done(trouble);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (next != <span class="keyword">null</span>) &#123;</span><br><span class="line">            next.support(trouble);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            fail(trouble);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">boolean</span> <span class="title">resolve</span><span class="params">(Trouble trouble)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">done</span><span class="params">(Trouble trouble)</span> </span>&#123;</span><br><span class="line">        log.info(trouble + <span class="string">&quot; is resolved by &quot;</span> + <span class="keyword">this</span> + <span class="string">&quot;.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">fail</span><span class="params">(Trouble trouble)</span> </span>&#123;</span><br><span class="line">        log.info(trouble + <span class="string">&quot; cannot be resolved.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     è§£å†³é—®é¢˜å…·ä½“ç±»ï¼šä¸èƒ½è§£å†³é—®é¢˜</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NoSupport</span> <span class="keyword">extends</span> <span class="title">Support</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NoSupport</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">resolve</span><span class="params">(Trouble trouble)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     è§£å†³é—®é¢˜å…·ä½“ç±»ï¼šè§£å†³é—®é¢˜ç¼–å·å°äºlimitå€¼å¾—ç±»</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LimitSupport</span> <span class="keyword">extends</span> <span class="title">Support</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> limit;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LimitSupport</span><span class="params">(String name, <span class="keyword">int</span> limit)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">        <span class="keyword">this</span>.limit = limit;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">resolve</span><span class="params">(Trouble trouble)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (trouble.getNumber() &lt; limit) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     è§£å†³é—®é¢˜å…·ä½“ç±»ï¼šè§£å†³å¥‡æ•°ç¼–å·å¾—é—®é¢˜</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OddSupport</span> <span class="keyword">extends</span> <span class="title">Support</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">OddSupport</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">resolve</span><span class="params">(Trouble trouble)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (trouble.getNumber() % <span class="number">2</span> != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     è§£å†³é—®é¢˜å…·ä½“ç±»ï¼šåªè§£å†³æŒ‡å®šç¼–å·å¾—é—®é¢˜</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SpecialSupport</span> <span class="keyword">extends</span> <span class="title">Support</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> number;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SpecialSupport</span><span class="params">(String name, <span class="keyword">int</span> number)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">        <span class="keyword">this</span>.number = number;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">resolve</span><span class="params">(Trouble trouble)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (trouble.getNumber() == <span class="keyword">this</span>.number) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-18-çŠ¶æ€æ¨¡å¼-State"><a href="#2-18-çŠ¶æ€æ¨¡å¼-State" class="headerlink" title="2.18 çŠ¶æ€æ¨¡å¼-State"></a>2.18 çŠ¶æ€æ¨¡å¼-State</h3><blockquote>
<p>å®šä¹‰</p>
</blockquote>
<p>å¯¹æœ‰çŠ¶æ€çš„å¯¹è±¡ï¼ŒæŠŠå¤æ‚çš„â€œåˆ¤æ–­é€»è¾‘â€æå–åˆ°ä¸åŒçš„çŠ¶æ€å¯¹è±¡ä¸­ï¼Œå…è®¸çŠ¶æ€å¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶æ”¹å˜å…¶è¡Œä¸ºã€‚</p>
<blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<ul>
<li>çŠ¶æ€æ¨¡å¼ä¸ç‰¹å®šçŠ¶æ€ç›¸å…³çš„è¡Œä¸ºå±€éƒ¨åŒ–åˆ°ä¸€ä¸ªçŠ¶æ€ä¸­ï¼Œå¹¶ä¸”å°†ä¸åŒçŠ¶æ€çš„è¡Œä¸ºåˆ†å‰²å¼€æ¥ï¼Œæ»¡è¶³å•ä¸€èŒè´£åŸåˆ™ã€‚</li>
<li>å‡å°‘å¯¹è±¡é—´çš„ç›¸äº’ä¾èµ–ã€‚å°†ä¸åŒçš„çŠ¶æ€å¼•å…¥ç‹¬ç«‹çš„å¯¹è±¡ä¸­ä¼šä½¿å¾—çŠ¶æ€å˜å¾—æ›´åŠ æ˜ç¡®ï¼Œåˆ‡å‡å°‘å¯¹è±¡é—´çš„ç›¸äº’ä¾èµ–ã€‚</li>
<li>æœ‰åˆ©äºç¨‹åºçš„æ‹“å±•ã€‚é€šè¿‡å®šä¹‰æ–°çš„å­ç±»å¾ˆå®¹æ˜“å¾·å¢åŠ æ–°çš„çŠ¶æ€å’Œè½¬æ¢ã€‚</li>
</ul>
<blockquote>
<p>ç¼ºç‚¹</p>
</blockquote>
<ul>
<li>çŠ¶æ€æ¨¡å¼çš„ä½¿ç”¨å¿…ç„¶ä¼šå¢åŠ ç³»ç»Ÿçš„ç±»ä¸å¯¹è±¡çš„ä¸ªæ•°ã€‚</li>
<li>çŠ¶æ€æ¨¡å¼çš„ç»“æ„å’Œå®ç°éƒ½è¾ƒä¸ºå¤æ‚ï¼Œå¦‚æœä½¿ç”¨ä¸å½“ä¼šå¯¼è‡´ç¨‹åºç»“æ„å’Œä»£ç çš„æ··ä¹±ã€‚ </li>
</ul>
<blockquote>
<p>ç»“æ„</p>
</blockquote>
<ul>
<li>ç¯å¢ƒç±»(Context)ï¼šä¹Ÿç§°ä¸ºä¸Šä¸‹æ–‡ï¼Œå®ƒå®šä¹‰äº†å®¢æˆ·æ„Ÿå…´è¶£çš„æ¥å£ï¼Œç»´æŠ¤ä¸€ä¸ªå½“å‰çŠ¶æ€ï¼Œå¹¶å°†ä¸çŠ¶æ€ç›¸å…³çš„æ“ä½œéƒ½å§”æ‰˜ç»™å½“å‰çŠ¶æ€å¯¹è±¡ç±»å¤„ç†ã€‚</li>
<li>æŠ½è±¡çŠ¶æ€ç±»(State)ï¼šå®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œç”¨ä»¥å°è£…ç¯å¢ƒå¯¹è±¡ä¸­ç‰¹å®šçŠ¶æ€æ‰€å¯¹åº”çš„è¡Œä¸ºã€‚</li>
<li>å…·ä½“çŠ¶æ€ç±»(Concrete State)ï¼šå®ç°æŠ½è±¡çŠ¶æ€æ‰€å¯¹åº”çš„è¡Œä¸ºã€‚</li>
</ul>
<blockquote>
<p>å®ç°</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;package top.parak.state.pattern;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/**</span></span><br><span class="line"><span class="string"> * &lt;p&gt; Project: DesignPattern &lt;/P&gt;</span></span><br><span class="line"><span class="string"> * &lt;p&gt; Package: top.parak.state.pattern &lt;/p&gt;</span></span><br><span class="line"><span class="string"> * &lt;p&gt; FileName: StateDemo &lt;p&gt;</span></span><br><span class="line"><span class="string"> * &lt;p&gt; Description: çŠ¶æ€æ¨¡å¼ &lt;p&gt;</span></span><br><span class="line"><span class="string"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="string"> *</span></span><br><span class="line"><span class="string"> * @author KHighness</span></span><br><span class="line"><span class="string"> * @since 2020/11/8</span></span><br><span class="line"><span class="string"> */</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">import org.apache.log4j.Logger;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/**</span></span><br><span class="line"><span class="string"> * &lt;p&gt;æµ‹è¯•ç±»&lt;/p&gt;</span></span><br><span class="line"><span class="string"> */</span></span><br><span class="line"><span class="string">public class StateDemo &#123;</span></span><br><span class="line"><span class="string">    public static void main(String[] args) &#123;</span></span><br><span class="line"><span class="string">        Context context = new Context();</span></span><br><span class="line"><span class="string">        context.handle();</span></span><br><span class="line"><span class="string">        context.handle();</span></span><br><span class="line"><span class="string">        context.handle();</span></span><br><span class="line"><span class="string">        context.handle();</span></span><br><span class="line"><span class="string">        context.handle();</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/**</span></span><br><span class="line"><span class="string"> * &lt;p&gt;</span></span><br><span class="line"><span class="string"> *     ç¯å¢ƒç±»</span></span><br><span class="line"><span class="string"> * &lt;/p&gt;</span></span><br><span class="line"><span class="string"> */</span></span><br><span class="line"><span class="string">class Context &#123;</span></span><br><span class="line"><span class="string">    private State state;</span></span><br><span class="line"><span class="string">    /* åˆå§‹çŠ¶æ€ */</span></span><br><span class="line"><span class="string">    public Context()  &#123;</span></span><br><span class="line"><span class="string">        this.state = new ConcreteStateA();</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    /* è¯»å–çŠ¶æ€ */</span></span><br><span class="line"><span class="string">    public State getState() &#123;</span></span><br><span class="line"><span class="string">        return state;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    /* è®¾ç½®çŠ¶æ€ */</span></span><br><span class="line"><span class="string">    public void setState(State state) &#123;</span></span><br><span class="line"><span class="string">        this.state = state;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    /* å¤„ç†è¯·æ±‚ */</span></span><br><span class="line"><span class="string">    public void handle()  &#123;</span></span><br><span class="line"><span class="string">        state.handle(this);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/**</span></span><br><span class="line"><span class="string"> * &lt;p&gt;</span></span><br><span class="line"><span class="string"> *     æŠ½è±¡çŠ¶æ€ç±»</span></span><br><span class="line"><span class="string"> * &lt;/p&gt;</span></span><br><span class="line"><span class="string"> */</span></span><br><span class="line"><span class="string">abstract class State &#123;</span></span><br><span class="line"><span class="string">    abstract void handle(Context context);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/**</span></span><br><span class="line"><span class="string"> * &lt;p&gt;</span></span><br><span class="line"><span class="string"> *     å…·ä½“çŠ¶æ€Aç±»</span></span><br><span class="line"><span class="string"> * &lt;/p&gt;</span></span><br><span class="line"><span class="string"> */</span></span><br><span class="line"><span class="string">class ConcreteStateA extends State &#123;</span></span><br><span class="line"><span class="string">    private Logger log = Logger.getLogger(ConcreteStateA.class);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    @Override</span></span><br><span class="line"><span class="string">    void handle(Context context) &#123;</span></span><br><span class="line"><span class="string">        log.info(&quot;å½“å‰çŠ¶æ€ï¼šA&quot;);</span></span><br><span class="line"><span class="string">        context.setState(new ConcreteStateB());</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/**</span></span><br><span class="line"><span class="string"> * &lt;p&gt;</span></span><br><span class="line"><span class="string"> *     å…·ä½“çŠ¶æ€Bç±»</span></span><br><span class="line"><span class="string"> * &lt;/p&gt;</span></span><br><span class="line"><span class="string"> */</span></span><br><span class="line"><span class="string">class ConcreteStateB extends State &#123;</span></span><br><span class="line"><span class="string">    private Logger log = Logger.getLogger(ConcreteStateB.class);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    @Override</span></span><br><span class="line"><span class="string">    void handle(Context context) &#123;</span></span><br><span class="line"><span class="string">        log.info(&quot;å½“å‰çŠ¶æ€ï¼šB&quot;);</span></span><br><span class="line"><span class="string">        context.setState(new ConcreteStateA());</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br></pre></td></tr></table></figure>



<h3 id="2-19-è§‚å¯Ÿè€…æ¨¡å¼-Observer"><a href="#2-19-è§‚å¯Ÿè€…æ¨¡å¼-Observer" class="headerlink" title="2.19 è§‚å¯Ÿè€…æ¨¡å¼-Observer"></a>2.19 è§‚å¯Ÿè€…æ¨¡å¼-Observer</h3><blockquote>
<p>å®šä¹‰</p>
</blockquote>
<p>å¤šä¸ªå¯¹è±¡ä¹‹é—´å­˜åœ¨ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å¾—åˆ°é€šçŸ¥å¹¶è¢«è‡ªåŠ¨æ›´æ–°ï¼Œåˆå«åšå‘å¸ƒ-è®¢é˜…æ¨¡å¼ã€‚</p>
<blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<ul>
<li><p>é™ä½äº†ç›®æ ‡ä¸è§‚å¯Ÿè€…ä¹‹é—´çš„è€¦åˆå…³ç³»ï¼Œä¸¤è€…ä¹‹é—´æ˜¯æŠ½è±¡è€¦åˆå…³ç³»ã€‚</p>
</li>
<li><p>ç›®æ ‡ä¸è§‚å¯Ÿè€…ä¹‹é—´å»ºç«‹äº†ä¸€å¥—è§¦å‘æœºåˆ¶ã€‚</p>
</li>
</ul>
<blockquote>
<p>ç¼ºç‚¹</p>
</blockquote>
<ul>
<li>ç›®æ ‡ä¸è§‚å¯Ÿè€…ä¹‹é—´çš„ä¾èµ–å…³ç³»å¹¶æ²¡æœ‰å®Œå…¨è§£é™¤ï¼Œè€Œä¸”æœ‰å¯èƒ½å‡ºç°å¾ªç¯å¼•ç”¨ã€‚</li>
<li>å½“è§‚å¯Ÿè€…å¯¹è±¡å¾ˆå¤šæ—¶ï¼Œé€šçŸ¥çš„å‘å¸ƒä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´ï¼Œå½±å“ç¨‹åºçš„æ•ˆç‡ã€‚</li>
</ul>
<blockquote>
<p>ç»“æ„</p>
</blockquote>
<ul>
<li>æŠ½è±¡ä¸»é¢˜(Subject)ï¼šæä¾›äº†ä¸€ä¸ªç”¨äºä¿å­˜è§‚å¯Ÿè€…å¯¹è±¡çš„èšé›†ç±»å’Œå¢åŠ ã€å¢åŠ è§‚å¯Ÿè€…å¯¹è±¡çš„æ–¹æ³•ï¼Œä»¥åŠé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…çš„æŠ½è±¡æ–¹æ³•ã€‚</li>
<li>å…·ä½“ä¸»é¢˜(Concrete Subject)ï¼šå®ç°æŠ½è±¡ç›®æ ‡ä¸­çš„é€šçŸ¥æ–¹æ³•ï¼Œå½“å…·ä½“ä¸»é¢˜çš„å†…éƒ¨çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œé€šçŸ¥æ‰€æœ‰æ³¨å†Œè¿‡çš„è§‚å¯Ÿè€…å¯¹è±¡ã€‚</li>
<li>æŠ½è±¡è§‚å¯Ÿè€…(Observer)ï¼šä¸€ä¸ªæŠ½è±¡ç±»æˆ–è€…æ¥å£ï¼ŒåŒ…å«äº†ä¸€ä¸ªæ›´æ–°è‡ªå·±çš„æŠ½è±¡æ–¹æ³•ï¼Œå½“æ¥åˆ°å…·ä½“ä¸»é¢˜çš„æ›´æ”¹é€šçŸ¥æ—¶è¢«è°ƒç”¨ã€‚</li>
<li>å…·ä½“è§‚å¯Ÿè€…(Concrete Observer)ï¼šå®ç°æŠ½è±¡è§‚å¯Ÿè€…ä¸­å®šä¹‰çš„æŠ½è±¡æ–¹æ³•ï¼Œä»¥ä¾¿åœ¨å¾—åˆ°ç›®æ ‡çš„æ›´æ”¹é€šçŸ¥æ—¶æ›´æ–°è‡ªèº«çš„çŠ¶æ€ã€‚</li>
</ul>
<blockquote>
<p>å®ç°</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.observer.pattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: DesignPattern &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.observer.pattern &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: ObserverDemo &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: è§‚å¯Ÿè€…æ¨¡å¼ &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/10/27</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ObserverDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Subject subject = <span class="keyword">new</span> ConcreteSubject();</span><br><span class="line">        Observer[] observers = <span class="keyword">new</span> Observer[<span class="number">20</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">1</span>) &#123;</span><br><span class="line">                observers[i] = <span class="keyword">new</span> ConcreteObserver1();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                observers[i] = <span class="keyword">new</span> ConcreteObserver2();</span><br><span class="line">            &#125;</span><br><span class="line">            subject.add(observers[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        subject.notifyObserver();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     æŠ½è±¡ç›®æ ‡</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;Observer&gt; observers = <span class="keyword">new</span> ArrayList&lt;Observer&gt;();</span><br><span class="line">    <span class="comment">/* å¢åŠ è§‚å¯Ÿè€… */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Observer observer)</span> </span>&#123;</span><br><span class="line">        observers.add(observer);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* åˆ é™¤è§‚å¯Ÿè€… */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">del</span><span class="params">(Observer observer)</span> </span>&#123;</span><br><span class="line">        observers.remove(observer);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* é€šçŸ¥è§‚å¯Ÿè€… */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">notifyObserver</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“ç›®æ ‡</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteSubject</span> <span class="keyword">extends</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyObserver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å…·ä½“ç›®æ ‡å‘ç”Ÿæ”¹å˜&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Observer observer : observers) &#123;</span><br><span class="line">            observer.response();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     æŠ½è±¡è§‚å¯Ÿè€…</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="comment">/* ä½œå‡ºååº” */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">response</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“è§‚å¯Ÿè€…1</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteObserver1</span> <span class="keyword">implements</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(ConcreteObserver1.class);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">response</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…·ä½“è§‚å¯Ÿè€…1ä½œå‡ºååº”&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;P&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“è§‚å¯Ÿè€…2</span></span><br><span class="line"><span class="comment"> * &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteObserver2</span> <span class="keyword">implements</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(ConcreteObserver2.class);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">response</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…·ä½“è§‚å¯Ÿè€…2ä½œå‡ºååº”&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-20-ä¸­ä»‹è€…æ¨¡å¼-Mediator"><a href="#2-20-ä¸­ä»‹è€…æ¨¡å¼-Mediator" class="headerlink" title="2.20 ä¸­ä»‹è€…æ¨¡å¼-Mediator"></a>2.20 ä¸­ä»‹è€…æ¨¡å¼-Mediator</h3><blockquote>
<p>å®šä¹‰</p>
</blockquote>
<p>å®šä¹‰ä¸€ä¸ªä¸­ä»‹å¯¹è±¡æ¥å°è£…ä¸€ç³»åˆ—å¯¹è±¡ä¹‹é—´çš„äº¤äº’ï¼Œä½¿åŸæœ‰å¯¹è±¡ç›´æ¥çš„è€¦åˆæ¾æ•£ï¼Œä¸”å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜å®ƒä»¬ä¹‹é—´çš„äº¤äº’ã€‚ä¸­ä»‹è€…æ¨¡å¼åˆå«è°ƒåœæ¨¡å¼ã€‚</p>
<blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<ul>
<li>é™ä½äº†å¯¹è±¡ä¹‹é—´çš„è€¦åˆæ€§ï¼Œä½¿å¾—å¯¹è±¡æ˜“äºç‹¬ç«‹åœ°è¢«å¤ç”¨ã€‚</li>
<li>å°†å¯¹è±¡ä¹‹é—´çš„ä¸€å¯¹å¤šå…³è”è½¬ä¸ºä¸€å¯¹ä¸€çš„å…³è”ï¼Œæé«˜ç³»ç»Ÿçš„çµæ´»æ€§ï¼Œä½¿å¾—ç³»ç»Ÿæ˜“äºç»´æŠ¤å’Œæ‹“å±•ã€‚</li>
</ul>
<blockquote>
<p>ç¼ºç‚¹</p>
</blockquote>
<ul>
<li>å½“åŒäº‹ç±»å¤ªå¤šæ—¶ï¼Œä¸­ä»‹è€…çš„èŒè´£èŒè´£å°†å¾ˆå¤§ï¼Œå®ƒä¼šå˜å¾—å¤æ‚è€Œåºå¤§ï¼Œä»¥è‡³äºç³»ç»Ÿéš¾ä»¥ç»´æŠ¤ã€‚</li>
</ul>
<blockquote>
<p>å®ç°</p>
</blockquote>
<p>==ç»“æ„==</p>
<ul>
<li>æŠ½è±¡ä¸­ä»‹è€…(Mediator)ï¼šå®ƒæ˜¯ä¸­ä»‹è€…çš„æ¥å£ï¼Œæä¾›äº†åŒäº‹å¯¹è±¡æ³¨å†Œä¸è½¬å‘åŒäº‹å¯¹è±¡ä¿¡æ¯çš„æŠ½è±¡æ–¹æ³•ã€‚</li>
<li>å…·ä½“ä¸­ä»‹è€…(Concrete Mediator)ï¼šå®ç°ä¸­ä»‹è€…æ¥å£ï¼Œå®šä¹‰ä¸€ä¸ªListæ¥ç®¡ç†åŒäº‹å¯¹è±¡ï¼Œåè°ƒå„ä¸ªåŒäº‹è§’è‰²ä¹‹é—´çš„äº¤äº’å…³ç³»ï¼Œå› æ­¤å®ƒä¾èµ–äºåŒäº‹è§’è‰²ã€‚</li>
<li>æŠ½è±¡åŒäº‹ç±»(Colleague)ï¼šå®šä¹‰åŒäº‹ç±»çš„æ¥å£ï¼Œä¿å­˜ä¸­ä»‹è€…å¯¹è±¡ï¼Œæä¾›åŒäº‹å¯¹è±¡äº¤äº’çš„æŠ½è±¡æ–¹æ³•ï¼Œå®ç°æ‰€æœ‰ç›¸äº’å½±å“çš„åŒäº‹ç±»çš„å…¬å…±åŠŸèƒ½ã€‚</li>
<li>å…·ä½“åŒäº‹ç±»(Concrete Colleague)ï¼šæ˜¯æŠ½è±¡åŒäº‹ç±»çš„å®ç°è€…ï¼Œå½“éœ€è¦ä¸å…¶ä»–åŒäº‹å¯¹è±¡äº¤äº’æ—¶ï¼Œç”±ä¸­ä»‹è€…å¯¹è±¡è´Ÿè´£åç»­çš„äº¤äº’ã€‚</li>
</ul>
<p>==å®ç°==</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.mediator.pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: DesignPattern &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.mediator.pattern &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: MediatorDemo &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/11/8</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     ä¸­ä»‹è€…</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MediatorDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Mediator mediator = <span class="keyword">new</span> ConcreteMediator();</span><br><span class="line">        Colleague colleague1, colleague2;</span><br><span class="line">        colleague1 = <span class="keyword">new</span> ConcreteColleague1();</span><br><span class="line">        colleague2 = <span class="keyword">new</span> ConcreteColleague2();</span><br><span class="line">        mediator.register(colleague1);</span><br><span class="line">        mediator.register(colleague2);</span><br><span class="line">        colleague1.send();</span><br><span class="line">        colleague2.send();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     ä¸­ä»‹è€…</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Mediator</span> </span>&#123;</span><br><span class="line">    <span class="comment">/* æ³¨å†Œ */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(Colleague colleague)</span></span>;</span><br><span class="line">    <span class="comment">/* è½¬å‘ */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">relay</span><span class="params">(Colleague colleague)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“ä¸­ä»‹è€…</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteMediator</span> <span class="keyword">extends</span> <span class="title">Mediator</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Colleague&gt; colleagues = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(Colleague colleague)</span> </span>&#123;</span><br><span class="line">        colleagues.add(colleague);</span><br><span class="line">        colleague.setMediator(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">relay</span><span class="params">(Colleague colleague)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Colleague colleague1 : colleagues) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!colleague1.equals(colleague)) &#123;</span><br><span class="line">                colleague1.receive();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     æŠ½è±¡åŒäº‹ç±»</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Colleague</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(Colleague.class);</span><br><span class="line">    <span class="keyword">protected</span> Mediator mediator;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMediator</span><span class="params">(Mediator mediator)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mediator = mediator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“åŒäº‹ç±»1</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteColleague1</span> <span class="keyword">extends</span> <span class="title">Colleague</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(ConcreteColleague1.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…·ä½“åŒäº‹ç±»1æ”¶åˆ°è¯·æ±‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…·ä½“åŒäº‹1å‘å‡ºè¯·æ±‚&quot;</span>);</span><br><span class="line">        mediator.relay(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“åŒäº‹ç±»2</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteColleague2</span> <span class="keyword">extends</span> <span class="title">Colleague</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(ConcreteColleague2.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…·ä½“åŒäº‹ç±»2æ”¶åˆ°è¯·æ±‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…·ä½“åŒäº‹2å‘å‡ºè¯·æ±‚&quot;</span>);</span><br><span class="line">        mediator.relay(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-21è¿­ä»£å™¨æ¨¡å¼-Iterator"><a href="#2-21è¿­ä»£å™¨æ¨¡å¼-Iterator" class="headerlink" title="2.21è¿­ä»£å™¨æ¨¡å¼-Iterator"></a>2.21è¿­ä»£å™¨æ¨¡å¼-Iterator</h3><blockquote>
<p>å®šä¹‰</p>
</blockquote>
<p>æä¾›ä¸€ä¸ªå¯¹è±¡æ¥é¡ºåºè®¿é—®èšåˆå¯¹è±¡ä¸­çš„ä¸€ç³»åˆ—æ•°æ®ï¼Œè€Œä¸æš´éœ²èšåˆå¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºã€‚</p>
<blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<ul>
<li>è®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡çš„å†…å®¹è€Œæ— é¡»æš´éœ²å®ƒçš„å†…éƒ¨è¡¨ç¤ºã€‚</li>
<li>éå†ä»»åŠ¡äº¤ç”±è¿­ä»£å™¨å®Œæˆï¼Œè¿™ç®€åŒ–äº†èšåˆç±»ã€‚</li>
<li>å®ƒæ”¯æŒä»¥ä¸åŒæ–¹å¼éå†ä¸€ä¸ªèšåˆï¼Œç”šè‡³å¯ä»¥è‡ªå®šä¹‰è¿­ä»£å™¨çš„å­ç±»ä»¥æ”¯æŒæ–°çš„éå†ã€‚</li>
<li>å¢åŠ æ–°çš„èšåˆç±»å’Œè¿­ä»£å™¨éƒ½å¾ˆæ–¹ä¾¿ï¼Œæ— é¡»ä¿®æ”¹åŸæœ‰ä»£ç ã€‚</li>
<li>å°è£…æ€§è‰¯å¥½ï¼Œä¸ºéå†ä¸åŒçš„èšåˆç»“æ„æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ã€‚</li>
</ul>
<blockquote>
<p>ç¼ºç‚¹</p>
</blockquote>
<ul>
<li>å¢åŠ äº†ç±»çš„ä¸ªæ•°ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚</li>
</ul>
<blockquote>
<p>å®ç°</p>
</blockquote>
<p>==ç»“æ„==</p>
<ul>
<li>æŠ½è±¡èšåˆè§’è‰²(Aggregate)ï¼šå®šä¹‰å­˜å‚¨ã€æ·»åŠ ã€åˆ é™¤èšåˆå¯¹è±¡ä»¥åŠåˆ›å»ºè¿­ä»£å™¨å¯¹è±¡çš„æ¥å£ã€‚</li>
<li>å…·ä½“èšåˆè‰²(Concrete Aggregate)ï¼šå®ç°æŠ½è±¡èšåˆç±»ï¼Œè¿”å›ä¸€ä¸ªå…·ä½“è¿­ä»£å™¨çš„å®ä¾‹ã€‚</li>
<li>æŠ½è±¡è¿­ä»£å™¨è§’è‰²(Iterator)ï¼šå®šä¹‰è®¿é—®å’Œéå†èšåˆå…ƒç´ çš„æ¥å£ï¼Œé€šå¸¸åŒ…å«hasNext()ã€first()ã€next()ç­‰æ–¹æ³•ã€‚</li>
<li>å…·ä½“è¿­ä»£å™¨è§’è‰²(Concrete Iterator)ï¼šå®ç°æŠ½è±¡è¿­ä»£å™¨æ¥å£ä¸­æ‰€å®šä¹‰çš„æ–¹æ³•ï¼Œå®Œæˆå¯¹èšåˆå¯¹è±¡çš„éå†ï¼Œè®°å½•éå†çš„å½“å‰ä½ç½®ã€‚</li>
</ul>
<p>==å®ç°==</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.iterator.pattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: DesignPattern &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.iterator.pattern &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: IteratorDemo &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: è¿­ä»£å™¨æ¨¡å¼ &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/10/27</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IteratorDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Logger log = Logger.getLogger(IteratorDemo.class);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Aggregate aggregate = <span class="keyword">new</span> ConcreteAggregate();</span><br><span class="line">        aggregate.add(<span class="string">&quot;KHighness&quot;</span>);</span><br><span class="line">        aggregate.add(<span class="string">&quot;ParaK&quot;</span>);</span><br><span class="line">        aggregate.add(<span class="string">&quot;FlowerK&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;èšåˆçš„å†…å®¹&quot;</span>);</span><br><span class="line">        Iterator iterator = aggregate.getIterator();</span><br><span class="line">        log.info(iterator.first().toString());</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            log.info(iterator.next().toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     æŠ½è±¡èšåˆ</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Aggregate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Object o)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">del</span><span class="params">(Object o)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator <span class="title">getIterator</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“èšåˆ</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteAggregate</span> <span class="keyword">implements</span> <span class="title">Aggregate</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Object&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        list.add(o);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">del</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        list.remove(o);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator <span class="title">getIterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">new</span> ConcreteIterator(list));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     æŠ½è±¡è¿­ä»£å™¨</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Iterator</span> </span>&#123;</span><br><span class="line">    <span class="function">Object <span class="title">first</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">Object <span class="title">next</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“è¿­ä»£å™¨</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Object&gt; list = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> index = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConcreteIterator</span><span class="params">(List&lt;Object&gt; list)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.list = list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">first</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        index = <span class="number">0</span>;</span><br><span class="line">        Object object = list.get(index);</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Object object = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.hasNext()) &#123;</span><br><span class="line">            object = list.get(++index);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; list.size() - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="2-22-è®¿é—®è€…æ¨¡å¼-Visitor"><a href="#2-22-è®¿é—®è€…æ¨¡å¼-Visitor" class="headerlink" title="2.22 è®¿é—®è€…æ¨¡å¼-Visitor"></a>2.22 è®¿é—®è€…æ¨¡å¼-Visitor</h3><blockquote>
<p>å®šä¹‰</p>
</blockquote>
<p>å°†ä½œç”¨äºæŸç§æ•°æ®ç»“æ„ä¸­çš„å„å…ƒç´ çš„æ“ä½œåˆ†ç¦»å‡ºæ¥å°è£…æˆç‹¬ç«‹çš„ç±»ï¼Œä½¿å…¶åœ¨ä¸æ”¹å˜æ•°æ®ç»“æ„çš„å‰æä¸‹å¯ä»¥æ·»åŠ ä½œç”¨äºè¿™äº›å…ƒç´ çš„æ–°çš„æ“ä½œã€‚</p>
<blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<ul>
<li>æ‰©å±•æ€§å¥½</li>
<li>å¤ç”¨æ€§å¥½</li>
<li>çµæ´»æ€§å¥½</li>
<li>ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™</li>
</ul>
<blockquote>
<p>ç¼ºç‚¹</p>
</blockquote>
<ul>
<li>å¢åŠ æ–°çš„å…ƒç´ å¾ˆå›°éš¾</li>
<li>ç ´åå°è£…</li>
<li>è¿åäº†ä¾èµ–å€’ç½®åŸåˆ™</li>
</ul>
<blockquote>
<p>ç»“æ„</p>
</blockquote>
<ul>
<li>æŠ½è±¡è®¿é—®è€…(Visitor)ï¼šå®šä¹‰ä¸€ä¸ªè®¿é—®å…·ä½“å…ƒç´ çš„æ¥å£ï¼Œä¸ºæ¯ä¸ªå…·ä½“å…ƒç´ ç±»å¯¹åº”ä¸€ä¸ªè®¿é—®æ“ä½œvisit()ï¼Œè¯¥æ“ä½œä¸­çš„å‚æ•°ç±»å‹æ ‡è¯†äº†è¢«è®¿é—®çš„å…·ä½“å…ƒç´ ã€‚</li>
<li>å…·ä½“è®¿é—®è€…(Concrete Visitor)ï¼šå®ç°æŠ½è±¡è®¿é—®è€…è§’è‰²å£°æ˜çš„å„ä¸ªè®¿é—®æ“ä½œï¼Œç¡®å®šè®¿é—®è€…è®¿é—®ä¸€ä¸ªå…ƒç´ æ—¶è¯¥åšä»€ä¹ˆã€‚</li>
<li>æŠ½è±¡å…ƒç´ (Element)ï¼šå£°æ˜ä¸€ä¸ªåŒ…å«æ¥å—æ“ä½œaccept()çš„æ¥å£ï¼Œè¢«æ¥å—çš„è®¿é—®è€…å¯¹è±¡ä½œä¸ºaccept()çš„å‚æ•°ã€‚</li>
<li>å…·ä½“å…ƒç´ (Concrete Element)ï¼šå®ç°æŠ½è±¡å…ƒç´ è§’è‰²æä¾›çš„accept()æ“ä½œã€‚</li>
<li>å¯¹è±¡ç»“æ„(Object Structure)ï¼šåŒ…å«å…ƒç´ è§’è‰²çš„å®¹å™¨ï¼Œæä¾›è®©è®¿é—®è€…å¯¹è±¡éå†å®¹å™¨ä¸­çš„æ‰€æœ‰å…ƒç´ çš„æ–¹æ³•ã€‚</li>
</ul>
<blockquote>
<p>å®ç°</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.visitor.pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: DesignPattern &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.visitor.pattern &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: VisitorDemo &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: è®¿é—®è€…æ¨¡å¼ &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/11/8</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;æµ‹è¯•ç±»&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VisitorDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ObjectStructure structure = <span class="keyword">new</span> ObjectStructure();</span><br><span class="line">        structure.add(<span class="keyword">new</span> ConcreteElementA());</span><br><span class="line">        structure.add(<span class="keyword">new</span> ConcreteElementB());</span><br><span class="line">        structure.add(<span class="keyword">new</span> ConcreteElementC());</span><br><span class="line"></span><br><span class="line">        Visitor visitorA = <span class="keyword">new</span> ConcreteVisitorA();</span><br><span class="line">        Visitor visitorB = <span class="keyword">new</span> ConcreteVisitorB();</span><br><span class="line">        structure.accept(visitorA);</span><br><span class="line">        structure.accept(visitorB);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     æŠ½è±¡è®¿é—®è€…</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Visitor</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">visit</span><span class="params">(ConcreteElementA elementA)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">visit</span><span class="params">(ConcreteElementB elementB)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">visit</span><span class="params">(ConcreteElementC elementC)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“è®¿é—®è€…A</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteVisitorA</span> <span class="keyword">implements</span> <span class="title">Visitor</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(ConcreteVisitorA.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(ConcreteElementA elementA)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…·ä½“è®¿é—®è€…Aè®¿é—®=&gt;å…·ä½“å…ƒç´ A&quot;</span>);</span><br><span class="line">        elementA.operaA();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(ConcreteElementB elementB)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…·ä½“è®¿é—®è€…Aè®¿é—®=&gt;å…·ä½“å…ƒç´ B&quot;</span>);</span><br><span class="line">        elementB.operaB();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(ConcreteElementC elementC)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…·ä½“è®¿é—®è€…Aè®¿é—®=&gt;å…·ä½“å…ƒç´ C&quot;</span>);</span><br><span class="line">        elementC.operaC();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“è®¿é—®è€…B</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteVisitorB</span> <span class="keyword">implements</span> <span class="title">Visitor</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(ConcreteVisitorB.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(ConcreteElementA elementA)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…·ä½“è®¿é—®è€…Bè®¿é—®=&gt;å…·ä½“å…ƒç´ A&quot;</span>);</span><br><span class="line">        elementA.operaA();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(ConcreteElementB elementB)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…·ä½“è®¿é—®è€…Bè®¿é—®=&gt;å…·ä½“å…ƒç´ B&quot;</span>);</span><br><span class="line">        elementB.operaB();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(ConcreteElementC elementC)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…·ä½“è®¿é—®è€…Bè®¿é—®=&gt;å…·ä½“å…ƒç´ C&quot;</span>);</span><br><span class="line">        elementC.operaC();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     æŠ½è±¡å…ƒç´ ç±»</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Element</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor visitor)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“å…ƒç´ A</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteElementA</span> <span class="keyword">implements</span> <span class="title">Element</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(ConcreteElementA.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor visitor)</span> </span>&#123;</span><br><span class="line">        visitor.visit(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operaA</span><span class="params">()</span>  </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…·ä½“å…ƒç´ Aæ“ä½œ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“å…ƒç´ B</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteElementB</span> <span class="keyword">implements</span> <span class="title">Element</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(ConcreteElementB.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor visitor)</span> </span>&#123;</span><br><span class="line">        visitor.visit(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operaB</span><span class="params">()</span>  </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…·ä½“å…ƒç´ Bæ“ä½œ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å…·ä½“å…ƒç´ C</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteElementC</span> <span class="keyword">implements</span> <span class="title">Element</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(ConcreteElementC.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor visitor)</span> </span>&#123;</span><br><span class="line">        visitor.visit(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operaC</span><span class="params">()</span>  </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å…·ä½“å…ƒç´ Cæ“ä½œ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å¯¹è±¡ç»“æ„è§’è‰²</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ObjectStructure</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Element&gt; list = <span class="keyword">new</span> ArrayList&lt;Element&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor visitor)</span> </span>&#123;</span><br><span class="line">        Iterator&lt;Element&gt; iterator = list.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            iterator.next().accept(visitor);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Element element)</span> </span>&#123;</span><br><span class="line">        list.add(element);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(Element element)</span> </span>&#123;</span><br><span class="line">        list.remove(element);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="2-23-å¤‡å¿˜å½•æ¨¡å¼-Memento"><a href="#2-23-å¤‡å¿˜å½•æ¨¡å¼-Memento" class="headerlink" title="2.23 å¤‡å¿˜å½•æ¨¡å¼-Memento"></a>2.23 å¤‡å¿˜å½•æ¨¡å¼-Memento</h3><blockquote>
<p>å®šä¹‰</p>
</blockquote>
<p>åœ¨ä¸ç ´åå°è£…æ€§çš„å‰æä¸‹ï¼Œæ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¹‹å¤–ä¿å­˜è¿™ä¸ªçŠ¶æ€ï¼Œä»¥ä¾¿ä»¥åå½“éœ€è¦æ—¶èƒ½å°†è¯¥å¯¹è±¡æ¢å¤åˆ°åŸå…ˆä¿å­˜çš„çŠ¶æ€ã€‚</p>
<blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<ul>
<li>æä¾›äº†ä¸€ä¸ªå¯ä»¥æ¢å¤çŠ¶æ€çš„æœºåˆ¶</li>
<li>å®ç°å†…éƒ¨çŠ¶æ€çš„å°è£…</li>
<li>ç®€åŒ–äº†å‘èµ·äºº</li>
</ul>
<blockquote>
<p>ç¼ºç‚¹</p>
</blockquote>
<ul>
<li>èµ„æºæ¶ˆè€—å¤§</li>
</ul>
<blockquote>
<p>ç»“æ„</p>
</blockquote>
<ul>
<li>å‘èµ·äºº(Originator)ï¼šè®°å½•å½“å‰æ—¶åˆ»çš„å†…éƒ¨çŠ¶æ€ä¿¡æ¯ï¼Œæä¾›åˆ›å»ºå¤‡å¿˜å½•å’Œæ¢å¤å¤‡å¿˜å½•æ•°æ®çš„åŠŸèƒ½ï¼Œå®ç°å…¶ä»–ä¸šåŠ¡åŠŸèƒ½ï¼Œå®ƒå¯ä»¥è®¿é—®å¤‡å¿˜å½•é‡Œçš„æ‰€æœ‰ä¿¡æ¯ã€‚</li>
<li>å¤‡å¿˜å½•(Memento)ï¼šè´Ÿè´£å­˜å‚¨å‘èµ·äººçš„å†…éƒ¨çŠ¶æ€ï¼Œåœ¨éœ€è¦çš„æ—¶å€™æä¾›è¿™äº›å†…éƒ¨çŠ¶æ€ç»™å‘èµ·äººã€‚</li>
<li>ç®¡ç†è€…(Caretaker)ï¼šå¯¹å¤‡å¿˜å½•è¿›è¡Œç®¡ç†ï¼Œæä¾›ä¿å­˜ä¸è·å–å¤‡å¿˜å½•çš„åŠŸèƒ½ï¼Œä½†ä¸èƒ½å¯¹å¤‡å¿˜å½•è¿›è¡Œè®¿é—®ä¸ä¿®æ”¹ã€‚</li>
</ul>
<blockquote>
<p>å®ç°</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.memento.pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: DesignPattern &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.memento.pattern &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: MementoDemo &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: å¤‡å¿˜å½•æ¨¡å¼ &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/11/8</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;æµ‹è¯•ç±»&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MementoDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Logger log = Logger.getLogger(MementoDemo.class);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Originator originator = <span class="keyword">new</span> Originator();</span><br><span class="line">        Caretaker caretaker = <span class="keyword">new</span> Caretaker();</span><br><span class="line">        originator.setState(<span class="string">&quot;State1&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;åˆå§‹çŠ¶æ€ï¼š&quot;</span> + originator.getState());</span><br><span class="line">        <span class="comment">// ä¿å­˜çŠ¶æ€</span></span><br><span class="line">        caretaker.setMemento(originator.createMemento());</span><br><span class="line">        originator.setState(<span class="string">&quot;State2&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;æ–°çš„çŠ¶æ€ï¼š&quot;</span> + originator.getState());</span><br><span class="line">        <span class="comment">// æ¢å¤çŠ¶æ€</span></span><br><span class="line">        originator.restoreMemento(caretaker.getMemento());</span><br><span class="line">        log.info(<span class="string">&quot;æ¢å¤çŠ¶æ€ï¼š&quot;</span> + originator.getState());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å¤‡å¿˜å½•</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Memento</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String state;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Memento</span><span class="params">(String state)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setState</span><span class="params">(String state)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     å‘èµ·äºº</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Originator</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String state;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setState</span><span class="params">(String state)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Memento <span class="title">createMemento</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Memento(state);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">restoreMemento</span><span class="params">(Memento memento)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(memento.getState());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     ç®¡ç†è€…</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Caretaker</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Memento memento;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Memento <span class="title">getMemento</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> memento;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMemento</span><span class="params">(Memento memento)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.memento = memento;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-24-è§£é‡Šå™¨æ¨¡å¼-Interpreter"><a href="#2-24-è§£é‡Šå™¨æ¨¡å¼-Interpreter" class="headerlink" title="2.24 è§£é‡Šå™¨æ¨¡å¼-Interpreter"></a>2.24 è§£é‡Šå™¨æ¨¡å¼-Interpreter</h3><blockquote>
<p>å®šä¹‰</p>
</blockquote>
<p>ç»™åˆ†æå¯¹è±¡å®šä¹‰ä¸€ä¸ªè¯­è¨€ï¼Œå¹¶å®šä¹‰è¯¥è¯­è¨€çš„æ–‡æ³•è¡¨ç¤ºï¼Œå†è®¾è®¡ä¸€ä¸ªè§£æå™¨æ¥è§£é‡Šå…¶ä¸­çš„å¥å­ã€‚</p>
<blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<ul>
<li>æ‰©å±•æ€§å¥½</li>
<li>å®¹æ˜“å®ç°</li>
</ul>
<blockquote>
<p>ç¼ºç‚¹</p>
</blockquote>
<ul>
<li>æ‰§è¡Œæ•ˆç‡è¾ƒä½</li>
<li>ä¼šå¼•èµ·ç±»è†¨èƒ€</li>
<li>å¯åº”ç”¨çš„åœºæ™¯æ¯”è¾ƒå°‘</li>
</ul>
<blockquote>
<p>ç»“æ„</p>
</blockquote>
<ul>
<li>æŠ½è±¡è¡¨è¾¾å¼(Abstract Expression)ï¼šå®šä¹‰è§£é‡Šå™¨çš„æ¥å£ï¼Œçº¦å®šè§£é‡Šå™¨çš„è§£é‡Šæ“ä½œï¼Œä¸»è¦åŒ…å«è§£é‡Šæ–¹æ³•interpret()ã€‚</li>
<li>ç»ˆç»“ç¬¦è¡¨è¾¾å¼(Terminal Expression)ï¼šæŠ½è±¡è¡¨è¾¾å¼çš„å­ç±»ï¼Œç”¨æ¥å®ç°æ–‡æ³•ä¸­ä¸ç»ˆç»“ç¬¦ç›¸å…³çš„æ“ä½œï¼Œæ–‡æ³•ä¸­çš„æ¯æ¡ä¸€ä¸ªç»ˆç»“ç¬¦éƒ½å¯¹åº”äºä¸€ä¸ªéç»ˆç»“ç¬¦è¡¨è¾¾å¼ã€‚</li>
<li>éç»ˆç»“ç¬¦è¡¨è¾¾å¼(Terminal Expression)ï¼šæŠ½è±¡è¡¨è¾¾å¼çš„å­ç±»ï¼Œç”¨æ¥å®ç°æ–‡æ³•ä¸­ä¸éç»ˆç»“ç¬¦ç›¸å…³çš„æ“ä½œï¼Œæ–‡æ³•ä¸­çš„æ¯æ¡è§„åˆ™éƒ½å¯¹åº”äºä¸€ä¸ªéç»ˆç»“ç¬¦è¡¨è¾¾å¼ã€‚</li>
<li>ç¯å¢ƒ(Context)ï¼šé€šå¸¸åŒ…å«å„ä¸ªè§£é‡Šå™¨éœ€è¦çš„æ•°æ®æˆ–æ˜¯å…¬å…±çš„åŠŸèƒ½ï¼Œä¸€èˆ¬ç”¨æ¥ä¼ é€’è¢«æ‰€æœ‰è§£é‡Šå™¨å…±äº«çš„æ•°æ®ï¼Œåå¼€ä½ çš„è§£é‡Šå™¨å¯ä»¥ä»è¿™é‡Œè·å–è¿™äº›å€¼ã€‚</li>
<li>å®¢æˆ·ç«¯(Client)ï¼šä¸»è¦ä»»åŠ¡æ˜¯å°†éœ€è¦åˆ†æçš„å¥å­æˆ–è¡¨è¾¾å¼è½¬æ¢æˆä½¿ç”¨è§£é‡Šå™¨å¯¹è±¡æè¿°çš„æŠ½è±¡è¯­æ³•æ ‘ï¼Œç„¶åè°ƒç”¨è§£é‡Šå™¨çš„è§£é‡Šæ–¹æ³•ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡ç¯å¢ƒè§’è‰²é—´æ¥è®¿é—®è§£é‡Šå™¨çš„è§£é‡Šæ–¹æ³•ã€‚</li>
</ul>
<blockquote>
<p>å®ç°</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.interpreter.pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Project: DesignPattern &lt;/P&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Package: top.parak.interpreter.pattern &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; FileName: InterpreterDemo &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Description: è§£é‡Šå™¨æ¨¡å¼ &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; Created By IntelliJ IDEA &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020/11/8</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     æµ‹è¯•ç±»</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InterpreterDemo</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     æŠ½è±¡è¡¨è¾¾å¼</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">AbstractExpression</span> </span>&#123;</span><br><span class="line">    <span class="function">Object <span class="title">interpret</span><span class="params">(String info)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     ç»ˆç»“ç¬¦è¡¨è¾¾å¼ç±»</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TerminalExpression</span> <span class="keyword">implements</span> <span class="title">AbstractExpression</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">interpret</span><span class="params">(String info)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/* å¯¹ç»ˆç»“ç¬¦è¡¨è¾¾å¼çš„å¤„ç† */</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     éç»ˆç»“ç¬¦è¡¨è¾¾å¼ç±»</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NonTerminalExpression</span> <span class="keyword">implements</span> <span class="title">AbstractExpression</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">interpret</span><span class="params">(String info)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/* å¯¹éç»ˆç»“ç¬¦è¡¨è¾¾å¼çš„å¤„ç† */</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     ç¯å¢ƒç±»</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Context</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> AbstractExpression abstractExpression;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Context</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">/* æ•°æ®åˆå§‹åŒ– */</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">(String info)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/* è°ƒç”¨ç›¸å…³è¡¨è¾¾å¼çš„è§£é‡Šæ–¹æ³• */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Design Pattern</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Design Pattern</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis</title>
    <url>/2020/10/08/Redis/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><center>
    <font face="Kristen ITC" color="#555555" font-size=100px>ğŸ’Œ Khighness ğŸ’Œ</font><br>
</center>

<p>[TOC]</p>
<h2 id="1-ğŸ“©NoSQLæ¦‚è¿°"><a href="#1-ğŸ“©NoSQLæ¦‚è¿°" class="headerlink" title="1. ğŸ“©NoSQLæ¦‚è¿°"></a>1. ğŸ“©NoSQLæ¦‚è¿°</h2><h3 id="1-1-ğŸ“ƒç®€ä»‹"><a href="#1-1-ğŸ“ƒç®€ä»‹" class="headerlink" title="1.1 ğŸ“ƒç®€ä»‹"></a>1.1 ğŸ“ƒç®€ä»‹</h3><blockquote>
<p>âš¡ NoSQL</p>
<p>NoSQL != éSQL </p>
<p>NoSQL == Not Only SQL</p>
<p>ä¸ä»…ä»…æ˜¯SQLï¼</p>
</blockquote>
<p>æ³›æŒ‡éå…³ç³»å‹çš„æ•°æ®åº“ã€‚å…‹æœå¤§å¹¶å‘ã€‚</p>
<p>å¾ˆå¤šçš„æ•°æ®ç±»å‹ï¼Œç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ã€ç¤¾äº¤ç½‘ç»œå’Œåœ°ç†ä½ç½®ï¼Œè¿™äº›æ•°æ®ç±»å‹çš„å­˜å‚¨ä¸éœ€è¦ä¸€ä¸ªå›ºå®šçš„æ ¼å¼ï¼Œä¸éœ€è¦å¤šå…ƒçš„æ“ä½œå°±å¯ä»¥æ¨ªå‘æ‰©å±•ã€‚</p>
<h3 id="1-2-ğŸŒ€ç‰¹ç‚¹"><a href="#1-2-ğŸŒ€ç‰¹ç‚¹" class="headerlink" title="1.2 ğŸŒ€ç‰¹ç‚¹"></a>1.2 ğŸŒ€ç‰¹ç‚¹</h3><ul>
<li><p>æ–¹ä¾¿æ‰©å±•ï¼ˆæ•°æ®ä¹‹é—´æ²¡æœ‰å…³ç³»ï¼Œå¾ˆå¥½æ‰©å±•ï¼‰</p>
</li>
<li><p>å¤§æ•°æ®é‡é«˜æ€§èƒ½ï¼ˆç»†ç²’åº¦ç¼“å­˜ï¼Œæ€§èƒ½é«˜ï¼‰</p>
</li>
<li><p>æ•°æ®ç±»å‹å¤šæ ·ï¼ˆä¸éœ€è¦è®¾è®¡æ•°æ®åº“ï¼Œéšå–éšç”¨ï¼‰</p>
</li>
<li><p>RDBMSå’ŒNoSQLçš„åŒºåˆ«: </p>
<ul>
<li>RDBMS<ul>
<li>ç»“æ„åŒ–ç»„ç»‡</li>
<li>SQL</li>
<li>æ•°æ®å’Œå…³ç³»éƒ½å­˜åœ¨å•ç‹¬çš„è¡¨ä¸­</li>
<li>ä¸¥æ ¼çš„ä¸€è‡´æ€§</li>
<li>åŸºç¡€çš„äº‹åŠ¡</li>
<li>Â·Â·Â·</li>
</ul>
</li>
<li>NoSQL<ul>
<li>ä¸ä»…ä»…æ˜¯æ•°æ®</li>
<li>æ²¡æœ‰å›ºå®šçš„æŸ¥è¯¢è¯­è¨€</li>
<li>é”®å€¼å¯¹å­˜å‚¨ï¼Œåˆ—å­˜å‚¨ï¼Œæ–‡æ¡£å­˜å‚¨ï¼Œå›¾å½¢å­˜å‚¨</li>
<li>æœ€ç»ˆä¸€è‡´æ€§</li>
<li>CAPå’ŒBASE</li>
<li>ä¸‰é«˜ï¼šé«˜æ€§èƒ½ã€é«˜å¯ç”¨ã€é«˜å¯æ‰©å±•</li>
<li>Â·Â·Â·</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="1-3-ğŸš€3V-3H"><a href="#1-3-ğŸš€3V-3H" class="headerlink" title="1.3 ğŸš€3V+3H"></a>1.3 ğŸš€3V+3H</h3><ul>
<li>å¤§æ•°æ®æ—¶ä»£çš„3V<ul>
<li>æµ·é‡ Volume</li>
<li>å¤šæ · Variety</li>
<li>å®æ—¶ Velocity</li>
</ul>
</li>
<li>äº’è”ç½‘éœ€æ±‚çš„3H<ul>
<li>é«˜å¹¶å‘ High concurrency</li>
<li>é«˜å¯æ‹“ High scalable</li>
<li>é«˜æ€§èƒ½ High performance</li>
</ul>
</li>
</ul>
<h3 id="1-4-ğŸ“šåˆ†ç±»"><a href="#1-4-ğŸ“šåˆ†ç±»" class="headerlink" title="1.4 ğŸ“šåˆ†ç±»"></a>1.4 ğŸ“šåˆ†ç±»</h3><blockquote>
<p>ğŸ˜­å‘œå‘œå‘œï¼Œæˆ‘å¥½èœï¼Œæˆ‘å•¥éƒ½ä¸ä¼šğŸ¼</p>
</blockquote>
<table>
<thead>
<tr>
<th>åˆ†ç±»</th>
<th>ä¸¾ä¾‹</th>
<th>å…¸å‹åº”ç”¨åœºæ™¯</th>
<th>æ•°æ®æ¨¡å‹</th>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
</tr>
</thead>
<tbody><tr>
<td>é”®å€¼å¯¹</td>
<td>Tokyo Cabinet/Tyrantï¼ŒRedisï¼ŒVoldemortï¼ŒOracle BDB</td>
<td>å†…å®¹UANï¼Œä¸»è¦ç”¨äºå¤„ç†å¤§é‡æ•°æ®çš„é«˜è®¿é—®è´Ÿè½½ï¼Œä¹Ÿç”¨äºä¸€äº›æ—¥å¿—ç³»ç»Ÿç­‰ç­‰</td>
<td>KeyæŒ‡å‘valueçš„é”®å€¼å¯¹ï¼Œé€šå¸¸ç”¨hash tableæ¥å®ç°</td>
<td>æŸ¥æ‰¾é€Ÿåº¦å¿«</td>
<td>æ•°æ®æ— ç»“æ„åŒ–ï¼Œé€šå¸¸åªè¢«å½“åšå­—ç¬¦ä¸²æˆ–è€…äºŒè¿›åˆ¶æ•°æ®</td>
</tr>
<tr>
<td>åˆ—å­˜å‚¨æ•°æ®åº“</td>
<td>Cassandraï¼ŒHBaseï¼ŒRiak</td>
<td>åˆ†å¸ƒå¼çš„æ–‡ä»¶ç³»ç»Ÿ</td>
<td>ä»¥åˆ—ç°‡å¼å­˜å‚¨ï¼Œå°†åŒä¸€åˆ—æ•°æ®å­˜åœ¨ä¸€èµ·</td>
<td>æŸ¥æ‰¾é€Ÿåº¦å¿«ï¼Œå¯æ‰©å±•æ€§å¼ºï¼Œæ›´å®¹æ˜“è¿›è¡Œåˆ†å¸ƒå¼æ‰©å±•</td>
<td>åŠŸèƒ½ç›¸å¯¹å±€é™</td>
</tr>
<tr>
<td>æ–‡æ¡£å‹æ•°æ®åº“</td>
<td>CouchDBï¼ŒMongoDB</td>
<td>Webåº”ç”¨</td>
<td>Key-Valueå¯¹åº”çš„é”®å€¼å¯¹ï¼ŒValueä¸ºç»“æ„åŒ–æ•°æ®</td>
<td>æ•°æ®ç»“æ„è¦æ±‚ä¸ä¸¥æ ¼ï¼Œè¡¨ç»“æ„å¯å˜ï¼Œä¸éœ€è¦åƒå…³ç³»å‹æ•°æ®åº“ä¸€æ ·éœ€è¦é¢„å…ˆå®šä¹‰è¡¨ç»“æ„</td>
<td>æŸ¥è¯¢æ€§èƒ½ä¸é«˜ï¼Œè€Œä¸”ç¼ºä¹ç»Ÿä¸€çš„æŸ¥è¯¢è¯­è¨€</td>
</tr>
<tr>
<td>å›¾å½¢æ•°æ®åº“</td>
<td>Neo4Jï¼ŒInfoGridï¼ŒInfinite Graph</td>
<td>ç¤¾äº¤ç½‘ç»œã€æ¨èç³»ç»Ÿç­‰ç­‰ï¼Œä¸“æ³¨äºæ„å»ºå…³ç³»å›¾è°±</td>
<td>å›¾ç»“æ„</td>
<td>åˆ©ç”¨å›¾ç»“æ„ç›¸å…³ç®—æ³•ã€‚æ¯”å¦‚æœ€çŸ­è·¯å¾„å¯»å€ï¼ŒNåº¦å…³ç³»æŸ¥æ‰¾ç­‰</td>
<td>å¾ˆå¤šæ—¶å€™éœ€è¦å¯¹æ•´ä¸ªå›¾åšè®¡ç®—æ‰èƒ½å¾—å‡ºéœ€è¦çš„ä¿¡æ¯ï¼Œè€Œä¸”è¿™ç§ç»“æ„ä¸å¤ªå¥½åšåˆ†å¸ƒå¼çš„é›†ç¾¤æ–¹æ¡ˆ</td>
</tr>
</tbody></table>
<h3 id="1-5-ğŸ“ˆé˜¿é‡Œå·´æŠ€æœ¯æ¼”è¿›"><a href="#1-5-ğŸ“ˆé˜¿é‡Œå·´æŠ€æœ¯æ¼”è¿›" class="headerlink" title="1.5 ğŸ“ˆé˜¿é‡Œå·´æŠ€æœ¯æ¼”è¿›"></a>1.5 ğŸ“ˆé˜¿é‡Œå·´æŠ€æœ¯æ¼”è¿›</h3><blockquote>
<p>âœ¡æŠ€æœ¯å¹¶æ— é«˜ä½ä¹‹åˆ†ï¼Œå°±çœ‹ä½ å¦‚ä½•ä½¿ç”¨</p>
</blockquote>
<img src="/2020/10/08/Redis/image-20201009144812661.png" class="" title="image-20201009144812661.png">

<img src="/2020/10/08/Redis/image-20201009145619674.png" class="" title="image-20201009145619674.png">

<img src="/2020/10/08/Redis/image-20201009153115683.png" class="" title="image-20201009153115683.png">

<img src="/2020/10/08/Redis/image-20201009153346176.png" class="" title="image-20201009153346176.png">





<h2 id="2-ğŸ“©Rediså…¥é—¨"><a href="#2-ğŸ“©Rediså…¥é—¨" class="headerlink" title="2. ğŸ“©Rediså…¥é—¨"></a>2. ğŸ“©Rediså…¥é—¨</h2><blockquote>
<p> ğŸŒ official website</p>
</blockquote>
<ul>
<li><p>è‹±æ–‡å®˜ç½‘ï¼š<a href="https://www.redis.io/">redis</a></p>
</li>
<li><p>ä¸­æ–‡å®˜ç½‘ï¼š<del><a href="https://www.redis.cn/">redis</a></del></p>
</li>
<li><p>ä¸­æ–‡å®˜ç½‘ï¼š<a href="https://www.redis.net.cn/">redis</a></p>
</li>
</ul>
<h3 id="2-1-ğŸ“‘ç®€ä»‹"><a href="#2-1-ğŸ“‘ç®€ä»‹" class="headerlink" title="2.1 ğŸ“‘ç®€ä»‹"></a>2.1 ğŸ“‘ç®€ä»‹</h3><blockquote>
<p>ğŸ’¡ Redis = Remote Dictionary Server</p>
</blockquote>
<p>Redis æ˜¯ä¸€ä¸ªå¼€æºï¼ˆBSDè®¸å¯ï¼‰çš„ï¼Œå†…å­˜ä¸­çš„æ•°æ®ç»“æ„å­˜å‚¨ç³»ç»Ÿï¼Œå®ƒå¯ä»¥ç”¨ä½œæ•°æ®åº“ã€ç¼“å­˜å’Œæ¶ˆæ¯ä¸­é—´ä»¶ã€‚ å®ƒæ”¯æŒå¤šç§ç±»å‹çš„æ•°æ®ç»“æ„ï¼Œå¦‚ <a href="http://redis.cn/topics/data-types-intro.html#strings">å­—ç¬¦ä¸²ï¼ˆstringsï¼‰</a>ï¼Œ <a href="http://redis.cn/topics/data-types-intro.html#hashes">æ•£åˆ—ï¼ˆhashesï¼‰</a>ï¼Œ <a href="http://redis.cn/topics/data-types-intro.html#lists">åˆ—è¡¨ï¼ˆlistsï¼‰</a>ï¼Œ <a href="http://redis.cn/topics/data-types-intro.html#sets">é›†åˆï¼ˆsetsï¼‰</a>ï¼Œ <a href="http://redis.cn/topics/data-types-intro.html#sorted-sets">æœ‰åºé›†åˆï¼ˆsorted setsï¼‰</a> ä¸èŒƒå›´æŸ¥è¯¢ï¼Œ <a href="http://redis.cn/topics/data-types-intro.html#bitmaps">bitmaps</a>ï¼Œ <a href="http://redis.cn/topics/data-types-intro.html#hyperloglogs">hyperloglogs</a> å’Œ <a href="http://redis.cn/commands/geoadd.html">åœ°ç†ç©ºé—´ï¼ˆgeospatialï¼‰</a> ç´¢å¼•åŠå¾„æŸ¥è¯¢ã€‚ Redis å†…ç½®äº† <a href="http://redis.cn/topics/replication.html">å¤åˆ¶ï¼ˆreplicationï¼‰</a>ï¼Œ<a href="http://redis.cn/commands/eval.html">LUAè„šæœ¬ï¼ˆLua scriptingï¼‰</a>ï¼Œ <a href="http://redis.cn/topics/lru-cache.html">LRUé©±åŠ¨äº‹ä»¶ï¼ˆLRU evictionï¼‰</a>ï¼Œ<a href="http://redis.cn/topics/transactions.html">äº‹åŠ¡ï¼ˆtransactionsï¼‰</a> å’Œä¸åŒçº§åˆ«çš„ <a href="http://redis.cn/topics/persistence.html">ç£ç›˜æŒä¹…åŒ–ï¼ˆpersistenceï¼‰</a>ï¼Œ å¹¶é€šè¿‡ <a href="http://redis.cn/topics/sentinel.html">Rediså“¨å…µï¼ˆSentinelï¼‰</a>å’Œè‡ªåŠ¨ <a href="http://redis.cn/topics/cluster-tutorial.html">åˆ†åŒºï¼ˆClusterï¼‰</a>æä¾›é«˜å¯ç”¨æ€§ï¼ˆhigh availabilityï¼‰^(æ¥è‡ªå®˜æ–¹æ–‡æ¡£)^ã€‚</p>
<h3 id="2-2-ğŸŒ ç‰¹æ€§"><a href="#2-2-ğŸŒ ç‰¹æ€§" class="headerlink" title="2.2 ğŸŒ ç‰¹æ€§"></a>2.2 ğŸŒ ç‰¹æ€§</h3><ul>
<li><input checked="" disabled="" type="checkbox"> æ€§èƒ½ä¼˜ç§€ï¼Œæ•°æ®åœ¨å†…å­˜ä¸­ï¼Œè¯»å†™é€Ÿåº¦éå¸¸å¿«ï¼Œæ”¯æŒ10wå¹¶å‘QPS</li>
<li><input checked="" disabled="" type="checkbox"> å•è¿›ç¨‹å•çº¿ç¨‹ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œé‡‡ç”¨IOå¤šè·¯å¤ç”¨æœºåˆ¶</li>
<li><input checked="" disabled="" type="checkbox"> ä¸°å¯Œçš„æ•°æ®ç±»å‹ï¼Œæ”¯æŒStringã€Hashã€Listã€Setã€Sorted Set</li>
<li><input checked="" disabled="" type="checkbox"> æ”¯æŒæ•°æ®æŒä¹…åŒ–ï¼Œå¯ä»¥å°†å†…å­˜ä¸­æ•°æ®ä¿å­˜åœ¨ç£ç›˜ä¸­ï¼Œé‡å¯æ—¶åŠ è½½</li>
<li><input checked="" disabled="" type="checkbox"> ä¸»ä»å¤åˆ¶ï¼Œå“¨å…µæ¨¡å¼ï¼Œé«˜å¯ç”¨</li>
<li><input checked="" disabled="" type="checkbox"> å¯ä»¥ç”¨ä½œåˆ†å¸ƒå¼é”</li>
<li><input checked="" disabled="" type="checkbox"> å¯ä»¥è¿›è¡Œåœ°å›¾ä¿¡æ¯åˆ†æ</li>
<li><input checked="" disabled="" type="checkbox"> å¯ä»¥ä½œä¸ºæ¶ˆæ¯ä¸­é—´ä»¶ä½¿ç”¨ï¼Œæ”¯æŒå‘å¸ƒè®¢é˜…</li>
<li><input checked="" disabled="" type="checkbox"> å¯ä»¥ä½œä¸ºè®¡æ•°å™¨ä½¿ç”¨ï¼Œè®°å½•ç½‘é¡µæˆ–è€…å°ç¨‹åºç­‰çš„æµè§ˆé‡</li>
<li><input checked="" disabled="" type="checkbox"> Â·Â·Â·Â·Â·Â·</li>
</ul>
<h3 id="2-3-ğŸ”°æ‹“å±•"><a href="#2-3-ğŸ”°æ‹“å±•" class="headerlink" title="2.3 ğŸ”°æ‹“å±•"></a>2.3 ğŸ”°æ‹“å±•</h3><blockquote>
<p>Redis ğŸ†š Memcache</p>
</blockquote>
<ol>
<li>å­˜å‚¨æ–¹å¼ä¸Šï¼šmemcacheä¼šæŠŠæ•°æ®å…¨éƒ¨å­˜åœ¨å†…å­˜ä¹‹ä¸­ï¼Œæ–­ç”µåä¼šæŒ‚æ‰ï¼Œæ•°æ®ä¸èƒ½è¶…è¿‡å†…å­˜å¤§å°ã€‚redisæœ‰éƒ¨åˆ†æ•°æ®å­˜åœ¨ç¡¬ç›˜ä¸Šï¼Œè¿™æ ·èƒ½ä¿è¯æ•°æ®çš„æŒä¹…æ€§</li>
<li>æ•°æ®æ”¯æŒç±»å‹ä¸Šï¼šmemcacheå¯¹æ•°æ®ç±»å‹çš„æ”¯æŒç®€å•ï¼Œåªæ”¯æŒç®€å•çš„key-valueï¼Œè€Œredisæ”¯æŒäº”å¤§æ•°æ®ç±»å‹å’Œä¸‰å¤§ç‰¹æ®Šæ•°æ®ç±»å‹</li>
<li>åº•å±‚æ¨¡å‹ä¸Šï¼šå®ƒä»¬ä¹‹é—´åº•å±‚å®ç°æ–¹å¼ä»¥åŠä¸å®¢æˆ·ç«¯ä¹‹é—´çš„åº”ç”¨åè®®ä¸ä¸€æ ·ã€‚redisç›´æ¥æ„å»ºäº†VMæœºåˆ¶ï¼Œå› ä¸ºä¸€èˆ¬çš„ç³»ç»Ÿè°ƒç”¨ç³»ç»Ÿå‡½æ•°çš„è¯ï¼Œä¼šæµªè´¹ä¸€å®šçš„æ—¶é—´å»ç§»åŠ¨å’Œè¯·æ±‚</li>
<li>valueçš„å¤§å°ï¼šrediså¯ä»¥è¾¾åˆ°1GBï¼Œè€Œmemcacheåªæœ‰1MB</li>
</ol>
<h2 id="3-ğŸ“©Rediså®‰è£…"><a href="#3-ğŸ“©Rediså®‰è£…" class="headerlink" title="3. ğŸ“©Rediså®‰è£…"></a>3. ğŸ“©Rediså®‰è£…</h2><blockquote>
<p>âš ï¸ notice</p>
</blockquote>
<ul>
<li><p>Githubä¸Šredisçš„windowsç‰ˆæœ¬å·²ç»å¾ˆä¹…ä¸å†æ›´æ–°ï¼Œå¯¹äºæœ€æ–°çš„3.2.100ç‰ˆæœ¬ï¼Œä¸ªäººä½¿ç”¨è¿‡ï¼Œredis-cli.exeä½¿ç”¨èµ·æ¥å¶å°”ä¼šå‡ºé—®é¢˜ï¼Œå‘½ä»¤å†™å‡ºæ¥é‚£ä¸€è¡Œä¼šå˜æˆé»‘è‰²ï¼Œå…¼å®¹æ€§ä¸å¤ªå¥½ï¼Œç”±äº3.0ä¸æ”¯æŒGEOç­‰æ“ä½œï¼Œæˆ‘è¿˜æ˜¯é€‰æ‹©ä½¿ç”¨3.2.100ç‰ˆæœ¬ã€‚</p>
</li>
<li><p>Redisè¿™ç§é«˜æ€§èƒ½æœåŠ¡å™¨æœ¬èº«ä¸CentOSçš„ä½“è´¨å°±å¾ˆèˆ¬é…ï¼Œä¸ªäººæ¨èåœ¨Linuxä¸Šå®‰è£…ï¼Œå°¤å…¶æ˜¯åæœŸæ­å»ºredisé›†ç¾¤ç¯å¢ƒã€‚CentOS7æœ¬èº«è‡ªå¸¦çš„yumé•œåƒä¸­å¸¦çš„gccå®‰è£…åŒ…åªæœ‰4.8.5ç‰ˆæœ¬ï¼Œä¸æ”¯æŒé«˜ç‰ˆæœ¬redisçš„ç¼–è¯‘ï¼Œæ‰€ä»¥æ¨èä¸‹è½½5.0.8ç‰ˆæœ¬ã€‚</p>
</li>
<li><p>ä»¥ä¸Šï¼Œä¸ç®¡æ˜¯Windowsè¿˜æ˜¯Linuxï¼Œéƒ½æ¨èä½¿ç”¨Xshellå¼€å¯RedisæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚</p>
</li>
</ul>
<blockquote>
<p>ğŸ”½Xshell</p>
</blockquote>
<ul>
<li>ç½‘ç›˜é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1qWtPzJgF3N24yIlUfTtq9w">https://pan.baidu.com/s/1qWtPzJgF3N24yIlUfTtq9w</a></li>
<li>æå–ç ï¼škkkk</li>
</ul>
<h3 id="3-1-ğŸ’»Windows10-å®‰è£…"><a href="#3-1-ğŸ’»Windows10-å®‰è£…" class="headerlink" title="3.1 ğŸ’»Windows10 å®‰è£…"></a>3.1 ğŸ’»Windows10 å®‰è£…</h3><blockquote>
<p>ä¸‹è½½: <a href="https://github.com/MSOpenTech/redis/releases">redis</a></p>
</blockquote>
<img src="/2020/10/08/Redis/image-20201008213905860.png" class="" title="image-20201008213905860">

<blockquote>
<p>è§£å‹</p>
</blockquote>
<img src="/2020/10/08/Redis/image-20201008214011620.png" class="" title="image-20201008214011620">

<blockquote>
<p>å¯åŠ¨</p>
</blockquote>
<img src="/2020/10/08/Redis/image-20201008214053586.png" class="" title="image-20201008214053586">



<h3 id="3-2-ğŸ’»CentOS7-å®‰è£…"><a href="#3-2-ğŸ’»CentOS7-å®‰è£…" class="headerlink" title="3.2 ğŸ’»CentOS7 å®‰è£…"></a>3.2 ğŸ’»CentOS7 å®‰è£…</h3><blockquote>
<p>å®‰è£…gcc: <code>yum install gcc-c++ tcl</code></p>
<p>æ³¨æ„å®‰è£… version&gt;6 çš„rediséœ€è¦ version&gt;5 çš„gcc: </p>
<p><code>sudo yum install centos-release-scl</code><br><code>sudo yum install devtoolset-7-gcc*</code><br><code>scl enable devtoolset-7 bash</code></p>
</blockquote>
<img src="/2020/10/08/Redis/image-20201008224757570.png" class="" title="image-20201008224757570">

<blockquote>
<p>ä¸‹è½½å‹ç¼©åŒ…: <code>wget http://download.redis.io/releases/redis-5.0.8.tar.gz</code></p>
</blockquote>
<img src="/2020/10/08/Redis/image-20201008223909191.png" class="" title="image-20201008223909191">

<blockquote>
<p>è§£å‹å‹ç¼©åŒ…: <code>tar xzf redis-5.0.8.tar.gz</code></p>
</blockquote>
<img src="/2020/10/08/Redis/image-20201008224102401.png" class="" title="image-20201008224102401">

<blockquote>
<p>è·³è½¬ç›®å½•: <code>cd redis-5.0.8</code>    </p>
</blockquote>
<img src="/2020/10/08/Redis/image-20201008215145306.png" class="" title="image-20201008215145306">

<blockquote>
<p>ç¼–è¯‘å®‰è£…: <code>make</code></p>
</blockquote>
<img src="/2020/10/08/Redis/image-20201008215335902.png" class="" title="image-20201008215335902">

<img src="/2020/10/08/Redis/image-20201008224230979.png" class="" title="image-20201008224230979">

<blockquote>
<p>å†æ¬¡ç¼–è¯‘: <code>make</code></p>
</blockquote>
<img src="/2020/10/08/Redis/image-20201008224450296.png" class="" title="image-20201008224450296">

<blockquote>
<p>æœ€åå®‰è£…: </p>
<p><code>cd src/</code></p>
<p><code>make install</code></p>
</blockquote>
<img src="/2020/10/08/Redis/image-20201008230537427.png" class="" title="image-20201008230537427">

<blockquote>
<p>æŸ¥çœ‹ç»“æœ: <code>ll /usr/local/bin/</code></p>
</blockquote>
<img src="/2020/10/08/Redis/image-20201008230723447.png" class="" title="image-20201008230723447">

<blockquote>
<p>æ›´æ”¹é…ç½®:</p>
<p>æ–°å»ºé…ç½®æ–‡ä»¶ç›®å½•: <code>mkdir kconfig</code>   </p>
<p>å°†åŸç”ŸRedisé…ç½®æ–‡ä»¶å¤åˆ¶è¿›æ¥: <code>cp /home/parak/Redis/redis-5.0.8/redis.conf </code></p>
<p>ä¿®æ”¹é…ç½®æ–‡ä»¶: <code>gedit redis.conf</code> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">daemonize yes</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>æµ‹è¯•å¯åŠ¨: <code>redis-server kconfig/redis.conf</code></p>
</blockquote>
<img src="/2020/10/08/Redis/image-20201009105138976.png" class="" title="image-20201009105138976">

<blockquote>
<p>æŸ¥çœ‹redisè¿›ç¨‹: <code>ps -ef | grep redis</code></p>
</blockquote>
<img src="/2020/10/08/Redis/image-20201009105424943.png" class="" title="image-20201009105424943">

<blockquote>
<p>å…³é—­redisæœåŠ¡: <code>shutdown</code></p>
</blockquote>
<img src="/2020/10/08/Redis/image-20201009105552015.png" class="" title="image-20201009105552015">



<h2 id="4-ğŸ“©Redisé…ç½®"><a href="#4-ğŸ“©Redisé…ç½®" class="headerlink" title="4. ğŸ“©Redisé…ç½®"></a>4. ğŸ“©Redisé…ç½®</h2><h3 id="4-1-ğŸš©å‘½ä»¤"><a href="#4-1-ğŸš©å‘½ä»¤" class="headerlink" title="4.1 ğŸš©å‘½ä»¤"></a>4.1 ğŸš©å‘½ä»¤</h3><blockquote>
<p>ğŸ‘€æŸ¥çœ‹æ‰€æœ‰é…ç½®é¡¹</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">config get *</span><br></pre></td></tr></table></figure>

<blockquote>
<p>âœå‘½ä»¤è¡Œç¼–è¾‘é…ç½®</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">config set &lt;option&gt; &lt;value&gt;</span><br></pre></td></tr></table></figure>



<h3 id="4-2-ğŸ“redis-conf-é…ç½®é¡¹è¯´æ˜"><a href="#4-2-ğŸ“redis-conf-é…ç½®é¡¹è¯´æ˜" class="headerlink" title="4.2 ğŸ“redis.conf é…ç½®é¡¹è¯´æ˜"></a>4.2 ğŸ“redis.conf é…ç½®é¡¹è¯´æ˜</h3><table>
<thead>
<tr>
<th align="left">åºå·</th>
<th align="left">é…ç½®é¡¹</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><code>daemonize no</code></td>
<td align="left">Redis é»˜è®¤ä¸æ˜¯ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œï¼Œå¯ä»¥é€šè¿‡è¯¥é…ç½®é¡¹ä¿®æ”¹ï¼Œä½¿ç”¨ yes å¯ç”¨å®ˆæŠ¤è¿›ç¨‹ï¼ˆWindows ä¸æ”¯æŒå®ˆæŠ¤çº¿ç¨‹çš„é…ç½®ä¸º no ï¼‰</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><code>pidfile /var/run/redis.pid</code></td>
<td align="left">å½“ Redis ä»¥å®ˆæŠ¤è¿›ç¨‹æ–¹å¼è¿è¡Œæ—¶ï¼ŒRedis é»˜è®¤ä¼šæŠŠ pid å†™å…¥ /var/run/redis.pid æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ pidfile æŒ‡å®š</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><code>port 6379</code></td>
<td align="left">æŒ‡å®š Redis ç›‘å¬ç«¯å£ï¼Œé»˜è®¤ç«¯å£ä¸º 6379</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><code>bind 127.0.0.1</code></td>
<td align="left">ç»‘å®šçš„ä¸»æœºåœ°å€</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><code>timeout 300</code></td>
<td align="left">å½“å®¢æˆ·ç«¯é—²ç½®å¤šé•¿ç§’åå…³é—­è¿æ¥ï¼Œå¦‚æœæŒ‡å®šä¸º 0 ï¼Œè¡¨ç¤ºå…³é—­è¯¥åŠŸèƒ½</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><code>loglevel notice</code></td>
<td align="left">æŒ‡å®šæ—¥å¿—è®°å½•çº§åˆ«ï¼ŒRedis æ€»å…±æ”¯æŒå››ä¸ªçº§åˆ«ï¼šdebugã€verboseã€noticeã€warningï¼Œé»˜è®¤ä¸º notice</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><code>logfile stdout</code></td>
<td align="left">æ—¥å¿—è®°å½•æ–¹å¼ï¼Œé»˜è®¤ä¸ºæ ‡å‡†è¾“å‡ºï¼Œå¦‚æœé…ç½® Redis ä¸ºå®ˆæŠ¤è¿›ç¨‹æ–¹å¼è¿è¡Œï¼Œè€Œè¿™é‡Œåˆé…ç½®ä¸ºæ—¥å¿—è®°å½•æ–¹å¼ä¸ºæ ‡å‡†è¾“å‡ºï¼Œåˆ™æ—¥å¿—å°†ä¼šå‘é€ç»™ /dev/null</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><code>databases 16</code></td>
<td align="left">è®¾ç½®æ•°æ®åº“çš„æ•°é‡ï¼Œé»˜è®¤æ•°æ®åº“ä¸º0ï¼Œå¯ä»¥ä½¿ç”¨SELECT å‘½ä»¤åœ¨è¿æ¥ä¸ŠæŒ‡å®šæ•°æ®åº“id</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><code>save  </code>Redis é»˜è®¤é…ç½®æ–‡ä»¶ä¸­æä¾›äº†ä¸‰ä¸ªæ¡ä»¶ï¼š<strong>save 900 1</strong>ã€<strong>save 300 10</strong> ã€<strong>save 60 10000</strong>åˆ†åˆ«è¡¨ç¤º 900 ç§’ï¼ˆ15 åˆ†é’Ÿï¼‰å†…æœ‰ 1 ä¸ªæ›´æ”¹ï¼Œ300 ç§’ï¼ˆ5 åˆ†é’Ÿï¼‰å†…æœ‰ 10 ä¸ªæ›´æ”¹ä»¥åŠ 60 ç§’å†…æœ‰ 10000 ä¸ªæ›´æ”¹ã€‚</td>
<td align="left">æŒ‡å®šåœ¨å¤šé•¿æ—¶é—´å†…ï¼Œæœ‰å¤šå°‘æ¬¡æ›´æ–°æ“ä½œï¼Œå°±å°†æ•°æ®åŒæ­¥åˆ°æ•°æ®æ–‡ä»¶ï¼Œå¯ä»¥å¤šä¸ªæ¡ä»¶é…åˆ</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><code>rdbcompression yes</code></td>
<td align="left">æŒ‡å®šå­˜å‚¨è‡³æœ¬åœ°æ•°æ®åº“æ—¶æ˜¯å¦å‹ç¼©æ•°æ®ï¼Œé»˜è®¤ä¸º yesï¼ŒRedis é‡‡ç”¨ LZF å‹ç¼©ï¼Œå¦‚æœä¸ºäº†èŠ‚çœ CPU æ—¶é—´ï¼Œå¯ä»¥å…³é—­è¯¥é€‰é¡¹ï¼Œä½†ä¼šå¯¼è‡´æ•°æ®åº“æ–‡ä»¶å˜çš„å·¨å¤§</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left"><code>dbfilename dump.rdb</code></td>
<td align="left">æŒ‡å®šæœ¬åœ°æ•°æ®åº“æ–‡ä»¶åï¼Œé»˜è®¤å€¼ä¸º dump.rdb</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><code>dir ./</code></td>
<td align="left">æŒ‡å®šæœ¬åœ°æ•°æ®åº“å­˜æ”¾ç›®å½•</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><code>slaveof  </code></td>
<td align="left">è®¾ç½®å½“æœ¬æœºä¸º slave æœåŠ¡æ—¶ï¼Œè®¾ç½® master æœåŠ¡çš„ IP åœ°å€åŠç«¯å£ï¼Œåœ¨ Redis å¯åŠ¨æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨ä» master è¿›è¡Œæ•°æ®åŒæ­¥</td>
</tr>
<tr>
<td align="left">14</td>
<td align="left"><code>masterauth </code></td>
<td align="left">å½“ master æœåŠ¡è®¾ç½®äº†å¯†ç ä¿æŠ¤æ—¶ï¼Œslav æœåŠ¡è¿æ¥ master çš„å¯†ç </td>
</tr>
<tr>
<td align="left">15</td>
<td align="left"><code>requirepass foobared</code></td>
<td align="left">è®¾ç½® Redis è¿æ¥å¯†ç ï¼Œå¦‚æœé…ç½®äº†è¿æ¥å¯†ç ï¼Œå®¢æˆ·ç«¯åœ¨è¿æ¥ Redis æ—¶éœ€è¦é€šè¿‡ AUTH <password> å‘½ä»¤æä¾›å¯†ç ï¼Œé»˜è®¤å…³é—­</td>
</tr>
<tr>
<td align="left">16</td>
<td align="left"><code> maxclients 128</code></td>
<td align="left">è®¾ç½®åŒä¸€æ—¶é—´æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°ï¼Œé»˜è®¤æ— é™åˆ¶ï¼ŒRedis å¯ä»¥åŒæ—¶æ‰“å¼€çš„å®¢æˆ·ç«¯è¿æ¥æ•°ä¸º Redis è¿›ç¨‹å¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦æ•°ï¼Œå¦‚æœè®¾ç½® maxclients 0ï¼Œè¡¨ç¤ºä¸ä½œé™åˆ¶ã€‚å½“å®¢æˆ·ç«¯è¿æ¥æ•°åˆ°è¾¾é™åˆ¶æ—¶ï¼ŒRedis ä¼šå…³é—­æ–°çš„è¿æ¥å¹¶å‘å®¢æˆ·ç«¯è¿”å› max number of clients reached é”™è¯¯ä¿¡æ¯</td>
</tr>
<tr>
<td align="left">17</td>
<td align="left"><code>maxmemory </code></td>
<td align="left">æŒ‡å®š Redis æœ€å¤§å†…å­˜é™åˆ¶ï¼ŒRedis åœ¨å¯åŠ¨æ—¶ä¼šæŠŠæ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè¾¾åˆ°æœ€å¤§å†…å­˜åï¼ŒRedis ä¼šå…ˆå°è¯•æ¸…é™¤å·²åˆ°æœŸæˆ–å³å°†åˆ°æœŸçš„ Keyï¼Œå½“æ­¤æ–¹æ³•å¤„ç† åï¼Œä»ç„¶åˆ°è¾¾æœ€å¤§å†…å­˜è®¾ç½®ï¼Œå°†æ— æ³•å†è¿›è¡Œå†™å…¥æ“ä½œï¼Œä½†ä»ç„¶å¯ä»¥è¿›è¡Œè¯»å–æ“ä½œã€‚Redis æ–°çš„ vm æœºåˆ¶ï¼Œä¼šæŠŠ Key å­˜æ”¾å†…å­˜ï¼ŒValue ä¼šå­˜æ”¾åœ¨ swap åŒº</td>
</tr>
<tr>
<td align="left">18</td>
<td align="left"><code>appendonly no</code></td>
<td align="left">æŒ‡å®šæ˜¯å¦åœ¨æ¯æ¬¡æ›´æ–°æ“ä½œåè¿›è¡Œæ—¥å¿—è®°å½•ï¼ŒRedis åœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯å¼‚æ­¥çš„æŠŠæ•°æ®å†™å…¥ç£ç›˜ï¼Œå¦‚æœä¸å¼€å¯ï¼Œå¯èƒ½ä¼šåœ¨æ–­ç”µæ—¶å¯¼è‡´ä¸€æ®µæ—¶é—´å†…çš„æ•°æ®ä¸¢å¤±ã€‚å› ä¸º redis æœ¬èº«åŒæ­¥æ•°æ®æ–‡ä»¶æ˜¯æŒ‰ä¸Šé¢ save æ¡ä»¶æ¥åŒæ­¥çš„ï¼Œæ‰€ä»¥æœ‰çš„æ•°æ®ä¼šåœ¨ä¸€æ®µæ—¶é—´å†…åªå­˜åœ¨äºå†…å­˜ä¸­ã€‚é»˜è®¤ä¸º no</td>
</tr>
<tr>
<td align="left">19</td>
<td align="left"><code>appendfilename appendonly.aof</code></td>
<td align="left">æŒ‡å®šæ›´æ–°æ—¥å¿—æ–‡ä»¶åï¼Œé»˜è®¤ä¸º appendonly.aof</td>
</tr>
<tr>
<td align="left">20</td>
<td align="left"><code>appendfsync everysec</code></td>
<td align="left">æŒ‡å®šæ›´æ–°æ—¥å¿—æ¡ä»¶ï¼Œå…±æœ‰ 3 ä¸ªå¯é€‰å€¼ï¼š<strong>no</strong>ï¼šè¡¨ç¤ºç­‰æ“ä½œç³»ç»Ÿè¿›è¡Œæ•°æ®ç¼“å­˜åŒæ­¥åˆ°ç£ç›˜ï¼ˆå¿«ï¼‰<strong>always</strong>ï¼šè¡¨ç¤ºæ¯æ¬¡æ›´æ–°æ“ä½œåæ‰‹åŠ¨è°ƒç”¨ fsync() å°†æ•°æ®å†™åˆ°ç£ç›˜ï¼ˆæ…¢ï¼Œå®‰å…¨ï¼‰<strong>everysec</strong>ï¼šè¡¨ç¤ºæ¯ç§’åŒæ­¥ä¸€æ¬¡ï¼ˆæŠ˜ä¸­ï¼Œé»˜è®¤å€¼ï¼‰</td>
</tr>
<tr>
<td align="left">21</td>
<td align="left"><code>vm-enabled no</code></td>
<td align="left">æŒ‡å®šæ˜¯å¦å¯ç”¨è™šæ‹Ÿå†…å­˜æœºåˆ¶ï¼Œé»˜è®¤å€¼ä¸º noï¼Œç®€å•çš„ä»‹ç»ä¸€ä¸‹ï¼ŒVM æœºåˆ¶å°†æ•°æ®åˆ†é¡µå­˜æ”¾ï¼Œç”± Redis å°†è®¿é—®é‡è¾ƒå°‘çš„é¡µå³å†·æ•°æ® swap åˆ°ç£ç›˜ä¸Šï¼Œè®¿é—®å¤šçš„é¡µé¢ç”±ç£ç›˜è‡ªåŠ¨æ¢å‡ºåˆ°å†…å­˜ä¸­ï¼ˆåœ¨åé¢çš„æ–‡ç« æˆ‘ä¼šä»”ç»†åˆ†æ Redis çš„ VM æœºåˆ¶ï¼‰</td>
</tr>
<tr>
<td align="left">22</td>
<td align="left"><code>vm-swap-file /tmp/redis.swap</code></td>
<td align="left">è™šæ‹Ÿå†…å­˜æ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤å€¼ä¸º /tmp/redis.swapï¼Œä¸å¯å¤šä¸ª Redis å®ä¾‹å…±äº«</td>
</tr>
<tr>
<td align="left">23</td>
<td align="left"><code>vm-max-memory 0</code></td>
<td align="left">å°†æ‰€æœ‰å¤§äº vm-max-memory çš„æ•°æ®å­˜å…¥è™šæ‹Ÿå†…å­˜ï¼Œæ— è®º vm-max-memory è®¾ç½®å¤šå°ï¼Œæ‰€æœ‰ç´¢å¼•æ•°æ®éƒ½æ˜¯å†…å­˜å­˜å‚¨çš„(Redis çš„ç´¢å¼•æ•°æ® å°±æ˜¯ keys)ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ vm-max-memory è®¾ç½®ä¸º 0 çš„æ—¶å€™ï¼Œå…¶å®æ˜¯æ‰€æœ‰ value éƒ½å­˜åœ¨äºç£ç›˜ã€‚é»˜è®¤å€¼ä¸º 0</td>
</tr>
<tr>
<td align="left">24</td>
<td align="left"><code>vm-page-size 32</code></td>
<td align="left">Redis swap æ–‡ä»¶åˆ†æˆäº†å¾ˆå¤šçš„ pageï¼Œä¸€ä¸ªå¯¹è±¡å¯ä»¥ä¿å­˜åœ¨å¤šä¸ª page ä¸Šé¢ï¼Œä½†ä¸€ä¸ª page ä¸Šä¸èƒ½è¢«å¤šä¸ªå¯¹è±¡å…±äº«ï¼Œvm-page-size æ˜¯è¦æ ¹æ®å­˜å‚¨çš„ æ•°æ®å¤§å°æ¥è®¾å®šçš„ï¼Œä½œè€…å»ºè®®å¦‚æœå­˜å‚¨å¾ˆå¤šå°å¯¹è±¡ï¼Œpage å¤§å°æœ€å¥½è®¾ç½®ä¸º 32 æˆ–è€… 64bytesï¼›å¦‚æœå­˜å‚¨å¾ˆå¤§å¤§å¯¹è±¡ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ›´å¤§çš„ pageï¼Œå¦‚æœä¸ç¡®å®šï¼Œå°±ä½¿ç”¨é»˜è®¤å€¼</td>
</tr>
<tr>
<td align="left">25</td>
<td align="left"><code>vm-pages 134217728</code></td>
<td align="left">è®¾ç½® swap æ–‡ä»¶ä¸­çš„ page æ•°é‡ï¼Œç”±äºé¡µè¡¨ï¼ˆä¸€ç§è¡¨ç¤ºé¡µé¢ç©ºé—²æˆ–ä½¿ç”¨çš„ bitmapï¼‰æ˜¯åœ¨æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œï¼Œåœ¨ç£ç›˜ä¸Šæ¯ 8 ä¸ª pages å°†æ¶ˆè€— 1byte çš„å†…å­˜ã€‚</td>
</tr>
<tr>
<td align="left">26</td>
<td align="left"><code>vm-max-threads 4</code></td>
<td align="left">è®¾ç½®è®¿é—®swapæ–‡ä»¶çš„çº¿ç¨‹æ•°,æœ€å¥½ä¸è¦è¶…è¿‡æœºå™¨çš„æ ¸æ•°,å¦‚æœè®¾ç½®ä¸º0,é‚£ä¹ˆæ‰€æœ‰å¯¹swapæ–‡ä»¶çš„æ“ä½œéƒ½æ˜¯ä¸²è¡Œçš„ï¼Œå¯èƒ½ä¼šé€ æˆæ¯”è¾ƒé•¿æ—¶é—´çš„å»¶è¿Ÿã€‚é»˜è®¤å€¼ä¸º4</td>
</tr>
<tr>
<td align="left">27</td>
<td align="left"><code>glueoutputbuf yes</code></td>
<td align="left">è®¾ç½®åœ¨å‘å®¢æˆ·ç«¯åº”ç­”æ—¶ï¼Œæ˜¯å¦æŠŠè¾ƒå°çš„åŒ…åˆå¹¶ä¸ºä¸€ä¸ªåŒ…å‘é€ï¼Œé»˜è®¤ä¸ºå¼€å¯</td>
</tr>
<tr>
<td align="left">28</td>
<td align="left"><code>hash-max-zipmap-entries 64 hash-max-zipmap-value 512</code></td>
<td align="left">æŒ‡å®šåœ¨è¶…è¿‡ä¸€å®šçš„æ•°é‡æˆ–è€…æœ€å¤§çš„å…ƒç´ è¶…è¿‡æŸä¸€ä¸´ç•Œå€¼æ—¶ï¼Œé‡‡ç”¨ä¸€ç§ç‰¹æ®Šçš„å“ˆå¸Œç®—æ³•</td>
</tr>
<tr>
<td align="left">29</td>
<td align="left"><code>activerehashing yes</code></td>
<td align="left">æŒ‡å®šæ˜¯å¦æ¿€æ´»é‡ç½®å“ˆå¸Œï¼Œé»˜è®¤ä¸ºå¼€å¯ï¼ˆåé¢åœ¨ä»‹ç» Redis çš„å“ˆå¸Œç®—æ³•æ—¶å…·ä½“ä»‹ç»ï¼‰</td>
</tr>
<tr>
<td align="left">30</td>
<td align="left"><code>include /path/to/local.conf</code></td>
<td align="left">æŒ‡å®šåŒ…å«å…¶å®ƒçš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥åœ¨åŒä¸€ä¸»æœºä¸Šå¤šä¸ªRediså®ä¾‹ä¹‹é—´ä½¿ç”¨åŒä¸€ä»½é…ç½®æ–‡ä»¶ï¼Œè€ŒåŒæ—¶å„ä¸ªå®ä¾‹åˆæ‹¥æœ‰è‡ªå·±çš„ç‰¹å®šé…ç½®æ–‡ä»¶</td>
</tr>
</tbody></table>
<h3 id="4-3-ğŸ”-é‡ç‚¹è¯¦è§£"><a href="#4-3-ğŸ”-é‡ç‚¹è¯¦è§£" class="headerlink" title="4.3 ğŸ” é‡ç‚¹è¯¦è§£"></a>4.3 ğŸ” é‡ç‚¹è¯¦è§£</h3><ol>
<li><p>UNIT: rediså¯¹å¤§å°å†™ä¸æ•æ„Ÿ</p>
</li>
<li><p>INCLUEDS[æ¨¡å—]: å¯ä»¥åŒ…å«å¤šä¸ªé…ç½®æ–‡ä»¶</p>
</li>
<li><p>MOUDLES[æ¨¡å—]: å¯åŠ¨æ—¶åŠ è½½æ¨¡å—</p>
</li>
<li><p>NETWORK[ç½‘ç»œ]: </p>
<ul>
<li>bind: ç»‘å®šIP</li>
<li>protected-mode: ä¿æŠ¤æ¨¡å¼</li>
<li>post: ç«¯å£è®¾ç½®</li>
</ul>
</li>
<li><p>GENERAL[é€šç”¨]: </p>
<ul>
<li>daemonize: æ˜¯å¦ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œ[^1]</li>
<li>pidfile /var/run/redis_6379.pid: å¦‚æœä»¥åå°çš„æ–¹å¼è¿è¡Œï¼Œå°±éœ€è¦æŒ‡å®šä¸€ä¸ªpidçš„é…ç½®æ–‡ä»¶</li>
<li>loglevel: æ—¥å¿—çº§åˆ«</li>
<li>logfile: æ—¥å¿—çš„æ–‡ä»¶ä½ç½®</li>
<li>database: æ•°æ®åº“çš„æ•°é‡</li>
<li>always-show-logo: æ˜¯å¦å¼€å¯æœåŠ¡çš„æ—¶å€™æ˜¾ç¤ºlogo</li>
</ul>
</li>
<li><p>SNAPSHOTTING[å¿«ç…§]:</p>
<ul>
<li>save 900 1: å¦‚æœåœ¨900så†…ï¼Œè‡³å°‘æœ‰1ä¸ªkeyè¿›è¡Œäº†ä¿®æ”¹ï¼Œå°±è¿›è¡ŒæŒä¹…åŒ–æ“ä½œ</li>
<li>save 300 10: å¦‚æœåœ¨300så†…ï¼Œè‡³å°‘æœ‰10ä¸ªkeyè¿›è¡Œäº†ä¿®æ”¹ï¼Œå°±è¿›è¡ŒæŒä¹…åŒ–æ“ä½œ</li>
<li>save 60 10000: å¦‚æœåœ¨60så†…ï¼Œè‡³å°‘æœ‰10000ä¸ªkeyè¿›è¡Œäº†ä¿®æ”¹ï¼Œå°±è¿›è¡ŒæŒä¹…åŒ–æ“ä½œ</li>
<li>stop-writes-on-bgsave-error: æŒä¹…åŒ–å‡ºç°é”™è¯¯ï¼Œæ˜¯å¦è®©redisç»§ç»­å·¥ä½œ</li>
<li>rdbcompression: æ˜¯å¦å‹ç¼©rdbæ–‡ä»¶ï¼Œéœ€è¦æ¶ˆè€—ä¸€äº›CPUèµ„æº</li>
<li>rdbchecksum: ä¿å­˜rdbçš„æ–‡ä»¶çš„æ—¶å€™ï¼Œæ˜¯å¦è¿›è¡Œé”™è¯¯æ ¡éªŒ</li>
<li>dir: æ–‡ä»¶ä¿å­˜çš„ç›®å½•</li>
</ul>
</li>
<li><p>REPLICATION[å¤åˆ¶]:</p>
<ul>
<li>è§ä¸»ä»å¤åˆ¶</li>
</ul>
</li>
<li><p>SECURITY[å®‰å…¨]:</p>
<ul>
<li><p>requirepass: è®¾ç½®å¯†ç </p>
</li>
<li><pre><code class="shell"># è®¾ç½®å¯†ç 
&gt; config set requirepass &lt;password&gt;
# ç™»å½•è¾“å…¥
&gt; auth &lt;password&gt;
# è·å–å¯†ç 
&gt; config get requirepass
# å–æ¶ˆè®¾ç½®
&gt; config set requirepass &#39;&#39;
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">9. CLIENTS[å®¢æˆ·ç«¯]:</span><br><span class="line"></span><br><span class="line">   - maxclients: è®¾ç½®å¯è¿æ¥redisçš„æœ€å¤§å®¢æˆ·ç«¯æ•°é‡</span><br><span class="line">   - maxmemory: é…ç½®redisçš„æœ€å¤§å†…å­˜å®¹é‡</span><br><span class="line">   - maxmemory-policy: å†…å­˜åˆ°è¾¾ä¸Šé™çš„å¤„ç†ç­–ç•¥</span><br><span class="line">     - volatile-lruï¼šåªå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyè¿›è¡ŒLRUï¼ˆé»˜è®¤å€¼ï¼‰ </span><br><span class="line">     - allkeys-lru ï¼š åˆ é™¤lruç®—æ³•çš„key  </span><br><span class="line">     - volatile-randomï¼šéšæœºåˆ é™¤å³å°†è¿‡æœŸkey  </span><br><span class="line">     - allkeys-randomï¼šéšæœºåˆ é™¤  </span><br><span class="line">     - volatile-ttl ï¼š åˆ é™¤å³å°†è¿‡æœŸçš„  </span><br><span class="line">     - noeviction ï¼š æ°¸ä¸è¿‡æœŸï¼Œè¿”å›é”™è¯¯</span><br><span class="line"></span><br><span class="line">10. APPEND ONLY MODE[AOF]:</span><br><span class="line"></span><br><span class="line">    - appendonly: é»˜è®¤ä¸å¼€å¯AOFæ¨¡å¼</span><br><span class="line">    - appendfilename: AOFæŒä¹…åŒ–çš„æ–‡ä»¶åç§°</span><br><span class="line">    - appendfsync always: æ¯æ¬¡ä¿®æ”¹éƒ½ä¼šåŒæ­¥ï¼Œæ¶ˆè€—æ€§èƒ½</span><br><span class="line">    - appendfsync everysec: æ¯ç§’æ‰§è¡Œä¸€æ¬¡åŒæ­¥ï¼Œå¯èƒ½ä¼šä¸¢å¤±è¿™1sçš„æ•°æ®</span><br><span class="line">    - appendfsync no: ä¸æ‰§è¡ŒåŒæ­¥ï¼Œæ“ä½œç³»ç»Ÿè‡ªå·±åŒæ­¥æ•°æ®ï¼Œé€Ÿåº¦æœ€å¿«</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[^1]: å®ˆæŠ¤è¿›ç¨‹(daemon)æ˜¯ä¸€ç±»åœ¨åå°è¿è¡Œçš„ç‰¹æ®Šè¿›ç¨‹ï¼Œç”¨äºæ‰§è¡Œç‰¹å®šçš„ç³»ç»Ÿä»»åŠ¡ã€‚å¾ˆå¤šå®ˆæŠ¤è¿›ç¨‹åœ¨ç³»ç»Ÿå¼•å¯¼çš„æ—¶å€™å¯åŠ¨ï¼Œå¹¶ä¸”ä¸€ç›´è¿è¡Œç›´åˆ°ç³»ç»Ÿå…³é—­ã€‚å¦ä¸€äº›åªåœ¨éœ€è¦çš„æ—¶å€™æ‰å¯åŠ¨ï¼Œå®Œæˆä»»åŠ¡åå°±è‡ªåŠ¨ç»“æŸã€‚RedisæœåŠ¡å™¨å¼€å¯å®ˆæŠ¤è¿›ç¨‹åï¼Œä¸ä¼šè‡ªåŠ¨è‡ªåŠ¨å…³é—­ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 5. ğŸ“©Redisæµ‹è¯•</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 5.1ğŸ”¬æµ‹è¯•æ–¹æ³•</span><br><span class="line"></span><br><span class="line">&gt; redisçš„æ€§èƒ½æµ‹è¯•å‘½ä»¤</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;shell</span><br><span class="line">redis-benchmark [option] [option value]</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ol>
<p>ğŸ””<strong>æ³¨æ„: è¿™ä¸ªå‘½ä»¤æ˜¯åœ¨redisç›®å½•ä¸‹æ‰§è¡Œï¼Œè€Œérediså®¢æˆ·ç«¯çš„å†…éƒ¨å‘½ä»¤</strong></p>
<h3 id="5-2-ğŸ“redisæ€§èƒ½æµ‹è¯•å·¥å…·å¯é€‰å‚æ•°"><a href="#5-2-ğŸ“redisæ€§èƒ½æµ‹è¯•å·¥å…·å¯é€‰å‚æ•°" class="headerlink" title="5.2 ğŸ“redisæ€§èƒ½æµ‹è¯•å·¥å…·å¯é€‰å‚æ•°"></a>5.2 ğŸ“redisæ€§èƒ½æµ‹è¯•å·¥å…·å¯é€‰å‚æ•°</h3><table>
<thead>
<tr>
<th align="left">åºå·</th>
<th align="left">é€‰é¡¹</th>
<th align="left">æè¿°</th>
<th align="left">é»˜è®¤å€¼</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><strong>-h</strong></td>
<td align="left">æŒ‡å®šæœåŠ¡å™¨ä¸»æœºå</td>
<td align="left">127.0.0.1</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><strong>-p</strong></td>
<td align="left">æŒ‡å®šæœåŠ¡å™¨ç«¯å£</td>
<td align="left">6379</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><strong>-s</strong></td>
<td align="left">æŒ‡å®šæœåŠ¡å™¨ socket</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><strong>-c</strong></td>
<td align="left">æŒ‡å®šå¹¶å‘è¿æ¥æ•°</td>
<td align="left">50</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><strong>-n</strong></td>
<td align="left">æŒ‡å®šè¯·æ±‚æ•°</td>
<td align="left">10000</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><strong>-d</strong></td>
<td align="left">ä»¥å­—èŠ‚çš„å½¢å¼æŒ‡å®š SET/GET å€¼çš„æ•°æ®å¤§å°</td>
<td align="left">3</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><strong>-k</strong></td>
<td align="left">1=keep alive 0=reconnect</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><strong>-r</strong></td>
<td align="left">SET/GET/INCR ä½¿ç”¨éšæœº key, SADD ä½¿ç”¨éšæœºå€¼</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><strong>-P</strong></td>
<td align="left">é€šè¿‡ç®¡é“ä¼ è¾“ <numreq> è¯·æ±‚</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><strong>-q</strong></td>
<td align="left">å¼ºåˆ¶é€€å‡º redisã€‚ä»…æ˜¾ç¤º query/sec å€¼</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">11</td>
<td align="left"><strong>â€“csv</strong></td>
<td align="left">ä»¥ CSV æ ¼å¼è¾“å‡º</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><strong>-l</strong></td>
<td align="left">ç”Ÿæˆå¾ªç¯ï¼Œæ°¸ä¹…æ‰§è¡Œæµ‹è¯•</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><strong>-t</strong></td>
<td align="left">ä»…è¿è¡Œä»¥é€—å·åˆ†éš”çš„æµ‹è¯•å‘½ä»¤åˆ—è¡¨ã€‚</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">14</td>
<td align="left"><strong>-I</strong></td>
<td align="left">Idle æ¨¡å¼ã€‚ä»…æ‰“å¼€ N ä¸ª idle è¿æ¥å¹¶ç­‰å¾…ã€‚</td>
<td align="left"></td>
</tr>
</tbody></table>
<h3 id="5-3-ğŸ“Šæµ‹è¯•ç»“æœåˆ†æ"><a href="#5-3-ğŸ“Šæµ‹è¯•ç»“æœåˆ†æ" class="headerlink" title="5.3 ğŸ“Šæµ‹è¯•ç»“æœåˆ†æ"></a>5.3 ğŸ“Šæµ‹è¯•ç»“æœåˆ†æ</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">redis-benchmark -h 127.0.0.1 -p 6379 -c 100 -n 100000 </span><br></pre></td></tr></table></figure>

<img src="/2020/10/08/Redis/image-20201009193727448.png" class="" title="image-20201009193727448">

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">redis-benchmark -h 127.0.0.1 -p 6379 -c 1 -n 100000 -q</span><br></pre></td></tr></table></figure>

<img src="/2020/10/08/Redis/image-20201009194004617.png" class="" title="image-20201009194004617">

<p>è¿™ä¸ªæ˜¯å¯¹æ‰€æœ‰æ“ä½œæµ‹è¯•æ€§èƒ½ï¼Œæ¯ç§’å¤„ç†çš„è¯·æ±‚æ•°é‡ã€‚</p>
<h2 id="6-ğŸ“©RedisåŸºç¡€"><a href="#6-ğŸ“©RedisåŸºç¡€" class="headerlink" title="6. ğŸ“©RedisåŸºç¡€"></a>6. ğŸ“©RedisåŸºç¡€</h2><h3 id="6-1-ğŸ’ Redisæ•°æ®åº“"><a href="#6-1-ğŸ’ Redisæ•°æ®åº“" class="headerlink" title="6.1 ğŸ’ Redisæ•°æ®åº“"></a>6.1 ğŸ’ Redisæ•°æ®åº“</h3><p><strong>redisæœ‰16ä¸ªæ•°æ®åº“ï¼Œé»˜è®¤ä½¿ç”¨ç¬¬0ä¸ª</strong></p>
<blockquote>
<p>æµ‹è¯•è¿æ¥</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ping</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å…³é—­è¿æ¥</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">quit</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿”å›æ¶ˆæ¯</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &lt;str&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>åˆ‡æ¢æ•°æ®åº“</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">select &lt;num of database&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è·å–å½“å‰æ•°æ®åº“çš„å¤§å°</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">dbsize</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ¸…ç©ºå½“å‰æ•°æ®åº“</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">flushdb</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ¸…ç©ºæ‰€æœ‰æ•°æ®åº“</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">flushall</span><br></pre></td></tr></table></figure>

<blockquote>
<p>äº¤æ¢æ•°æ®åº“</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">swap &lt;n1&gt; &lt;n2&gt;</span><br></pre></td></tr></table></figure>



<h3 id="6-2-ğŸŒ6379çš„æ•…äº‹"><a href="#6-2-ğŸŒ6379çš„æ•…äº‹" class="headerlink" title="6.2 ğŸŒ6379çš„æ•…äº‹"></a>6.2 ğŸŒ6379çš„æ•…äº‹</h3><p><strong>redisé»˜è®¤ç«¯å£å·ä¸º6379</strong></p>
<blockquote>
<p>ä½œè€…åœ¨è‡ªå·±çš„ä¸€ç¯‡åšæ–‡ä¸­è§£é‡Šäº†ä¸ºä»€ä¹ˆé€‰ç”¨ 6379 ä½œä¸ºé»˜è®¤ç«¯å£ï¼Œå› ä¸º 6379 åœ¨æ‰‹æœºæŒ‰é”®ä¸Š MERZ å¯¹åº”çš„å·ç ï¼Œè€Œ MERZ å–è‡ªæ„å¤§åˆ©æ­Œå¥³ Alessia Merz çš„åå­—ã€‚MERZé•¿æœŸä»¥æ¥è¢«Redisä½œè€…antirezåŠå…¶æœ‹å‹å½“ä½œæ„šè ¢çš„ä»£åè¯ï¼Œåæ¥ä½œè€…åœ¨å¼€å‘Rediså°±é€‰ç”¨äº†è¿™ä¸ªç«¯å£ã€‚</p>
</blockquote>
<h3 id="6-3-âš¡Redisèœœæ±é€Ÿåº¦"><a href="#6-3-âš¡Redisèœœæ±é€Ÿåº¦" class="headerlink" title="6.3 âš¡Redisèœœæ±é€Ÿåº¦"></a>6.3 âš¡Redisèœœæ±é€Ÿåº¦</h3><p><strong>redisæ˜¯å•çº¿ç¨‹çš„ã€‚</strong></p>
<p>redisåŸºäºå†…å­˜æ“ä½œï¼ŒCPUä¸æ˜¯redisçš„æ€§èƒ½ç“¶é¢ˆï¼ŒRedisçš„ç“¶é¢ˆå¾ˆå¯èƒ½æ˜¯æœºå™¨å†…å­˜æˆ–è€…ç½‘è·¯å¸¦å®½ã€‚</p>
<p>æ—¢ç„¶å•çº¿ç¨‹å®¹æ˜“å®ç°ï¼Œè€Œä¸”CPUä¸ä¼šæˆä¸ºç“¶é¢ˆï¼Œé‚£å°±é¡ºç†æˆç« çš„é‡‡ç”¨å•çº¿ç¨‹å®ç°ã€‚</p>
<blockquote>
<p>ğŸ’‰ç†è§£Redisèœœæ±é€Ÿåº¦éœ€è¦è·¨è¿‡ä¸¤ä¸ªè¯¯åŒº</p>
</blockquote>
<ul>
<li><p>è¯¯åŒº1ï¼šé«˜æ€§èƒ½çš„æœåŠ¡å™¨ä¸€å®šæ˜¯å¤šçº¿ç¨‹çš„ï¼Ÿ</p>
</li>
<li><p>è¯¯åŒº2ï¼šå¤šçº¿ç¨‹çš„æ•ˆç‡ä¸€å®šæ¯”å•çº¿ç¨‹é«˜ï¼Ÿ</p>
</li>
</ul>
<blockquote>
<p>ğŸ’ŠRedisé‡‡ç”¨å•çº¿ç¨‹ä¾ç„¶å¿«çš„åŸå› </p>
</blockquote>
<ol>
<li>Rediså®Œå…¨åŸºäºå†…å­˜ï¼Œè¯»å†™å…¨éƒ¨åœ¨ä¸€ä¸ªCPUä¸Šï¼Œç»å¤§éƒ¨åˆ†è¯·æ±‚æ˜¯çº¯ç²¹çš„å†…å­˜æ“ä½œï¼Œéå¸¸è¿…é€Ÿï¼Œæ•°æ®å­˜åœ¨äºå†…å­˜ä¸­ï¼Œç±»ä¼¼äºHashMapï¼ŒHashMapçš„ä¼˜åŠ¿å°±æ˜¯æŸ¥è¯¢å’Œæ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ—¶O(1)</li>
<li>æ•°æ®ç»“æ„ç®€å•ï¼Œå¯¹æ•°æ®æ“ä½œä¹Ÿç®€å•</li>
<li>é‡‡ç”¨å•çº¿ç¨‹ï¼Œé¿å…äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰æ¡ä»¶ï¼Œä¸å­˜åœ¨å¤šçº¿ç¨‹å¯¼è‡´çš„CPUåˆ‡æ¢ï¼Œä¸ç”¨å–è€ƒè™‘å„ç§é”çš„é—®é¢˜ï¼Œä¸å­˜åœ¨åŠ é”æ”¾é”æ“ä½œï¼Œæ²¡æœ‰æ­»é”é—®é¢˜å¯¼è‡´çš„æ€§èƒ½æ¶ˆè€—</li>
<li>ä½¿ç”¨å¤šè·¯å¤ç”¨IOæ¨¡å‹ï¼Œéé˜»å¡IO</li>
</ol>
<h2 id="7-ğŸ“©Redisæ•°æ®ç±»å‹"><a href="#7-ğŸ“©Redisæ•°æ®ç±»å‹" class="headerlink" title="7. ğŸ“©Redisæ•°æ®ç±»å‹"></a>7. ğŸ“©Redisæ•°æ®ç±»å‹</h2><blockquote>
<p>ğŸŒè¯´æ˜</p>
</blockquote>
<p>æ‰€æœ‰å‘½ä»¤å¯æŸ¥çœ‹ä¸­æ–‡å®˜æ–¹æ–‡æ¡£: <a href="http://redis.cn/commands.html#">http://redis.cn/commands.html#</a></p>
<h3 id="7-1-ğŸ†äº”å¤§æ•°æ®ç±»å‹"><a href="#7-1-ğŸ†äº”å¤§æ•°æ®ç±»å‹" class="headerlink" title="7.1 ğŸ†äº”å¤§æ•°æ®ç±»å‹"></a>7.1 ğŸ†äº”å¤§æ•°æ®ç±»å‹</h3><table>
<thead>
<tr>
<th align="center">ç±»å‹</th>
<th align="center">ç®€ä»‹</th>
<th align="center">ç‰¹æ€§</th>
<th align="center">åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td align="center">String(å­—ç¬¦ä¸²)</td>
<td align="center">äºŒè¿›åˆ¶å®‰å…¨</td>
<td align="center">å¯ä»¥åŒ…å«ä»»ä½•æ•°æ®ï¼Œæ¯”å¦‚jpgå›¾ç‰‡æˆ–è€…åºåˆ—åŒ–å¯¹è±¡</td>
<td align="center">â€”</td>
</tr>
<tr>
<td align="center">Hash(å­—å…¸)</td>
<td align="center">é”®å€¼å¯¹é›†åˆ</td>
<td align="center">é€‚åˆå­˜å‚¨å¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥åƒæ•°æ®åº“ä¸­çš„updateä¸€ä¸ªå±æ€§ä¸€æ ·å€¼ä¿®æ”¹æŸä¸€é¡¹å±æ€§å€¼</td>
<td align="center">å­˜å‚¨ã€è¯»å–ã€ä¿®æ”¹ç”¨æˆ·å±æ€§</td>
</tr>
<tr>
<td align="center">List(åˆ—è¡¨)</td>
<td align="center">åŒå‘é“¾è¡¨</td>
<td align="center">å¢åˆ å¿«ï¼Œæä¾›äº†æ“ä½œæŸä¸€å…ƒç´ çš„api</td>
<td align="center">æœ€æ–°æ¶ˆæ¯æ’è¡Œï¼›æ¶ˆæ¯é˜Ÿåˆ—</td>
</tr>
<tr>
<td align="center">Set(é›†åˆ)</td>
<td align="center">hashè¡¨å®ç°ï¼Œå…ƒç´ ä¸é‡å¤</td>
<td align="center">å¢åˆ æŸ¥å¿«ï¼Œæä¾›äº†æ±‚äº¤é›†ã€å¹¶é›†å’Œå·®é›†çš„æ“ä½œ</td>
<td align="center">å…±åŒå¥½å‹:  åˆ©ç”¨å”¯ä¸€æ€§ï¼Œç»Ÿè®¡ç½‘ç«™UV</td>
</tr>
<tr>
<td align="center">Sorted Set(æœ‰åºé›†åˆ)</td>
<td align="center">å°†setä¸­çš„å…ƒç´ å¢åŠ ä¸€ä¸ªæƒé‡scoreï¼Œå…ƒç´ æŒ‰ç…§scoreæœ‰åºæ’åˆ—</td>
<td align="center">æ•°æ®æ’å…¥é›†åˆæ—¶ï¼Œå·²ç»è¿›è¡Œäº†å¤©ç„¶æ’åº</td>
<td align="center">æ’è¡Œæ¦œï¼›å¸¦æƒé‡çš„æ¶ˆæ¯é˜Ÿåˆ—</td>
</tr>
</tbody></table>
<p><strong>ğŸ²Key</strong></p>
<blockquote>
<p>æŸ¥çœ‹æ‰€æœ‰çš„key</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">keys *</span><br></pre></td></tr></table></figure>

<blockquote>
<p>åˆ›å»ºé”®å€¼å¯¹</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">set &lt;key&gt; &lt;value&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è·å–keyçš„å€¼</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">get &lt;key&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç§»é™¤é”®å€¼å¯¹</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">move &lt;key&gt; &lt;value&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">exists &lt;key&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æŸ¥çœ‹keyçš„ç±»å‹</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">type &lt;key&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è®¾ç½®keyçš„è¿‡æœŸæ—¶é—´/ç§’</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">expire &lt;key&gt; &lt;seconds&gt; </span><br></pre></td></tr></table></figure>

<blockquote>
<p>è·å–keyçš„æœ‰æ•ˆæ—¶é—´/ç§’</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ttl &lt;key&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è·å–keyçš„æœ‰æ•ˆæ—¶é—´/æ¯«ç§’</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pttl &lt;key&gt;</span><br></pre></td></tr></table></figure>



<h4 id="7-1-1-âš½String"><a href="#7-1-1-âš½String" class="headerlink" title="7.1.1 âš½String"></a>7.1.1 âš½String</h4><blockquote>
<p>å‘keyä¸Šè¿½åŠ å­—ç¬¦ä¸²</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">append &lt;key&gt; &lt;value&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è·å–keyçš„é•¿åº¦</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">strlen &lt;key&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Integeræ“ä½œ</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åŠ 1</span></span><br><span class="line">incr &lt;key&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> åŠ n</span></span><br><span class="line">incrby &lt;key&gt; n</span><br><span class="line"><span class="meta">#</span><span class="bash"> å‡1</span></span><br><span class="line">decr &lt;key&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> å‡n</span></span><br><span class="line">decrby &lt;key&gt; n</span><br></pre></td></tr></table></figure>

<blockquote>
<p>subString(start, end)æ“ä½œ</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æˆªå–æ•´ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">getrange &lt;key&gt; 0 -1</span><br><span class="line"><span class="meta">#</span><span class="bash"> æˆªå–éƒ¨åˆ†å­—ç¬¦ä¸²</span></span><br><span class="line">getrange &lt;key&gt; start end</span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¾‹å¦‚</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="built_in">set</span> s <span class="string">&quot;Khighness&quot;</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> getrange s 0 -1 <span class="comment"># &quot;Khighness&quot;</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> getrange s 1 4  <span class="comment"># &quot;high&quot;</span></span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>replace(start, end)æ“ä½œ</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŠŠå­—ç¬¦ä¸²ä»nä½å¼€å§‹ä¹‹åçš„å­—ç¬¦æ›¿æ¢ä¸ºæ–°çš„å­—ç¬¦ä¸²newStr</span></span><br><span class="line">setrange &lt;key&gt; n newStr</span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¾‹å¦‚</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="built_in">set</span> s <span class="string">&quot;Khighness&quot;</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> setrange s 0 X </span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> get s <span class="comment"># &quot;Xhighness&quot;</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> setrange s 5 <span class="string">&quot;XXXXX&quot;</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> get s <span class="comment"># &quot;XhighXXXXX&quot;</span></span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>setex (set with expire) åˆ›å»ºé”®å€¼å¯¹çš„åŒæ—¶è®¾ç½®è¿‡æœŸæ—¶é—´</p>
<p>setnx (set if not exist)  å¦‚æœkeyä¸å­˜åœ¨åˆ™åˆ›å»ºé”®å€¼å¯¹ï¼Œé˜²æ­¢è¦†ç›–åŸæœ‰é”®å€¼å¯¹ (åˆ†å¸ƒå¼é”ä¸­ç»å¸¸ä½¿ç”¨)</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è®¾ç½®é”®å€¼å¯¹ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´</span></span><br><span class="line">setex &lt;key&gt; &lt;seconds&gt; &lt;value&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> keyä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºé”®å€¼å¯¹</span></span><br><span class="line">setnx &lt;key&gt; &lt;value&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¾‹å¦‚</span></span><br><span class="line">127.0.0.1:6379&gt; setex k1 10 parak</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; ttl k1</span><br><span class="line">(integer) 5</span><br><span class="line">127.0.0.1:6379&gt; ttl k1</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; ttl k1</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; ttl k1</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; ttl k1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; ttl k1</span><br><span class="line">(integer) -2</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line">(nil)</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; setnx k2 parak</span><br><span class="line">(integer) 1 # 1ä»£è¡¨è®¾ç½®æˆåŠŸ</span><br><span class="line">127.0.0.1:6379&gt; setnx k2 flowerk</span><br><span class="line">(integer) 0 # 0ä»£è¡¨è®¾ç½®å¤±è´¥</span><br><span class="line">127.0.0.1:6379&gt; get k2</span><br><span class="line">&quot;parak&quot;     </span><br><span class="line">127.0.0.1:6379&gt; setnx k2 FlowerK</span><br><span class="line">(integer) 0 </span><br><span class="line">127.0.0.1:6379&gt; set k2 FlowerK</span><br><span class="line">OK          # å¼ºåˆ¶è®¾ç½®value</span><br><span class="line">127.0.0.1:6379&gt; get k2</span><br><span class="line">&quot;FlowerK&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¤šä¸ªé”®å€¼å¯¹æ“ä½œ</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä¸€æ¬¡æ€§åˆ›å»ºå¤šä¸ªé”®å€¼å¯¹</span></span><br><span class="line">mset &lt;key&gt; &lt;value&gt; [key value ...]</span><br><span class="line"><span class="meta">#</span><span class="bash"> è·å–å¤šä¸ªkeyçš„å€¼</span></span><br><span class="line">meget &lt;key&gt; [key ...]</span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸å­˜åœ¨åˆ™åˆ›å»ºå¤šä¸ªé”®å€¼å¯¹</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åŸå­æ€§æ“ä½œï¼Œåªè¦å…¶ä¸­æœ‰ä¸€ä¸ªkeyå·²å­˜åœ¨ï¼Œå°±ä¼šå…¨éƒ¨åˆ›å»ºå¤±è´¥</span></span><br><span class="line">msetnx &lt;key&gt; &lt;value&gt; [key value ...]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¾‹å¦‚</span></span><br><span class="line">127.0.0.1:6379&gt; mset k1 v1 k2 v2 k3 v3</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; mget k1 k2 k3</span><br><span class="line">1) &quot;v1&quot;</span><br><span class="line">2) &quot;v2&quot;</span><br><span class="line">3) &quot;v3&quot;</span><br><span class="line">127.0.0.1:6379&gt; msetnx k2 v2 k4 v4 k5 v5</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) &quot;k2&quot;</span><br><span class="line">2) &quot;k3&quot;</span><br><span class="line">3) &quot;k1&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å·§å¦™è®¾è®¡key  object:&#123;id&#125;:&#123;field&#125;</span></span><br><span class="line">127.0.0.1:6379&gt; mset user:1:name Khighness user:1:age 18</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; mget user:1:name user:1:age</span><br><span class="line">1) &quot;Khighness&quot;</span><br><span class="line">2) &quot;18&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç»„åˆæ“ä½œ</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å…ˆè·å–å€¼ï¼Œå†è®¾ç½®æ–°çš„å€¼</span></span><br><span class="line">getset k v</span><br></pre></td></tr></table></figure>



<h4 id="7-1-2-âš¾List"><a href="#7-1-2-âš¾List" class="headerlink" title="7.1.2 âš¾List"></a>7.1.2 âš¾List</h4><p>redisé‡Œé¢ï¼Œlistå¯ä»¥å½“æˆæ ˆã€é˜Ÿåˆ—ã€é˜Ÿåˆ—ã€‚</p>
<blockquote>
<p>å‘listçš„å¤´éƒ¨æ·»åŠ å€¼</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">lpush &lt;key&gt; value [value ...]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å‘listçš„å°¾éƒ¨æ·»åŠ å€¼</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rpush &lt;key&gt; value [value ...]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>åˆ¤æ–­listæ˜¯å¦å­˜åœ¨</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">exists &lt;key&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç§»é™¤åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ </p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">lpop &lt;key&gt; </span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç§»é™¤åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ </p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rpop &lt;key&gt; </span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç§»é™¤æŒ‡å®šçš„å€¼</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">lrem &lt;key&gt; &lt;count&gt; &lt;value&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ›´æ–°list</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æ ¹æ®indexæ›´æ–°å€¼</span></span><br><span class="line">lset &lt;key&gt; &lt;index&gt; &lt;value&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ ¹æ®ä¸‹æ ‡è·å–å€¼</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">lindex &lt;key&gt; &lt;index&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è·å–listçš„é•¿åº¦</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">llen &lt;key&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è·å–listæŒ‡å®šèŒƒå›´çš„å€¼</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è·å–æ•´ä¸ªlistçš„å€¼</span></span><br><span class="line">lrange &lt;key&gt; 0 -1</span><br><span class="line"><span class="meta">#</span><span class="bash"> è·å–æŒ‡å®šèŒƒå›´çš„å€¼</span></span><br><span class="line">lrange &lt;key&gt; start end</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¾‹å¦‚</span></span><br><span class="line">127.0.0.1:6379&gt; lpush list1 1 2 3 4 5 </span><br><span class="line">(integer) 5</span><br><span class="line">127.0.0.1:6379&gt; lrange list1 0 -1</span><br><span class="line">1) &quot;5&quot;</span><br><span class="line">2) &quot;4&quot;</span><br><span class="line">3) &quot;3&quot;</span><br><span class="line">4) &quot;2&quot;</span><br><span class="line">5) &quot;1&quot;</span><br><span class="line">127.0.0.1:6379&gt; lrange list1 0 1</span><br><span class="line">1) &quot;5&quot;</span><br><span class="line">2) &quot;4&quot;</span><br><span class="line">127.0.0.1:6379&gt; rpush list2 1 2 3 4 5</span><br><span class="line">(integer) 5</span><br><span class="line">127.0.0.1:6379&gt; lrange list2 0 -1</span><br><span class="line">1) &quot;1&quot;</span><br><span class="line">2) &quot;2&quot;</span><br><span class="line">3) &quot;3&quot;</span><br><span class="line">4) &quot;4&quot;</span><br><span class="line">5) &quot;5&quot;</span><br><span class="line">127.0.0.1:6379&gt; lrange list2 0 1</span><br><span class="line">1) &quot;1&quot;</span><br><span class="line">2) &quot;2&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æˆªå–listä¸­æŒ‡å®šèŒƒå›´çš„å€¼</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä¿ç•™ä¸‹æ ‡[start, end]çš„å€¼</span></span><br><span class="line">ltrim &lt;key&gt; start end</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¾‹å¦‚</span></span><br><span class="line">127.0.0.1:6379&gt; rpush list parak1 parak2 parak3 parak4 parak5</span><br><span class="line">(integer) 5</span><br><span class="line">127.0.0.1:6379&gt; ltrim list 0 2</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) &quot;parak1&quot;</span><br><span class="line">2) &quot;parak2&quot;</span><br><span class="line">3) &quot;parak3&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç»„åˆæ“ä½œ</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ç§»é™¤<span class="built_in">source</span>çš„å°¾éƒ¨çš„å€¼æ’å…¥åˆ°destinationçš„å¤´éƒ¨</span></span><br><span class="line">rpoplpush &lt;source&gt; &lt;destination&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¾‹å¦‚</span></span><br><span class="line">127.0.0.1:6379&gt; rpush list 1 2 3 4 5</span><br><span class="line">(integer) 5</span><br><span class="line">127.0.0.1:6379&gt; rpoplpush list newlist</span><br><span class="line">&quot;5&quot;</span><br><span class="line">127.0.0.1:6379&gt; lrange newlist 0 -1</span><br><span class="line">1) &quot;5&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>åœ¨listä¸­æ’å…¥å€¼</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åœ¨listä¸­çš„æŸä¸ªå€¼ä¹‹å‰æ’å…¥</span></span><br><span class="line">linsert &lt;key&gt; before &lt;priot&gt; &lt;value&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> åœ¨listä¸­çš„æŸä¸ªå€¼ä¹‹åæ’å…¥</span></span><br><span class="line">linsert &lt;key&gt; after &lt;priot&gt; &lt;value&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¾‹å¦‚</span></span><br><span class="line">127.0.0.1:6379&gt; rpush list 1 2 3 4 5</span><br><span class="line">(integer) 5</span><br><span class="line">127.0.0.1:6379&gt; linsert list before 3 6</span><br><span class="line">(integer) 6</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) &quot;1&quot;</span><br><span class="line">2) &quot;2&quot;</span><br><span class="line">3) &quot;6&quot;</span><br><span class="line">4) &quot;3&quot;</span><br><span class="line">5) &quot;4&quot;</span><br><span class="line">6) &quot;5&quot;</span><br><span class="line">127.0.0.1:6379&gt; linsert list after 5 7</span><br><span class="line">(integer) 7</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) &quot;1&quot;</span><br><span class="line">2) &quot;2&quot;</span><br><span class="line">3) &quot;6&quot;</span><br><span class="line">4) &quot;3&quot;</span><br><span class="line">5) &quot;4&quot;</span><br><span class="line">6) &quot;5&quot;</span><br><span class="line">7) &quot;7&quot;</span><br></pre></td></tr></table></figure>



<h4 id="7-1-3-ğŸ€Set"><a href="#7-1-3-ğŸ€Set" class="headerlink" title="7.1.3 ğŸ€Set"></a>7.1.3 ğŸ€Set</h4><p>set æ— åºä¸é‡å¤é›†åˆ</p>
<ul>
<li>seté€šè¿‡å“ˆå¸Œè¡¨å®ç°ï¼Œæ‰€æœ‰å¢åˆ æŸ¥çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(1)</li>
</ul>
<blockquote>
<p>å‘setä¸­å›½æ·»åŠ å€¼</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sadd &lt;key&gt; &lt;value&gt; [value ...]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æŸ¥çœ‹setä¸­çš„æ‰€æœ‰å€¼</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">smembers &lt;key&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æŸ¥çœ‹setä¸­æ˜¯å¦åŒ…å«å€¼value</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sismember &lt;key&gt; &lt;value&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è·å–setä¸­çš„å…ƒç´ ä¸ªæ•°</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">scard &lt;key&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç§»é™¤setä¸­çš„å€¼value</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">srem &lt;key&gt; &lt;value&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è·å–setä¸­çš„éšæœºå€¼(å¯ä»¥åšæŠ½å¥–åŠŸèƒ½)</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">srandmember &lt;key&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>éšæœºç§»é™¤setä¸­çš„å…ƒç´ </p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">spop &lt;key&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å°†ä¸€ä¸ªseté›†åˆä¸­æŒ‡å®šçš„å€¼ç§»åŠ¨åˆ°å¦ä¸€ä¸ªseté›†åˆ</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å°†<span class="built_in">source</span>ä¸­çš„valueç§»åŠ¨åˆ°destination</span></span><br><span class="line">smove &lt;source&gt; &lt;destination&gt; &lt;value&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¾‹å¦‚</span></span><br><span class="line">127.0.0.1:6379&gt; sadd set k1 k2 k3 k4 k5 k6 k7</span><br><span class="line">(integer) 7</span><br><span class="line">127.0.0.1:6379&gt; sadd newset k1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; smove set newset k3</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; smembers newset</span><br><span class="line">1) &quot;k3&quot;</span><br><span class="line">2) &quot;k1&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>é›†åˆè¿ç®—</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> é›†åˆs1å’Œs2çš„å¹¶é›†</span></span><br><span class="line">sunion &lt;s1&gt; &lt;s&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> é›†åˆs1å’Œs2çš„äº¤é›† (å®ç°å…±åŒå¥½å‹ã€å…±åŒå…³æ³¨)</span></span><br><span class="line">sinter &lt;s1&gt; &lt;s2&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> é›†åˆs1ä¸­ç‹¬æœ‰çš„å…ƒç´ </span></span><br><span class="line">sdiff &lt;s1&gt; &lt;s2&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¾‹å¦‚</span></span><br><span class="line">127.0.0.1:6379&gt; sadd s1 k1 k2 k3 k4 k5 k6</span><br><span class="line">(integer) 6</span><br><span class="line">127.0.0.1:6379&gt; sadd s2 k5 k6 k7 k8 k9 k10</span><br><span class="line">(integer) 6</span><br><span class="line">127.0.0.1:6379&gt; sunion s1 s2</span><br><span class="line"> 1) &quot;k5&quot;</span><br><span class="line"> 2) &quot;k6&quot;</span><br><span class="line"> 3) &quot;k8&quot;</span><br><span class="line"> 4) &quot;k2&quot;</span><br><span class="line"> 5) &quot;k3&quot;</span><br><span class="line"> 6) &quot;k1&quot;</span><br><span class="line"> 7) &quot;k4&quot;</span><br><span class="line"> 8) &quot;k7&quot;</span><br><span class="line"> 9) &quot;k10&quot;</span><br><span class="line">10) &quot;k9&quot;</span><br><span class="line">127.0.0.1:6379&gt; sinter s1 s2</span><br><span class="line">1) &quot;k5&quot;</span><br><span class="line">2) &quot;k6&quot;</span><br><span class="line">127.0.0.1:6379&gt; sdiff s1 s2</span><br><span class="line">1) &quot;k2&quot;</span><br><span class="line">2) &quot;k1&quot;</span><br><span class="line">3) &quot;k3&quot;</span><br><span class="line">4) &quot;k4&quot;</span><br></pre></td></tr></table></figure>



<h4 id="7-1-4-ğŸˆHash"><a href="#7-1-4-ğŸˆHash" class="headerlink" title="7.1.4 ğŸˆHash"></a>7.1.4 ğŸˆHash</h4><p>ç›¸å½“äºkey-HashMapï¼Œvalueä¸ºä¸€ä¸ªmapé›†åˆï¼Œæ›´é€‚åˆäºå¯¹è±¡çš„å­˜å‚¨ï¼Œå¤šç”¨äºå­˜å‚¨å˜æ›´æ•°æ®ã€</p>
<blockquote>
<p>è®¾ç½®keyæŒ‡å®šçš„å“ˆå¸Œé›†ä¸­æŒ‡å®šå­—æ®µçš„å€¼</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hset &lt;key&gt; &lt;field&gt; &lt;value&gt; </span><br></pre></td></tr></table></figure>

<blockquote>
<p>keyæŒ‡å®šçš„å“ˆå¸Œé›†ä¸­ä¸å­˜åœ¨æŒ‡å®šå­—æ®µæ—¶ï¼Œè®¾ç½®å­—æ®µçš„å€¼</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hsetnx &lt;key&gt; &lt;field&gt; &lt;value&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>åˆ é™¤keyæŒ‡å®šçš„å“ˆå¸Œé›†ä¸­æŒ‡å®šå­—æ®µ</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hdel &lt;key&gt; &lt;field&gt; [field ...]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>åˆ¤æ–­keyæŒ‡å®šå“ˆå¸Œé›†ä¸­æŒ‡å®šå­—æ®µæ˜¯å¦å­˜åœ¨</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexists &lt;key&gt; &lt;field&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¯¹keyæŒ‡å®šçš„å“ˆå¸Œé›†ä¸­æŒ‡å®šå­—æ®µçš„å€¼åŠ ä¸Šå¢é‡(Integerå‹ï¼Œå¯æ­£å¯è´Ÿï¼Œå­—æ®µä¸å­˜åœ¨åˆ™åœ¨æ“ä½œæ‰§è¡Œå‰æŠŠè¯¥å­—æ®µçš„å€¼è®¾ç½®ä¸º0)</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hincrby &lt;key&gt; &lt;field&gt; &lt;integer&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¯¹keyæŒ‡å®šçš„å“ˆå¸Œé›†ä¸­æŒ‡å®šå­—æ®µçš„å€¼åŠ ä¸Šå¢é‡(floatå‹ï¼Œå¯æ­£å¯è´Ÿï¼Œå­—æ®µä¸å­˜åœ¨åˆ™åœ¨æ“ä½œæ‰§è¡Œå‰æŠŠè¯¥å­—æ®µçš„å€¼è®¾ç½®ä¸º0)</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hincrbyfloat &lt;key&gt; &lt;field&gt; &lt;float&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è·å–keyæŒ‡å®šçš„å“ˆå¸Œé›†ä¸­å­—æ®µæ•°é‡</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hlen &lt;key&gt; </span><br></pre></td></tr></table></figure>

<blockquote>
<p>è·å–keyæŒ‡å®šçš„å“ˆå¸Œé›†ä¸­æŒ‡å®šå­—æ®µçš„å€¼çš„å­—ç¬¦ä¸²é•¿åº¦</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hstrlen hash &lt;key&gt; &lt;value&gt; </span><br></pre></td></tr></table></figure>

<blockquote>
<p>keyæŒ‡å®šçš„å“ˆå¸Œé›†æ“ä½œ</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è®¾ç½®keyæŒ‡å®šçš„å“ˆå¸Œé›†ä¸­æŒ‡å®šå­—æ®µçš„å€¼</span></span><br><span class="line">hmset &lt;key&gt; &lt;field&gt; &lt;value&gt; [field value ...]</span><br><span class="line"><span class="meta">#</span><span class="bash"> è·å–keyæŒ‡å®šçš„å“ˆå¸Œé›†ä¸­æŒ‡å®šå­—æ®µæ‰€å…³è”çš„å€¼</span></span><br><span class="line">hmget &lt;key&gt; &lt;field&gt; [field ...]</span><br><span class="line"><span class="meta">#</span><span class="bash"> è·å–keyæŒ‡å®šçš„å“ˆå¸Œé›†ä¸­æ‰€æœ‰å­—æ®µçš„åå­—</span></span><br><span class="line">hkeys</span><br><span class="line"><span class="meta">#</span><span class="bash"> è·å–keyæŒ‡å®šå“ˆå¸Œé›†ä¸­æ‰€æœ‰å­—æ®µçš„å€¼</span></span><br><span class="line">hvals</span><br><span class="line"><span class="meta">#</span><span class="bash"> è·å–keyæŒ‡å®šçš„å“ˆå¸Œé›†ä¸­æ‰€æœ‰çš„å­—æ®µå’Œå€¼</span></span><br><span class="line">hgetall</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¾‹å¦‚</span></span><br><span class="line">127.0.0.1:6379&gt; hmset hash field1 hello field2 world</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; hmget hash field1 field2</span><br><span class="line">1) &quot;hello&quot;</span><br><span class="line">2) &quot;world&quot;</span><br><span class="line">127.0.0.1:6379&gt; hkeys hash</span><br><span class="line">1) &quot;field1&quot;</span><br><span class="line">2) &quot;field2&quot;</span><br><span class="line">127.0.0.1:6379&gt; hvals hash</span><br><span class="line">1) &quot;hello&quot;</span><br><span class="line">2) &quot;world&quot;</span><br><span class="line">127.0.0.1:6379&gt; hgetall hash</span><br><span class="line">1) &quot;field1&quot;</span><br><span class="line">2) &quot;hello&quot;</span><br><span class="line">3) &quot;field2&quot;</span><br><span class="line">4) &quot;world&quot;</span><br></pre></td></tr></table></figure>



<h4 id="7-1-5-ğŸ‰Sorted-Set"><a href="#7-1-5-ğŸ‰Sorted-Set" class="headerlink" title="7.1.5 ğŸ‰Sorted Set"></a>7.1.5 ğŸ‰Sorted Set</h4><p>æœ‰åºé›†åˆsorted setï¼Œé›†åˆä¸­æ¯ä¸ªå…ƒç´ éƒ½ä¼šå…³è”ä¸€ä¸ªdoubleç±»å‹çš„åˆ†æ•°ã€‚</p>
<ul>
<li><p>redisé€šè¿‡åˆ†æ•°å¯¹é›†åˆä¸­çš„æˆå‘˜è¿›è¡Œæ’åºã€‚</p>
</li>
<li><p>æœ‰åºé›†åˆä¸­æˆå‘˜æ˜¯å”¯ä¸€çš„ï¼Œåˆ†æ•°å¯ä»¥é‡å¤ã€‚</p>
</li>
<li><p>é›†åˆæ˜¯é€šè¿‡å“ˆå¸Œè¡¨å®ç°çš„ï¼Œæ‰€ä»¥å¢åˆ æŸ¥çš„äº‹ä»¶å¤æ‚åº¦éƒ½æ˜¯O(1)ã€‚</p>
</li>
<li><p>é›†åˆä¸­æœ€å¤§çš„æˆå‘˜æ•°é‡ä¸º2^32^-1(4294967295)ï¼Œ æ¯ä¸ªé›†åˆå¯å­˜å‚¨40å¤šäº¿ä¸ªæˆå‘˜ã€‚</p>
</li>
</ul>
<blockquote>
<p>å‘keyçš„æœ‰åºé›†åˆä¸­æ·»åŠ åºå·ä¸ºnumberçš„value</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">zadd &lt;key&gt; &lt;number&gt; &lt;value&gt; [number value ...]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è·å–keyçš„æœ‰åºé›†åˆä¸­çš„æ‰€æœ‰å€¼</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">zrange &lt;key&gt; 0 -1</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è·å–keyçš„æœ‰åºé›†åˆä¸­çš„æˆå‘˜æ•°é‡</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">zcard &lt;key&gt; </span><br></pre></td></tr></table></figure>

<blockquote>
<p>è·å–keyçš„æœ‰åºé›†åˆä¸­æŒ‡å®šä¸‹æ ‡åŒºé—´çš„æˆå‘˜</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">zrange &lt;key&gt; start end</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è·å–keyçš„æœ‰åºé›†åˆä¸­æŒ‡å®šæˆå‘˜memberçš„ç´¢å¼•</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">zrank &lt;key&gt; member</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¯¹keyçš„æœ‰åºé›†åˆä¸­æŒ‡å®šæˆå‘˜memberçš„åˆ†æ•°åŠ ä¸Šå¢é‡</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">zincrby &lt;key&gt; &lt;Integer&gt; member</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è·å–keyçš„æœ‰åºé›†åˆä¸­æŒ‡å®šæˆå‘˜memberçš„åˆ†æ•°å€¼</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">zscore &lt;key&gt; member</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è·å–keyçš„æœ‰åºé›†åˆä¸­æŒ‡å®šæˆå‘˜memberçš„æ’å(ä»å°åˆ°å¤§)</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">zrank &lt;key&gt; member</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è·å–keyçš„æœ‰åºé›†åˆä¸­æŒ‡å®šæˆå‘˜memberçš„æ’å(ä»å¤§åˆ°å°)</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">zrevrank &lt;key&gt; member</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è·å–keyçš„æœ‰åºé›†åˆä¸­åˆ†æ•°åœ¨æŒ‡å®šåŒºé—´[min,max]çš„æˆå‘˜æ•°é‡</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">zcount &lt;key&gt; min max</span><br></pre></td></tr></table></figure>

<blockquote>
<p>é€šè¿‡å­—å…¸åŒºé—´è·å–keyçš„æœ‰åºé›†åˆä¸­çš„æˆå‘˜æ•°é‡</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">zlexcount &lt;key&gt; min max</span><br></pre></td></tr></table></figure>

<blockquote>
<p>é€šè¿‡å­—å…¸åŒºé—´è·å–keyçš„æœ‰åºé›†åˆä¸­çš„æˆå‘˜</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">zrangebylex &lt;key&gt; min max [limit offset count]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è·å–keyçš„æœ‰åºé›†åˆä¸­åˆ†æ•°åœ¨æŒ‡å®šåŒºé—´[min,max]çš„æˆå‘˜</p>
<blockquote>
<p>å‚æ•°è¯´æ˜</p>
<ul>
<li>min max<ul>
<li>é»˜è®¤æƒ…å†µä¸‹ä¸ºé—­åŒºé—´ï¼Œå³[min ,max]</li>
<li>ä¹Ÿå¯ä»¥æ˜¯ä½¿ç”¨å¼€åŒºé—´ï¼Œå³(min, max)ï¼Œå†™æ³•ä¸º<code> (min  (max</code></li>
</ul>
</li>
<li>withscores<ul>
<li>è¿”å›æˆå‘˜çš„åŒæ—¶ä¼šè¿”å›åˆ†æ•°</li>
</ul>
</li>
<li>limit offset count<ul>
<li>offsetï¼šèµ·å§‹ä½ç½®ï¼Œcountï¼šä»èµ·å§‹ä½ç½®å¼€å§‹çš„è®°å½•æ•°é‡</li>
<li>å®ç°åˆ†é¡µæŸ¥è¯¢</li>
<li>å‚æ•°: é¡µæ•°pagenumï¼Œé¡µé¢å¤§å°pagesize</li>
<li>é‚£ä¹ˆå®é™…çš„offset = (pagenum - 1) * pagesizeï¼Œcount = pagesize</li>
<li>å³æŸ¥è¯¢è¯­å¥ä¸º<code>zrangebyscore salary min max withscores limit (pagenum - 1) * pagesize pagesize  </code></li>
</ul>
</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">zrangebyscore &lt;key&gt; min max [withscores] [limit offset count]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¾‹å¦‚</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zadd salary -10000 W -20000 F -30000 S</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; zadd salary 10000 K 20000 A 30000 G</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; zrangebyscore salary -20000 20000</span><br><span class="line">1) &quot;F&quot;</span><br><span class="line">2) &quot;W&quot;</span><br><span class="line">3) &quot;K&quot;</span><br><span class="line">4) &quot;A&quot;</span><br><span class="line">127.0.0.1:6379&gt; zrangebyscore salary -inf inf </span><br><span class="line">1) &quot;S&quot;</span><br><span class="line">2) &quot;F&quot;</span><br><span class="line">3) &quot;W&quot;</span><br><span class="line">4) &quot;K&quot;</span><br><span class="line">5) &quot;A&quot;</span><br><span class="line">6) &quot;G&quot;</span><br><span class="line">127.0.0.1:6379&gt; zrangebyscore salary -inf inf withscores</span><br><span class="line"> 1) &quot;S&quot;</span><br><span class="line"> 2) &quot;-30000&quot;</span><br><span class="line"> 3) &quot;F&quot;</span><br><span class="line"> 4) &quot;-20000&quot;</span><br><span class="line"> 5) &quot;W&quot;</span><br><span class="line"> 6) &quot;-10000&quot;</span><br><span class="line"> 7) &quot;K&quot;</span><br><span class="line"> 8) &quot;10000&quot;</span><br><span class="line"> 9) &quot;A&quot;</span><br><span class="line">10) &quot;20000&quot;</span><br><span class="line">11) &quot;G&quot;</span><br><span class="line">12) &quot;30000&quot;</span><br><span class="line">127.0.0.1:6379&gt; zrangebyscore salary -inf inf withscores limit 4 2</span><br><span class="line">1) &quot;G&quot;</span><br><span class="line">2) &quot;30000&quot;</span><br><span class="line">3) &quot;K&quot;</span><br><span class="line">4) &quot;60000&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>åˆ é™¤keyçš„æœ‰åºé›†åˆä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">zrem &lt;key&gt; member [member ...]</span><br></pre></td></tr></table></figure>



<h3 id="7-2-ğŸŒŒä¸‰ç§ç‰¹æ®Šç±»å‹"><a href="#7-2-ğŸŒŒä¸‰ç§ç‰¹æ®Šç±»å‹" class="headerlink" title="7.2 ğŸŒŒä¸‰ç§ç‰¹æ®Šç±»å‹"></a>7.2 ğŸŒŒä¸‰ç§ç‰¹æ®Šç±»å‹</h3><h4 id="7-2-1-ğŸ”®Geospatial"><a href="#7-2-1-ğŸ”®Geospatial" class="headerlink" title="7.2.1 ğŸ”®Geospatial"></a>7.2.1 ğŸ”®Geospatial</h4><p>Geospatialï¼Œåœ°ç†ç©ºé—´ï¼Œç®€ç§°GEOï¼Œä¸»è¦ç”¨äºå­˜å‚¨åœ°ç†ä½ç½®ä¿¡æ¯ï¼Œå¹¶å¯¹å­˜å‚¨çš„ä¿¡æ¯è¿›è¡Œæ“ä½œã€‚</p>
<blockquote>
<p>æ“ä½œæ–¹æ³•</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">å‘½ä»¤</th>
<th align="center">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="center">geoadd</td>
<td align="center">æ·»åŠ åœ°ç†ä½ç½®çš„åæ ‡</td>
</tr>
<tr>
<td align="center">geopos</td>
<td align="center">è·å–åœ°ç†ä½ç½®çš„åæ ‡</td>
</tr>
<tr>
<td align="center">geodist</td>
<td align="center">è®¡ç®—ä¸¤ä¸ªä½ç½®ä¹‹é—´çš„è·ç¦»</td>
</tr>
<tr>
<td align="center">georadius</td>
<td align="center">æ ¹æ®ç”¨æˆ·ç»™å®šçš„ç»çº¬åº¦åæ ‡æ¥è·å–æŒ‡å®šèŒƒå›´å†…çš„åœ°ç†ä½ç½®é›†åˆ</td>
</tr>
<tr>
<td align="center">georadiusbymember</td>
<td align="center">æ ¹æ®å‚¨å­˜åœ¨ä½ç½®é›†åˆé‡Œé¢çš„æŸä¸ªåœ°ç‚¹è·å–æŒ‡å®šèŒƒå›´å†…çš„åœ°ç†ä½ç½®é›†åˆ</td>
</tr>
<tr>
<td align="center">geohash</td>
<td align="center">è¿”å›ä¸€ä¸ªæˆ–è€…å¤šä¸ªä½ç½®å¯¹è±¡çš„geohashå€¼</td>
</tr>
</tbody></table>
<p>æŸ¥è¯¢åœ°ç†æ•°æ®ï¼š<a href="http://www.jsons.cn/lngcode/">åŸå¸‚ç»çº¬åº¦æŸ¥è¯¢</a></p>
<blockquote>
<p>æµ‹è¯•æ•°æ®</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">åœ°æ–¹</th>
<th align="center">ç»åº¦</th>
<th align="center">çº¬åº¦</th>
</tr>
</thead>
<tbody><tr>
<td align="center">é»„å†ˆå¸‚é»„æ¢…å¿</td>
<td align="center">115.94427</td>
<td align="center">30.07033</td>
</tr>
<tr>
<td align="center">æ­¦æ±‰å¸‚æ­¦æ˜ŒåŒº</td>
<td align="center">114.31589</td>
<td align="center">30.55389</td>
</tr>
<tr>
<td align="center">åŒ—äº¬å¸‚ä¸°å°åŒº</td>
<td align="center">116.28625</td>
<td align="center">39.8585</td>
</tr>
<tr>
<td align="center">ä¸Šæµ·å¸‚é»„æµ¦åŒº</td>
<td align="center">121.49295</td>
<td align="center">31.22337</td>
</tr>
<tr>
<td align="center">åˆè‚¥å¸‚èœ€å±±åŒº</td>
<td align="center">117.26104</td>
<td align="center">31.85117</td>
</tr>
<tr>
<td align="center">æ·±åœ³å¸‚å—å±±åŒº</td>
<td align="center">113.93029</td>
<td align="center">22.53291</td>
</tr>
<tr>
<td align="center">å¤§è¿å¸‚ä¸­å±±åŒº</td>
<td align="center">121.64465</td>
<td align="center">38.91859</td>
</tr>
<tr>
<td align="center">å¹¿å·å¸‚å¤©æ²³åŒº</td>
<td align="center">113.36112</td>
<td align="center">23.12467</td>
</tr>
</tbody></table>
<p>1ï¸âƒ£<strong>geoadd</strong></p>
<blockquote>
<p>æè¿°</p>
</blockquote>
<p>geoaddç”¨äºå­˜å‚¨æŒ‡å®šçš„åœ°ç†ä½ç½®ç©ºé—´ï¼Œå¯ä»¥å°†ä¸€ä¸ªæˆ–å¤šä¸ªç»åº¦(longitude)ã€çº¬åº¦(latitude)ã€ä½ç½®åç§°(member)æ·»åŠ åˆ°æŒ‡å®šçš„keyä¸­ã€‚</p>
<blockquote>
<p>è¯­æ³•</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">geoadd &lt;key&gt; longitude latitude member [longtitude latitude member ...]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è§„åˆ™</p>
</blockquote>
<ul>
<li>ä¸¤çº§æ— æ³•ç›´æ¥æ·»åŠ </li>
<li>æœ‰æ•ˆç»åº¦ï¼š-180 - 180</li>
<li>æœ‰æ•ˆçº¬åº¦ï¼š-85.05112878 - 85.05112878</li>
</ul>
<blockquote>
<p>å®ä¾‹</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; geoadd china:city 115.94427 30.07033 huanggang</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; geoadd china:city 114.31589 30.55389 wuhan</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; geoadd china:city 116.28625 39.8585 beijing</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; geoadd china:city 121.49295 31.22337 shanghai</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; geoadd china:city 117.26104 31.85117 hefei</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; geoadd china:city 113.93029 22.53291 shenzhen</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; geoadd china:city 121.64465 38.91859 dalian</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; geoadd china:city 113.36112 23.12467 guangzhou</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>

<p>å®é™…åº”ç”¨ä¸­ï¼Œä¸€èˆ¬ä¼šæŠŠåŸå¸‚åœ°ç†æ•°æ®å†™åœ¨æ–‡ä»¶ä¸­ï¼Œç›´æ¥é€šè¿‡javaç¨‹åºä¸€æ¬¡æ€§å¯¼å…¥ã€‚</p>
<p>2ï¸âƒ£<strong>geopos</strong></p>
<blockquote>
<p>æè¿°</p>
</blockquote>
<p>geoposç”¨äºä»ç»™å®šçš„keyé‡Œè¿”å›æ‰€æœ‰æŒ‡å®šåç§°(member)çš„ä½ç½®(ç»åº¦å’Œçº¬åº¦)ï¼Œä¸å­˜åœ¨çš„è¿”å›nilã€‚</p>
<blockquote>
<p>è¯­æ³•</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">geopos &lt;key&gt; member [member ...]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å®ä¾‹</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; geopos china:city huanggang shenzhen shanghai </span><br><span class="line">1) 1) &quot;115.94427019357681274&quot;</span><br><span class="line">   2) &quot;30.07033115798519418&quot;</span><br><span class="line">2) 1) &quot;113.93029063940048218&quot;</span><br><span class="line">   2) &quot;22.53290942281488896&quot;</span><br><span class="line">3) 1) &quot;121.49295061826705933&quot;</span><br><span class="line">   2) &quot;31.22337074392616074&quot;</span><br></pre></td></tr></table></figure>



<p>3ï¸âƒ£<strong>geodist</strong></p>
<blockquote>
<p>æè¿°</p>
</blockquote>
<p>geodistç”¨äºè®¡ç®—ä¸¤ä¸ªç»™å®šä½ç½®ä¹‹é—´çš„è·ç¦»ã€‚</p>
<blockquote>
<p>è¯­æ³•</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">geodist &lt;key&gt; member1 member2 [m|km|ft|mi]</span><br></pre></td></tr></table></figure>

<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li>member1å’Œmember2ä¸ºä¸¤ä¸ªåœ°ç†ä½ç½®</li>
<li>mï¼šç±³ï¼Œé»˜è®¤ä½ç½®</li>
<li>kmï¼šåƒç±³</li>
<li>miï¼šè‹±é‡Œ</li>
<li>ftï¼šè‹±å°º</li>
</ul>
<blockquote>
<p>å®ä¾‹</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; geodist china:city huanggang shenzhen</span><br><span class="line">&quot;862016.4959&quot;</span><br><span class="line">127.0.0.1:6379&gt; geodist china:city huanggang hefei km</span><br><span class="line">&quot;234.5308&quot;</span><br><span class="line">127.0.0.1:6379&gt; geodist china:city shanghai dalian mi</span><br><span class="line">&quot;531.9085&quot;</span><br></pre></td></tr></table></figure>



<p>4ï¸âƒ£<strong>georadius</strong></p>
<blockquote>
<p>æè¿°</p>
</blockquote>
<p>ç»™å®šä¸€ä¸ªä¸­å¿ƒçš„åœ°ç†ä½ç½®(ç»åº¦å’Œçº¬åº¦)ï¼Œç»™å®šä¸€ä¸ªæœ€å¤§è·ç¦»ï¼Œè¿”å›ç»™å®šçš„keyåŒ…å«çš„ä½ç½®å…ƒç´ ä¸­ï¼Œä¸ä¸­å¿ƒçš„è·ç¦»ä¸è¶…è¿‡æœ€å¤§è·ç¦»çš„æ‰€æœ‰ä½ç½®å…ƒç´ ã€‚</p>
<blockquote>
<p>è¯­æ³•</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">georadius &lt;key&gt; longitude latitude radius m|km|ft|mi [withcoord] [withdist] [withhash] [count] [asc|desc] [store key] [storedist key]</span><br></pre></td></tr></table></figure>

<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li><p>longitudeï¼šç»™å®šä¸­å¿ƒçš„ç»åº¦</p>
</li>
<li><p>latitudeï¼šç»™å®šä¸­å¿ƒçš„çº¬åº¦</p>
</li>
<li><p>radiusï¼šç»™å®šçš„æœ€å¤§è·ç¦»</p>
</li>
<li><p>withcoordï¼šè¿”å›+(ä½ç½®å…ƒç´ çš„ç»åº¦å’Œçº¬åº¦)</p>
</li>
<li><p>withdistï¼šè¿”å›+(ä½ç½®å…ƒç´ ä¸ä¸­å¿ƒä¹‹é—´çš„è·ç¦»)</p>
</li>
<li><p>withhashï¼šä»¥ 52 ä½æœ‰ç¬¦å·æ•´æ•°çš„å½¢å¼ï¼Œ è¿”å›ä½ç½®å…ƒç´ ç»è¿‡åŸå§‹ geohash ç¼–ç çš„æœ‰åºé›†åˆåˆ†å€¼ã€‚ è¿™ä¸ªé€‰é¡¹ä¸»è¦ç”¨äºåº•å±‚åº”ç”¨æˆ–è€…è°ƒè¯•ï¼Œ å®é™…ä¸­çš„ä½œç”¨å¹¶ä¸å¤§ã€‚</p>
</li>
<li><p>countï¼šé™å®šè¿”å›çš„è®°å½•æ•°é‡</p>
</li>
<li><p>ascï¼šæŸ¥æ‰¾ç»“æœæ ¹æ®è·ç¦»ä»å°åˆ°å¤§æ’åº</p>
</li>
<li><p>descï¼šæŸ¥æ‰¾ç»“æœæ ¹æ®è·ç¦»ä»å¤§åˆ°å°æ’åº</p>
</li>
</ul>
<blockquote>
<p>å®ä¾‹</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹è·ç¦»å¹¿å·ä¸å¤§äº1000kmçš„åŸå¸‚</span></span><br><span class="line">127.0.0.1:6379&gt; georadius china:city 113.36112 23.12467 1000 km asc</span><br><span class="line">1) &quot;guangzhou&quot;</span><br><span class="line">2) &quot;shenzhen&quot;</span><br><span class="line">3) &quot;huanggang&quot;</span><br><span class="line">4) &quot;wuhan&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹è·ç¦»æ­¦æ±‰ä¸å¤§äº1000kmçš„åŸå¸‚ï¼Œä»å¤§åˆ°å°ï¼Œé™åˆ¶5ä¸ªï¼Œå¹¶ä¸”æ˜¾ç¤ºè·ç¦»å’ŒåŸå¸‚ç»çº¬åº¦</span></span><br><span class="line">127.0.0.1:6379&gt; georadius china:city 114.31589 30.55389 1000 km withcoord withdist count 5 desc </span><br><span class="line">1) 1) &quot;shenzhen&quot;</span><br><span class="line">   2) &quot;892.9663&quot;</span><br><span class="line">   3) 1) &quot;113.93029063940048218&quot;</span><br><span class="line">      2) &quot;22.53290942281488896&quot;</span><br><span class="line">2) 1) &quot;guangzhou&quot;</span><br><span class="line">   2) &quot;831.7263&quot;</span><br><span class="line">   3) 1) &quot;113.36112052202224731&quot;</span><br><span class="line">      2) &quot;23.12467049411647935&quot;</span><br><span class="line">3) 1) &quot;shanghai&quot;</span><br><span class="line">   2) &quot;688.9652&quot;</span><br><span class="line">   3) 1) &quot;121.49295061826705933&quot;</span><br><span class="line">      2) &quot;31.22337074392616074&quot;</span><br><span class="line">4) 1) &quot;hefei&quot;</span><br><span class="line">   2) &quot;315.1437&quot;</span><br><span class="line">   3) 1) &quot;117.26104170083999634&quot;</span><br><span class="line">      2) &quot;31.85117048067123591&quot;</span><br><span class="line">5) 1) &quot;huanggang&quot;</span><br><span class="line">   2) &quot;165.3475&quot;</span><br><span class="line">   3) 1) &quot;115.94427019357681274&quot;</span><br><span class="line">      2) &quot;30.07033115798519418&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹è·ç¦»åŒ—äº¬ä¸å¤§äº1500kmçš„åŸå¸‚</span></span><br><span class="line">127.0.0.1:6379&gt; georadius china:city 116.28625 39.8585 1500 km withdist asc</span><br><span class="line">1) 1) &quot;beijing&quot;</span><br><span class="line">   2) &quot;0.0002&quot;</span><br><span class="line">2) 1) &quot;dalian&quot;</span><br><span class="line">   2) &quot;472.2545&quot;</span><br><span class="line">3) 1) &quot;hefei&quot;</span><br><span class="line">   2) &quot;894.9324&quot;</span><br><span class="line">4) 1) &quot;wuhan&quot;</span><br><span class="line">   2) &quot;1050.2106&quot;</span><br><span class="line">5) 1) &quot;shanghai&quot;</span><br><span class="line">   2) &quot;1069.3051&quot;</span><br><span class="line">6) 1) &quot;huanggang&quot;</span><br><span class="line">   2) &quot;1089.1453&quot;</span><br></pre></td></tr></table></figure>



<p>5ï¸âƒ£<strong>georadiusbymember</strong></p>
<blockquote>
<p>æè¿°</p>
</blockquote>
<p>georadiusbymember å’Œ georadiuså‘½ä»¤ä¸€æ ·ï¼Œ éƒ½å¯ä»¥æ‰¾å‡ºä½äºæŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ ï¼Œ ä½†æ˜¯ georadiusbymember çš„ä¸­å¿ƒç‚¹æ˜¯åªèƒ½ä»keyä¸­çš„ä½ç½®å…ƒç´ é€‰ã€‚</p>
<blockquote>
<p>è¯­æ³•</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">georadiusbymember &lt;key&gt; member radius m|km|ft|mi [withcoord] [withdist] [withhash] [count] [asc|desc] [store key] [storedist key]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å®ä¾‹</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹è·ç¦»é»„å†ˆä¸å¤§äº900kmçš„åŸå¸‚</span></span><br><span class="line">127.0.0.1:6379&gt; georadiusbymember china:city huanggang 900 km withdist asc</span><br><span class="line">1) 1) &quot;huanggang&quot;</span><br><span class="line">   2) &quot;0.0000&quot;</span><br><span class="line">2) 1) &quot;wuhan&quot;</span><br><span class="line">   2) &quot;165.3475&quot;</span><br><span class="line">3) 1) &quot;hefei&quot;</span><br><span class="line">   2) &quot;234.5308&quot;</span><br><span class="line">4) 1) &quot;shanghai&quot;</span><br><span class="line">   2) &quot;546.1566&quot;</span><br><span class="line">5) 1) &quot;guangzhou&quot;</span><br><span class="line">   2) &quot;814.0494&quot;</span><br><span class="line">6) 1) &quot;shenzhen&quot;</span><br><span class="line">   2) &quot;862.0165&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹è·ç¦»æ·±åœ³ä¸å¤§äº2000kmçš„åŸå¸‚</span></span><br><span class="line">127.0.0.1:6379&gt; georadiusbymember china:city shenzhen 2000 km withdist desc</span><br><span class="line">1) 1) &quot;dalian&quot;</span><br><span class="line">   2) &quot;1964.1097&quot;</span><br><span class="line">2) 1) &quot;beijing&quot;</span><br><span class="line">   2) &quot;1939.8454&quot;</span><br><span class="line">3) 1) &quot;shanghai&quot;</span><br><span class="line">   2) &quot;1222.7809&quot;</span><br><span class="line">4) 1) &quot;hefei&quot;</span><br><span class="line">   2) &quot;1087.3585&quot;</span><br><span class="line">5) 1) &quot;wuhan&quot;</span><br><span class="line">   2) &quot;892.9663&quot;</span><br><span class="line">6) 1) &quot;huanggang&quot;</span><br><span class="line">   2) &quot;862.0165&quot;</span><br><span class="line">7) 1) &quot;guangzhou&quot;</span><br><span class="line">   2) &quot;87.9580&quot;</span><br><span class="line">8) 1) &quot;shenzhen&quot;</span><br><span class="line">   2) &quot;0.0000&quot;</span><br></pre></td></tr></table></figure>



<p>6ï¸âƒ£<strong>geohash</strong></p>
<blockquote>
<p>æè¿°</p>
</blockquote>
<p>geohashç”¨äºè·å–ä¸€ä¸ªæˆ–å¤šä¸ªä½ç½®å…ƒç´ çš„geohashå€¼ã€‚</p>
<blockquote>
<p>å®è´¨</p>
</blockquote>
<p><strong>é™ç»´æ‰“å‡»</strong>ï¼šå°†äºŒç»´çš„ç»çº¬åº¦è½¬æ¢ä¸ºä¸€ç»´çš„å­—ç¬¦ä¸²</p>
<p>å¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²è¶Šæ¥è¿‘ï¼Œé‚£ä¹ˆè·ç¦»è¶Šè¿‘ã€‚</p>
<blockquote>
<p>è¯­æ³•</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">geohash &lt;key&gt; member [member ...]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å®ä¾‹</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; geohash china:city huanggang beijing hefei</span><br><span class="line">1) &quot;wt67n6hh3k0&quot;</span><br><span class="line">2) &quot;wx4dy0j0d40&quot;</span><br><span class="line">3) &quot;wtemhq6fs20&quot;</span><br></pre></td></tr></table></figure>



<p>7ï¸âƒ£<strong>Other</strong></p>
<blockquote>
<p>GEO</p>
</blockquote>
<p>GEOçš„åº•å±‚åŸç†å°±æ˜¯Sorted Setï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Sorted Setå‘½ä»¤æ¥æ“ä½œGEOã€‚</p>
<blockquote>
<p>å®ä¾‹</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹åœ°å›¾ä¸­å…¨éƒ¨å…ƒç´ </span></span><br><span class="line">127.0.0.1:6379&gt; zrange china:city 0 -1</span><br><span class="line">1) &quot;shenzhen&quot;</span><br><span class="line">2) &quot;guangzhou&quot;</span><br><span class="line">3) &quot;wuhan&quot;</span><br><span class="line">4) &quot;huanggang&quot;</span><br><span class="line">5) &quot;hefei&quot;</span><br><span class="line">6) &quot;shanghai&quot;</span><br><span class="line">7) &quot;beijing&quot;</span><br><span class="line">8) &quot;dalian&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> ç§»é™¤å¤§è¿è¿™ä¸ªåŸå¸‚</span></span><br><span class="line">127.0.0.1:6379&gt; zrem china:city dalian</span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŒ‰ç…§åˆ†æ•°ç»™åŸå¸‚æ’å</span></span><br><span class="line">127.0.0.1:6379&gt; zrangebyscore china:city -inf inf withscores</span><br><span class="line"> 1) &quot;shenzhen&quot;</span><br><span class="line"> 2) &quot;4046431599170567&quot;</span><br><span class="line"> 3) &quot;guangzhou&quot;</span><br><span class="line"> 4) &quot;4046534293000673&quot;</span><br><span class="line"> 5) &quot;wuhan&quot;</span><br><span class="line"> 6) &quot;4051938129491420&quot;</span><br><span class="line"> 7) &quot;huanggang&quot;</span><br><span class="line"> 8) &quot;4052334404505800&quot;</span><br><span class="line"> 9) &quot;hefei&quot;</span><br><span class="line">10) &quot;4052764524670284&quot;</span><br><span class="line">11) &quot;shanghai&quot;</span><br><span class="line">12) &quot;4054757680623470&quot;</span><br><span class="line">13) &quot;beijing&quot;</span><br><span class="line">14) &quot;4069146323276357&quot;</span><br></pre></td></tr></table></figure>



<h4 id="7-2-2-ğŸ“„HyperLogLog"><a href="#7-2-2-ğŸ“„HyperLogLog" class="headerlink" title="7.2.2 ğŸ“„HyperLogLog"></a>7.2.2 ğŸ“„HyperLogLog</h4><p>HyperLogLogï¼ŒRedisä¸­åŸºæ•°ç»Ÿè®¡çš„ç®—æ³•ã€‚</p>
<blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<p>å ç”¨å†…å­˜å›ºå®šä¸”è¾ƒå°ã€‚æ¯ä¸ªHyperLogLogé”®å ç”¨12KBå†…å­˜ï¼Œå¯ä»¥è®¡ç®—2^64^ä¸ªä¸åŒå…ƒç´ çš„åŸºæ•°ã€‚</p>
<blockquote>
<p>åŸºæ•°</p>
</blockquote>
<p>ä¸€ä¸ªæ•°æ®é›†ä¸­ä¸é‡å¤å…ƒç´ çš„æ•°é‡</p>
<blockquote>
<p>åº”ç”¨åœºæ™¯</p>
</blockquote>
<p>ç»Ÿè®¡ç½‘ç«™UV</p>
<p>ä¼ ç»Ÿæ–¹å¼ï¼šä½¿ç”¨setä¿å­˜ç”¨æˆ·idï¼Œsetçš„å…ƒç´ æ•°é‡å¯ä½œä¸ºæ ‡å‡†åˆ¤æ–­ã€‚</p>
<p>è¿™ä¸ªæ–¹å¼å¦‚æœä¿å­˜å¤§é‡çš„ç”¨æˆ·idï¼Œå°±ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œç›®çš„æ˜¯è®¡æ•°ï¼Œè€Œéä¿å­˜ç”¨æˆ·idã€‚</p>
<p>ä½¿ç”¨HyperLogLogä¼šæœ‰**0.81%**çš„é”™è¯¯ç‡ï¼Œè¿™ä¸ªåœ¨ç»Ÿè®¡UVä»»åŠ¡ä¸­æ˜¯å¯ä»¥æ¥å—çš„ã€‚</p>
<blockquote>
<p>æ“ä½œæ–¹æ³•</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">å‘½ä»¤</th>
<th align="center">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="center">pfadd &lt;key&gt; element [element â€¦]</td>
<td align="center">æ·»åŠ æŒ‡å®šå…ƒç´ åˆ°HyperLogLogä¸­</td>
</tr>
<tr>
<td align="center">pfcount &lt;key&gt;</td>
<td align="center">è¿”å›ç»™å®šHyperLogLogçš„åŸºæ•°ä¼°ç®—å€¼</td>
</tr>
<tr>
<td align="center">pfmerge &lt;destkey&gt; &lt;key&gt; [keyâ€¦]</td>
<td align="center">å°†å¤šä¸ªHyperLogLogåˆå¹¶ä¸ºä¸€ä¸ªHyperLogLog</td>
</tr>
</tbody></table>
<blockquote>
<p>å®ä¾‹</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºç¬¬ä¸€ç»„å…ƒç´ </span></span><br><span class="line">127.0.0.1:6379&gt; pfadd hyper K H I G H N E S S </span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta">#</span><span class="bash"> ç»Ÿè®¡ç¬¬ä¸€ç»„å…ƒç´ åŸºæ•°</span></span><br><span class="line">127.0.0.1:6379&gt; pfcount hyper</span><br><span class="line">(integer) 7</span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºç¬¬äºŒç»„å…ƒç´ </span></span><br><span class="line">127.0.0.1:6379&gt; pfadd hyper2 P A R A K</span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta">#</span><span class="bash"> ç»Ÿè®¡ç¬¬äºŒç»„å…ƒç´ åŸºæ•°</span></span><br><span class="line">127.0.0.1:6379&gt; pfcount hyper2</span><br><span class="line">(integer) 4</span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆå¹¶ä¸¤ç»„å…ƒç´ </span></span><br><span class="line">127.0.0.1:6379&gt; pfmerge hyper hyper hyper2</span><br><span class="line">OK</span><br><span class="line"><span class="meta">#</span><span class="bash"> ç»Ÿè®¡æ‰€æœ‰å…ƒç´ åŸºæ•°</span></span><br><span class="line">127.0.0.1:6379&gt; pfcount hyper</span><br><span class="line">(integer) 10</span><br></pre></td></tr></table></figure>





<h4 id="7-1-3-ğŸ”³Bitmaps"><a href="#7-1-3-ğŸ”³Bitmaps" class="headerlink" title="7.1.3 ğŸ”³Bitmaps"></a>7.1.3 ğŸ”³Bitmaps</h4><p>Bitmapsï¼Œä½å›¾ï¼Œæ“ä½œäºŒè¿›åˆ¶ä½æ¥è¿›è¡Œè®°å½•ï¼Œåªæœ‰0å’Œ1ä¸¤ä¸ªçŠ¶æ€ã€‚</p>
<blockquote>
<p>åº”ç”¨åœºæ™¯</p>
</blockquote>
<p>ç»Ÿè®¡ç”¨æˆ·æ´»è·ƒåº¦ï¼Œæ‰“å¡ï¼Œä¸¤ä¸ªçŠ¶æ€çš„éƒ½å¯ä»¥ä½¿ç”¨Bitmapsã€‚</p>
<blockquote>
<p>æ“ä½œæ–¹æ³•</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">å‘½ä»¤</th>
<th align="center">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="center">setbit &lt;key&gt; offset value</td>
<td align="center">è®¾ç½®å€¼</td>
</tr>
<tr>
<td align="center">getbit &lt;key&gt;  offset</td>
<td align="center">è·å–å€¼</td>
</tr>
<tr>
<td align="center">bitcount &lt;key&gt; start end</td>
<td align="center">è·å–BitmapsæŒ‡å®šèŒƒå›´å€¼ä¸º1çš„ä¸ªæ•°</td>
</tr>
<tr>
<td align="center">bitop and|or|not|xor &lt;destkey&gt; key [key â€¦]</td>
<td align="center">Bitmapsçš„é›†åˆè¿ç®—</td>
</tr>
</tbody></table>
<blockquote>
<p>å®ä¾‹</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æ‰“å¡ 0-6:å‘¨ä¸€-å‘¨æ—¥</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2020å¹´ç¬¬ä¸€å‘¨æ‰“å¡</span></span><br><span class="line">127.0.0.1:6379&gt; setbit 2020:week:1 0 1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit 2020:week:1 1 1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit 2020:week:1 2 1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit 2020:week:1 3 1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit 2020:week:1 4 1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit 2020:week:1 5 0</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit 2020:week:1 6 0</span><br><span class="line">(integer) 0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2020å¹´ç¬¬äºŒå‘¨æ‰“å¡</span></span><br><span class="line">127.0.0.1:6379&gt; setbit 2020:week:2 0 0</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit 2020:week:2 1 0</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit 2020:week:2 2 0</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit 2020:week:2 3 1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit 2020:week:2 4 0</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; setbit 2020:week:2 5 1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit 2020:week:2 6 1</span><br><span class="line">(integer) 0</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ£€æŸ¥æ‰“å¡</span></span><br><span class="line">127.0.0.1:6379&gt; getbit 2020:week:1 3</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; getbit 2020:week:2 1</span><br><span class="line">(integer) 0</span><br><span class="line"><span class="meta">#</span><span class="bash"> ç»Ÿè®¡æ‰“å¡</span></span><br><span class="line">127.0.0.1:6379&gt; bitcount 2020:week:1</span><br><span class="line">(integer) 5</span><br><span class="line">127.0.0.1:6379&gt; bitcount 2020:week:2</span><br><span class="line">(integer) 3</span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯¹ä¸¤å‘¨æ‰“å¡ç»“æœå–å¹¶é›†</span></span><br><span class="line">127.0.0.1:6379&gt; bitop and andres 2020:week:1 2020:week:2</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; bitcount andres</span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯¹ä¸¤å‘¨æ‰“å¡ç»“æœå–äº¤é›†</span></span><br><span class="line">127.0.0.1:6379&gt; bitop or orres 2020:week:1 2020:week:2</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; bitcount orres</span><br><span class="line">(integer) 7</span><br></pre></td></tr></table></figure>



<h2 id="8-ğŸ“©Redisäº‹åŠ¡"><a href="#8-ğŸ“©Redisäº‹åŠ¡" class="headerlink" title="8. ğŸ“©Redisäº‹åŠ¡"></a>8. ğŸ“©Redisäº‹åŠ¡</h2><blockquote>
<p> ğŸ’¡ è¯´æ˜</p>
</blockquote>
<p>Rediså•æ¡å‘½ä»¤æ‰§è¡Œå…·æœ‰åŸå­æ€§ï¼Œä½†æ˜¯äº‹åŠ¡ä¸ä¿è¯åŸå­æ€§ã€‚</p>
<h3 id="8-1ğŸ“–å®šä¹‰"><a href="#8-1ğŸ“–å®šä¹‰" class="headerlink" title="8. 1ğŸ“–å®šä¹‰"></a>8. 1ğŸ“–å®šä¹‰</h3><p>ä¸€ç»„å‘½ä»¤çš„é˜Ÿåˆ—</p>
<h3 id="8-2-ğŸŒ ç‰¹å¾"><a href="#8-2-ğŸŒ ç‰¹å¾" class="headerlink" title="8.2 ğŸŒ ç‰¹å¾"></a>8.2 ğŸŒ ç‰¹å¾</h3><ul>
<li>ä¸€æ¬¡æ€§</li>
<li>é¡ºåºæ€§</li>
<li>æ’ä»–æ€§</li>
</ul>
<h3 id="8-3-â³ä¸‰ä¸ªé˜¶æ®µ"><a href="#8-3-â³ä¸‰ä¸ªé˜¶æ®µ" class="headerlink" title="8.3 â³ä¸‰ä¸ªé˜¶æ®µ"></a>8.3 â³ä¸‰ä¸ªé˜¶æ®µ</h3><ul>
<li>å¼€å§‹äº‹åŠ¡ (multi)</li>
<li>å‘½ä»¤å…¥é˜Ÿ (â€¦)</li>
<li>æ‰§è¡Œäº‹åŠ¡ (exec)</li>
</ul>
<h3 id="8-4-ğŸ“æ“ä½œæ–¹æ³•"><a href="#8-4-ğŸ“æ“ä½œæ–¹æ³•" class="headerlink" title="8.4 ğŸ“æ“ä½œæ–¹æ³•"></a>8.4 ğŸ“æ“ä½œæ–¹æ³•</h3><table>
<thead>
<tr>
<th align="center">å‘½ä»¤</th>
<th align="center">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="center">discard</td>
<td align="center">å–æ¶ˆäº‹åŠ¡ï¼Œæ”¾å¼ƒæ‰§è¡Œäº‹åŠ¡å—å†…çš„æ‰€æœ‰å‘½ä»¤</td>
</tr>
<tr>
<td align="center">exec</td>
<td align="center">æ‰§è¡Œäº‹åŠ¡å—å†…çš„æ‰€æœ‰å‘½ä»¤</td>
</tr>
<tr>
<td align="center">multi</td>
<td align="center">æ ‡è®°ä¸€ä¸ªäº‹åŠ¡çš„å¼€å§‹</td>
</tr>
<tr>
<td align="center">unwatch</td>
<td align="center">å–æ¶ˆwatchå‘½ä»¤å¯¹æ‰€æœ‰keyçš„ç›‘è§†</td>
</tr>
<tr>
<td align="center">watch</td>
<td align="center">ç›‘è§†ä¸€ä¸ªæˆ–å¤šä¸ªkeyï¼Œå¦‚æœåœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰è¿™ä¸ªæˆ–è¿™äº›keyè¢«å…¶ä»–å‘½ä»¤é”æ”¹åŠ¨ï¼Œé‚£ä¹ˆäº‹åŠ¡å°†è¢«æ‰“æ–­</td>
</tr>
</tbody></table>
<h3 id="8-5-ğŸ•µï¸å®ä¾‹"><a href="#8-5-ğŸ•µï¸å®ä¾‹" class="headerlink" title="8.5 ğŸ•µï¸å®ä¾‹"></a>8.5 ğŸ•µï¸å®ä¾‹</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¼€å¯äº‹åŠ¡</span></span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line"><span class="meta">#</span><span class="bash"> å‘½ä»¤å…¥é˜Ÿ</span></span><br><span class="line">127.0.0.1:6379&gt; set k1 v1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; set k2 v2 </span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; mget k1 k2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; getset k3 v3</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; get k3</span><br><span class="line">QUEUED</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ‰§è¡Œäº‹åŠ¡</span></span><br><span class="line">127.0.0.1:6379&gt; exec</span><br><span class="line">1) OK</span><br><span class="line">2) OK</span><br><span class="line">3) 1) &quot;v1&quot;</span><br><span class="line">   2) &quot;v2&quot;</span><br><span class="line">4) &quot;v3&quot;</span><br><span class="line">5) &quot;v3&quot;</span><br></pre></td></tr></table></figure>



<h3 id="8-6-â­•å¼‚å¸¸"><a href="#8-6-â­•å¼‚å¸¸" class="headerlink" title="8.6 â­•å¼‚å¸¸"></a>8.6 â­•å¼‚å¸¸</h3><ul>
<li>å‘½ä»¤å¼‚å¸¸ï¼šå‘½ä»¤å­˜åœ¨é”™è¯¯ï¼Œæ‰€æœ‰å‘½ä»¤éƒ½ä¸ä¼šè¢«æ‰§è¡Œ</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set k1 v1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; set k2 v2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; getset k3 # é”™è¯¯å‘½ä»¤</span><br><span class="line">(error) ERR wrong number of arguments for &#x27;getset&#x27; command</span><br><span class="line">127.0.0.1:6379&gt; set k4 v4</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; exec # æ‰§è¡Œäº‹åŠ¡æŠ¥é”™</span><br><span class="line">(error) EXECABORT Transaction discarded because of previous errors.</span><br><span class="line">127.0.0.1:6379&gt; get k1 # æ‰€æœ‰å‘½ä»¤éƒ½æœªè¢«æ‰§è¡Œ</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure>

<ul>
<li>è¿è¡Œå¼‚å¸¸ï¼šé”™è¯¯æ“ä½œçš„å‘½ä»¤æŠ›å‡ºå¼‚å¸¸ï¼Œå…¶ä»–å‘½ä»¤æ­£å¸¸æ‰§è¡Œ</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi </span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set k1 v1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; incr k1 # é”™è¯¯æ“ä½œ</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; set k2 v2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; exec # æ‰§è¡Œäº‹åŠ¡ä»…é”™è¯¯æ“ä½œæ‰§è¡Œå¤±è´¥ï¼Œå…¶ä»–å‘½ä»¤æ‰§è¡ŒæˆåŠŸ</span><br><span class="line">1) OK</span><br><span class="line">2) (error) ERR value is not an integer or out of range</span><br><span class="line">3) OK</span><br><span class="line">127.0.0.1:6379&gt; mget k1 k2</span><br><span class="line">1) &quot;v1&quot;</span><br><span class="line">2) &quot;v2&quot;</span><br></pre></td></tr></table></figure>



<h3 id="9-7-ğŸ”­ç›‘æ§"><a href="#9-7-ğŸ”­ç›‘æ§" class="headerlink" title="9.7 ğŸ”­ç›‘æ§"></a>9.7 ğŸ”­ç›‘æ§</h3><ul>
<li>æ‚²è§‚é”ï¼šå¾ˆæ‚²è§‚ï¼Œè®¤ä¸ºä»€ä¹ˆæ—¶å€™éƒ½ä¼šå‡ºé—®é¢˜ï¼Œæ— è®ºåšä»€ä¹ˆéƒ½ä¼šåŠ é”ã€‚</li>
<li>ä¹è§‚é”ï¼šå¾ˆä¹è§‚ï¼Œè®¤ä¸ºä»€ä¹ˆæ—¶å€™éƒ½ä¸ä¼šå‡ºé—®é¢˜ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ã€‚æ›´æ–°æ•°æ®çš„æ—¶å€™ä¼šæ¯”è¾ƒversionï¼Œåˆ¤æ–­æ•°æ®æ˜¯å¦æ›´æ–°è¿‡ã€‚</li>
<li>watchçš„æœ¬è´¨ï¼šselect versionï¼Œä¸€æ—¦å‘ç°ç›‘è§†çš„æ•°æ®versionæ”¹å˜ï¼Œäº‹åŠ¡å°†è¢«æ‰“æ–­ã€‚</li>
</ul>
<blockquote>
<p>å®ä¾‹1-watchçš„ç›‘æ§æµ‹è¯•</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä¸ªäººè´¢åŠ¡</span></span><br><span class="line">127.0.0.1:6379&gt; set money 100</span><br><span class="line">OK</span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸ªäººæ”¯å‡º</span></span><br><span class="line">127.0.0.1:6379&gt; set out 0</span><br><span class="line">OK</span><br><span class="line"><span class="meta">#</span><span class="bash"> ç›‘æ§è´¢åŠ¡</span></span><br><span class="line">127.0.0.1:6379&gt; watch money </span><br><span class="line">OK</span><br><span class="line"><span class="meta">#</span><span class="bash"> å¼€å¯äº‹åŠ¡</span></span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ¶ˆè´¹10å…ƒ</span></span><br><span class="line">127.0.0.1:6379&gt; decrby money 30</span><br><span class="line">QUEUED</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ”¯å‡ºå¢åŠ </span></span><br><span class="line">127.0.0.1:6379&gt; incrby out 30</span><br><span class="line">QUEUED</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ‰§è¡Œäº‹åŠ¡</span></span><br><span class="line">127.0.0.1:6379&gt; exec</span><br><span class="line">1) (integer) 70</span><br><span class="line">2) (integer) 30</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å®ä¾‹2-watchçš„å¤šçº¿ç¨‹æµ‹è¯•ï¼Œwatchå¯ä»¥å½“åšredisçš„ä¹è§‚é”æ“ä½œ</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> çº¿ç¨‹1</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ç›‘æ§è´¢åŠ¡</span></span><br><span class="line">127.0.0.1:6379&gt; watch money</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ¶ˆè´¹10å…ƒ</span></span><br><span class="line">127.0.0.1:6379&gt; decrby money 10</span><br><span class="line">QUEUED</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ”¯å‡ºå¢åŠ </span></span><br><span class="line">127.0.0.1:6379&gt; incrby out 10</span><br><span class="line">QUEUED</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ‰§è¡Œä¹‹å‰çº¿ç¨‹2ä¿®æ”¹äº†è´¢åŠ¡ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå¯¼è‡´äº‹åŠ¡æ‰§è¡Œå¤±è´¥</span></span><br><span class="line">127.0.0.1:6379&gt; exec</span><br><span class="line">(nil)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> çº¿ç¨‹2 </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ‰§è¡Œåœ¨çº¿ç¨‹1çš„äº‹åŠ¡<span class="built_in">exec</span>ä¹‹å‰</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥è¯¢è´¢åŠ¡</span></span><br><span class="line">127.0.0.1:6379&gt; get money</span><br><span class="line">&quot;70&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> å……å€¼1000</span></span><br><span class="line">127.0.0.1:6379&gt; incrby money 1000</span><br><span class="line">(integer) 1070</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> çº¿ç¨‹1</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ‰§è¡Œåœ¨çº¿ç¨‹1çš„äº‹åŠ¡<span class="built_in">exec</span>ä¹‹å</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1ã€å¦‚æœå‘ç°äº‹åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œå°±å…ˆè§£é”</span></span><br><span class="line">127.0.0.1:6379&gt; unwatch </span><br><span class="line">OK</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2ã€è·å–æœ€æ–°çš„å€¼ï¼Œå†æ¬¡ç›‘è§†</span></span><br><span class="line">127.0.0.1:6379&gt; watch money</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; decrby money 50</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; incrby out 50</span><br><span class="line">QUEUED</span><br><span class="line"><span class="meta">#</span><span class="bash"> 3ã€å¯¹æ¯”ç›‘è§†çš„å€¼æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœæ²¡æœ‰å˜åŒ–ï¼Œé‚£ä¹ˆå¯ä»¥æ‰§è¡ŒæˆåŠŸï¼Œå¦åˆ™æ‰§è¡Œå¤±è´¥</span></span><br><span class="line">127.0.0.1:6379&gt; exec</span><br><span class="line">1) (integer) 1020</span><br><span class="line">2) (integer) 80</span><br></pre></td></tr></table></figure>



<h2 id="9-ğŸ“©Jedis"><a href="#9-ğŸ“©Jedis" class="headerlink" title="9. ğŸ“©Jedis"></a>9. ğŸ“©Jedis</h2><blockquote>
<p>ğŸ“¢ è¯´æ˜</p>
</blockquote>
<p>Jedisæ˜¯Rediså®˜æ–¹æ¨èçš„Javaè¿æ¥å¼€å‘å·¥å…·ã€‚</p>
<p>Jedisä¸­çš„æ‰€æœ‰apiå°±å¯¹åº”Redisä¸­çš„æ‰€æœ‰å‘½ä»¤ã€‚</p>
<h3 id="9-1-â•å¯¼å…¥ä¾èµ–"><a href="#9-1-â•å¯¼å…¥ä¾èµ–" class="headerlink" title="9.1 â•å¯¼å…¥ä¾èµ–"></a>9.1 â•å¯¼å…¥ä¾èµ–</h3><blockquote>
<p>pom.xml</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>top.parak<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springboot-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">developers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">developer</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>KHighness<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">email</span>&gt;</span>parakovo@gmail.com<span class="tag">&lt;/<span class="name">email</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">developer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">developers</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">fastjson.version</span>&gt;</span>1.2.68<span class="tag">&lt;/<span class="name">fastjson.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jackson.version</span>&gt;</span>2.11.0<span class="tag">&lt;/<span class="name">jackson.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jedis.version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">jedis.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Springboot-Web  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Spring Test --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Springboot-Aop  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Springboot-Redis  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- SpringCloud-Context --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Fastjson --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;fastjson.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Jackson --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jackson.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Lombok --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Jedis --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jedis.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="9-2-âŒ¨ï¸ç¼–ç æµ‹è¯•"><a href="#9-2-âŒ¨ï¸ç¼–ç æµ‹è¯•" class="headerlink" title="9.2 âŒ¨ï¸ç¼–ç æµ‹è¯•"></a>9.2 âŒ¨ï¸ç¼–ç æµ‹è¯•</h3><h4 id="9-2-1-ğŸ…¿Pingæµ‹è¯•"><a href="#9-2-1-ğŸ…¿Pingæµ‹è¯•" class="headerlink" title="9.2.1 ğŸ…¿Pingæµ‹è¯•"></a>9.2.1 ğŸ…¿Pingæµ‹è¯•</h4><blockquote>
<p>Ping.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.log4j.Log4j2;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2020/10/11 17:47</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span>: æµ‹è¯•é“¾æ¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Log4j2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Ping</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        log.info(jedis.ping());</span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿è¡Œç»“æœ</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">17:52:31.303 [main] INFO top.parak.jedis.Ping - PONG</span><br></pre></td></tr></table></figure>



<h4 id="9-2-1-âšªGEO-apiæµ‹è¯•"><a href="#9-2-1-âšªGEO-apiæµ‹è¯•" class="headerlink" title="9.2.1 âšªGEO-apiæµ‹è¯•"></a>9.2.1 âšªGEO-apiæµ‹è¯•</h4><blockquote>
<p>city.txt</p>
</blockquote>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">huanggang    115.94427    30.07033</span><br><span class="line">wuhan        114.31589    30.55389</span><br><span class="line">beijing      116.28625    39.8585</span><br><span class="line">shanghai     121.49295    31.22337</span><br><span class="line">hefei        117.26104    31.85117</span><br><span class="line">shenzhen     113.93029    22.53291</span><br><span class="line">dalian       121.64465    38.91859</span><br><span class="line">guangzhou    113.36112    23.12467</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Geo.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.log4j.Log4j2;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.ResourceUtils;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.GeoCoordinate;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.GeoUnit;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.params.GeoRadiusParam;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.FileChannel;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2020/10/11 17:59</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span>: æµ‹è¯•Geospatial</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Log4j2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Geo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯»å–æ–‡ä»¶å°†åœ°ç†æ•°æ®å†™è¿›redis</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">readAndWriteIntoRedis</span><span class="params">(String path, Jedis jedis)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        FileInputStream fileInputStream = <span class="keyword">new</span> FileInputStream(path);</span><br><span class="line">        FileChannel channel = fileInputStream.getChannel();</span><br><span class="line">        ByteBuffer byteBuffer = ByteBuffer.allocate(<span class="number">512</span>);</span><br><span class="line">        channel.read(byteBuffer);</span><br><span class="line">        String[] res = <span class="keyword">new</span> String(byteBuffer.array()).split(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        Map&lt;String, GeoCoordinate&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        Arrays.stream(res).forEach(s -&gt; &#123;</span><br><span class="line">            <span class="comment">// ä½¿ç”¨æ­£åˆ™\s+åŒ¹é…å¤šä¸ªç©ºæ ¼ï¼Œåˆ†å‰²å­—ç¬¦ä¸²</span></span><br><span class="line">            String[] ss = s.split(<span class="string">&quot;\\s+&quot;</span>);</span><br><span class="line">            map.put(ss[<span class="number">0</span>], <span class="keyword">new</span> GeoCoordinate(Double.valueOf(ss[<span class="number">1</span>]), Double.valueOf(ss[<span class="number">2</span>])));</span><br><span class="line">        &#125;);</span><br><span class="line">        jedis.geoadd(<span class="string">&quot;china:city&quot;</span>, map);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        readAndWriteIntoRedis(ResourceUtils.getFile(<span class="string">&quot;src/main/resources/city.txt&quot;</span>).getAbsolutePath(), jedis);</span><br><span class="line">        log.info(<span class="string">&quot;==========åœ°å›¾ä¸­çš„æ‰€æœ‰åŸå¸‚==========&quot;</span>);</span><br><span class="line">        jedis.zrange(<span class="string">&quot;china:city&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>).stream().forEach(s -&gt; &#123; log.info(s + <span class="string">&quot; &quot;</span>); &#125;);</span><br><span class="line">        log.info(<span class="string">&quot;==========æŸ¥è¯¢é»„å†ˆçš„ç»çº¬åº¦==========&quot;</span>);</span><br><span class="line">        log.info(jedis.geopos(<span class="string">&quot;china:city&quot;</span>, <span class="string">&quot;huanggang&quot;</span>));</span><br><span class="line">        log.info(<span class="string">&quot;==========æŸ¥è¯¢è·ç¦»æ­å·ä¸è¶…è¿‡1000kmçš„åŸå¸‚==========&quot;</span>);</span><br><span class="line">        GeoRadiusParam geoRadiusParam = <span class="keyword">new</span> GeoRadiusParam();</span><br><span class="line">        geoRadiusParam.withCoord().withDist().sortAscending();</span><br><span class="line">        jedis.georadius(<span class="string">&quot;china:city&quot;</span>, <span class="number">120.153576</span>, <span class="number">30.287459</span>, <span class="number">1000</span>, GeoUnit.KM, geoRadiusParam).forEach( c -&gt; &#123;</span><br><span class="line">            log.info(<span class="string">&quot;åŸå¸‚åç§°ï¼š&#123;&#125;, ç»çº¬åº¦ï¼š&#123;&#125;ï¼Œè·ç¦»ï¼š&#123;&#125;KM&quot;</span>, c.getMemberByString(), c.getCoordinate(), c.getDistance());</span><br><span class="line">        &#125;);</span><br><span class="line">        log.info(<span class="string">&quot;==========æŸ¥è¯¢è·ç¦»æ­¦æ±‰ä¸è¶…è¿‡1000KMçš„åŸå¸‚==========&quot;</span>);</span><br><span class="line">        jedis.georadiusByMember(<span class="string">&quot;china:city&quot;</span>, <span class="string">&quot;wuhan&quot;</span>, <span class="number">1000</span>, GeoUnit.KM, geoRadiusParam).forEach( c -&gt; &#123;</span><br><span class="line">            log.info(<span class="string">&quot;åŸå¸‚åç§°ï¼š&#123;&#125;, ç»çº¬åº¦ï¼š&#123;&#125;ï¼Œè·ç¦»ï¼š&#123;&#125;KM&quot;</span>, c.getMemberByString(), c.getCoordinate(), c.getDistance());</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿è¡Œç»“æœ</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">20:21:02.671 [main] INFO top.parak.jedis.Geo - ==========åœ°å›¾ä¸­çš„æ‰€æœ‰åŸå¸‚==========</span><br><span class="line">20:21:02.718 [main] INFO top.parak.jedis.Geo - shenzhen </span><br><span class="line">20:21:02.718 [main] INFO top.parak.jedis.Geo - guangzhou </span><br><span class="line">20:21:02.718 [main] INFO top.parak.jedis.Geo - wuhan </span><br><span class="line">20:21:02.718 [main] INFO top.parak.jedis.Geo - huanggang </span><br><span class="line">20:21:02.718 [main] INFO top.parak.jedis.Geo - hefei </span><br><span class="line">20:21:02.718 [main] INFO top.parak.jedis.Geo - shanghai </span><br><span class="line">20:21:02.718 [main] INFO top.parak.jedis.Geo - beijing </span><br><span class="line">20:21:02.718 [main] INFO top.parak.jedis.Geo - dalian </span><br><span class="line">20:21:02.718 [main] INFO top.parak.jedis.Geo - ==========æŸ¥è¯¢é»„å†ˆçš„ç»çº¬åº¦==========</span><br><span class="line">20:21:02.720 [main] INFO top.parak.jedis.Geo - [(115.94427019357681,30.070331157985194)]</span><br><span class="line">20:21:02.721 [main] INFO top.parak.jedis.Geo - ==========æŸ¥è¯¢è·ç¦»æ­å·ä¸è¶…è¿‡1000kmçš„åŸå¸‚==========</span><br><span class="line">20:21:02.724 [main] INFO top.parak.jedis.Geo - åŸå¸‚åç§°ï¼šshanghai, ç»çº¬åº¦ï¼š(121.49295061826706,31.22337074392616)ï¼Œè·ç¦»ï¼š165.0KM</span><br><span class="line">20:21:02.724 [main] INFO top.parak.jedis.Geo - åŸå¸‚åç§°ï¼šhefei, ç»çº¬åº¦ï¼š(117.26104170084,31.851170480671236)ï¼Œè·ç¦»ï¼š325.8468KM</span><br><span class="line">20:21:02.725 [main] INFO top.parak.jedis.Geo - åŸå¸‚åç§°ï¼šhuanggang, ç»çº¬åº¦ï¼š(115.94427019357681,30.070331157985194)ï¼Œè·ç¦»ï¼š405.4241KM</span><br><span class="line">20:21:02.725 [main] INFO top.parak.jedis.Geo - åŸå¸‚åç§°ï¼šwuhan, ç»çº¬åº¦ï¼š(114.31589037179947,30.55389005243692)ï¼Œè·ç¦»ï¼š560.6357KM</span><br><span class="line">20:21:02.725 [main] INFO top.parak.jedis.Geo - åŸå¸‚åç§°ï¼šdalian, ç»çº¬åº¦ï¼š(121.64465099573135,38.91858901014995)ï¼Œè·ç¦»ï¼š969.6213KM</span><br><span class="line">20:21:02.725 [main] INFO top.parak.jedis.Geo - ==========æŸ¥è¯¢è·ç¦»æ­¦æ±‰ä¸è¶…è¿‡1000KMçš„åŸå¸‚==========</span><br><span class="line">20:21:02.725 [main] INFO top.parak.jedis.Geo - åŸå¸‚åç§°ï¼šwuhan, ç»çº¬åº¦ï¼š(114.31589037179947,30.55389005243692)ï¼Œè·ç¦»ï¼š0.0KM</span><br><span class="line">20:21:02.725 [main] INFO top.parak.jedis.Geo - åŸå¸‚åç§°ï¼šhuanggang, ç»çº¬åº¦ï¼š(115.94427019357681,30.070331157985194)ï¼Œè·ç¦»ï¼š165.3475KM</span><br><span class="line">20:21:02.726 [main] INFO top.parak.jedis.Geo - åŸå¸‚åç§°ï¼šhefei, ç»çº¬åº¦ï¼š(117.26104170084,31.851170480671236)ï¼Œè·ç¦»ï¼š315.1437KM</span><br><span class="line">20:21:02.726 [main] INFO top.parak.jedis.Geo - åŸå¸‚åç§°ï¼šshanghai, ç»çº¬åº¦ï¼š(121.49295061826706,31.22337074392616)ï¼Œè·ç¦»ï¼š688.9652KM</span><br><span class="line">20:21:02.726 [main] INFO top.parak.jedis.Geo - åŸå¸‚åç§°ï¼šguangzhou, ç»çº¬åº¦ï¼š(113.36112052202225,23.12467049411648)ï¼Œè·ç¦»ï¼š831.7263KM</span><br><span class="line">20:21:02.726 [main] INFO top.parak.jedis.Geo - åŸå¸‚åç§°ï¼šshenzhen, ç»çº¬åº¦ï¼š(113.93029063940048,22.53290942281489)ï¼Œè·ç¦»ï¼š892.9663KM</span><br></pre></td></tr></table></figure>



<h4 id="9-2-2-âš«Hyper-apiæµ‹è¯•"><a href="#9-2-2-âš«Hyper-apiæµ‹è¯•" class="headerlink" title="9.2.2 âš«Hyper-apiæµ‹è¯•"></a>9.2.2 âš«Hyper-apiæµ‹è¯•</h4><blockquote>
<p>Hyper.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.log4j.Log4j2;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2020/10/11 20:26</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span>: æµ‹è¯•hyper</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Log4j2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hyper</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        jedis.pfadd(<span class="string">&quot;hyper1&quot;</span>, <span class="string">&quot;K&quot;</span>, <span class="string">&quot;H&quot;</span>, <span class="string">&quot;I&quot;</span>, <span class="string">&quot;G&quot;</span>, <span class="string">&quot;H&quot;</span>, <span class="string">&quot;N&quot;</span>, <span class="string">&quot;E&quot;</span>, <span class="string">&quot;S&quot;</span>, <span class="string">&quot;S&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;hyper1ä¸­çš„å…ƒç´ åŸºæ•°ï¼š&#123;&#125;&quot;</span>, jedis.pfcount(<span class="string">&quot;hyper1&quot;</span>));</span><br><span class="line">        jedis.pfadd(<span class="string">&quot;hyper2&quot;</span>, <span class="string">&quot;P&quot;</span>, <span class="string">&quot;A&quot;</span>, <span class="string">&quot;R&quot;</span>, <span class="string">&quot;A&quot;</span>, <span class="string">&quot;K&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;hyper2ä¸­çš„å…ƒç´ åŸºæ•°ï¼š&#123;&#125;&quot;</span>, jedis.pfcount(<span class="string">&quot;hyper2&quot;</span>));</span><br><span class="line">        jedis.pfmerge(<span class="string">&quot;hyper&quot;</span>, <span class="string">&quot;hyper1&quot;</span>, <span class="string">&quot;hyper2&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;hyper1å’Œhyper2åˆå¹¶åçš„å…ƒç´ åŸºæ•°ï¼š&#123;&#125;&quot;</span>, jedis.pfcount(<span class="string">&quot;hyper&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿è¡Œç»“æœ</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">20:36:20.386 [main] INFO top.parak.jedis.Hyper - hyper1ä¸­çš„å…ƒç´ åŸºæ•°ï¼š7</span><br><span class="line">20:36:20.390 [main] INFO top.parak.jedis.Hyper - hyper2ä¸­çš„å…ƒç´ åŸºæ•°ï¼š4</span><br><span class="line">20:36:20.390 [main] INFO top.parak.jedis.Hyper - hyper1å’Œhyper2åˆå¹¶åçš„å…ƒç´ åŸºæ•°ï¼š10</span><br></pre></td></tr></table></figure>



<h4 id="9-2-3-ğŸ”´Bitmaps-apiæµ‹è¯•"><a href="#9-2-3-ğŸ”´Bitmaps-apiæµ‹è¯•" class="headerlink" title="9.2.3 ğŸ”´Bitmaps-apiæµ‹è¯•"></a>9.2.3 ğŸ”´Bitmaps-apiæµ‹è¯•</h4><blockquote>
<p>Bit.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.log4j.Log4j2;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.BitOP;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2020/10/11 20:38</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span>: æµ‹è¯•Bitmaps</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Log4j2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bit</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getChineseExpression</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (i) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>: <span class="keyword">return</span> <span class="string">&quot;æ˜ŸæœŸä¸€&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>: <span class="keyword">return</span> <span class="string">&quot;æ˜ŸæœŸäºŒ&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>: <span class="keyword">return</span> <span class="string">&quot;æ˜ŸæœŸä¸‰&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>: <span class="keyword">return</span> <span class="string">&quot;æ˜ŸæœŸå››&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">4</span>: <span class="keyword">return</span> <span class="string">&quot;æ˜ŸæœŸäº”&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">5</span>: <span class="keyword">return</span> <span class="string">&quot;æ˜ŸæœŸå…­&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">6</span>: <span class="keyword">return</span> <span class="string">&quot;æ˜ŸæœŸæ—¥&quot;</span>;</span><br><span class="line">            <span class="keyword">default</span>: <span class="keyword">return</span> <span class="string">&quot;Error&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿä¸¤å‘¨çš„æ‰“å¡æƒ…å†µ</span></span><br><span class="line">        <span class="keyword">boolean</span>[] bool1 = <span class="keyword">new</span> <span class="keyword">boolean</span>[]&#123;<span class="keyword">true</span>, <span class="keyword">true</span>, <span class="keyword">true</span>, <span class="keyword">true</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>&#125;;</span><br><span class="line">        <span class="keyword">boolean</span>[] bool2 = <span class="keyword">new</span> <span class="keyword">boolean</span>[]&#123;<span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="keyword">true</span>, <span class="keyword">true</span>, <span class="keyword">false</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; bool1.length; i++) &#123; jedis.setbit(<span class="string">&quot;2020:week:1&quot;</span>, i, bool1[i]); &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; bool2.length; i++) &#123; jedis.setbit(<span class="string">&quot;2020:week:2&quot;</span>, i, bool2[i]); &#125;</span><br><span class="line">        log.info(<span class="string">&quot;2020å¹´ç¬¬ä¸€å‘¨çš„æ‰“å¡å¤©æ•°ï¼š&#123;&#125;&quot;</span>, jedis.bitcount(<span class="string">&quot;2020:week:1&quot;</span>));</span><br><span class="line">        log.info(<span class="string">&quot;2020å¹´ç¬¬ä¸€å‘¨å…·ä½“æ‰“å¡æƒ…å†µ&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; bool1.length; i++) &#123; log.info(getChineseExpression(i) + <span class="string">&quot;: &quot;</span> + (jedis.getbit(<span class="string">&quot;2020:week:1&quot;</span>, i) ? <span class="string">&quot;å·²æ‰“å¡&quot;</span> : <span class="string">&quot;æœªæ‰“å¡&quot;</span>)); &#125;</span><br><span class="line">        log.info(<span class="string">&quot;2020å¹´ç¬¬äºŒå‘¨çš„æ‰“å¡å¤©æ•°ï¼š&#123;&#125;&quot;</span>, jedis.bitcount(<span class="string">&quot;2020:week:2&quot;</span>));</span><br><span class="line">        log.info(<span class="string">&quot;2020å¹´ç¬¬äºŒå‘¨å…·ä½“æ‰“å¡æƒ…å†µ&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; bool2.length; i++) &#123; log.info(getChineseExpression(i) + <span class="string">&quot;: &quot;</span> + (jedis.getbit(<span class="string">&quot;2020:week:2&quot;</span>, i) ? <span class="string">&quot;å·²æ‰“å¡&quot;</span> : <span class="string">&quot;æœªæ‰“å¡&quot;</span>)); &#125;</span><br><span class="line">        jedis.bitop(BitOP.AND, <span class="string">&quot;2020:week:1and2&quot;</span>, <span class="string">&quot;2020:week:1&quot;</span>, <span class="string">&quot;2020:week:2&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;2020å¹´ç¬¬ä¸€å‘¨å’Œç¬¬äºŒå‘¨ä¸¤å¤©éƒ½æ‰“å¡çš„å¤©æ•°ï¼š&#123;&#125;&quot;</span>, jedis.bitcount(<span class="string">&quot;2020:week:1and2&quot;</span>));</span><br><span class="line">        jedis.bitop(BitOP.OR, <span class="string">&quot;2020:week:1or2&quot;</span>, <span class="string">&quot;2020:week:1&quot;</span>, <span class="string">&quot;2020:week:2&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;2020å¹´ç¬¬ä¸€å‘¨å’Œç¬¬äºŒå‘¨è‡³å°‘æœ‰ä¸€å¤©æ‰“å¡çš„å¤©æ•°ï¼š&#123;&#125;&quot;</span>, jedis.bitcount(<span class="string">&quot;2020:week:1or2&quot;</span>));</span><br><span class="line">        jedis.bitop(BitOP.XOR,<span class="string">&quot;2020:week:1xor2&quot;</span>, <span class="string">&quot;2020:week:1&quot;</span>, <span class="string">&quot;2020:week:2&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;2020å¹´ç¬¬ä¸€å‘¨å’Œç¬¬äºŒå‘¨ä»…æœ‰ä¸€å¤©æ‰“å¡çš„å¤©æ•°ï¼š&#123;&#125;&quot;</span>, jedis.bitcount(<span class="string">&quot;2020:week:1xor2&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿è¡Œç»“æœ</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">21:07:40.042 [main] INFO top.parak.jedis.Bit - 2020å¹´ç¬¬ä¸€å‘¨çš„æ‰“å¡å¤©æ•°ï¼š5</span><br><span class="line">21:07:40.046 [main] INFO top.parak.jedis.Bit - 2020å¹´ç¬¬ä¸€å‘¨å…·ä½“æ‰“å¡æƒ…å†µ</span><br><span class="line">21:07:40.046 [main] INFO top.parak.jedis.Bit - æ˜ŸæœŸä¸€: å·²æ‰“å¡</span><br><span class="line">21:07:40.046 [main] INFO top.parak.jedis.Bit - æ˜ŸæœŸäºŒ: å·²æ‰“å¡</span><br><span class="line">21:07:40.046 [main] INFO top.parak.jedis.Bit - æ˜ŸæœŸä¸‰: å·²æ‰“å¡</span><br><span class="line">21:07:40.046 [main] INFO top.parak.jedis.Bit - æ˜ŸæœŸå››: å·²æ‰“å¡</span><br><span class="line">21:07:40.046 [main] INFO top.parak.jedis.Bit - æ˜ŸæœŸäº”: å·²æ‰“å¡</span><br><span class="line">21:07:40.046 [main] INFO top.parak.jedis.Bit - æ˜ŸæœŸå…­: æœªæ‰“å¡</span><br><span class="line">21:07:40.047 [main] INFO top.parak.jedis.Bit - æ˜ŸæœŸæ—¥: æœªæ‰“å¡</span><br><span class="line">21:07:40.047 [main] INFO top.parak.jedis.Bit - 2020å¹´ç¬¬äºŒå‘¨çš„æ‰“å¡å¤©æ•°ï¼š3</span><br><span class="line">21:07:40.047 [main] INFO top.parak.jedis.Bit - 2020å¹´ç¬¬äºŒå‘¨å…·ä½“æ‰“å¡æƒ…å†µ</span><br><span class="line">21:07:40.047 [main] INFO top.parak.jedis.Bit - æ˜ŸæœŸä¸€: æœªæ‰“å¡</span><br><span class="line">21:07:40.047 [main] INFO top.parak.jedis.Bit - æ˜ŸæœŸäºŒ: æœªæ‰“å¡</span><br><span class="line">21:07:40.047 [main] INFO top.parak.jedis.Bit - æ˜ŸæœŸä¸‰: æœªæ‰“å¡</span><br><span class="line">21:07:40.047 [main] INFO top.parak.jedis.Bit - æ˜ŸæœŸå››: å·²æ‰“å¡</span><br><span class="line">21:07:40.047 [main] INFO top.parak.jedis.Bit - æ˜ŸæœŸäº”: å·²æ‰“å¡</span><br><span class="line">21:07:40.047 [main] INFO top.parak.jedis.Bit - æ˜ŸæœŸå…­: å·²æ‰“å¡</span><br><span class="line">21:07:40.047 [main] INFO top.parak.jedis.Bit - æ˜ŸæœŸæ—¥: æœªæ‰“å¡</span><br><span class="line">21:07:40.048 [main] INFO top.parak.jedis.Bit - 2020å¹´ç¬¬ä¸€å‘¨å’Œç¬¬äºŒå‘¨ä¸¤å¤©éƒ½æ‰“å¡çš„å¤©æ•°ï¼š2</span><br><span class="line">21:07:40.048 [main] INFO top.parak.jedis.Bit - 2020å¹´ç¬¬ä¸€å‘¨å’Œç¬¬äºŒå‘¨è‡³å°‘æœ‰ä¸€å¤©æ‰“å¡çš„å¤©æ•°ï¼š6</span><br><span class="line">21:07:40.048 [main] INFO top.parak.jedis.Bit - 2020å¹´ç¬¬ä¸€å‘¨å’Œç¬¬äºŒå‘¨ä»…æœ‰ä¸€å¤©æ‰“å¡çš„å¤©æ•°ï¼š4</span><br></pre></td></tr></table></figure>



<h4 id="9-2-4-ğŸ”µäº‹åŠ¡æµ‹è¯•"><a href="#9-2-4-ğŸ”µäº‹åŠ¡æµ‹è¯•" class="headerlink" title="9.2.4 ğŸ”µäº‹åŠ¡æµ‹è¯•"></a>9.2.4 ğŸ”µäº‹åŠ¡æµ‹è¯•</h4><blockquote>
<p>Affair.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.log4j.Log4j2;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Transaction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2020/10/11 21:33</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span>: æµ‹è¯•äº‹åŠ¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Log4j2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Affair</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºjsonæ•°æ®</span></span><br><span class="line">        JSONObject jsonObject1 = <span class="keyword">new</span> JSONObject();</span><br><span class="line">        jsonObject1.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;KHighness&quot;</span>);</span><br><span class="line">        jsonObject1.put(<span class="string">&quot;age&quot;</span>, <span class="number">19</span>);</span><br><span class="line">        jsonObject1.put(<span class="string">&quot;constellation&quot;</span>, <span class="string">&quot;Virgo&quot;</span>);</span><br><span class="line">        jsonObject1.put(<span class="string">&quot;Hobby&quot;</span>, <span class="string">&quot;Jay&quot;</span>);</span><br><span class="line">        String json1 = jsonObject1.toJSONString();</span><br><span class="line">        JSONObject jsonObject2 = <span class="keyword">new</span> JSONObject();</span><br><span class="line">        jsonObject2.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;BingYao&quot;</span>);</span><br><span class="line">        jsonObject2.put(<span class="string">&quot;age&quot;</span>, <span class="number">16</span>);</span><br><span class="line">        jsonObject2.put(<span class="string">&quot;constellation&quot;</span>, <span class="string">&quot;Taurus&quot;</span>);</span><br><span class="line">        jsonObject2.put(<span class="string">&quot;Hobby&quot;</span>, <span class="string">&quot;Czk&quot;</span>);</span><br><span class="line">        String json2 = jsonObject2.toJSONString();</span><br><span class="line">        jedis.set(<span class="string">&quot;user1&quot;</span>, json1);</span><br><span class="line">        jedis.set(<span class="string">&quot;user2&quot;</span>, json2);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŠ å…¥ä¹è§‚é”</span></span><br><span class="line">        jedis.watch(<span class="string">&quot;user1&quot;</span>, <span class="string">&quot;user2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¼€å¯äº‹åŠ¡</span></span><br><span class="line">        Transaction multi = jedis.multi();</span><br><span class="line">        <span class="keyword">new</span> Thread( () -&gt; &#123;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               TimeUnit.SECONDS.sleep(<span class="number">5</span>);</span><br><span class="line">               multi.set(<span class="string">&quot;user1&quot;</span>, json1);</span><br><span class="line">               multi.set(<span class="string">&quot;user2&quot;</span>, json2);</span><br><span class="line">               <span class="comment">// æ‰§è¡Œäº‹åŠ¡</span></span><br><span class="line">               multi.exec();</span><br><span class="line">           &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">               <span class="comment">// å‘ç”Ÿå¼‚å¸¸</span></span><br><span class="line">               <span class="comment">// æ”¾å¼ƒäº‹åŠ¡</span></span><br><span class="line">               multi.discard();</span><br><span class="line">               log.info(e.getMessage());</span><br><span class="line">           &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">               <span class="comment">// è¾“å‡ºæ•°æ®</span></span><br><span class="line">               log.info(<span class="string">&quot;user1: [&#123;&#125;]&quot;</span>, jedis.get(<span class="string">&quot;user1&quot;</span>));</span><br><span class="line">               log.info(<span class="string">&quot;user2: [&#123;&#125;]&quot;</span>, jedis.get(<span class="string">&quot;user2&quot;</span>));</span><br><span class="line">               jedis.close();</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;Multi&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦ä¸€çº¿ç¨‹</span></span><br><span class="line">        <span class="comment">// å¼€å¯åœ¨äº‹åŠ¡ä¹‹å‰</span></span><br><span class="line">        <span class="keyword">new</span> Thread( () -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">new</span> Affair().resetInfo1(jedis);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                log.info(e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;Other&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">resetInfo1</span><span class="params">(Jedis jedis)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        JSONObject jsonObject1 = <span class="keyword">new</span> JSONObject();</span><br><span class="line">        jsonObject1.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;KHighness&quot;</span>);</span><br><span class="line">        jsonObject1.put(<span class="string">&quot;age&quot;</span>, <span class="number">20</span>);</span><br><span class="line">        jsonObject1.put(<span class="string">&quot;constellation&quot;</span>, <span class="string">&quot;Leo&quot;</span>);</span><br><span class="line">        jsonObject1.put(<span class="string">&quot;Hobby&quot;</span>, <span class="string">&quot;BingYao&quot;</span>);</span><br><span class="line">        String json1 = jsonObject1.toJSONString();</span><br><span class="line">        jedis.set(<span class="string">&quot;user1&quot;</span>, json1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿è¡Œç»“æœ</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Exception in thread &quot;Other&quot; redis.clients.jedis.exceptions.JedisDataException: Cannot use Jedis when in Multi. Please use Transaction or reset jedis state.</span><br><span class="line">	at redis.clients.jedis.BinaryJedis.checkIsInMultiOrPipeline(BinaryJedis.java:1895)</span><br><span class="line">	at redis.clients.jedis.Jedis.set(Jedis.java:152)</span><br><span class="line">	at top.parak.jedis.Affair.resetInfo1(Affair.java:82)</span><br><span class="line">	at top.parak.jedis.Affair.lambda$main$1(Affair.java:66)</span><br><span class="line">	at java.lang.Thread.run(Thread.java:748)</span><br><span class="line">22:05:18.651 [Multi] INFO top.parak.jedis.Affair - user1: [&#123;&quot;constellation&quot;:&quot;Virgo&quot;,&quot;name&quot;:&quot;KHighness&quot;,&quot;Hobby&quot;:&quot;Jay&quot;,&quot;age&quot;:19&#125;]</span><br><span class="line">22:05:18.654 [Multi] INFO top.parak.jedis.Affair - user2: [&#123;&quot;constellation&quot;:&quot;Taurus&quot;,&quot;name&quot;:&quot;BingYao&quot;,&quot;Hobby&quot;:&quot;Czk&quot;,&quot;age&quot;:16&#125;]</span><br></pre></td></tr></table></figure>



<h2 id="10-ğŸ“©Springbootæ•´åˆ"><a href="#10-ğŸ“©Springbootæ•´åˆ" class="headerlink" title="10. ğŸ“©Springbootæ•´åˆ"></a>10. ğŸ“©Springbootæ•´åˆ</h2><blockquote>
<p>âš ï¸notice</p>
</blockquote>
<p>åœ¨SpringBoot2.Xä¹‹åï¼ŒåŸæ¥ä½¿ç”¨çš„jedisè¢«æ›¿æ¢ä¸ºäº†lettuceï¼Œåœ¨windowsä¸‹lettuceè¿æ¥æ± ä»…æ”¯æŒ3.2.100ç‰ˆæœ¬çš„Redis</p>
<ul>
<li><p>jedisï¼šé‡‡ç”¨çš„ç›´è¿ï¼Œå¤šä¸ªçº¿ç¨‹æ“ä½œçš„è¯ï¼Œæ˜¯ä¸å®‰å…¨çš„ï¼Œå¦‚æœæƒ³è¦é¿å…ä¸å®‰å…¨ï¼Œéœ€è¦ä½¿ç”¨jedis poolè¿æ¥æ± ï¼Œæ›´åƒBIOæ¨¡å¼</p>
</li>
<li><p>lettuceï¼šåº•å±‚æ•´åˆNettyï¼Œå®ä¾‹å¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å…±äº«ï¼Œä¸å­˜åœ¨çº¿ç¨‹ä¸å®‰å…¨çš„æƒ…å†µï¼Œå¯ä»¥å‡å°‘çº¿ç¨‹æ•°æ®ï¼Œæ›´åƒNIOæ¨¡å¼</p>
</li>
</ul>
<h3 id="10-1-ğŸ”æºç åˆ†æ"><a href="#10-1-ğŸ”æºç åˆ†æ" class="headerlink" title="10.1 ğŸ”æºç åˆ†æ"></a>10.1 ğŸ”æºç åˆ†æ</h3><blockquote>
<p>è‡ªåŠ¨é…ç½®ç±»ï¼šRedisAutoConfiguration.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration(</span></span><br><span class="line"><span class="meta">    proxyBeanMethods = false</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;RedisOperations.class&#125;)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;RedisProperties.class&#125;)</span></span><br><span class="line"><span class="meta">@Import(&#123;LettuceConnectionConfiguration.class, JedisConnectionConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisAutoConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RedisAutoConfiguration</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean(name = &#123;&quot;redisTemplate&quot;&#125;)</span> </span><br><span class="line">    <span class="comment">// ==&gt; è¿™ä¸ªæ³¨è§£è¯´æ˜ï¼Œä¸å­˜åœ¨æˆ‘ä»¬è‡ªå®šä¹‰åä¸ºredisTemplateçš„Beançš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªBeanæ‰ç”Ÿæ•ˆ</span></span><br><span class="line">    <span class="comment">// ==&gt; å› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„RedisTemplateï¼ŒSpringBootä¼šä¼˜å…ˆä½¿ç”¨è‡ªå®šä¹‰RedisTemplate</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> <span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line">        <span class="comment">// é»˜è®¤çš„RedisTemplateæ²¡æœ‰è¿‡å¤šçš„é…ç½®ï¼ŒRediså¯¹è±¡éƒ½éœ€è¦åºåˆ—åŒ–å’Œååºåˆ—åŒ–</span></span><br><span class="line">        <span class="comment">// ä¸¤ä¸ªæ³›å‹éƒ½æ˜¯ Object, Obeject çš„ç±»å‹ï¼Œæˆ‘ä»¬ä»¥åä½¿ç”¨éœ€è¦å¼ºåˆ¶è½¬æ¢æˆ String, Object</span></span><br><span class="line">        RedisTemplate&lt;Object, Object&gt; template = <span class="keyword">new</span> RedisTemplate();</span><br><span class="line">        template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="comment">// ç”±äºStringæ˜¯Redisä¸­æœ€å¸¸ä½¿ç”¨çš„ç±»å‹ï¼Œæ‰€ä»¥å•ç‹¬ä¸€ä¸ªStringRedisTemplate</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥æ“ä½œStringç±»å‹ï¼Œç›´æ¥ä½¿ç”¨StringRedisTemplateå³å¯</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> StringRedisTemplate <span class="title">stringRedisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> <span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line">        StringRedisTemplate template = <span class="keyword">new</span> StringRedisTemplate();</span><br><span class="line">        template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="10-2-ğŸ”‘æ•´åˆä½¿ç”¨"><a href="#10-2-ğŸ”‘æ•´åˆä½¿ç”¨" class="headerlink" title="10.2 ğŸ”‘æ•´åˆä½¿ç”¨"></a>10.2 ğŸ”‘æ•´åˆä½¿ç”¨</h3><blockquote>
<p>å¯¼å…¥ä¾èµ–ï¼špom.xml(è§ä¸Šjedis)</p>
</blockquote>
<blockquote>
<p>é…ç½®ç¯å¢ƒï¼šapplication.properties</p>
</blockquote>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Redisæ•°æ®åº“ç´¢å¼•ï¼ˆé»˜è®¤ä¸º0ï¼‰</span></span><br><span class="line"><span class="meta">spring.redis.database</span>=<span class="string">0</span></span><br><span class="line"><span class="comment"># RedisæœåŠ¡å™¨åœ°å€</span></span><br><span class="line"><span class="meta">spring.redis.host</span>=<span class="string">127.0.0.1</span></span><br><span class="line"><span class="comment"># RedisæœåŠ¡å™¨è¿æ¥ç«¯å£</span></span><br><span class="line"><span class="meta">spring.redis.port</span>=<span class="string">6379</span></span><br><span class="line"><span class="comment"># RedisæœåŠ¡å™¨è¿æ¥å¯†ç ï¼ˆé»˜è®¤ä¸ºç©ºï¼‰</span></span><br><span class="line"><span class="meta">spring.redis.password</span>=<span class="string"></span></span><br><span class="line"><span class="comment"># è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span></span><br><span class="line"><span class="meta">spring.redis.timeout</span>=<span class="string">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Spring 2.Xä»¥åï¼Œä½¿ç”¨lettuceè¿æ¥æ± </span></span><br><span class="line"><span class="comment"># è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰</span></span><br><span class="line"><span class="meta">spring.redis.lettuce.pool.max-active</span>=<span class="string">100</span></span><br><span class="line"><span class="comment"># è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥</span></span><br><span class="line"><span class="meta">spring.redis.lettuce.pool.max-idle</span>=<span class="string">10</span></span><br><span class="line"><span class="comment"># è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥</span></span><br><span class="line"><span class="meta">spring.redis.lettuce.pool.min-idle</span>=<span class="string">0</span></span><br><span class="line"><span class="comment"># è¿æ¥è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="meta">spring.redis.lettuce.shutdown-timeout</span>=<span class="string">100ms</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>âŒ¨ï¸è‡ªå®šä¹‰RedisTemplateï¼šRedisConfig.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonAutoDetect;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.PropertyAccessor;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.jsontype.impl.LaissezFaireSubTypeValidator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.GenericJackson2JsonRedisSerializer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.GenericToStringSerializer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.UnknownHostException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2020/10/7 20:23</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span>: è‡ªå®šä¹‰RedisTemplate</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class="line">    <span class="meta">@Qualifier(&quot;redisTemplate&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> <span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Jackson2JsonRedisSerializer: åºåˆ—åŒ–objectå¯¹è±¡ä¸ºjsonå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">// åˆ›å»º redisTemplate æ¨¡ç‰ˆ</span></span><br><span class="line">        RedisTemplate&lt;String, Object&gt; redisTemplate = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">        <span class="comment">// å…³è” redisConnectionFactory</span></span><br><span class="line">        redisTemplate.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        <span class="comment">// Jsonåºåˆ—åŒ–é…ç½®</span></span><br><span class="line">        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = <span class="keyword">new</span> Jackson2JsonRedisSerializer(Object.class);</span><br><span class="line">        redisTemplate.setKeySerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        objectMapper.activateDefaultTyping(LaissezFaireSubTypeValidator.instance, ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(objectMapper);</span><br><span class="line">        <span class="comment">// Stringåºåˆ—åŒ–é…ç½®</span></span><br><span class="line">        StringRedisSerializer stringRedisSerializer = <span class="keyword">new</span> StringRedisSerializer();</span><br><span class="line">        <span class="comment">// è®¾ç½® key çš„åºåˆ—åŒ–æ–¹å¼</span></span><br><span class="line">        redisTemplate.setKeySerializer(stringRedisSerializer);</span><br><span class="line">        <span class="comment">// è®¾ç½® value çš„åºåˆ—åŒ–æ–¹å¼</span></span><br><span class="line">        redisTemplate.setHashKeySerializer(stringRedisSerializer);</span><br><span class="line">        <span class="comment">// è®¾ç½® hash çš„ key çš„åºåˆ—åŒ–æ–¹å¼</span></span><br><span class="line">        redisTemplate.setHashValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="comment">// è®¾ç½® hash çš„ value çš„åºåˆ—åŒ–æ–¹å¼</span></span><br><span class="line">        redisTemplate.setHashValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        redisTemplate.afterPropertiesSet();</span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>âŒ¨ï¸Rediså·¥å…·ç±»ï¼šRedisUtil.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.log4j.Log4j2;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.CollectionUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: KHighness</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2020/10/7 21:33</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span>: Redisæ“ä½œå·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Log4j2</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*==================================================================</span></span><br><span class="line"><span class="comment">    //                            common                              //</span></span><br><span class="line"><span class="comment">    ==================================================================*/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŒ‡å®šç¼“å­˜å¤±æ•ˆæ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time æ—¶é—´(ç§’)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true æˆåŠŸï¼Œfalse å¤±è´¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">expire</span><span class="params">(String key, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                redisTemplate.expire(key, time, TimeUnit.SECONDS);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®keyè·å–è¿‡æœŸæ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ—¶é—´(ç§’) è¿”å›0ä»£è¡¨æ°¸ä¹…æœ‰æ•ˆ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getExpire</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.getExpire(key, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*==================================================================</span></span><br><span class="line"><span class="comment">    //                            String                              //</span></span><br><span class="line"><span class="comment">    ==================================================================*/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true å­˜åœ¨ï¼Œfalse ä¸å­˜åœ¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasKey</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.hasKey(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤ç¼“å­˜</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key å¯ä»¥ä¼ ä¸€ä¸ªæˆ–å¤šä¸ª</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">del</span><span class="params">(String... key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (key != <span class="keyword">null</span> &amp;&amp; key.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (key.length == <span class="number">1</span>) &#123;</span><br><span class="line">                redisTemplate.delete(key[<span class="number">0</span>]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                redisTemplate.delete(CollectionUtils.arrayToList(key));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ™®é€šç¼“å­˜è·å–</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> key == <span class="keyword">null</span> ? <span class="keyword">null</span> : redisTemplate.opsForValue().get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ™®é€šç¼“å­˜æ”¾å…¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true æˆåŠŸï¼Œfalse å¤±è´¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">set</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForValue().set(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ™®é€šç¼“å­˜æ”¾å…¥å¹¶è®¾ç½®æ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time æ—¶é—´(ç§’) timeè¦å¤§äº0 å¦‚æœtimeå°äºç­‰äº0 å°†è®¾ç½®æ— é™æœŸ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true æˆåŠŸï¼Œfalse å¤±è´¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">set</span><span class="params">(String key, Object value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                redisTemplate.opsForValue().set(key, value, time, TimeUnit.SECONDS);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                set(key, value);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€’å¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> delta å¢é‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> é€’å¢åçš„å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">incr</span><span class="params">(String key, <span class="keyword">long</span> delta)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (delta &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;å¢é‡å¿…é¡»å¤§äº0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().increment(key, delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€’å‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> delta å‡é‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> é€’å‡åçš„å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">decr</span><span class="params">(String key, <span class="keyword">long</span> delta)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (delta &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;å‡é‡å¿…é¡»å¤§äº0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().decrement(key, delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*==================================================================</span></span><br><span class="line"><span class="comment">    //                              map                               //</span></span><br><span class="line"><span class="comment">    ==================================================================*/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashGet</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  é”® ä¸èƒ½ä¸ºNULL</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item é¡¹ ä¸èƒ½ä¸ºNULL</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">hget</span><span class="params">(String key, String item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().get(key, item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–hashKeyå¯¹åº”çš„æ‰€æœ‰é”®å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å¯¹åº”çš„å¤šä¸ªé”®å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;Object, Object&gt; <span class="title">hmget</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().entries(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashSet</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map å¯¹åº”çš„å¤šä¸ªé”®å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true æˆåŠŸï¼Œfalse å¤±è´¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hmset</span><span class="params">(String key, Map&lt;String, Object&gt; map)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashSet å¹¶è®¾ç½®æ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map å¯¹åº”å¤šä¸ªé”®å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time æ—¶é—´(ç§’)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true æˆåŠŸï¼Œfalse å¤±è´¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hmset</span><span class="params">(String key, Map&lt;String, Object&gt; map, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘ä¸€å¼ hashè¡¨ä¸­æ”¾å…¥æ•°æ®ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»º</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item  é¡¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true æˆåŠŸï¼Œfalse å¤±è´¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hset</span><span class="params">(String key, String item, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().put(key, item, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘ä¸€å¼ hashè¡¨ä¸­æ”¾å…¥æ•°æ®ï¼Œå¹¶è®¾ç½®æ—¶é—´ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»º</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item  é¡¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  æ—¶é—´(ç§’) å¦‚æœå·²å­˜åœ¨çš„hashè¡¨æœ‰æ—¶é—´ï¼Œè¿™é‡Œä¼šæ›´æ–°åŸå€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true æˆåŠŸï¼Œfalse å¤±è´¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hset</span><span class="params">(String key, String item, Object value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().put(key, item, value);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤hashè¡¨ä¸­çš„å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  é”® ä¸èƒ½ä¸ºNULL</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item é¡¹ å¯ä»¥ä½¿å¤šä¸ª ä¸èƒ½ä¸ºNULL</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hdel</span><span class="params">(String key, Object... item)</span> </span>&#123;</span><br><span class="line">        redisTemplate.opsForHash().delete(key, item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­hashè¡¨ä¸­æ˜¯å¦æœ‰è¯¥é¡¹çš„å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  é”® ä¸èƒ½ä¸ºNULL</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item é¡¹ ä¸èƒ½ä¸ºNULL</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true å­˜åœ¨ï¼Œfalse ä¸å­˜åœ¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hHasKey</span><span class="params">(String key, String item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().hasKey(key, item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * hashé€’å¢ å¦‚æœä¸å­˜åœ¨ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªï¼Œå¹¶æŠŠé€’å¢åçš„å€¼è¿”å›</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> by   å¢é‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> é€’å¢åçš„å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">hincr</span><span class="params">(String key, String item, <span class="keyword">double</span> by)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().increment(key, item, by);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * hashé€’å‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> by   å‡é‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> é€’å‡åçš„å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">hdecr</span><span class="params">(String key, String item, <span class="keyword">double</span> by)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().increment(key, item, -by);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*==================================================================</span></span><br><span class="line"><span class="comment">    //                              set                               //</span></span><br><span class="line"><span class="comment">    ==================================================================*/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®keyè·å–Setä¸­çš„æ‰€æœ‰å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> setä¸­çš„æ‰€æœ‰å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;Object&gt; <span class="title">sGet</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().members(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®valueä»ä¸€ä¸ªsetä¸­æŸ¥è¯¢æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true å­˜åœ¨ï¼Œfalse ä¸å­˜åœ¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">sHasKey</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().isMember(key, value);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†æ•°æ®æ”¾å…¥setç¼“å­˜</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key    é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values å€¼ å¯ä»¥æ˜¯å¤šä¸ª</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æˆåŠŸä¸ªæ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">sSet</span><span class="params">(String key, Object... values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().add(key, values);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†setæ•°æ®æ”¾å…¥ç¼“å­˜ï¼Œå¹¶è®¾ç½®æ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key    é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time   æ—¶é—´(ç§’)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values å€¼ å¯ä»¥æ˜¯å¤šä¸ª</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æˆåŠŸä¸ªæ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">sSetAndTime</span><span class="params">(String key, <span class="keyword">long</span> time, Object... values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Long count = redisTemplate.opsForSet().add(key, values);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> count;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.info(e.getMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–setç¼“å­˜çš„é•¿åº¦</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> setçš„é•¿åº¦</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">sGetSetSize</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().size(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.info(e.getMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*==================================================================</span></span><br><span class="line"><span class="comment">    //                             list                               //</span></span><br><span class="line"><span class="comment">    ==================================================================*/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–listç¼“å­˜çš„é•¿åº¦</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> listçš„é•¿åº¦</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">lGetListSize</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().size(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šè¿‡ç´¢å¼•è·å–listä¸­çš„å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index ç´¢å¼• index &gt;= 0æ—¶ï¼Œ0 è¡¨å¤´ï¼Œ1 ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä¾æ¬¡ç±»æ¨ï¼›index &lt; 0æ—¶ï¼Œ-1 è¡¨å°¾ï¼Œ-2 å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä¾æ¬¡ç±»æ¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">lGetIndex</span><span class="params">(String key, <span class="keyword">long</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().index(key, index);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†listæ”¾å…¥ç¼“å­˜</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true æˆåŠŸï¼Œfalse å¤±è´¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lSet</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPush(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†listæ”¾å…¥ç¼“å­˜ï¼Œå¹¶è®¾ç½®æ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  æ—¶é—´(ç§’)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æˆåŠŸæ•°é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lSet</span><span class="params">(String key, Object value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPush(key, value);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®ç´¢å¼•ä¿®æ”¹listä¸­çš„æŸæ¡æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index ç´¢å¼•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true æˆåŠŸï¼Œfalse å¤±è´¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lUpdateIndex</span><span class="params">(String key, <span class="keyword">long</span> index, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().set(key, index, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç§»é™¤Nä¸ªå€¼ä¸ºvalue</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> count ç§»é™¤æ•°é‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç§»é™¤æ•°é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">lRemove</span><span class="params">(String key, <span class="keyword">long</span> count ,Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Long remove = redisTemplate.opsForList().remove(key, count, value);</span><br><span class="line">            <span class="keyword">return</span> remove;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="10-3-ğŸ’¨apiæµ‹è¯•"><a href="#10-3-ğŸ’¨apiæµ‹è¯•" class="headerlink" title="10.3 ğŸ’¨apiæµ‹è¯•"></a>10.3 ğŸ’¨apiæµ‹è¯•</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.parak;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"><span class="keyword">import</span> top.parak.common.RedisUtil;</span><br><span class="line"><span class="keyword">import</span> top.parak.entity.User;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.log4j.Log4j2;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@Log4j2</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SpringbootRedisApplicationTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisUtil redisUtil;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Kæ®¿ä¸‹&quot;</span>);</span><br><span class="line">        log.info(redisTemplate.opsForValue().get(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        stringRedisTemplate.opsForValue().set(<span class="string">&quot;Knum&quot;</span>, <span class="string">&quot;3&quot;</span>);</span><br><span class="line">        log.info(stringRedisTemplate.opsForValue().increment(<span class="string">&quot;Knum&quot;</span>, <span class="number">3</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User(<span class="string">&quot;KHighness&quot;</span>, <span class="number">19</span>);</span><br><span class="line">        String jsonUser = <span class="keyword">new</span> ObjectMapper().writeValueAsString(user);</span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;user&quot;</span>, user);</span><br><span class="line">        log.info(redisTemplate.opsForValue().get(<span class="string">&quot;user&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        HashMap hashMap = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">        hashMap.put(<span class="string">&quot;name1&quot;</span>, <span class="string">&quot;KHighness&quot;</span>);</span><br><span class="line">        hashMap.put(<span class="string">&quot;name2&quot;</span>, <span class="string">&quot;ParaK&quot;</span>);</span><br><span class="line">        hashMap.put(<span class="string">&quot;name3&quot;</span>, <span class="string">&quot;FlowerK&quot;</span>);</span><br><span class="line">        redisUtil.hmset(<span class="string">&quot;K&quot;</span>, hashMap);</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry k : redisUtil.hmget(<span class="string">&quot;K&quot;</span>).entrySet()) &#123;</span><br><span class="line">            log.info(k.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿è¡Œç»“æœ</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">                        __ __ __    _       __</span><br><span class="line">                       / <span class="comment">//_// /_  (_)___ _/ /_  ____  ___  __________</span></span><br><span class="line">                      / ,&lt;  / __ \/ / __ `/ __ \/ __ \/ _ \/ ___/ ___/</span><br><span class="line">                     / /| |/ / / / / /_/ / / / / / / /  __(__  |__  )</span><br><span class="line">                    /_/ |_/_/ /_/_/\__, /_/ /_/_/ /_/\___/____/____/</span><br><span class="line">                                  /____/</span><br><span class="line"></span><br><span class="line">                     Copyright Â© <span class="number">2020</span> KHighness. All Rights Reserved</span><br><span class="line"></span><br><span class="line"><span class="number">2020</span>-<span class="number">10</span>-<span class="number">12</span> <span class="number">13</span>:<span class="number">36</span>:<span class="number">35.073</span>  INFO <span class="number">18840</span> --- [           main] t.parak.SpringbootRedisApplicationTest   : No active profile set, falling back to <span class="keyword">default</span> profiles: <span class="keyword">default</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">10</span>-<span class="number">12</span> <span class="number">13</span>:<span class="number">36</span>:<span class="number">35.417</span>  INFO <span class="number">18840</span> --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode!</span><br><span class="line"><span class="number">2020</span>-<span class="number">10</span>-<span class="number">12</span> <span class="number">13</span>:<span class="number">36</span>:<span class="number">35.420</span>  INFO <span class="number">18840</span> --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.</span><br><span class="line"><span class="number">2020</span>-<span class="number">10</span>-<span class="number">12</span> <span class="number">13</span>:<span class="number">36</span>:<span class="number">35.445</span>  INFO <span class="number">18840</span> --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in <span class="number">10</span>ms. Found <span class="number">0</span> Redis repository interfaces.</span><br><span class="line"><span class="number">2020</span>-<span class="number">10</span>-<span class="number">12</span> <span class="number">13</span>:<span class="number">36</span>:<span class="number">35.534</span>  INFO <span class="number">18840</span> --- [           main] o.s.cloud.context.scope.GenericScope     : BeanFactory id=<span class="number">8d</span>774ca9-<span class="number">71</span>ca-<span class="number">37</span>a9-<span class="number">91e1</span>-<span class="number">35</span>cd9af79e44</span><br><span class="line"><span class="number">2020</span>-<span class="number">10</span>-<span class="number">12</span> <span class="number">13</span>:<span class="number">36</span>:<span class="number">35.699</span>  INFO <span class="number">18840</span> --- [           main] trationDelegate$BeanPostProcessorChecker : Bean <span class="string">&#x27;org.springframework.cloud.autoconfigure.ConfigurationPropertiesRebinderAutoConfiguration&#x27;</span> of type [org.springframework.cloud.autoconfigure.ConfigurationPropertiesRebinderAutoConfiguration$$EnhancerBySpringCGLIB$$<span class="number">67</span>ea5b63] <span class="function">is not eligible <span class="keyword">for</span> getting processed by all <span class="title">BeanPostProcessors</span> <span class="params">(<span class="keyword">for</span> example: not eligible <span class="keyword">for</span> auto-proxying)</span></span></span><br><span class="line"><span class="function">2020-10-12 13:36:36.483  INFO 18840 --- [           main] o.s.s.concurrent.ThreadPoolTaskExecutor  : Initializing ExecutorService &#x27;applicationTaskExecutor&#x27;</span></span><br><span class="line"><span class="function">2020-10-12 13:36:36.818  INFO 18840 --- [           main] t.parak.SpringbootRedisApplicationTest   : Started SpringbootRedisApplicationTest in 2.287 <span class="title">seconds</span> <span class="params">(JVM running <span class="keyword">for</span> <span class="number">3.29</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">2020-10-12 13:36:37.191  INFO 18840 --- [           main] io.lettuce.core.EpollProvider            : Starting without optional epoll library</span></span><br><span class="line"><span class="function">2020-10-12 13:36:37.192  INFO 18840 --- [           main] io.lettuce.core.KqueueProvider           : Starting without optional kqueue library</span></span><br><span class="line"><span class="function">2020-10-12 13:36:37.740  INFO 18840 --- [           main] t.parak.SpringbootRedisApplicationTest   : Kæ®¿ä¸‹</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">2020-10-12 13:36:37.762  INFO 18840 --- [           main] t.parak.SpringbootRedisApplicationTest   : 6</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">2020-10-12 13:36:37.802  INFO 18840 --- [           main] t.parak.SpringbootRedisApplicationTest   : <span class="title">User</span><span class="params">(name=KHighness, age=<span class="number">19</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">2020-10-12 13:36:37.836  INFO 18840 --- [           main] t.parak.SpringbootRedisApplicationTest   : name3</span>=FlowerK</span><br><span class="line"><span class="number">2020</span>-<span class="number">10</span>-<span class="number">12</span> <span class="number">13</span>:<span class="number">36</span>:<span class="number">37.836</span>  INFO <span class="number">18840</span> --- [           main] t.parak.SpringbootRedisApplicationTest   : name2=ParaK</span><br><span class="line"><span class="number">2020</span>-<span class="number">10</span>-<span class="number">12</span> <span class="number">13</span>:<span class="number">36</span>:<span class="number">37.836</span>  INFO <span class="number">18840</span> --- [           main] t.parak.SpringbootRedisApplicationTest   : name1=KHighness</span><br></pre></td></tr></table></figure>



<h2 id="11-ğŸ“©RedisæŒä¹…åŒ–"><a href="#11-ğŸ“©RedisæŒä¹…åŒ–" class="headerlink" title="11. ğŸ“©RedisæŒä¹…åŒ–"></a>11. ğŸ“©RedisæŒä¹…åŒ–</h2><blockquote>
<p>ğŸ“Œtip</p>
</blockquote>
<p>Redisæ˜¯å†…å­˜æ•°æ®åº“ï¼Œå¦‚æœä¸å°†å†…å­˜ä¸­çš„æ•°æ®åº“çŠ¶æ€ä¿å­˜åœ¨ç£ç›˜ï¼Œé‚£ä¹ˆä¸€æ—¦æœåŠ¡å™¨è¿›ç¨‹é€€å‡ºï¼ŒæœåŠ¡å™¨ä¸­çš„æ•°æ®åº“çŠ¶æ€ä¹Ÿä¼šæ¶ˆå¤±ã€‚æ‰€ä»¥Redisæä¾›äº†æŒä¹…åŒ–åŠŸèƒ½ã€‚</p>
<ul>
<li><p>Redisé»˜è®¤æ˜¯æŒ‰ç…§å¿«ç…§RDBçš„æŒä¹…åŒ–æ–¹å¼</p>
</li>
<li><p>Redisé‡å¯çš„æ—¶å€™ä¼šä¼˜å…ˆä½¿ç”¨AOFæ–‡ä»¶è¿˜åŸæ•°æ®åº“çŠ¶æ€</p>
</li>
</ul>
<h3 id="11-1-ğŸ“RDB"><a href="#11-1-ğŸ“RDB" class="headerlink" title="11.1 ğŸ“RDB"></a>11.1 ğŸ“RDB</h3><blockquote>
<p>ğŸ””RDB = Redis Database</p>
</blockquote>
<p>å°†å†…å­˜ä¸­çš„æ•°æ®ä»¥å¿«ç…§â€RDBâ€çš„å½¢å¼å°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜çš„ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶dump.rdbï¼Œå®šæ—¶ä¿å­˜ã€‚</p>
<blockquote>
<p>ğŸ”¨é…ç½®</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">save 900 1    # 15åˆ†é’Ÿå¤‡ä»½ä¸€æ¬¡</span><br><span class="line">save 300 10   # å¦‚æœåœ¨300så†…ï¼Œè‡³å°‘æœ‰10ä¸ªkeyè¿›è¡Œäº†ä¿®æ”¹ï¼Œå°±è¿›è¡ŒæŒä¹…åŒ–æ“ä½œ</span><br><span class="line">save 60 10000 # å¦‚æœåœ¨60så†…ï¼Œè‡³å°‘æœ‰10000ä¸ªkeyè¿›è¡Œäº†ä¿®æ”¹ï¼Œå°±è¿›è¡ŒæŒä¹…åŒ–æ“ä½œ</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥åœ¨24å°æ—¶å†…ï¼Œæ¯å°æ—¶å¤‡ä»½ä¸€æ¬¡ï¼Œå¹¶ä¸”åœ¨æ¯ä¸ªæœˆçš„æ¯ä¸€å¤©ä¹Ÿå¤‡ä»½ä¸€ä¸ªRDBæ–‡ä»¶ã€‚</p>
<p>è¿™æ ·çš„è¯ï¼Œå³ä½¿é‡ä¸Šé—®é¢˜ï¼Œä¹Ÿå¯ä»¥éšæ—¶å°†æ•°æ®é›†æ¢å¤åˆ°ä¸åŒçš„ç‰ˆæœ¬ã€‚</p>
<blockquote>
<p>ğŸ”å·¥ä½œæœºåˆ¶</p>
</blockquote>
<p>Redisä¼šå•ç‹¬åˆ›å»º(fork)ä¸€ä¸ªå­è¿›ç¨‹æ¥è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¼šå…ˆå°†æ•°æ®å†™å…¥åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œå¾…æŒä¹…åŒ–è¿‡ç¨‹éƒ½ç»“æŸäº†ï¼Œå†ç”¨è¿™ä¸ªä¸´æ—¶æ–‡ä»¶æ›¿æ¢ä¸Šæ¬¡æŒä¹…åŒ–å¥½çš„æ–‡ä»¶ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸»è¿›ç¨‹æ˜¯ä¸è¿›è¡Œä»»ä½•I/Oæ“ä½œçš„ã€‚è¿™å°±ç¡®ä¿äº†æé«˜çš„æ€§èƒ½ã€‚å¦‚æœéœ€è¦è¿›è¡Œå¤§è§„æ¨¡æ•°æ®çš„æ¢å¤ï¼Œä¸”å¯¹äºæ•°æ®æ¢å¤çš„å®Œæ•´æ€§ä¸æ˜¯éå¸¸æ•æ„Ÿï¼Œé‚£RDBæ–¹å¼è¦æ¯”AOFæ–¹å¼æ›´åŠ é«˜æ•ˆã€‚RDBçš„<strong>ç¼ºç‚¹æ˜¯æœ€åä¸€æ¬¡æŒä¹…åŒ–åçš„æ•°æ®å¯èƒ½ä¸¢å¤±</strong>ã€‚æˆ‘ä»¬é»˜è®¤çš„å°±æ˜¯RDBï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸éœ€è¦ä¿®æ”¹è¿™ä¸ªé…ç½®ã€‚</p>
<blockquote>
<p>ğŸ’£è§¦å‘æœºåˆ¶</p>
</blockquote>
<ul>
<li>saveçš„è§„åˆ™æ»¡è¶³çš„æƒ…å†µä¸‹ï¼Œä¼šè‡ªåŠ¨è§¦å‘rdbè§„åˆ™</li>
<li>æ‰§è¡Œflushallå‘½ä»¤ï¼Œä¹Ÿä¼šè§¦å‘rdbè§„åˆ™</li>
<li>é€€å‡ºredisï¼Œä¹Ÿä¼šäº§ç”Ÿrdbæ–‡ä»¶</li>
</ul>
<blockquote>
<p>ğŸ’Ÿæ¢å¤rdb</p>
</blockquote>
<ul>
<li><p>å°†rdbæ–‡ä»¶æ”¾åœ¨rediså¯åŠ¨ç›®å½•ï¼ŒredisæœåŠ¡å™¨å¯åŠ¨çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨æ£€æŸ¥dump.rdbï¼Œæ¢å¤å…¶ä¸­çš„æ•°æ®</p>
</li>
<li><p>æŸ¥çœ‹éœ€è¦å­˜åœ¨çš„ä½ç½®</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; config get dir</span><br><span class="line">1) &quot;dir&quot;</span><br><span class="line">2) &quot;/usr/local/bin&quot; # å¦‚æœåœ¨è¿™ä¸ªç›®å½•ä¸‹å­˜åœ¨dump.rdbæ–‡ä»¶ï¼Œå¯åŠ¨å°±ä¼šè‡ªåŠ¨æ¢å¤å…¶ä¸­çš„æ•°æ®</span><br></pre></td></tr></table></figure>



<blockquote>
<p>ğŸŒ ä¼˜ç‚¹ç¼ºç‚¹</p>
</blockquote>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li><p>é€‚åˆå¤§è§„æ¨¡çš„æ•°æ®æ¢å¤(é€‚åˆæ–‡ä»¶å¤‡ä»½)</p>
</li>
<li><p>å¯¹æ•°æ®çš„å®Œæ•´æ€§è¦æ±‚ä¸é«˜</p>
</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li><p>RedisæœåŠ¡å™¨å®•æœºæ—¶ä¼šä¸¢å¤±æ•°æ®</p>
</li>
<li><p>forkè¿›ç¨‹ä¼šå ç”¨ä¸€å®šçš„å†…å®¹ç©ºé—´</p>
</li>
</ul>
<h3 id="11-2-ğŸ“AOF"><a href="#11-2-ğŸ“AOF" class="headerlink" title="11.2 ğŸ“AOF"></a>11.2 ğŸ“AOF</h3><blockquote>
<p>ğŸ””AOF = Append Only Mode</p>
</blockquote>
<p>æŠŠæ‰€æœ‰çš„å¯¹Redisçš„æœåŠ¡å™¨è¿›è¡Œä¿®æ”¹çš„å‘½ä»¤éƒ½å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶(é»˜è®¤ä¸ºappendonly.aof)é‡Œï¼Œå‘½ä»¤çš„é›†åˆã€‚</p>
<blockquote>
<p>ğŸ””é…ç½®</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">appendonly yes # å¼€å¯AOF</span><br><span class="line">appendfsync yes # é»˜è®¤å¼€å¯åŒæ­¥</span><br><span class="line">appendfsync always # æ¯æ¬¡æ•°æ®ä¿®æ”¹å‘ç”Ÿæ—¶å€™éƒ½ä¼šå†™å…¥AOFæ–‡ä»¶</span><br><span class="line">appendfsync everysec # æ¯ç§’é’ŸåŒæ­¥ä¸€æ¬¡ï¼Œè¿™ä¸ªæ­»AOFçš„ç¼ºçœç­–ç•¥</span><br></pre></td></tr></table></figure>



<blockquote>
<p>ğŸ“AOFé‡å†™</p>
</blockquote>
<ul>
<li>AOFæ–‡ä»¶çš„å¤§å°éšç€æ—¶é—´çš„æµé€ä¸€å®šè¶Šæ¥è¶Šå¤§ï¼Œå½±å“åŒ…æ‹¬ä½†ä¸é™äºï¼šå¯¹äºRedisæœåŠ¡å™¨è®¡ç®—æœºçš„å­˜å‚¨å‹åŠ›ï¼›AOFè¿˜åŸæ•°æ®åº“çŠ¶æ€çš„æ—¶é—´å¢åŠ </li>
<li>ä¸ºäº†è§£å†³AOFæ–‡ä»¶ä½“ç§¯è†¨èƒ€çš„é—®é¢˜ï¼ŒRedisæä¾›äº†AOFé‡å†™åŠŸèƒ½ï¼šRedisæœåŠ¡å™¨å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„AOFæ–‡ä»¶æ¥æ›¿ä»£ç°æœ‰çš„AOFæ–‡ä»¶ï¼Œæ–°æ—§ä¸¤ä¸ªæ–‡ä»¶æ‰€ä¿å­˜çš„æ•°æ®åº“çŠ¶æ€æ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯æ–°çš„AOF æ–‡ä»¶ä¸ä¼šåŒ…å«ä»»ä½•æµªè´¹ç©ºé—´çš„å†—ä½™å‘½ä»¤ï¼Œé€šå¸¸ä¼šè¾ƒæ—§AOFæ–‡ä»¶å°å¾ˆå¤š</li>
</ul>
<p>Redisä¼šåœ¨æœ€è¿‘ä¸€æ¬¡é‡å†™åè®°ä½AOFæ–‡ä»¶çš„å¤§å°ï¼Œå°†æ¬¡åŸºæœ¬å¤§å°ä¸å½“å‰å¤§å°è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå½“å‰å¤§å°å¤§äºæŒ‡å®šçš„ç™¾åˆ†æ¯”ï¼Œåˆ™è§¦å‘é‡å†™ã€‚</p>
<p>æŒ‡å®šé›¶ç™¾åˆ†æ¯”å¯ä»¥ç¦ç”¨é‡å†™åŠŸèƒ½ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">auto-aof-rewrite-percentage 100 </span><br><span class="line">auto-aof-rewrite-min-size 64mb # è§¦å‘é‡å†™çš„AOFæ–‡ä»¶çš„æœ€å°å¤§å°</span><br></pre></td></tr></table></figure>



<blockquote>
<p>ğŸ’¢äº§ç”Ÿé—®é¢˜</p>
</blockquote>
<p>æ¯æ¬¡é‡å¯Redisçš„æ—¶å€™ï¼Œä¼šä¼˜å…ˆä½¿ç”¨AOFæ–‡ä»¶è¿˜åŸæ•°æ®ã€‚</p>
<p>å¦‚æœAOFæ–‡ä»¶ä»¥å¤–äº§ç”Ÿé”™ä½ï¼Œæˆ–è€…äººå·¥æ„å¤–æ”¹å†™ï¼Œå¯ä»¥é€šè¿‡<code>redis-check-aof --fix appendonly.aof</code>ä¿®å¤æ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@master bin]# redis-check-aof --fix appendonly.aof </span><br><span class="line">&#x27;x              3f: Expected prefix &#x27;*&#x27;, got: &#x27;</span><br><span class="line">AOF analyzed: size=114, ok_up_to=63, diff=51</span><br><span class="line">This will shrink the AOF from 114 bytes, with 51 bytes, to 63 bytes</span><br><span class="line">Continue? [y/N]: y</span><br><span class="line">Successfully truncated AOF</span><br></pre></td></tr></table></figure>



<blockquote>
<p>ğŸŒ ä¼˜ç‚¹ç¼ºç‚¹</p>
</blockquote>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>AOFä¼šè®©rediså˜å¾—éå¸¸è€ä¹…ï¼ŒAOFçš„é»˜è®¤ç­–ç•¥æ˜¯æ¯ç§’åŒæ­¥ä¸€æ¬¡ï¼Œåœ¨è¿™ç§é…ç½®ä¸‹ï¼Œå°±ç®—RedisæœåŠ¡å™¨å®•æœºï¼Œä¹Ÿæœ€å¤šä¸¢å¤±ä¸€ç§’é’Ÿçš„æ•°æ®</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>å¯¹äºç›¸åŒçš„æ•°æ®é›†æ¥è¯´ï¼ŒAOFçš„æ–‡ä»¶ä½“ç§¯è¦å¤§äºRDBçš„æ–‡ä»¶ä½“ç§¯ï¼Œæ•°æ®æ¢å¤çš„é€Ÿåº¦æ›´æ…¢</li>
<li>æ ¹æ®æ‰€ä½¿ç”¨çš„syncç­–ç•¥ï¼ŒAOFçš„é€Ÿåº¦å¯èƒ½æ…¢äºRDB</li>
</ul>
<h2 id="12-ğŸ“©Rediså‘å¸ƒè®¢é˜…"><a href="#12-ğŸ“©Rediså‘å¸ƒè®¢é˜…" class="headerlink" title="12. ğŸ“©Rediså‘å¸ƒè®¢é˜…"></a>12. ğŸ“©Rediså‘å¸ƒè®¢é˜…</h2><h3 id="12-1-ğŸ’¬è¯´æ˜"><a href="#12-1-ğŸ’¬è¯´æ˜" class="headerlink" title="12.1 ğŸ’¬è¯´æ˜"></a>12.1 ğŸ’¬è¯´æ˜</h3><p>Redis å‘å¸ƒè®¢é˜… (pub/sub) æ˜¯ä¸€ç§æ¶ˆæ¯é€šä¿¡æ¨¡å¼ï¼šå‘é€è€…(pub) å‘é€æ–¹æ¶ˆæ¯ï¼Œè®¢é˜…è€…(sub)æ¥æ”¶æ¶ˆæ¯ã€‚</p>
<p>Rediså®¢æˆ·ç«¯å¯ä»¥è®¢é˜…ä»»æ„æ•°é‡çš„é¢‘é“ã€‚</p>
<h3 id="12-2-ğŸ“·æ¨¡å‹"><a href="#12-2-ğŸ“·æ¨¡å‹" class="headerlink" title="12.2 ğŸ“·æ¨¡å‹"></a>12.2 ğŸ“·æ¨¡å‹</h3><blockquote>
<p>ğŸ—¼è®¢é˜…æ¨¡å‹</p>
</blockquote>
<img src="/2020/10/08/Redis/image-20201125132811770.png" class="" title="image-20201125132811770">

<blockquote>
<p>ğŸ—½æ¶ˆæ¯æ¨¡å‹</p>
</blockquote>
<img src="/2020/10/08/Redis/image-20201125132839908.png" class="" title="image-20201125132839908">



<blockquote>
<p>ğŸ“œå‘å¸ƒè®¢é˜…å‘½ä»¤</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">å‘½ä»¤</th>
<th align="center">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="center">psubscribe pattern [pattern â€¦]</td>
<td align="center">è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªç¬¦åˆç»™å®šæ¨¡å¼çš„é¢‘é“</td>
</tr>
<tr>
<td align="center">pubsub subcommand [argument [argument â€¦]]</td>
<td align="center">æŸ¥çœ‹è®¢é˜…ä¸å‘å¸ƒç³»ç»ŸçŠ¶æ€</td>
</tr>
<tr>
<td align="center">publish channel message</td>
<td align="center">å°†æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šçš„é¢‘é“</td>
</tr>
<tr>
<td align="center">punsubscribe channel [channel â€¦]</td>
<td align="center">é€€è®¢æ‰€æœ‰ç»™å®šæ¨¡å¼çš„é¢‘é“</td>
</tr>
<tr>
<td align="center">subscribe channel [channel â€¦]</td>
<td align="center">è®¢é˜…ç»™å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ªé¢‘é“çš„ä¿¡æ¯</td>
</tr>
<tr>
<td align="center">unsubscribe [channel [channel â€¦]]</td>
<td align="center">é€€è®¢ç»™å®šçš„é¢‘é“</td>
</tr>
</tbody></table>
<blockquote>
<p>ğŸæ¼”ç¤º</p>
</blockquote>
<p>å¼€å¯ä¸‰ä¸ªredis-cli</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œè®¢é˜…é¢‘é“ï¼šKhighness</span></span><br><span class="line">127.0.0.1:6379&gt; subscribe Khighness</span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) &quot;subscribe&quot;</span><br><span class="line">2) &quot;Khighness&quot;</span><br><span class="line">3) (integer) 1</span><br><span class="line">1) &quot;message&quot;</span><br><span class="line">2) &quot;Khighness&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ç¬¬äºŒä¸ªå®¢æˆ·ç«¯ï¼Œåœ¨é¢‘é“Khighnesså‘å¸ƒæ¶ˆæ¯</span></span><br><span class="line">127.0.0.1:6379&gt; publish Khighness &quot;Client1: Hello, Khighness&quot;</span><br><span class="line">(integer) 1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ç¬¬ä¸‰ä¸ªå®¢æˆ·ç«¯ï¼Œåœ¨é¢‘é“Khighnesså‘å¸ƒæ¶ˆæ¯</span></span><br><span class="line">127.0.0.1:6379&gt; publish Khighness &quot;Client3: Hello, Khighness&quot;</span><br><span class="line">(integer) 1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¢é˜…é¢‘é“çš„ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯å°±èƒ½æ”¶åˆ°æ¶ˆæ¯</span></span><br><span class="line">1) &quot;message&quot;</span><br><span class="line">2) &quot;Khighness&quot;</span><br><span class="line">3) &quot;Client2: Hello, Khighness&quot;</span><br><span class="line">1) &quot;message&quot;</span><br><span class="line">2) &quot;Khighness&quot;</span><br><span class="line">3) &quot;Client3: Hello, Khighness&quot;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>ğŸ•µï¸åŸç†</p>
</blockquote>
<p>Redisæ˜¯Cè¯­è¨€ç¼–å†™çš„ï¼Œé€šè¿‡åˆ†æRedisæºä»£ç é‡Œé¢çš„pubsub.cæ–‡ä»¶ï¼Œäº†è§£å‘å¸ƒå’Œè®¢é˜…æœºåˆ¶çš„åº•å±‚å®ç°ã€‚</p>
<p>é€šè¿‡subscribeå‘½ä»¤è®¢é˜…æŸé¢‘é“åï¼Œredis-serveré‡Œç»´æŠ¤äº†ä¸€ä¸ªå­—å…¸ï¼Œå­—å…¸çš„é”®å°±æ˜¯ä¸€ä¸ªä¸ªé¢‘é“channelï¼Œè€Œå­—å…¸çš„å€¼åˆ™æ˜¯ä¸€ä¸ªä¸ªé“¾è¡¨ï¼Œé“¾è¡¨ä¸­ä¿å­˜äº†æ‰€æœ‰è®¢é˜…è¿™ä¸ªé¢‘é“çš„å®¢æˆ·ç«¯clientã€‚subscribeå‘½ä»¤çš„å…³é”®ï¼Œå°±æ˜¯å°†clientæ·»åŠ åˆ°ç»™å®šchannelçš„è®¢é˜…é“¾ä¸­ã€‚</p>
<p>é€šè¿‡publishå‘½ä»¤å‘è®¢é˜…è€…å‘é€æ¶ˆæ¯ï¼Œredis-serverä¼šä½¿ç”¨ç»™å®šçš„é¢‘é“ä½œä¸ºé”®ï¼Œåœ¨å®ƒæ‰€ç»´æŠ¤çš„channelå­—å…¸æŸ¥æ‰¾è®°å½•äº†è®¢é˜…è¿™ä¸ªé¢‘é“çš„æ‰€æœ‰å®¢æˆ·ç«¯çš„é“¾è¡¨ï¼Œéå†è¿™ä¸ªé“¾è¡¨ï¼Œå°†æ¶ˆæ¯å‘å¸ƒç»™æ‰€æœ‰è®¢é˜…è€…ã€‚</p>
<p>åœ¨Redisä¸­ï¼Œå¯ä»¥è®¾å®šå¯¹æŸä¸€ä¸ªkeyå€¼è¿›è¡Œæ¶ˆæ¯å‘å¸ƒåŠæ¶ˆæ¯è®¢é˜…ï¼Œå½“ä¸€ä¸ªkeyå€¼ä¸Šè¿›è¡Œäº†æ¶ˆæ¯å‘å¸ƒåï¼Œæ‰€æœ‰è®¢é˜…å®ƒçš„å®¢æˆ·ç«¯éƒ½ä¼šæ”¶åˆ°å“åº”çš„æ¶ˆæ¯ã€‚è¿™ä¸€åŠŸèƒ½æœ€æ˜æ˜¾çš„ç”¨æ³•å°±æ˜¯ç”¨ä½œå®æ—¶æ¶ˆæ¯ç³»ç»Ÿï¼Œæ™®é€šçš„å³æ—¶èŠå¤©å’Œç¾¤èŠåŠŸèƒ½ã€‚</p>
<h2 id="13-ğŸ“©Redisä¸»ä»å¤åˆ¶"><a href="#13-ğŸ“©Redisä¸»ä»å¤åˆ¶" class="headerlink" title="13. ğŸ“©Redisä¸»ä»å¤åˆ¶"></a>13. ğŸ“©Redisä¸»ä»å¤åˆ¶</h2><h3 id="13-1-ğŸ“–æ¦‚å¿µ"><a href="#13-1-ğŸ“–æ¦‚å¿µ" class="headerlink" title="13.1 ğŸ“–æ¦‚å¿µ"></a>13.1 ğŸ“–æ¦‚å¿µ</h3><p>ä¸»ä»å¤åˆ¶ï¼Œæ˜¯æŒ‡å°†ä¸€å°RedisæœåŠ¡å™¨çš„æ•°æ®ï¼Œå¤åˆ¶åˆ°å…¶ä»–çš„RedisæœåŠ¡å™¨ã€‚å‰è€…ç§°ä¸ºä¸»ç»“ç‚¹(master)ï¼Œåè€…ç§°ä¸ºä»ç»“ç‚¹(slave)ï¼›æ•°æ®çš„å¤åˆ¶æ˜¯å•å‘çš„ï¼Œåªèƒ½ç”±ä¸»èŠ‚ç‚¹åˆ°ä»ç»“ç‚¹ã€‚masterä»¥å†™ä¸ºä¸»ï¼Œsalveä»¥è¯»ä¸ºä¸»ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯å°RedisæœåŠ¡å™¨éƒ½æ˜¯ä¸»ç»“ç‚¹ï¼›ä¸”ä¸€ä¸ªä¸»ç»“ç‚¹å¯ä»¥æœ‰å¤šä¸ªä»ç»“ç‚¹(æˆ–æ²¡æœ‰ä»ç»“ç‚¹)ï¼Œä½†ä¸€ä¸ªä»ç»“ç‚¹åªèƒ½æœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹ã€‚</p>
<h3 id="13-2-ğŸ”§ä½œç”¨"><a href="#13-2-ğŸ”§ä½œç”¨" class="headerlink" title="13.2 ğŸ”§ä½œç”¨"></a>13.2 ğŸ”§ä½œç”¨</h3><ol>
<li>æ•°æ®å†—ä½™ï¼šä¸»ä»å¤åˆ¶å®ç°äº†æ•°æ®çš„çƒ­å¤‡ä»½ï¼Œæ˜¯æŒä¹…åŒ–ä¹‹å¤–çš„ä¸€ç§æ•°æ®å†—ä½™æ–¹å¼</li>
<li>æ•…éšœæ¢å¤ï¼šå½“ä¸»èŠ‚ç‚¹å‡ºç°é—®é¢˜æ—¶ï¼Œå¯ä»¥ç”±ä»èŠ‚ç‚¹æä¾›æœåŠ¡ï¼Œå®ç°å¿«é€Ÿçš„æ•…éšœæ¢å¤ï¼Œå®é™…ä¸Šæ˜¯ä¸€ç§æœåŠ¡çš„å†—ä½™</li>
<li>è´Ÿè½½å‡è¡¡ï¼šåœ¨ä¸»ä»å¤åˆ¶çš„åŸºç¡€ä¸Šï¼Œé…åˆè¯»å†™åˆ†ç¦»ï¼Œå¯ä»¥ç”±ä¸»èŠ‚ç‚¹æä¾›è¯»æœåŠ¡ï¼Œåˆ†æ‹…æœåŠ¡å™¨è´Ÿè½½ï¼›å°¤å…¶æ˜¯åœ¨å†™å°‘è¯»å¤šçš„åœºæ™¯ä¸‹ï¼Œé€šè¿‡å¤šä¸ªä»ç»“ç‚¹åˆ†æ‹…è¯»è´Ÿè½½ï¼Œå¯ä»¥å¤§å¤§æé«˜RedisæœåŠ¡å™¨çš„å¹¶å‘é‡</li>
<li>é«˜å¯ç”¨åŸºçŸ³ï¼šä¸»ä»å¤åˆ¶æ˜¯å“¨å…µå’Œé›†ç¾¤å¯å®æ–½çš„åŸºç¡€ï¼Œå› æ­¤è¯´ä¸»ä»å¤åˆ¶æ˜¯Redisé«˜å¯ç”¨çš„åŸºç¡€</li>
</ol>
<h3 id="13-3-ğŸ”å¤åˆ¶åŸç†"><a href="#13-3-ğŸ”å¤åˆ¶åŸç†" class="headerlink" title="13.3 ğŸ”å¤åˆ¶åŸç†"></a>13.3 ğŸ”å¤åˆ¶åŸç†</h3><p>slaveå¯åŠ¨æˆåŠŸè¿æ¥åˆ°masteråä¼šå‘é€ä¸€ä¸ªsyncåŒæ­¥å‘½ä»¤ã€‚</p>
<p>masteræ¥åˆ°å‘½ä»¤ï¼Œå¯åŠ¨åå°çš„å­˜ç›˜è¿›ç¨‹ï¼ŒåŒæ—¶æ”¶é›†æ‰€æœ‰æ¥æ”¶åˆ°çš„ç”¨äºä¿®æ”¹æ•°æ®é›†å‘½ä»¤ï¼Œåœ¨åå°è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œmasterå°†ä¼ é€æ•´ä¸ªæ•°æ®æ–‡ä»¶åˆ°slaveï¼Œå¹¶å®Œæˆä¸€æ¬¡å®Œå…¨åŒæ­¥ã€‚</p>
<p><strong>å…¨é‡å¤åˆ¶</strong>ï¼šslaveæœåŠ¡åœ¨æ¥æ”¶åˆ°æ•°æ®åº“æ–‡ä»¶åï¼Œå°†å…¶å­˜ç›˜å¹¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p>
<p><strong>å¢é‡å¤åˆ¶</strong>ï¼šmasterç»§ç»­å°†æ–°çš„æ‰€æœ‰æ”¶é›†åˆ°çš„ä¿®æ”¹å‘½ä»¤ä¾æ¬¡ä¼ ç»™slaveï¼Œå®ŒæˆåŒæ­¥ã€‚</p>
<p>ä½†æ˜¯åªè¦æ˜¯é‡æ–°è¿æ¥masterï¼Œä¸€æ¬¡å®Œå…¨åŒæ­¥(å…¨é‡å¤åˆ¶)å°†è¢«è‡ªåŠ¨æ‰§è¡Œã€‚</p>
<h2 id="14-ğŸ“©Redisé›†ç¾¤æ­å»º"><a href="#14-ğŸ“©Redisé›†ç¾¤æ­å»º" class="headerlink" title="14. ğŸ“©Redisé›†ç¾¤æ­å»º"></a>14. ğŸ“©Redisé›†ç¾¤æ­å»º</h2><h3 id="14-1-ğŸ”±æ–¹æ³•"><a href="#14-1-ğŸ”±æ–¹æ³•" class="headerlink" title="14.1 ğŸ”±æ–¹æ³•"></a>14.1 ğŸ”±æ–¹æ³•</h3><p>==æ­å»ºä¸´æ—¶ä¼ªé›†ç¾¤ï¼Œå‘½ä»¤æ“ä½œå³å¯==</p>
<p>ä¸»è¦æ“ä½œï¼š<strong>æ“ä½œä»æœºï¼Œè®¤è€å¤§ã€‚</strong></p>
<p>æŸ¥çœ‹redisæœåŠ¡å™¨ä¿¡æ¯ï¼š<code>info replication</code></p>
<p>åœ¨ä»æœºä¸Šè®¤è€å¤§masterï¼š<code>slaveof &lt;master-ip&gt; &lt;master-port&gt;</code></p>
<p>==æ­å»ºæ°¸ä¹…é›†ç¾¤ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶==</p>
<p>ä¸»è¦æ“ä½œï¼šä¿®æ”¹redis-confæ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">replicaof &lt;masterip&gt; &lt;masterport&gt;  # é…ç½®masterçš„ipå’Œç«¯å£å·</span><br><span class="line">masterauth &lt;master-passwordd&gt;      # å¦‚æœmasteræœ‰å¯†ç åˆ™é…ç½®å¯†ç </span><br></pre></td></tr></table></figure>



<p>==masterå…³æœºè§£å†³â€”â€”è°‹æƒç¯¡ä½==</p>
<p>é€šè¿‡<code>slaveof no one</code>è®©slaveè‡ªå·±å˜æˆmaster</p>
<h3 id="14-2-ğŸ”ªæ“ä½œ"><a href="#14-2-ğŸ”ªæ“ä½œ" class="headerlink" title="14.2 ğŸ”ªæ“ä½œ"></a>14.2 ğŸ”ªæ“ä½œ</h3><ol>
<li>å¤åˆ¶ä¸‰ä»½redis.confæ–‡ä»¶ï¼Œä¿®æ”¹ä¿¡æ¯<ul>
<li>port</li>
<li>logfile</li>
<li>pidfile</li>
<li>dbfilename</li>
</ul>
</li>
<li>åˆ†åˆ«åœ¨ä¸‰ä¸ªé…ç½®æ–‡ä»¶ä¸‹å¯åŠ¨redisæœåŠ¡</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@master bin]# ps -ef | grep redis</span><br><span class="line">root      18914      1  0 00:54 ?        00:01:38 redis-server 127.0.0.1:6379</span><br><span class="line">root      31612      1  0 11:51 ?        00:00:00 redis-server 127.0.0.1:6380</span><br><span class="line">root      31623      1  0 11:51 ?        00:00:00 redis-server 127.0.0.1:6381</span><br><span class="line">root      31634  31340  0 11:51 pts/2    00:00:00 grep --color=auto redis</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>å¼€å¯ä¸‰ä¸ªç»ˆç«¯å¼€å¯ä¸‰ä¸ªrediså®¢æˆ·ç«¯åˆ†åˆ«è¿æ¥ä¸‰ä¸ªredisæœåŠ¡å™¨</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Terminal1</span></span><br><span class="line">[parak@master bin]$ redis-cli -p 6379</span><br><span class="line"><span class="meta">#</span><span class="bash"> Terminal2</span></span><br><span class="line">[parak@master bin]$ redis-cli -p 6380</span><br><span class="line"><span class="meta">#</span><span class="bash"> Terminal3</span></span><br><span class="line">[parak@master bin]$ redis-cli -p 6381</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>å°†6379ç«¯å£çš„æœåŠ¡çš„é…ç½®æˆmasterï¼Œå¦å¤–ä¸¤ä¸ªé…ç½®æˆslave</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 6380</span></span><br><span class="line">127.0.0.1:6380&gt; slaveof 127.0.0.1 6379</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6380&gt; info replication</span><br><span class="line"><span class="meta">#</span><span class="bash"> Replication</span></span><br><span class="line">role:slave</span><br><span class="line">master_host:127.0.0.1</span><br><span class="line">master_port:6379</span><br><span class="line">master_link_status:up</span><br><span class="line">master_last_io_seconds_ago:3</span><br><span class="line">master_sync_in_progress:0</span><br><span class="line">slave_repl_offset:14</span><br><span class="line">slave_priority:100</span><br><span class="line">slave_read_only:1</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_replid:9c3e61afce386f90c00db9ee4e9a2e7b4b265297</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:14</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:1</span><br><span class="line">repl_backlog_histlen:14</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 6381</span></span><br><span class="line">127.0.0.1:6381&gt; slaveof 127.0.0.1 6379</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6381&gt; info replication</span><br><span class="line"><span class="meta">#</span><span class="bash"> Replication</span></span><br><span class="line">role:slave</span><br><span class="line">master_host:127.0.0.1</span><br><span class="line">master_port:6379</span><br><span class="line">master_link_status:up</span><br><span class="line">master_last_io_seconds_ago:8</span><br><span class="line">master_sync_in_progress:0</span><br><span class="line">slave_repl_offset:42</span><br><span class="line">slave_priority:100</span><br><span class="line">slave_read_only:1</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_replid:9c3e61afce386f90c00db9ee4e9a2e7b4b265297</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:42</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:43</span><br><span class="line">repl_backlog_histlen:0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 6379</span></span><br><span class="line">127.0.0.1:6379&gt; info replication</span><br><span class="line"><span class="meta">#</span><span class="bash"> Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:2</span><br><span class="line">slave0:ip=127.0.0.1,port=6380,state=online,offset=2087,lag=0</span><br><span class="line">slave1:ip=127.0.0.1,port=6381,state=online,offset=2087,lag=0</span><br><span class="line">master_replid:9c3e61afce386f90c00db9ee4e9a2e7b4b265297</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:2087</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:1</span><br><span class="line">repl_backlog_histlen:2087</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>åœ¨masterä¸Šå†™å…¥å€¼ï¼Œåœ¨slaveä¸Šè¯»å–å€¼</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 6379</span></span><br><span class="line">127.0.0.1:6379&gt; hmset student:1 name Khighness gender male age 19</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; hmset student:2 name bingyao gender female age 16</span><br><span class="line">OK</span><br><span class="line"><span class="meta">#</span><span class="bash"> 6380</span></span><br><span class="line">127.0.0.1:6380&gt; hmget student:1 name gender age</span><br><span class="line">1) &quot;Khighness&quot;</span><br><span class="line">2) &quot;male&quot;</span><br><span class="line">3) &quot;19&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 6381</span></span><br><span class="line">127.0.0.1:6381&gt; hmget student:2 name gender age</span><br><span class="line">1) &quot;bingyao&quot;</span><br><span class="line">2) &quot;female&quot;</span><br><span class="line">3) &quot;16&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> slaveåªèƒ½è¯»å–ï¼Œä¸èƒ½å†™å…¥</span></span><br><span class="line">127.0.0.1:6380&gt; set K2 V2</span><br><span class="line">(error) READONLY You can&#x27;t write against a read only replica</span><br></pre></td></tr></table></figure>



<h2 id="15-ğŸ“©Rediså“¨å…µæ¨¡å¼"><a href="#15-ğŸ“©Rediså“¨å…µæ¨¡å¼" class="headerlink" title="15. ğŸ“©Rediså“¨å…µæ¨¡å¼"></a>15. ğŸ“©Rediså“¨å…µæ¨¡å¼</h2><p><del>é©¾æ ¡æ‰‹åŠ¨æŒ¡=&gt;ä¸Šè·¯è‡ªåŠ¨æŒ¡</del></p>
<h3 id="15-1-ğŸ“™æ¦‚è¿°"><a href="#15-1-ğŸ“™æ¦‚è¿°" class="headerlink" title="15.1 ğŸ“™æ¦‚è¿°"></a>15.1 ğŸ“™æ¦‚è¿°</h3><p>ä¸»ä»åˆ‡æ¢æŠ€æœ¯çš„æ–¹æ³•ï¼šå½“ä¸»æœåŠ¡å™¨å®•æœºåï¼Œéœ€è¦æ‰‹åŠ¨æŠŠä¸€å°ä»æœåŠ¡å™¨åˆ‡æ¢ä¸ºä¸»æœåŠ¡å™¨ï¼Œè¿™å°±éœ€è¦äººå·¥å¹²é¢„ï¼Œè´¹äº‹è´¹åŠ›ï¼Œè¿˜ä¼šé€ æˆä¸€æ®µæ—¶é—´å†…æœåŠ¡ä¸å¯ç”¨ã€‚è¿™ä¸æ˜¯ä¸€ç§æ¨èçš„æ–¹å¼ï¼Œæ›´å¤šæ—¶å€™ï¼Œæˆ‘ä»¬ä¼˜å…ˆè€ƒè™‘å“¨å…µæ¨¡å¼ã€‚Redisä»2.8å¼€å§‹æ­£å¼æä¾›äº†Sentinel(å“¨å…µ)æ¶æ„æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼Œå“¨å…µæ¨¡å¼å°±æ˜¯è°‹æƒç¯¡ä½çš„è‡ªåŠ¨ç‰ˆï¼Œèƒ½å¤Ÿåå°ç›‘æ§ä¸»æœºæ˜¯å¦æ•…éšœï¼Œå¦‚æœå‘ç”Ÿæ•…éšœåˆ™æ ¹æ®æŠ•ç¥¨æ•°è‡ªåŠ¨å°†åº“è½¬æ¢ä¸ºä¸»åº“ã€‚</p>
<p>å“¨å…µæ¨¡å¼æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ¨¡å¼ï¼Œé¦–å…ˆRedisæä¾›äº†å“¨å…µçš„å‘½ä»¤ï¼Œå“¨å…µæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œä½œä¸ºè¿›ç¨‹ï¼Œå®ƒä¼šç‹¬ç«‹è¿è¡Œã€‚</p>
<p>åŸç†ï¼šå“¨å…µé€šè¿‡å‘é€å‘½ä»¤ï¼Œç­‰å¾…RedisæœåŠ¡å™¨å“åº”ï¼Œä»è€Œç›‘æ§è¿è¡Œçš„å¤šä¸ªRediså®ä¾‹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">graph TD;</span><br><span class="line">	A((å“¨å…µ))</span><br><span class="line">	B(ä¸»RedisæœåŠ¡å™¨)</span><br><span class="line">	C(ä»RedisæœåŠ¡å™¨1)</span><br><span class="line">	D(ä»RedisæœåŠ¡å™¨2)</span><br><span class="line">	S[ä»¥ç‹¬ç«‹çš„è¿›ç¨‹ç›‘æ§3å°æœåŠ¡å™¨Redisæ˜¯å¦æ­£å¸¸è¿è¡Œ] </span><br><span class="line">	S --&gt; A</span><br><span class="line">	A --&gt; C</span><br><span class="line">	A --&gt; B</span><br><span class="line">	A --&gt; D</span><br><span class="line">	B --&gt; C</span><br><span class="line">	B --&gt; D</span><br></pre></td></tr></table></figure>



<p>è¿™é‡Œçš„å“¨å…µæœ‰ä¸¤ä¸ªä½œç”¨ï¼š</p>
<ul>
<li>é€šè¿‡å‘é€å‘½ä»¤ï¼Œè®©RedisæœåŠ¡å™¨è¿”å›ç›‘æ§å…¶è¿è¡ŒçŠ¶æ€ï¼ŒåŒ…æ‹¬ä¸»æœåŠ¡å™¨å’Œä»æœåŠ¡å™¨</li>
<li>å½“å“¨å…µç›‘æµ‹åˆ°masterå®•æœºï¼Œä¼šè‡ªåŠ¨å°†slaveåˆ‡æ¢ä¸ºmasterï¼Œç„¶åé€šè¿‡å‘å¸ƒè®¢é˜…æ¨¡å¼é€šçŸ¥å…¶ä»–çš„ä»æœåŠ¡å™¨ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œè®©å®ƒä»¬åˆ‡æ¢ä¸»æœº</li>
</ul>
<p>ä¸€ä¸ªå“¨å…µè¿›ç¨‹å¯¹RedisæœåŠ¡å™¨è¿›è¡Œç›‘æ§ï¼Œå¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šä¸ªå“¨å…µè¿›è¡Œç›‘æ§ï¼Œå„ä¸ªå“¨å…µä¹‹é—´è¿˜ä¼šè¿›è¡Œç›‘æ§ï¼Œè¿™æ ·å°±å½¢æˆäº†å¤šå“¨å…µæ¨¡å¼ã€‚</p>
<img src="/2020/10/08/Redis/sentinel.jpg" class="" title="sentinel">



<p>å‡è®¾ä¸»æœåŠ¡å™¨å®•æœºï¼Œå“¨å…µ1å…ˆæ£€æµ‹åˆ°è¿™ä¸ªç»“æœï¼Œç³»ç»Ÿå¹¶ä¸ä¼šé©¬ä¸Šè¿›è¡Œfailoverè¿‡ç¨‹ï¼Œä»…ä»…æ˜¯å“¨å…µ1ä¸»ç®¡çš„è®¤ä¸ºä¸»æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œä»…ä»…æ˜¯å“¨å…µ1ä¸»è§‚çš„è®¤ä¸ºä¸»æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œè¿™ä¸ªç°è±¡ç§°ä¸ºä¸»è§‚ä¸‹çº¿ï¼Œå½“åé¢çš„å“¨å…µä¹Ÿæ£€æµ‹åˆ°ä¸»æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œå¹¶ä¸”æ•°é‡è¾¾åˆ°ä¸€å®šå€¼æ—¶ï¼Œé‚£ä¹ˆå“¨å…µä¹‹é—´å°±ä¼šè¿›è¡Œä¸€æ¬¡æŠ•ç¥¨ï¼ŒæŠ•ç¥¨çš„ç»“æœç”±ä¸€ä¸ªå“¨å…µå‘èµ·ï¼Œè¿›è¡Œfailover[æ•…éšœè½¬ç§»]æ“ä½œã€‚åˆ‡æ¢æˆåŠŸåï¼Œå°±ä¼šé€šè¿‡å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œè®©å„ä¸ªå“¨å…µæŠŠè‡ªå·±ç›‘æ§çš„ä»æœåŠ¡å™¨å®ç°åˆ‡æ¢ä¸»æœºï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºå®¢è§‚ä¸‹çº¿ã€‚</p>
<h3 id="15-2-ğŸæµ‹è¯•"><a href="#15-2-ğŸæµ‹è¯•" class="headerlink" title="15.2 ğŸæµ‹è¯•"></a>15.2 ğŸæµ‹è¯•</h3><p>å‡†å¤‡ä¸‰ä¸ªredisæœåŠ¡ï¼Œ6379-masterã€6380-slaveã€6381-slave</p>
<p>ä¿®æ”¹é…ç½®æ–‡ä»¶sentinel.conf</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sentinel monitor mymaster 127.0.0.1 6379 1</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨å“¨å…µ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">34055:X 20 Oct 2020 14:39:15.404 * Increased maximum number of open files to 10032 (it was originally set to 1024).</span><br><span class="line">                _._                                                  </span><br><span class="line">           _.-``__ &#x27;&#x27;-._                                             </span><br><span class="line">      _.-``    `.  `_.  &#x27;&#x27;-._           Redis 5.0.8 (00000000/0) 64 bit</span><br><span class="line">  .-`` .-```.  ```\/    _.,_ &#x27;&#x27;-._                                   </span><br><span class="line"> (    &#x27;      ,       .-`  | `,    )     Running in sentinel mode</span><br><span class="line"> |`-._`-...-` __...-.``-._|&#x27;` _.-&#x27;|     Port: 26379</span><br><span class="line"> |    `-._   `._    /     _.-&#x27;    |     PID: 34055</span><br><span class="line">  `-._    `-._  `-./  _.-&#x27;    _.-&#x27;                                   </span><br><span class="line"> |`-._`-._    `-.__.-&#x27;    _.-&#x27;_.-&#x27;|                                  </span><br><span class="line"> |    `-._`-._        _.-&#x27;_.-&#x27;    |           http://redis.io        </span><br><span class="line">  `-._    `-._`-.__.-&#x27;_.-&#x27;    _.-&#x27;                                   </span><br><span class="line"> |`-._`-._    `-.__.-&#x27;    _.-&#x27;_.-&#x27;|                                  </span><br><span class="line"> |    `-._`-._        _.-&#x27;_.-&#x27;    |                                  </span><br><span class="line">  `-._    `-._`-.__.-&#x27;_.-&#x27;    _.-&#x27;                                   </span><br><span class="line">      `-._    `-.__.-&#x27;    _.-&#x27;                                       </span><br><span class="line">          `-._        _.-&#x27;                                           </span><br><span class="line">              `-.__.-&#x27;                                               </span><br><span class="line"></span><br><span class="line">34055:X 20 Oct 2020 14:39:15.407 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span><br><span class="line">34055:X 20 Oct 2020 14:39:15.408 # Sentinel ID is dbfb304470e8ed2bb81b4be42f847e21ff5d9519</span><br><span class="line">34055:X 20 Oct 2020 14:39:15.408 # +monitor master mymaster 127.0.0.1 6379 quorum 1</span><br><span class="line">34055:X 20 Oct 2020 14:40:15.646 * +slave slave 127.0.0.1:6381 127.0.0.1 6381 @ mymaster 127.0.0.1 6379</span><br><span class="line">34055:X 20 Oct 2020 14:40:25.731 * +slave slave 127.0.0.1:6380 127.0.0.1 6380 @ mymaster 127.0.0.1 6379</span><br></pre></td></tr></table></figure>

<p>å…³é—­masteræœåŠ¡</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 6379: master -&gt; shutdown</span></span><br><span class="line">127.0.0.1:6379&gt; SHUTDOWN</span><br><span class="line">not connected&gt; exit</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> sentinel</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ç›‘æ§åˆ°masterå®•æœº</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é€‰å‡º6380ä¸ºmaster</span></span><br><span class="line">34055:X 20 Oct 2020 14:43:47.509 # +sdown master mymaster 127.0.0.1 6379</span><br><span class="line">34055:X 20 Oct 2020 14:43:47.509 # +odown master mymaster 127.0.0.1 6379 #quorum 1/1</span><br><span class="line">34055:X 20 Oct 2020 14:43:47.509 # +new-epoch 1</span><br><span class="line">34055:X 20 Oct 2020 14:43:47.509 # +try-failover master mymaster 127.0.0.1 6379</span><br><span class="line">34055:X 20 Oct 2020 14:43:47.510 # +vote-for-leader dbfb304470e8ed2bb81b4be42f847e21ff5d9519 1</span><br><span class="line">34055:X 20 Oct 2020 14:43:47.510 # +elected-leader master mymaster 127.0.0.1 6379</span><br><span class="line">34055:X 20 Oct 2020 14:43:47.510 # +failover-state-select-slave master mymaster 127.0.0.1 6379</span><br><span class="line">34055:X 20 Oct 2020 14:43:47.594 # +selected-slave slave 127.0.0.1:6380 127.0.0.1 6380 @ mymaster 127.0.0.1 6379</span><br><span class="line">34055:X 20 Oct 2020 14:43:47.594 * +failover-state-send-slaveof-noone slave 127.0.0.1:6380 127.0.0.1 6380 @ mymaster 127.0.0.1 6379</span><br><span class="line">34055:X 20 Oct 2020 14:43:47.678 * +failover-state-wait-promotion slave 127.0.0.1:6380 127.0.0.1 6380 @ mymaster 127.0.0.1 6379</span><br><span class="line">34055:X 20 Oct 2020 14:43:48.296 # +promoted-slave slave 127.0.0.1:6380 127.0.0.1 6380 @ mymaster 127.0.0.1 6379</span><br><span class="line">34055:X 20 Oct 2020 14:43:48.296 # +failover-state-reconf-slaves master mymaster 127.0.0.1 6379</span><br><span class="line">34055:X 20 Oct 2020 14:43:48.371 * +slave-reconf-sent slave 127.0.0.1:6381 127.0.0.1 6381 @ mymaster 127.0.0.1 6379</span><br><span class="line">34055:X 20 Oct 2020 14:43:49.310 * +slave-reconf-inprog slave 127.0.0.1:6381 127.0.0.1 6381 @ mymaster 127.0.0.1 6379</span><br><span class="line">34055:X 20 Oct 2020 14:43:49.310 * +slave-reconf-done slave 127.0.0.1:6381 127.0.0.1 6381 @ mymaster 127.0.0.1 6379</span><br><span class="line">34055:X 20 Oct 2020 14:43:49.362 # +failover-end master mymaster 127.0.0.1 6379</span><br><span class="line">34055:X 20 Oct 2020 14:43:49.362 # +switch-master mymaster 127.0.0.1 6379 127.0.0.1 6380</span><br><span class="line">34055:X 20 Oct 2020 14:43:49.362 * +slave slave 127.0.0.1:6381 127.0.0.1 6381 @ mymaster 127.0.0.1 6380</span><br><span class="line">34055:X 20 Oct 2020 14:43:49.362 * +slave slave 127.0.0.1:6379 127.0.0.1 6379 @ mymaster 127.0.0.1 6380</span><br><span class="line">34055:X 20 Oct 2020 14:44:19.365 # +sdown slave 127.0.0.1:6379 127.0.0.1 6379 @ mymaster 127.0.0.1 6380</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 6380: æ–°ç‹ç™»åŸº</span></span><br><span class="line">127.0.0.1:6380&gt; info replication</span><br><span class="line"><span class="meta">#</span><span class="bash"> Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:1</span><br><span class="line">slave0:ip=127.0.0.1,port=6381,state=online,offset=42337,lag=1</span><br><span class="line">master_replid:12a540accf0c9347d3e45fad83ccddea86f3b3c3</span><br><span class="line">master_replid2:b80e4fbbe06a83ac070f38e89267bd81b26ec5ca</span><br><span class="line">master_repl_offset:42351</span><br><span class="line">second_repl_offset:20188</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:8342</span><br><span class="line">repl_backlog_histlen:34010</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 6381: å‚æ‹œæ–°ç‹</span></span><br><span class="line">127.0.0.1:6381&gt; info replication</span><br><span class="line"><span class="meta">#</span><span class="bash"> Replication</span></span><br><span class="line">role:slave</span><br><span class="line">master_host:127.0.0.1</span><br><span class="line">master_port:6380</span><br><span class="line">master_link_status:up</span><br><span class="line">master_last_io_seconds_ago:0</span><br><span class="line">master_sync_in_progress:0</span><br><span class="line">slave_repl_offset:63969</span><br><span class="line">slave_priority:100</span><br><span class="line">slave_read_only:1</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_replid:12a540accf0c9347d3e45fad83ccddea86f3b3c3</span><br><span class="line">master_replid2:b80e4fbbe06a83ac070f38e89267bd81b26ec5ca</span><br><span class="line">master_repl_offset:63969</span><br><span class="line">second_repl_offset:20188</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:8053</span><br><span class="line">repl_backlog_histlen:55917</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> é‡å¯6379çš„æœåŠ¡</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é‡å¯ä¹‹åä¿¯é¦–ç§°è‡£</span></span><br><span class="line">[root@master bin]# redis-server kconfig/redis6379.conf </span><br><span class="line">[root@master bin]# redis-cli -p 6379</span><br><span class="line">127.0.0.1:6379&gt; ping</span><br><span class="line">PONG</span><br><span class="line">127.0.0.1:6379&gt; info relplication</span><br><span class="line">127.0.0.1:6379&gt; info replication</span><br><span class="line"><span class="meta">#</span><span class="bash"> Replication</span></span><br><span class="line">role:slave</span><br><span class="line">master_host:127.0.0.1</span><br><span class="line">master_port:6380</span><br><span class="line">master_link_status:up</span><br><span class="line">master_last_io_seconds_ago:2</span><br><span class="line">master_sync_in_progress:0</span><br><span class="line">slave_repl_offset:50522</span><br><span class="line">slave_priority:100</span><br><span class="line">slave_read_only:1</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_replid:12a540accf0c9347d3e45fad83ccddea86f3b3c3</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:50522</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:48596</span><br><span class="line">repl_backlog_histlen:1927</span><br></pre></td></tr></table></figure>



<h3 id="15-3-ğŸŒ ä¼˜ç‚¹"><a href="#15-3-ğŸŒ ä¼˜ç‚¹" class="headerlink" title="15.3 ğŸŒ ä¼˜ç‚¹"></a>15.3 ğŸŒ ä¼˜ç‚¹</h3><ul>
<li>å“¨å…µé›†ç¾¤ï¼ŒåŸºäºä¸»ä»å¤åˆ¶æ¨¡å¼ï¼Œç»§æ‰¿äº†ä¸»ä»çš„æ‰€æœ‰ä¼˜ç‚¹</li>
<li>ä¸»ä»å¯ä»¥åˆ‡æ¢ï¼Œæ•…éšœå¯ä»¥è½¬ç§»ï¼Œå¢å¼ºç³»ç»Ÿçš„å¯ç”¨æ€§</li>
<li>å“¨å…µæ¨¡å¼æ˜¯ä¸»ä»æ¨¡å¼çš„å‡çº§ç‰ˆï¼Œæ‰‹åŠ¨åˆ°è‡ªåŠ¨ï¼Œæ›´åŠ å¥å£®</li>
</ul>
<h3 id="15-4-ğŸ“°é…ç½®è¯¦è§£"><a href="#15-4-ğŸ“°é…ç½®è¯¦è§£" class="headerlink" title="15.4 ğŸ“°é…ç½®è¯¦è§£"></a>15.4 ğŸ“°é…ç½®è¯¦è§£</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> sentinel.conf</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å“¨å…µsentinelå®ä¾‹è¿è¡Œçš„ç«¯å£ï¼Œé»˜è®¤26379</span></span><br><span class="line">port 26379</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å®ˆæŠ¤è¿›ç¨‹ </span></span><br><span class="line">daemonize no</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿›ç¨‹æ–‡ä»¶</span></span><br><span class="line">pidfile &quot;/var/run/redis-sentinel.pid&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿›ç¨‹æ–‡ä»¶</span></span><br><span class="line">logfile &quot;&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å·¥ä½œç›®å½•</span></span><br><span class="line">dir &quot;/tmp&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å“¨å…µsentinelç›‘æ§çš„masterçš„IPå’ŒPort</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> quorumé…ç½®å¤šå°‘ä¸ªå“¨å…µç»Ÿä¸€è®¤ä¸ºmasterå¤±è”ã€‚é‚£ä¹ˆè¿™æ—¶å®¢è§‚ä¸Šè®¤ä¸ºä¸»ç»“ç‚¹å¤±è”</span></span><br><span class="line">sentinel monitor &lt;master-name&gt; &lt;master-ip&gt; &lt;redis-ip&gt; &lt;quorum&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åœ¨rediså®ä¾‹ä¸­å¼€å¯äº†æˆæƒå¯†ç </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¾ç½®å“¨å…µsentiçš„è¿æ¥å¯†ç </span></span><br><span class="line">sentinel auth-pass &lt;master-name&gt; &lt;password&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> é…ç½®æŒ‡å®šåœ¨å‘ç”Ÿfailoverä¸»ä»åˆ‡æ¢æ—¶æœ€å¤šå¯ä»¥æœ‰å¤šå°‘ä¸ªslaveåŒæ—¶å¯¹æ–°çš„masteråŒæ­¥</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> numreplicasè¶Šå°ï¼Œå®Œæˆfailoverçš„äº‹ä»¶å°±è¶Šé•¿</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> numreplicasè¶Šå¤§ï¼Œå°±æ„å‘³ç€è¶Šå¤šçš„slaveå› ä¸ºreplication(å¤åˆ¶)è€Œä¸å¯ç”¨</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> numreplicasè®¾ç½®ä¸º1ï¼Œä¿è¯æ¯æ¬¡åªæœ‰slaveå¤„äºä¸èƒ½å¤„ç†å‘½ä»¤è¯·æ±‚çš„çŠ¶æ€</span></span><br><span class="line">sentinel parallel-syncs &lt;master-name&gt; &lt;numreplicas&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> é…ç½®æŒ‡å®šå¤šmillisecondsæ¯«ç§’ä¹‹åï¼Œmasteræ²¡æœ‰å“åº”sentinel</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ­¤æ—¶ï¼Œå“¨å…µä¸»è§‚ä¸Šè®¤ä¸ºmasterä¸‹çº¿ï¼Œé»˜è®¤30ç§’</span></span><br><span class="line">sentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> é…ç½®æ•…éšœè½¬ç§»çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤2åˆ†é’Ÿ</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯ä»¥ç”¨äºä»¥ä¸‹æ–¹é¢</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1. åŒä¸€sentinelå¯¹åŒä¸€ä¸ªmasterä¸¤æ¬¡failo verçš„é—´éš”æ—¶é—´</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. å½“ä¸€ä¸ªslaveä»ä¸€ä¸ªé”™è¯¯çš„masteré‚£é‡ŒåŒæ­¥æ•°æ®å¼€å§‹è®¡ç®—æ—¶é—´ï¼Œç›´è‡³slaveè¢«çº æ­£ä¸ºå‘æ­£ç¡®çš„masteré‚£é‡ŒåŒæ­¥æ•°æ®</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. å½“æƒ³è¦å–æ¶ˆä¸€ä¸ªæ­£åœ¨è¿›è¡Œçš„failoveréœ€è¦çš„æ—¶é—´</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. å½“è¿›è¡Œfailoveræ—¶ï¼Œé…ç½®æ‰€æœ‰slavesæŒ‡å‘æ–°çš„masteræ‰€éœ€çš„æœ€å¤§æ—¶é—´</span></span><br><span class="line">sentinel failover-timeout &lt;master-name&gt; &lt;milliseconds&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> é€šçŸ¥è„šæœ¬</span></span><br><span class="line">sentinel notification-script &lt;master-name&gt; &lt;script-path&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å®¢æˆ·ç«¯é‡æ–°é…ç½®ä¸»èŠ‚ç‚¹å‚æ•°è„šæœ¬</span></span><br><span class="line">sentinel client-reconfig-script &lt;master-name&gt; &lt;script-path&gt;</span><br></pre></td></tr></table></figure>



<h2 id="16-ğŸ“©Redisç©¿é€ã€å‡»ç©¿å’Œé›ªå´©"><a href="#16-ğŸ“©Redisç©¿é€ã€å‡»ç©¿å’Œé›ªå´©" class="headerlink" title="16. ğŸ“©Redisç©¿é€ã€å‡»ç©¿å’Œé›ªå´©"></a>16. ğŸ“©Redisç©¿é€ã€å‡»ç©¿å’Œé›ªå´©</h2><h3 id="16-1-ğŸ”¥ç¼“å­˜ç©¿é€"><a href="#16-1-ğŸ”¥ç¼“å­˜ç©¿é€" class="headerlink" title="16.1 ğŸ”¥ç¼“å­˜ç©¿é€"></a>16.1 ğŸ”¥ç¼“å­˜ç©¿é€</h3><blockquote>
<p>ğŸ’­é—®é¢˜è¯´æ˜</p>
</blockquote>
<p>æŸ¥è¯¢çš„keyå¯¹åº”çš„æ•°æ®ä¸åœ¨redisç¼“å­˜ä¸­ï¼Œå³ç¼“å­˜æ²¡æœ‰å‘½ä¸­ï¼Œäºæ˜¯å‘æŒä¹…å±‚æ•°æ®åº“æŸ¥è¯¢ï¼Œæ•°æ®åº“ä¹Ÿæ²¡æœ‰ï¼Œå½“è¯·æ±‚é‡è¿‡å¤§çš„æ—¶å€™ï¼Œå¯èƒ½å‹å®æ•°æ®åº“ã€‚</p>
<p>å³å¤§é¢ç§¯çš„ç¼“å­˜å¤±æ•ˆï¼Œå¤§å¹¶å‘è¯·æ±‚æ‰“å´©DBã€‚</p>
<blockquote>
<p>ğŸ’–è§£å†³æ–¹æ³•</p>
</blockquote>
<p>1ï¸âƒ£<strong>å‚æ•°æ ¡éªŒ</strong></p>
<p>åœ¨æ¥å£å±‚å¢åŠ æ ¡éªŒï¼Œä¸åˆæ³•çš„å‚æ•°ç›´æ¥returnï¼Œæ¯”å¦‚id&lt;0ç›´æ¥æ‹¦æˆªã€‚</p>
<p>2ï¸âƒ£<strong>å¸ƒéš†è¿‡æ»¤å™¨</strong></p>
<p>åˆ©ç”¨é«˜æ•ˆçš„æ•°æ®ç»“æ„å’Œç®—æ³•å¿«é€Ÿåˆ¤æ–­å‡ºä½ è¿™ä¸ªKeyæ˜¯å¦åœ¨æ•°æ®åº“ä¸­å­˜åœ¨ï¼Œä¸å­˜åœ¨ä½ returnå°±å¥½äº†ï¼Œå­˜åœ¨ä½ å°±å»æŸ¥DBåˆ·æ–°KVå†returnã€‚</p>
<p>3ï¸âƒ£<strong>ç¼“å­˜ç©ºå¯¹è±¡</strong></p>
<p>å½“å­˜å‚¨å±‚ä¸å‘½ä¸­åï¼Œå³ä½¿è¿”å›çš„ç©ºå¯¹è±¡ä¹Ÿå°†å…¶ç¼“å­˜èµ·æ¥ï¼ŒåŒæ—¶ä¼šè®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œä¹‹åå†è®¿é—®è¿™ä¸ªæ•°æ®å°†ä¼šä»ç¼“å­˜ä¸­è·å–ï¼Œä¿æŠ¤æ•°æ®åº“ã€‚</p>
<h3 id="16-2-ğŸ’§ç¼“å­˜å‡»ç©¿"><a href="#16-2-ğŸ’§ç¼“å­˜å‡»ç©¿" class="headerlink" title="16.2 ğŸ’§ç¼“å­˜å‡»ç©¿"></a>16.2 ğŸ’§ç¼“å­˜å‡»ç©¿</h3><blockquote>
<p>ğŸ’­é—®é¢˜è¯´æ˜</p>
</blockquote>
<p>æŸ¥è¯¢çš„ä¸€ä¸ªkeyéå¸¸çƒ­ç‚¹ï¼Œåœ¨ä¸åœåœ°æ‰›ç€å¤§é‡çš„è¯·æ±‚ï¼Œå¤§å¹¶å‘é›†ä¸­å¯¹è¿™ä¸€ä¸ªç‚¹è¿›è¡Œè®¿é—®ï¼Œå½“è¿™ä¸ªkeyåœ¨å¤±æ•ˆçš„ç¬é—´ï¼ŒæŒç»­çš„å¤§å¹¶å‘ç›´æ¥è½åˆ°äº†æ•°æ®åº“ä¸Šï¼Œå°±åœ¨è¿™ä¸ªKeyçš„ç‚¹ä¸Šå‡»ç©¿äº†ç¼“å­˜ã€‚</p>
<p>å³å•ä¸ªkeyçš„ç¼“å­˜å¤±æ•ˆï¼Œå¤§å¹¶å‘è¯·æ±‚å‡»ç©¿redisç›´è½DBã€‚</p>
<blockquote>
<p>ğŸ’™è§£å†³æ–¹æ³•</p>
</blockquote>
<p>è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸï¼Œæˆ–è€…åŠ ä¸Šäº’æ–¥é”ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getData</span><span class="params">(String key)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">//ä»RedisæŸ¥è¯¢æ•°æ®</span></span><br><span class="line">        String result = getDataByKV(key);</span><br><span class="line">        <span class="comment">//å‚æ•°æ ¡éªŒ</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(result)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//è·å¾—é”</span></span><br><span class="line">                <span class="keyword">if</span> (reenLock.tryLock()) &#123;</span><br><span class="line">                    <span class="comment">//å»æ•°æ®åº“æŸ¥è¯¢</span></span><br><span class="line">                    result = getDataByDB(key);</span><br><span class="line">                    <span class="comment">//æ ¡éªŒ</span></span><br><span class="line">                    <span class="keyword">if</span> (StringUtils.isNotBlank(result)) &#123;</span><br><span class="line">                        <span class="comment">//æ’è¿›ç¼“å­˜</span></span><br><span class="line">                        setDataToKV(key, result);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//ç¡ä¸€ä¼šå†æ‹¿</span></span><br><span class="line">                    Thread.sleep(<span class="number">100L</span>);</span><br><span class="line">                    result = getData(key);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="comment">//é‡Šæ”¾é”</span></span><br><span class="line">                reenLock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h3 id="16-3-ğŸŒŠç¼“å­˜é›ªå´©"><a href="#16-3-ğŸŒŠç¼“å­˜é›ªå´©" class="headerlink" title="16.3 ğŸŒŠç¼“å­˜é›ªå´©"></a>16.3 ğŸŒŠç¼“å­˜é›ªå´©</h3><blockquote>
<p>ğŸ’­é—®é¢˜è¯´æ˜</p>
</blockquote>
<p>å½“redisæœåŠ¡å™¨é‡å¯æˆ–åˆ™å¤§é‡ç¼“å­˜é›†ä¸­åœ¨æŸä¸€ä¸ªæ—¶é—´æ®µå¤±æ•ˆï¼Œç¬é—´Redisè·Ÿæ²¡æœ‰ä¸€æ ·ï¼Œé‚£è¿™ä¸ªæ•°é‡çº§åˆ«çš„è¯·æ±‚ç›´æ¥æ‰“åˆ°æ•°æ®åº“å‡ ä¹æ˜¯ç¾éš¾æ€§çš„</p>
<blockquote>
<p>ğŸ’šè§£å†³æ–¹æ³•</p>
</blockquote>
<p>1ï¸âƒ£<strong>redisé«˜å¯ç”¨</strong></p>
<p>æ­å»ºé›†ç¾¤ï¼Œå¼‚åœ°å¤šæ´»</p>
<p>2ï¸âƒ£<strong>é™æµé™çº§</strong></p>
<p>åœ¨ç¼“å­˜å¤±æ•ˆåï¼Œé€šè¿‡åŠ é”æˆ–è€…é˜Ÿåˆ—å“æ§åˆ¶è¯»æ•°æ®åº“å†™ç¼“å­˜çš„çº¿ç¨‹æ•°é‡</p>
<p>3ï¸âƒ£<strong>æ•°æ®é¢„çƒ­</strong></p>
<p>åœ¨æ­£å¼éƒ¨ç½²ä¹‹å‰ï¼Œå…ˆæŠŠå¯èƒ½çš„æ•°æ®é¢„å…ˆè®¿é—®ä¸€éï¼Œè®©å¯èƒ½çš„æ•°æ®åŠ è½½åˆ°ç¼“å­˜ä¸­ã€‚</p>
<p>åœ¨å³å°†å‘ç”Ÿå¤§å¹¶å‘è®¿é—®å†™å…¥keyçš„æ—¶å€™ï¼Œè®¾ç½®ä¸åŒçš„ç¼“å­˜æ—¶é—´ï¼Œè®©ç¼“å­˜å¤±æ•ˆçš„æ—¶é—´ç‚¹å°½é‡å‡åŒ€ã€‚</p>
]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
        <tag>NoSQL</tag>
        <tag>Cache</tag>
      </tags>
  </entry>
</search>
